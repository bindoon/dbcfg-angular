(function(a){var c=this,b=this.Function,e=c[a],g=c.$,h=1,d=!0,f=Array.prototype.slice,i;for(i in{toString:1})d=null;d&&(d="hasOwnProperty,valueOf,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,constructor".split(","));b.prototype.overloadSetter=function(a){var b=this;return function(f,e){if(null==f)return this;if(a||"string"!==typeof f){for(var i in f)b.call(this,i,f[i]);if(d)for(var c=d.length;c--;)i=d[c],f.hasOwnProperty(i)&&b.call(this,i,f[i])}else b.call(this,f,e);return this}};b.prototype.overloadGetter=
function(a){var b=this;return function(f){var d,i;a||"string"!==typeof f?d=f:1<arguments.length&&(d=arguments);if(d){i={};for(var e=0;e<d.length;e++)i[d[e]]=b.call(this,d[e])}else i=b.call(this,f);return i}};b.prototype.traversalSetter=function(a){var b=this;return function(f,d,i){if(null==f||null==d)return f||this;f.length||(f=[f]);for(var e=0,o=f.length;e<o;e++)if(a||"string"!==typeof d)for(var c in d)b.call(this,f[e],c,d[c]);else b.call(this,f[e],d,i);return f.length?f:f[0]}};b.prototype.implement=
function(a,b){this.prototype[a]=b}.overloadSetter();b.implement({extend:function(a,b){this[a]=b}.overloadSetter(),hide:function(){this.$hidden=!0;return this},protect:function(){this.$protected=!0;return this}});b={namespace:function(){for(var b,f=arguments,d=this,e=0,i=f.length,c,o;e<i;e++)if(b=f[e],b.indexOf(".")){b=b.split(".");for(c=b[0]==a?1:0,o=b.length;c<o;c++)d[b[c]]=d[b[c]]||{},d=d[b[c]]}else d[b]=d[b]||{};return d},noop:function(){},now:function(){return+new Date},error:function(){},print:function(){},
random:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},resume:function(){g=c.$;c.$=c[a]=this;return this},retire:function(b){if(c.$===this)c.$=g;b&&c[a]===this&&(c[a]=e);return this},run:function(a){return a&&a.apply(c,[this].concat(f.call(arguments,1)))},uidOf:function(a){return a.uniqueNumber||(a.uniqueNumber=h++)}};b.ns=b.namespace;c[a]=c.$=b})("Klass");
(function(a){var c={},b=a.now(),e=/\{\s*\[native code\]\s*\}/,g=Object.prototype.toString,h=Object.prototype.hasOwnProperty,d=Array.prototype.slice,f=a.type=function(a){if(null==a)return""+a;if(a.$family)return a.$family();if(a.nodeName){if(1==a.nodeType)return"element";if(9==a.nodeType)return"document";if(3==a.nodeType)return/\S/.test(a.nodeValue)?"textnode":"whitespace"}else if("number"===typeof a.length){if(a.callee)return"arguments";if("item"in a)return"collection"}else if(a==a.window)return"window";
return typeof a};Function.from=function(a){return"function"===f(a)?a:function(){return a}};Array.from=function(b){return null==b?[]:a.isEnumerable(b)?"array"===f(b)?b:d.call(b):[b]};Number.from=function(a){a=parseFloat(a);return isFinite(a)?a:null};String.from=function(a){return a+""};Object.from=function(a,b){var d=f(a),e={};if("object"===d)return a;"string"===d&&(a=a.split(/[, ]+/));b=null==b?1:b;Array.from(a).forEach(function(a){e[a]=b});return e};var i=function(a){a=f(a.prototype);return c[a]||
(c[a]=[])},j=function(a,b){if(!b||!b.$hidden){for(var e=i(this),c=0;c<e.length;c++){var g=e[c];"defined"===f(g)?j.call(g,a,b):g.call(this,a,b)}e=this.prototype[a];if(null==e||!e.$protected)this.prototype[a]=b;null==this[a]&&"function"===f(b)&&m.call(this,a,function(a){return b.apply(a,d.call(arguments,1))})}},m=function(a,b){if(!b||!b.$hidden){var f=this[a];if(null==f||!f.$protected)this[a]=b}},l=a.Defined=function(b,d){if(b){var e=b.toLowerCase();a["is"+b]=function(a){return f(a)===e};if(null!=d)d.prototype.$family=
function(){return e}.hide()}if(null==d)return null;d.extend(this);return d};l.implement({implement:j.overloadSetter(),extend:m.overloadSetter(),alias:function(a,b){j.call(this,a,this.prototype[b])}.overloadSetter(),mirror:function(a){i(this).push(a);return this}});var k=function(a,b,f){var d=b!=Object,e=b.prototype;d&&(b=new l(a,b));for(var a=0,i=f.length;a<i;a++){var c=f[a],g=b[c],j=e[c];g&&g.protect();d&&j&&(delete e[c],e[c]=j.protect())}d&&b.implement(e);return k};k("String",String,"charAt,charCodeAt,concat,contains,indexOf,lastIndexOf,match,quote,replace,repeat,search,slice,split,substr,substring,trim,toLowerCase,toUpperCase".split(","))("Array",
Array,"pop,push,reverse,shift,sort,splice,unshift,concat,join,slice,indexOf,lastIndexOf,filter,forEach,every,map,some,reduce,reduceRight".split(","))("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",Function,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,"create,defineProperty,defineProperties,keys,getPrototypeOf,getOwnPropertyDescriptor,getOwnPropertyNames,preventExtensions,isExtensible,seal,isSealed,freeze,isFrozen".split(","))("Date",
Date,["now"]);new l("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();var n=function(a){switch(f(a)){case "array":return a.clone();case "object":return Object.clone(a);default:return a}},p=function(a,b,d){switch(f(d)){case "object":"object"===f(a[b])?Object.merge(a[b],d):a[b]=Object.clone(d);break;case "array":a[b]=d.clone();break;default:a[b]=d}return a};Array.implement({forEach:function(a,b){for(var d=0,f=this.length;d<f;d++)d in this&&a.call(b,
this[d],d,this)},each:function(a,b){Array.forEach(this,a,b);return this},clone:function(){for(var a=this.length,b=Array(a);a--;)b[a]=n(this[a]);return b}});Object.extend=m.overloadSetter();Object.extend({forEach:function(a,b,d){for(var f in a)h.call(a,f)&&b.call(d,a[f],f,a)},map:function(a,b,d){var f={},e;for(e in a)h.call(a,e)&&(f[e]=b.call(d,a[e],e,a));return f},merge:function(a,b,d){if("string"===typeof b)return p(a,b,d);for(var f=1,e=arguments.length;f<e;f++){var i=arguments[f],c;for(c in i)p(a,
c,i[c])}return a},clone:function(a){var b={},d;for(d in a)b[d]=n(a[d]);return b},append:function(a){for(var b=1,d=arguments.length;b<d;b++){var f=arguments[b]||{},e;for(e in f)a[e]=f[e]}return a}});Object.each=Object.forEach;["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(a){new l(a)});Object.append(a,{declare:function(a,b){var d=this.namespace(a);return"function"===typeof b?this.run(b,d):Object.append(d,b)},each:function(a,b,d){return a.each?a.each(b,d):Object.each(a,b,
d)},map:function(a,b,d){return a.map?a.map(b,d):Object.map(a,b,d)},isEnumerable:function(a){return null!=a&&"string"!==typeof a&&"number"===typeof a.length&&"[object Function]"!==g.call(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isEmptyObject:function(a){for(var b in a)return!1;return!0},isinstance:function(a,b){if(null==a)return!1;for(var d=a.$constructor||a.constructor;d;){if(d===b)return!0;d=d.parent}return a instanceof
b},isNativeCode:function(a){return e.test(""+a)},pick:function(a,b,d){var f=this.type(d),e=function(d){!a[d]&&d in b&&(a[d]=b[d]);return a};if(!b||!a)return null;if("string"===f)return e(d);if("array"===f)for(var i=0,c=d.length;i<c;i++)a=e(d[i]);if("object"===f)for(var g in d)a=e(d[g]);return a},uniqueID:function(){return(b++).toString(36)}})})(Klass);
Array.implement({every:function(a,c){for(var b=0,e=this.length>>>0;b<e;b++)if(b in this&&!a.call(c,this[b],b,this))return!1;return!0},filter:function(a,c){for(var b,e=[],g=0,h=this.length>>>0;g<h;g++)g in this&&(b=this[g],a.call(c,b,g,this)&&e.push(b));return e},indexOf:function(a,c){for(var b=this.length>>>0,e=0>c?Math.max(0,b+c):c||0;e<b;e++)if(this[e]===a)return e;return-1},map:function(a,c){for(var b=this.length>>>0,e=Array(b),g=0;g<b;g++)g in this&&(e[g]=a.call(c,this[g],g,this));return e},some:function(a,
c){for(var b=0,e=this.length>>>0;b<e;b++)if(b in this&&a.call(c,this[b],b,this))return!0;return!1},invoke:function(a){var c=Array.slice(arguments,1);return this.map(function(b){return b[a].apply(b,c)})},clean:function(){return this.filter(function(a){return null!=a})},contains:function(a,c){return-1!=this.indexOf(a,c)},append:function(a){this.push.apply(this,a);return this},getLast:function(){return this.length?this[this.length-1]:null},include:function(a){this.contains(a)||this.push(a);return this},
erase:function(a){for(var c=this.length;c--;)this[c]===a&&this.splice(c,1);return this},empty:function(){this.length=0;return this},flatten:function(){for(var a=[],c=0,b=this.length;c<b;c++){var e=Klass.type(this[c]);"null"!==e&&(a=a.concat("array"===e||"collection"===e||"arguments"===e||Klass.isinstance(this[c],Array)||Klass.isinstance(this[c],Klass)?Array.flatten(this[c]):this[c]))}return a},pick:function(){for(var a=0,c=this.length;a<c;a++)if(null!=this[a])return this[a];return null},hexToRgb:function(a){if(3!=
this.length)return null;var c=this.map(function(a){1==a.length&&(a+=a);return parseInt(a,16)});return a?c:"rgb("+c+")"},rgbToHex:function(a){if(3>this.length)return null;if(4==this.length&&0==this[3]&&!a)return"transparent";for(var c=[],b=0;3>b;b++){var e=(this[b]-0).toString(16);c.push(1==e.length?"0"+e:e)}return a?c:"#"+c.join("")}});
String.implement({contains:function(a,c){return-1<(c?(""+this).slice(c):""+this).indexOf(a)},repeat:function(a){a=parseInt(a,10);return 0<a?Array(a+1).join(this):""},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,
function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},hexToRgb:function(a){var c=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return c?c.slice(1).hexToRgb(a):null},rgbToHex:function(a){var c=this.match(/\d{1,3}/g);return c?c.rgbToHex(a):null},substitute:function(a,c){return this.replace(c||/\\?\{([^{}]+)\}/g,function(b,e){return"\\"==b.charAt(0)?b.slice(1):null!=a[e]?a[e]:""})}});
Function.extend({attempt:function(){for(var a=0,c=arguments.length;a<c;a++)try{return arguments[a]()}catch(b){}return null}});
Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a))}catch(b){}return null},bind:function(a){var c=this,b=1<arguments.length?Array.slice(arguments,1):null,e=function(){},g=function(){var h=a,d=arguments.length;if(this instanceof g)e.prototype=c.prototype,h=new e;d=!b&&!d?c.call(h):c.apply(h,b&&d?b.concat(Array.slice(arguments)):b||arguments);return h==a?d:h};return g},pass:function(a,c){var b=this;null!=a&&(a=Array.from(a));return function(){return b.apply(c,a||arguments)}},
delay:function(a,c,b){return setTimeout(this.pass(null==b?[]:b,c),a)},periodical:function(a,c,b){return setInterval(this.pass(null==b?[]:b,c),a)}});
(function(a){var c={},a=a.DOMEvent=new a.Defined("DOMEvent",function(a,e){e||(e=window);var g=e.document,a=a||e.event;if(a.$extended)return a;this.$extended=!0;this.event=a;this.shift=a.shiftKey;this.control=a.ctrlKey;this.alt=a.altKey;this.meta=a.metaKey;this.client={};this.page={};for(var h=this.type=a.type,d=this.target=a.target||a.srcElement;d&&3==d.nodeType;)d=d.parentNode;if(0==h.indexOf("key")){g=this.code=a.which||a.keyCode;this.key=c[g];if("keydown"===h)if(111<g&&124>g)this.key="f"+(g-111);
else if(95<g&&106>g)this.key=g-96;if(null==this.key)this.key=String.fromCharCode(g).toLowerCase()}else if("click"===h||"dblclick"===h||"contextmenu"===h||"DOMMouseScroll"===h||0==h.indexOf("mouse")){g=!g.compatMode||"CSS1Compat"==g.compatMode?g.html:g.body;this.page={x:null!=a.pageX?a.pageX:a.clientX+g.scrollLeft,y:null!=a.pageY?a.pageY:a.clientY+g.scrollTop};this.client={x:null!=a.pageX?a.pageX-e.pageXOffset:a.clientX,y:null!=a.pageY?a.pageY-e.pageYOffset:a.clientY};if("DOMMouseScroll"==h||"mousewheel"==
h)this.wheel=a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3;this.rightClick=3==a.which||2==a.button;if("mouseover"==h||"mouseout"==h){for(h=a.relatedTarget||a[("mouseover"==h?"from":"to")+"Element"];h&&3==h.nodeType;)h=h.parentNode;this.relatedTarget=h}}else if(0==h.indexOf("touch")||0==h.indexOf("gesture"))if(this.rotation=a.rotation,this.scale=a.scale,this.targetTouches=a.targetTouches,this.changedTouches=a.changedTouches,(h=this.touches=a.touches)&&h[0])h=h[0],this.page={x:h.pageX,y:h.pageY},this.client=
{x:h.clientX,y:h.clientY}});a.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0;return this},preventDefault:function(){this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1;return this}});a.defineKey=function(a,e){c[a]=e;return this};a.defineKeys=a.defineKey.overloadSetter(!0);a.defineKeys({38:"up",40:"down",37:"left",39:"right",27:"esc",
32:"space",8:"backspace",9:"tab",46:"delete",13:"enter"})})(Klass);
(function(a){var c=this.Class=new a.Defined("Class",function(d){a.isinstance(d,Function)&&(d={initialize:d});var f=function(){e(this);if(f.$prototyping)return this;this.$caller=null;var a=this.initialize?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return a}.extend(this).implement(d);f.$constructor=c;f.prototype.$constructor=f;f.prototype.parent=b;return f}),b=function(){if(!this.$caller)throw Error('The method "parent" cannot be called.');var a=this.$caller.$name,b=this.$caller.$owner.parent,
b=b?b.prototype[a]:null;if(!b)throw Error('The method "'+a+'" has no parent.');return b.apply(this,arguments)},e=function(b){for(var f in b){var i=b[f];switch(a.type(i)){case "object":var c=function(){};c.prototype=i;b[f]=e(new c);break;case "array":b[f]=i.clone()}}return b},g=function(a,b,e){if(e.$origin)e=e.$origin;var c=function(){if(e.$protected&&null==this.$caller)throw Error('The method "'+b+'" cannot be called.');var a=this.caller,d=this.$caller;this.caller=d;this.$caller=c;var g=e.apply(this,
arguments);this.$caller=d;this.caller=a;return g}.extend({$owner:a,$origin:e,$name:b});return c},h=function(b,f,e){if(c.Mutators.hasOwnProperty(b)&&(f=c.Mutators[b].call(this,f),null==f))return this;if("function"===a.type(f)){if(f.$hidden)return this;this.prototype[b]=e?f:g(this,b,f)}else Object.merge(this.prototype,b,f);return this};c.implement("implement",h.overloadSetter());c.Mutators={Extends:function(a){this.parent=a;a.$prototyping=!0;var b=new a;delete a.$prototyping;this.prototype=b},Implements:function(a){Array.from(a).each(function(a){var a=
new a,b;for(b in a)h.call(this,b,a[b],!0)},this)}}})(Klass);
(function(a){Class.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):!1},clearChain:function(){this.$chain.empty();return this}});var c=function(a){return a.replace(/^on([A-Z])/,function(a,b){return b.toLowerCase()})};Class.Events=new Class({$events:{$stop:[],$pause:[]},addEvent:function(a,e,g){a=c(a);this.$events[a]=(this.$events[a]||[]).include(e);if(g)e.internal=
!0;return this},addEvents:function(a){for(var e in a)this.addEvent(e,a[e]);return this},pauseEvent:function(a){a=c(a);this.$events.$pause.include(a);return this},restartEvent:function(a){a=c(a);a=this.$events.$pause.indexOf(a);-1!==a&&delete this.$events.$pause[a];return this},fireEvent:function(a,e,g){var a=c(a),h=this.$events[a],a=this.$events.$pause.contains(a);if(!h||a)return this;e=Array.from(e);h.each(function(a){g?a.delay(g,this,e):a.apply(this,e)},this);return this},removeEvent:function(a,
e){var a=c(a),g=this.$events[a];if(g&&!e.internal){var h=g.indexOf(e);-1!=h&&delete g[h]}return this},removeEvents:function(b){var e;if("object"===a.type(b)){for(e in b)this.removeEvent(e,b[e]);return this}b&&(b=c(b));for(e in this.$events)if(!(b&&b!=e))for(var g=this.$events[e],h=g.length;h--;)h in g&&this.removeEvent(e,g[h]);return this}});Class.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent)for(var e in b)"function"===
a.type(b[e])&&/^on[A-Z]/.test(e)&&(this.addEvent(e,b[e]),delete b[e]);return this}})})(Klass);Class.Occlude=new Class({occlude:function(a,c){var c=document.node(c||this.element),b=c.retrieve(a||this.property);if(b&&!this.occluded)return this.occluded=b;this.occluded=!1;c.store(a||this.property,this);return this.occluded}});
(function(a,c){var b=a.document;b.window=a;var e=navigator.userAgent.toLowerCase(),g=navigator.platform.toLowerCase(),h=e.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d="ie"==h[1]&&b.documentMode,f=c.env={air:!!a.runtime,browser:"version"==h[1]?h[3]:h[1],version:d||parseFloat("opera"==h[1]&&h[4]?h[4]:h[2]),engine:(e.match(/(trident|gecko|webkit|presto)/)||["ie"==h[1]&&"trident"||"unknown"])[0],platform:e.match(/ip(?:ad|od|hone)/)?
"ios":(e.match(/(?:webos|android)/)||g.match(/mac|win|linux/)||["other"])[0]};f[f.browser]=!0;f[f.browser+parseInt(f.version,10)]=!0;f[f.platform]=!0;f[f.engine]=!0;if(d)f.mode=!!d;f.xhr=function(){var a=function(){return new XMLHttpRequest},b=function(){return new ActiveXObject("MSXML2.XMLHTTP")},d=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){a();return a},function(){b();return b},function(){d();return d})}();f.exec=function(d){if(!d)return d;if(a.execScript)a.execScript(d);
else{var f=b.createElement("script");f.setAttribute("type","text/javascript");f.text=d;b.head.appendChild(f);b.head.removeChild(f)}return d};String.implement("stripScripts",function(a){var b="",d=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(a,d){b+=d+"\n";return""});!0===a?f.exec(b):"function"===typeof a&&a(b,d);return d})})(window,Klass);
(function(a){var c=navigator.userAgent.toLowerCase().match(/(maxthon|traveler|theworld|greenbrowser|360se|se|version)[\)\s\/:]([\w\d\.]+)?.*?/)||[null,"unknown",0],b="version"===c[1]?c[3]:"360se"===c[1]?"se360":c[1],c=c[2];if("unknown"!==b)a.shell=b,a[b]=!0;c&&(a[b+parseInt(c,10)]=!0)})(Klass.env);
(function(a,c,b){function e(){if(!h.isReady){try{g.documentElement.doScroll("left")}catch(a){setTimeout(e,1);return}h.ready()}}var g=a.document,h=function(a,b){return new h.node.init(a,b,d)},d,f=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,i=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,j=[],m=!1,l,k=Array.prototype.push,n=Array.prototype.slice;h.node=h.prototype={constructor:h,extend:Function.prototype.extend,init:function(a,d,e){var c;if(!a)return this;if(a.nodeType)return this.context=this[0]=this.uidOf(a),this.length=
1,this;if("body"===a&&!d&&g.body)return this[0]=this.uidOf(g.body),this.context=g,this.selector="body",this.length=1,this;if("string"===typeof a){if((c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?[null,a,null]:f.exec(a))&&(c[1]||!d)){if(c[1])return e=(d=d instanceof h?d[0]:d)?d.ownerDocument||d:g,e=9===e.nodeType?e:g,a=(a=i.exec(a))?h.isObject(d)?[h.dom.newElement(a[1],d,e)]:[e.createElement(a[1])]:h.dom.create(c[1],h.isObject(d)?d:null,e),this.merge(a);if((d=g.getElementById(c[2]))&&
d.parentNode){if(d.id!==c[2])return e.find(a);this.length=1;this[0]=this.uidOf(d)}this.element=d;this.context=g;this.selector=a;return this}return!d||d.version?(d||e).find(a):this.constructor(d).find(a)}if(h.isFunction(a))return e.ready(a);if(a.selector!==b)this.selector=a.selector,this.context=a.context;return this.merge(a)},selector:"",length:0,len:function(){return this.length},eq:function(a){return this.slice(a,-1===a?b:+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},
end:function(){return this.prevObject||this.constructor(null)},slice:function(){return this.stack(n.apply(this,arguments),"slice",n.call(arguments).join(""))},map:function(a){var d=n.call(arguments,1);return this.stack(Array.map(this,function(b){return a.apply(b,[b].concat(d))}).flatten())},stack:function(a,d,b){var f=this.constructor();h.isArray(a)?k.apply(f,a):f.push(a);f.prevObject=this;f.context=this.context;if("find"===d)f.selector=this.selector+(this.selector?" ":"")+b;else if(d)f.selector=
this.selector+"."+d+"("+b+")";return f},each:function(a,d){for(var b=0,f=this.length;b<f;b++)b in this&&a.call(d||this[b],b,this[b],this);return this},ready:function(a){h.bindReady();h.isReady?a.call(g,h):j&&j.push(a)},uidOf:function(a){if(a===b)for(var d=0,f=this.length;d<f;d++)h.uidOf(this[d]);else h.uidOf(a);return a||this},sort:[].sort,splice:[].splice,merge:function(a){if(null!=a)if(!h.isEnumerable(a)||h.isWindow(a))k.call(this,a);else for(var d=0,b=a.length;d<b;d++)this.push(a[d]);return this},
push:function(){for(var a=this.length,d=0,b=arguments.length;d<b;d++){var f=arguments[d];f&&(this[a++]=f)}return this.length=a}};h.node.init.prototype=h.node;h.extend({isReady:!1,readyWait:1,holdReady:function(a){a?h.readyWait++:h.ready(!0)},ready:function(a){if(!0===a&&!--h.readyWait||!0!==a&&!h.isReady){if(!g.body)return setTimeout(h.ready,1);h.isReady=!0;if(!(!0!==a&&0<--h.readyWait)&&j){var d=0,b=j;for(j=null;a=b[d++];)a.call(g,Klass)}}},bindReady:function(){if(!m){m=!0;if("complete"===g.readyState)return setTimeout(h.ready,
1);if(g.addEventListener)g.addEventListener("DOMContentLoaded",l,!1),a.addEventListener("load",h.ready,!1);else if(g.attachEvent){g.attachEvent("onreadystatechange",l);a.attachEvent("onload",h.ready);var d=!1;try{d=null==a.frameElement}catch(b){}g.documentElement.doScroll&&d&&e()}}},exec:function(a,d,f,e,c){var i,g=a.length;if("object"===typeof d){for(i in d)h.exec(a,i,d[i],e,c);return a}c===b&&(c=e);if(f!==b){i=h.isFunction(f);for(var j=0,m;j<g;j++)m=a[j],e(m,d,i?f.call(m,j,c(m,d)):f);return a}return g?
c(a[0],d):b}});h.extend(c);d=h(g);l=g.addEventListener?function(){g.removeEventListener("DOMContentLoaded",l,!1);h.ready()}:function(){"complete"===g.readyState&&(g.detachEvent("onreadystatechange",l),h.ready())};a.Klass=a.$=h})(window,Klass);
(function(a,c){var b=c.support={xhr:!!c.env.xhr,xpath:!!document.evaluate,query:!!document.querySelector,json:!!a.JSON,plugins:{}},e=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")})||"0 r0").match(/\d+/g);b.plugins.Flash={version:Number(e[0]||"0."+e[1])||0,build:Number(e[2])||0}})(window,Klass);
(function(a,c){var b=a.createElement("div"),e,g,h,d,f,i,j;b.setAttribute("className","t");b.innerHTML='   <link/><table></table><a href="/a">a</a><input type="checkbox"/>';e=b.getElementsByTagName("*");g=b.getElementsByTagName("a")[0];g.style.cssText="top:1px;float:left;opacity:.5";if(e&&e.length){h=a.createElement("select");d=h.appendChild(a.createElement("option"));e=b.getElementsByTagName("input")[0];j=c.support=Object.append(c.support,{leadingWhitespace:3===b.firstChild.nodeType,tbody:!b.getElementsByTagName("tbody").length,
htmlSerialize:!!b.getElementsByTagName("link").length,style:/top/.test(g.getAttribute("style")),hrefNormalized:"/a"===g.getAttribute("href"),opacity:/^0.5/.test(g.style.opacity),cssFloat:!!g.style.cssFloat,checkOn:"on"===e.value,selected:d.selected,getSetAttribute:"t"!==b.className,enctype:!!a.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==a.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===a.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,
noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1});e.checked=!0;j.noCloneChecked=e.cloneNode(!0).checked;h.disabled=!0;j.optionDisabled=!d.disabled;try{delete b.test}catch(m){j.deleteExpando=!1}!b.addEventListener&&b.attachEvent&&b.fireEvent&&(b.attachEvent("onclick",g=function(){j.noCloneEvent=!1}),b.cloneNode(!0).fireEvent("onclick"),b.detachEvent("onclick",g));g=a.createElement("div");b.style.height="0";b.appendChild(g);
j.brokenOffsetParent=g.offsetParent===b;e=a.createElement("input");e.value="t";e.setAttribute("type","radio");j.radioValue="t"===e.value;e.setAttribute("checked","checked");e.setAttribute("name","t");b.appendChild(e);g=a.createDocumentFragment();g.appendChild(b.lastChild);j.checkClone=g.cloneNode(!0).cloneNode(!0).lastChild.checked;j.appendChecked=e.checked;g.removeChild(e);g.appendChild(b);if(b.attachEvent)for(f in{submit:1,change:1,focusin:1})e="on"+f,i=e in b,i||(b.setAttribute(e,"return;"),i=
"function"===typeof b[e]),j[f+"Bubbles"]=i;c(function(){var d,b,f,e=a.getElementsByTagName("body")[0];if(e){d=a.createElement("div");d.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";e.insertBefore(d,e.firstChild);b=a.createElement("div");d.appendChild(b);b.style.position="fixed";b.style.top="20px";j.fixedPosition=20===b.offsetTop;b.style.position=b.style.top="";b.innerHTML="<table><tr><td></td><td>t</td></tr></table>";f=b.getElementsByTagName("td");
f[0].style.cssText="padding:0;margin:0;border:0;display:none";i=0===f[0].offsetHeight;f[0].style.display="";f[1].style.display="none";j.reliableHiddenOffsets=i&&0===f[0].offsetHeight;b.innerHTML="";b.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";j.boxSizing=4===b.offsetWidth;j.doesNotIncludeMarginInBodyOffset=1!==e.offsetTop;if(window.getComputedStyle)j.pixelPosition=
"1%"!==(window.getComputedStyle(b,null)||{}).top,j.boxSizingReliable="4px"===(window.getComputedStyle(b,null)||{width:"4px"}).width,f=a.createElement("div"),f.style.cssText=b.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",b.style.width="1px",b.appendChild(f),j.reliableMarginRight=!parseFloat((window.getComputedStyle(f,null)||{}).marginRight);if("undefined"!==typeof b.style.zoom)b.innerHTML="",b.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",
j.inlineBlockNeedsLayout=3===b.offsetWidth,b.style.display="block",b.style.overflow="visible",b.innerHTML="<div></div>",b.firstChild.style.width="5px",j.shrinkWrapBlocks=3!==b.offsetWidth,d.style.zoom=1;e.removeChild(d)}});g.removeChild(b);b=e=g=h=d=e=g=g=null}})(document,Klass);
(function(a,c){var b=c.documentElement,e=Function.prototype.extend,g=Object.prototype.toString;a.dom={isXML:function(a){a=a?a.ownerDocument||a:0;return!!a.xmlVersion||!!a.xml||"[object XMLDocument]"===g.call(a)||9===a.nodeType&&"HTML"!==a.documentElement.nodeName},contains:b&&a.isNativeCode(b.contains)?function(a,b){return a.contains(b)}:b&&b.compareDocumentPosition?function(a,b){return a===b||!!(a.compareDocumentPosition(b)&16)}:function(a,b){if(b){do if(b===a)return!0;while(b=b.parentNode)}return!1},
equals:function(a,b){return!(!a||!(b&&a===b))},extend:e,id:function(){var b={string:function(a,d){var f=d.getElementById(a);return f?b.element(f):null},element:function(b){a.uidOf(b);return b},object:function(a,d){var f=a.toElement?a.toElement(d):a[0]&&1===a[0].nodeType?a[0]:null;return f&&b.element(f)}};b.textnode=b.whitespace=b.window=b.document=function(a){return a};return function(d,f){if(d&&d.uniqueNumber)return d;var e=a.type(d);return b[e]?b[e](d,f||c):null}}(),getWindow:function(b){b=b.ownerDocument?
b.ownerDocument:b;return a.isWindow(b)?b:9===b.nodeType?b.defaultView||b.parentWindow:null},getDocument:function(a){a=a||c;return a.ownerDocument||a.document||a},nodeName:function(a,b){return a&&a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()}};c.html=b;if(!c.head)c.head=c.getElementsByTagName("head")[0];if(c.execCommand)try{c.execCommand("BackgroundImageCache",!1,!0)}catch(h){}if(this.attachEvent&&!this.addEventListener){var d=function(){this.detachEvent("onunload",d);c.head=c.html=c.window=
null};this.attachEvent("onunload",d)}var f=Array.from;try{f(c.html.childNodes)}catch(i){Array.from=function(b){if(a.isEnumerable(b)&&"array"!==a.type(b)){for(var d=b.length,e=Array(d);d--;)e[d]=b[d];return e}return f(b)};var j=Array.prototype,m=j.slice;"pop,push,reverse,shift,sort,splice,unshift,concat,join,slice".split(",").each(function(a){var b=j[a];Array[a]=function(a){return b.apply(Array.from(a),m.call(arguments,1))}})}})(Klass,document);
Klass.run(function(a,c){a.dom.extend({data:function(a,e,g){if(e===c)return this.retrieve(a);e="data-"+e;if(g===c)return this.getProperty(a,e)||this.retrieve(a,e);null===g?(this.removeProperty(a,e),this.eliminate(a,e)):("string"===typeof g&&this.setProperty(a,e,g),this.store(a,e,g));return this},removeData:function(a,e){return this.data(a,e,null)}})});
Klass.dom.extend({hasClass:function(a,c){return(" "+a.className.clean()+" ").contains(" "+c+" ")},addClass:function(a,c){if(!this.hasClass(a,c))a.className=(a.className+" "+c).clean();return this},removeClass:function(a,c){a.className=a.className.replace(RegExp("(^|\\s)"+c+"(?:\\s|$)"),"$1");a.className||a.removeAttribute("class");return this},toggleClass:function(a,c,b){null==b&&(b=!this.hasClass(a,c));return b?this.addClass(a,c):this.removeClass(a,c)},swapClass:function(a,c,b){return this.removeClass(a,
c).addClass(a,b)}});
(function(a,c){var b,e,g=c.documentElement,h=c.createElement("div"),d=c.body||c.getElementsByTagName("body")[0]||g,f={"class":function(){return this.getAttribute("class")||this.className},"for":function(){return"htmlFor"in this?this.htmlFor:this.getAttribute("for")},href:function(){return"href"in this?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return this.style?this.style.cssText:this.getAttribute("style")},tabindex:function(){var a=this.getAttributeNode("tabindex");return a&&
a.specified?a.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var a=this.getAttributeNode("maxLength");return a&&a.specified?a.nodeValue:null}};f.MAXLENGTH=f.maxLength=f.maxlength;d.appendChild(h);try{h.innerHTML='<a id="klass_uniqueid"></a>',b=!!c.getElementById("klass_uniqueid")}catch(i){}if(b)try{h.innerHTML='<form action="s"><input id="action"/></form>',e="s"!=h.firstChild.getAttribute("action")}catch(j){}d.removeChild(h);h=d=null;a.dom.extend({getAttribute:e?
function(a,b){var d=f[b];return d?d.call(a):(d=a.getAttributeNode(b))?d.nodeValue:null}:function(a,b){var d=f[b];return d?d.call(a):a.getAttribute(b)},hasAttribute:g&&a.isNativeCode(g.hasAttribute)?function(a,b){return a.hasAttribute(b)}:function(a,b){a=a.getAttributeNode(b);return!(!a||!a.specified&&!a.nodeValue)},defineAttributeGetter:function(a,b){f[a]=b;return this},lookupAttributeGetter:function(a){return f[a]}})})(Klass,document);
Klass.run(function(a,c){var b=a.dom,e={},g={},h={html:"innerHTML",text:null==c.createElement("div").textContent?"innerText":"textContent"};Array.forEach("type,value,defaultValue,accessKey,cellPadding,cellSpacing,colSpan,frameBorder,rowSpan,tabIndex,useMap".split(","),function(a){h[a.toLowerCase()]=a});Object.forEach(h,function(a,b){g[b]=function(b,d){b[a]=d};e[b]=function(b){return b[a]}});Array.forEach("compact,nowrap,ismap,declare,noshade,checked,disabled,readOnly,multiple,selected,noresize,defer,defaultChecked,autofocus,controls,autoplay,loop".split(","),
function(a){var b=a.toLowerCase();g[b]=function(b,d){b[a]=!!d};e[b]=function(b){return!!b[a]}});Object.append(g,{"class":function(a,b){"className"in a?a.className=b||"":a.setAttribute("class",b)},"for":function(a,b){"htmlFor"in a?a.htmlFor=b:a.setAttribute("for",b)},style:function(a,b){a.style?a.style.cssText=b:a.setAttribute("style",b)},value:function(a,b){a.value=null!=b?b:""}});e["class"]=function(a){return"className"in a?a.className||null:a.getAttribute("class")};var d=c.createElement("button");
try{d.type="button"}catch(f){}if("button"!==d.type)g.type=function(a,b){a.setAttribute("type",b)};var i=function(a){a.random="attribute";return"attribute"===a.getAttribute("random")}(c.createElement("div"));if(i)var j={};b.extend({set:function(a,d,f){var e=b.hooks[d];e&&e.set?e.set.call(a,f):this.setProperty(a,d,f)}.traversalSetter(),get:function(a,d){var f=b.hooks[d];return f&&f.get?f.get.apply(a):this.getProperty(a,d)},erase:function(a,d){var f=b.hooks[d];f&&f.erase?f.erase.apply(a):this.removeProperty(a,
d);return this},setProperty:function(a,b,d){var f;null==d?a.removeAttribute(b):(f=g[b.toLowerCase()])?f(a,d):(a.setAttribute(b,d),i&&(j[b]=!0));return this},getProperty:function(a,d){var f=e[d.toLowerCase()];if(f)return f(a);if(i&&!j[d]&&!a.getAttributeNode(d))return null;f=b.getAttribute(a,d);return!f&&!b.hasAttribute(a,d)?null:f},removeProperty:function(a,b){return this.setProperty(a,b,null)}})},document);
Klass.run(function(a,c){var b=a.dom,e=b.hooks={};e.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};e.tag={get:function(){return this.tagName.toLowerCase()}};e.html={set:function(b){null==b?b="":"array"===a.type(b)&&(b=b.join(""));this.innerHTML=b},erase:function(){this.innerHTML=""}};var g=c.createElement("div");g.innerHTML="<nav></nav>";var h=1==g.childNodes.length;if(!h)for(var g="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" "),
d=c.createDocumentFragment(),f=g.length;f--;)d.createElement(g[f]);g=null;g=Function.attempt(function(){c.createElement("table").innerHTML="<tr><td></td></tr>";return!0});f=c.createElement("tr");f.innerHTML="<td></td>";var i="<td></td>"==f.innerHTML,f=null;if(!g||!i||!h)e.html.set=function(a){var f={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};f.thead=f.tfoot=f.tbody;return function(e){var i=
f[b.get(this,"tag")];!i&&!h&&(i=[0,"",""]);if(!i)return a.call(this,e);var g=i[0],j=c.createElement("div"),q=j;h||d.appendChild(j);for(j.innerHTML=[i[1],e,i[2]].flatten().join("");g--;)q=q.firstChild;b.empty(this).adopt(this,q.childNodes);h||d.removeChild(j)}}(e.html.set);g=c.createElement("form");g.innerHTML="<select><option>s</option></select>";var j=b.getSelected=function(a){return Array.from(a.options).filter(function(a){return a.selected})};if("s"!==g.firstChild.value)e.value={set:function(a){if("select"!==
b.get(this,"tag"))return b.setProperty(this,"value",a);for(var d=this.getElementsByTagName("option"),f=0,e=d.length;f<e;f++){var c=d[f],i=c.getAttributeNode("value");if((i&&i.specified?c.value:b.get(c,"text"))==a)return c.selected=!0}},get:function(){var a=this,d=b.get(this,"tag");if("select"!==d&&"option"!==d)return b.getProperty(this,"value");return"select"===d&&!(a=j(a)[0])?"":(d=a.getAttributeNode("value"))&&d.specified?a.value:b.get(a,"text")}};g=null;if(c.createElement("div").getAttributeNode("id"))e.id=
{set:function(a){this.id=this.getAttributeNode("id").value=a},get:function(){return this.id||null},erase:function(){this.id=this.getAttributeNode("id").value=""}}},document);
Klass.run(function(a){var c=a.dom,b=this,e=this.document,g=/<|&#?\w+;/,h=e.createDocumentFragment(),d={},f={},i=function(a){return f[a]||(f[a]={})},j=function(a){var b=a.uniqueNumber;c.removeEvents&&c.removeEvents(a);a.clearAttributes&&a.clearAttributes();null!=b&&(delete d[b],delete f[b]);return a},m={input:"checked",option:"selected",textarea:"value"},l;try{l="x"==e.createElement("<input name=x>").name}catch(k){}var n=function(a){return(""+a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};c.extend({newElement:function(a,
b,d){d=c.getDocument(d);if(b&&null!=b.checked)b.defaultChecked=b.checked;l&&b&&(a="<"+a,b.name&&(a+=' name="'+n(b.name)+'"'),b.type&&(a+=' type="'+n(b.type)+'"'),a+=">",delete b.name,delete b.type);return c.set(d.createElement(a),b)},create:function(a,b,d){d=d||e;if(a.nodeType)return a;"undefined"===typeof d.createElement&&(d=c.getDocument(d));if("string"===typeof a)if(g.test(a))d=d.createElement("div"),h.appendChild(d),c.set(d,"html",a),a=d.childNodes,h.removeChild(d);else return d.createTextNode(a);
if(b)for(var d=0,f=a.length;d<f;d++)c.set(a[d],b);return a},destroy:function(a){var b=j(a).getElementsByTagName("*");Array.each(b,j);c.dispose(a);return null},empty:function(a){Array.from(a.childNodes).each(c.dispose);return this},dispose:function(a){return a.parentNode?a.parentNode.removeChild(a):a},replaces:function(a,b){b.parentNode.replaceChild(a,b);return this},clone:function(b,d,f){var d=!1!==d,e=b.cloneNode(d),c=[e],i=[b];d&&(c.append(Array.from(e.getElementsByTagName("*"))),i.append(Array.from(b.getElementsByTagName("*"))));
for(d=c.length;d--;){var g=c[d],j=i[d];f||g.removeAttribute("id");if(g.clearAttributes&&(g.clearAttributes(),g.mergeAttributes(j),g.removeAttribute("uniqueNumber"),g.options))for(var h=g.options,n=j.options,l=h.length;l--;)h[l].selected=n[l].selected;(h=m[j.tagName.toLowerCase()])&&j[h]&&(g[h]=j[h])}if(a.env.ie){f=e.getElementsByTagName("object");b=b.getElementsByTagName("object");for(d=f.length;d--;)f[d].outerHTML=b[d].outerHTML}return e},addListener:function(b,f,e,i){if("unload"==f)var g=e,e=function(){c.removeListener(b,
"unload",e);g()};else d[a.uidOf(b)]=b;b.addEventListener?b.addEventListener(f,e,!!i):b.attachEvent("on"+f,e);return this},removeListener:function(a,b,d,f){a.removeEventListener?a.removeEventListener(b,d,!!f):a.detachEvent("on"+b,d);return this},retrieve:function(b,d,f){var b=i(a.uidOf(b)),e=b[d];null!=f&&null==e&&(e=b[d]=f);return d?null!=e?e:null:b},store:function(b,d,f){i(a.uidOf(b))[d]=f;return this},eliminate:function(b,d){delete i(a.uidOf(b))[d];return this}});b.attachEvent&&!b.addEventListener&&
c.addListener(b,"unload",function(){Object.each(d,j);b.CollectGarbage&&CollectGarbage()})});
Klass.dom.extend({before:function(a,c){var b=c.parentNode;b&&b.insertBefore(a,c)},after:function(a,c){var b=c.parentNode;b&&b.insertBefore(a,c.nextSibling)},append:function(a,c){c.appendChild(a)},prepend:function(a,c){c.insertBefore(a,c.firstChild)},wraps:function(){return this.replaces(el).grab(el,where)},adopt:function(a){var c,b=Array.flatten(arguments).slice(1),e=b.length,g=a;1<e&&(g=c=document.createDocumentFragment());for(var h=0;h<e;h++){var d=this.id(b[h]);d&&g.appendChild(d)}c&&a.appendChild(c);
return this}});
Klass.run(function(a,c){var b=a.env,e=a.dom,g=c.html,h=null!=g.style.opacity,d=null!=g.style.filter,f=/alpha\(opacity=([\d.]+)\)/i,i=h?function(a,b){a.style.opacity=b}:d?function(a,b){if(!a.currentStyle||!a.currentStyle.hasLayout)a.style.zoom=1;var b=parseInt(Math.min(100,Math.max(0,100*b)),10),b=100==b?"":"alpha(opacity="+b+")",d=a.style.filter||e.getComputedStyle(a,"filter")||"";a.style.filter=f.test(d)?d.replace(f,b):d+b}:function(a,b){e.store(a,"$opacity",b);a.style.visibility=0<b?"visible":"hidden"},
j=h?function(a){a=a.style.opacity||e.getComputedStyle(a,"opacity");return""==a?1:parseFloat(a)}:d?function(a){var a=a.style.filter||e.getComputedStyle(a,"filter"),b;a&&(b=a.match(f));return null==b||null==a?1:b[1]/100}:function(a){var b=e.retrieve(a,"$opacity");null==b&&(b="hidden"==a.style.visibility?0:1);return b},m=null==g.style.cssFloat?"styleFloat":"cssFloat",l=function(a){return("float"===a?m:a).camelCase()};e.extend({getComputedStyle:function(a,b){if(a.currentStyle)return a.currentStyle[l(b)];
var d=e.getDocument(a).defaultView;return(d=d?d.getComputedStyle(a,null):null)?d.getPropertyValue(b==m?"float":b.hyphenate()):null},setStyle:function(a,b,d){if("opacity"===b)return i(a,parseFloat(d)),this;b=l(b);if("string"!==typeof d)var f=(e.styles[b]||"@").split(" "),d=Array.from(d).map(function(a,b){return!f[b]?"":"number"===typeof a?f[b].replace("@",Math.round(a)):a}).join(" ");else d==""+Number(d)&&(d=Math.round(d));a.style[b]=d;return this},getStyle:function(a,d){if("opacity"===d)return j(a);
var d=l(d),f=a.style[d];if(!f||"zIndex"===d){var f=[],c;for(c in e.styleHooks)if(d==c){for(var i in e.styleHooks[c])f.push(e.getStyle(a,i));return f.join(" ")}f=e.getComputedStyle(a,d)}f&&(f=""+f,(c=f.match(/rgba?\([\d\s,]+\)/))&&(f=f.replace(c[0],c[0].rgbToHex())));if(b.opera||b.ie&&isNaN(parseFloat(f))){if(/^(height|width)$/.test(d)){var g=0;("width"===d?["left","right"]:["top","bottom"]).each(function(b){g+=parseInt(this.getStyle(a,"border-"+b+"-width"),10)+parseInt(this.getStyle(a,"padding-"+
b),10)},e);return a["offset"+d.capitalize()]-g+"px"}if(b.opera&&-1!=(""+f).indexOf("px"))return f;if(/^border(.+)Width|margin|padding/.test(d))return"0px"}return f},setStyles:function(a,b){for(var d in b)this.setStyle(a,d,b[d]);return this},getStyles:function(a){var b={};Array.flatten(arguments).slice(1).each(function(d){b[d]=this.getStyle(a,d)},this);return b},styles:{left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",
backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"},styleHooks:{margin:{},padding:{},border:{},
borderWidth:{},borderStyle:{},borderColor:{}}});["Top","Right","Bottom","Left"].each(function(a){var b=e.styleHooks,d=e.styles;["margin","padding"].each(function(f){var e=f+a;b[f][e]=d[e]="@px"});var f="border"+a;b.border[f]=d[f]="@px @ rgb(@, @, @)";var c=f+"Width",i=f+"Style",g=f+"Color";b[f]={};b.borderWidth[c]=b[f][c]=d[c]="@px";b.borderStyle[i]=b[f][i]=d[i]="@";b.borderColor[g]=b[f][g]=d[g]="rgb(@, @, @)"});e.hooks.styles={set:function(a){e.setStyles(this,a)}}},document);
Klass.run(function(a){a.dom.extend({isDisplayed:function(a){return"none"!==this.getStyle(a,"display")},isVisible:function(a){var b=a.offsetWidth,e=a.offsetHeight;return 0==b&&0==e?!1:0<b&&0<e?!0:"none"!==a.style.display},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(a){var b;try{b=this.getStyle(a,"display")}catch(e){}return"none"===b?this:this.store(a,"element:_originalDisplay",b||"").setStyle(a,"display","none")},show:function(a,b){if(!b&&this.isDisplayed(a))return this;
b=b||this.retrieve(a,"element:_originalDisplay")||"block";return this.setStyle(a,"display","none"===b?"block":b)}})});
Klass.run(function(a,c){var b={dir:function(b,g,h){for(var d=[],b=b[g];b&&9!==b.nodeType&&(h===c||1!==b.nodeType||!a(b).is(h));)1===b.nodeType&&d.push(b),b=b[g];return d},nth:function(a,b){do a=a[b];while(a&&1!==a.nodeType);return a},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}};a.dom.extend({parent:function(a,b){var c=a.parentNode;if("string"===typeof b)for(;c&&!(c.tagName.toLowerCase()===b);)c=c.parentNode;return c&&11!==c.nodeType?c:null},parents:function(a){return b.dir(a,
"parentNode")},prev:function(a,c){return b.nth(a,"previousSibling",c)},prevAll:function(a){return b.dir(a,"previousSibling")},next:function(a,c){return b.nth(a,"nextSibling",c)},nextAll:function(a){return b.dir(a,"nextSibling")},siblings:function(a){return b.sibling(a.parentNode.firstChild,a)},children:function(a){return b.sibling(a.firstChild)},contents:function(b){return a.dom.nodeName(b,"iframe")?b.contentDocument||b.contentWindow.document:Array.form(b.childNodes)}})});
Klass.run(function(a,c){function b(a){return"border-box"===o(a,"-moz-box-sizing")}function e(a){return parseInt(o(a,"border-top-width"),10)||0}function g(a){return parseInt(o(a,"border-left-width"),10)||0}function h(a){return/^(?:body|html)$/i.test(a.tagName)}function d(b){return b&&(a.isWindow(b)||9===b.nodeType)}function f(a){a=p.getDocument(a);return!a.compatMode||"CSS1Compat"===a.compatMode?a.html:a.body}function i(a){for(var b={x:0,y:0};a&&!h(a);)a=a.parentNode,b.x+=a.scrollLeft,b.y+=a.scrollTop;
return b}var j=c.createElement("div"),m=c.createElement("div");j.style.height="0";j.appendChild(m);var l=m.offsetParent===j,j=m=null,k=function(a){return"static"!==o(a,"position")||h(a)},n=function(a){return k(a)||/^(?:table|td|th)$/i.test(a.tagName)},p=a.dom,o=p.getComputedStyle;p.extend({scrollBy:function(a,b,d){h(a)?this.getWindow(a).scrollBy(b,d):(a.scrollLeft+=b,a.scrollTop+=d);return this},scrollTo:function(a,b,d){h(a)?this.getWindow(a).scrollTo(b,d):(a.scrollLeft=b,a.scrollTop=d);return this},
getSize:function(a){h(a)&&(a=this.getWindow(a));return d(a)?(a=f(a),{x:a.clientWidth,y:a.clientHeight}):{x:a.offsetWidth,y:a.offsetHeight}},getScroll:function(a){var b;h(a)&&(b=a=this.getWindow(a));return d(a)?(!b&&(b=this.getWindow(a)),a=f(a),{x:b.pageXOffset||a.scrollLeft,y:b.pageYOffset||a.scrollTop}):{x:a.scrollLeft,y:a.scrollTop}},getScrollSize:function(a){h(a)&&(a=this.getWindow(a));if(d(a)){var b=f(a),e=this.getSize(a),a=this.getDocument(a).body;return{x:Math.max(b.scrollWidth,a.scrollWidth,
e.x),y:Math.max(b.scrollHeight,a.scrollHeight,e.y)}}return{x:a.scrollWidth,y:a.scrollHeight}},getOffsets:function(d){if(d.getBoundingClientRect&&!a.env.ios){var f=d.getBoundingClientRect(),c=this.getDocument(d).documentElement,j=this.getScroll(c),m=i(d),d="fixed"===o(d,"position");return{x:parseInt(f.left,10)+m.x+(d?0:j.x)-c.clientLeft,y:parseInt(f.top,10)+m.y+(d?0:j.y)-c.clientTop}}f=d;c={x:0,y:0};if(h(d))return c;for(;f&&!h(f);){c.x+=f.offsetLeft;c.y+=f.offsetTop;if(a.env.firefox){if(b(f)||(c.x+=
g(f),c.y+=e(f)),(j=f.parentNode)&&"visible"!==o(j,"overflow"))c.x+=g(j),c.y+=e(j)}else f!=d&&a.env.safari&&(c.x+=g(f),c.y+=e(f));f=f.offsetParent}a.env.firefox&&!b(d)&&(c.x-=g(d),c.y-=e(d));return c},getOffsetParent:function(a){if("fixed"===o(a,"position")||h(a))return null;if(l)for(var b="static"===o(a,"position")?n:k;a=a.parentNode;){if(b(a))return a}else try{return a.offsetParent}catch(d){}return null},getPosition:function(a,b){if(d(a))return{x:0,y:0};var f=this.getOffsets(a),c=i(a),f={x:f.x-c.x,
y:f.y-c.y};return b&&(b=p.id(b))?(c=this.getPosition(b),{x:f.x-c.x-g(b),y:f.y-c.y-e(b)}):f},getCoordinates:function(a,b){h(a)&&(a=this.getWindow(a));var f=this.getSize(a);if(d(a))return{top:0,left:0,bottom:f.y,right:f.x,height:f.y,width:f.x};var c=this.getPosition(a,b),f={left:c.x,top:c.y,width:f.x,height:f.y};f.right=f.left+f.width;f.bottom=f.top+f.height;return f}})},document);
Klass.run(function(a,c){var b=a.dom,e=function(a,b){var f=[];Object.each(b,function(b){Object.each(b,function(b){a.each(function(a){f.push(a+"-"+b+("border"===a?"-width":""))})})});return f},g=function(a,b){var f=0;Object.each(b,function(b,d){RegExp(""+a).test(d)&&(f+=parseInt(b,10))});return f};b.extend({measure:function(a,b){if(!a||a.offsetHeight||a.offsetWidth)return b.call(a);for(var f=this.parent(a),e=[];f&&!f.offsetHeight&&!f.offsetWidth&&f!=c.body;)e.push(this.expose(f)),f=this.parent(f);var f=
this.expose(a),g=b.call(a);f();e.each(function(a){a()});return g},expose:function(b){if(this.isDisplayed(b))return a.noop;var d=b.style.cssText;this.setStyles(b,{display:"block",position:"absolute",visibility:"hidden"});return function(){b.style.cssText=d}},getDimensions:function(a,d){var d=Object.merge({computeSize:!1},d),f={x:0,y:0},c=this.parent(a,"body");if(c&&!this.isDisplayed(a))f=this.measure(a,function(){return b[d.computeSize?"getComputedSize":"getSize"](this,d)});else if(c)try{f=b[d.computeSize?
"getComputedSize":"getSize"](a,d)}catch(e){}return Object.append(f,f.x||0===f.x?{width:f.x,height:f.y}:{x:f.width,y:f.height})},getComputedSize:function(a,d){var d=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},d),f={},c={width:0,height:0},j;"vertical"===d.mode?(delete c.width,delete d.planes.width):"horizontal"===d.mode&&(delete c.height,delete d.planes.height);e(d.styles,d.planes).each(function(d){f[d]=parseInt(b.getStyle(a,d),10)});
Object.each(d.planes,function(d,e){var k=e.capitalize(),n=b.getStyle(a,e),p="auto"===n;p&&!j&&(j=b.getDimensions(a));n=f[e]=p?j[e]:parseInt(n,10);c["total"+k]=n;d.each(function(a){var b=g(a,f);c["computed"+a.capitalize()]=b;c["total"+k]+=b})});return Object.append(c,f)}})},document);
Klass.run(function(a,c,b){var e,g=a,h=a.dom,d=c.document,f=this.Element&&Element.prototype.position,a={options:{relativeTo:d.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(b,d){d=Object.merge({},a.options,d);a.setPositionOption(d);a.setEdgeOption(d);a.setScrollOption(d);a.setOffsetOption(b,d);a.setDimensionsOption(b,d);return d},setPositionOption:function(b){b.position=a.getCoordinateFromValue(b.position)},setScrollOption:function(a){a.ignoreScroll=!1!==a.ignoreScroll&&
(a.enforceFixed||a.ignoreScroll)},setEdgeOption:function(b){var d=a.getCoordinateFromValue(b.edge);b.edge=d?d:"center"===b.position.x&&"center"===b.position.y?{x:"center",y:"center"}:{x:"left",y:"top"}},setOffsetOption:function(a,b){var d={x:0,y:0},f,e=h.measure(a,function(){return h.id(h.getOffsetParent(this))});if(e&&e!=h.getDocument(a).body)f=h.getScroll(e),d=h.measure(e,function(){var a=h.getPosition(this);if("fixed"===h.getStyle(this,"position")){var b=h.getScroll(c);a.x+=b.x;a.y+=b.y}return a}),
b.offset={parentPositioned:e!=h.id(b.relativeTo),x:b.offset.x-d.x+f.x,y:b.offset.y-d.y+f.y}},setDimensionsOption:function(a,b){b.dimensions=h.getDimensions(a,{computeSize:!0,styles:["padding","border","margin"]})},getPosition:function(b,f){var c={},e,f=a.getOptions(b,f);e=h.id(f.relativeTo)||d.body;a.setPositionCoordinates(f,c,e);f.edge&&a.toEdge(c,f);var g=f.offset;c.left=parseInt(0<=c.x||g.parentPositioned||f.allowNegative?c.x:0,10);c.top=parseInt(0<=c.y||g.parentPositioned||f.allowNegative?c.y:
0,10);a.toMinMax(c,f);(f.relFixedPosition||"fixed"===h.getStyle(e,"position"))&&a.toRelFixedPosition(c);f.ignoreScroll&&a.toIgnoreScroll(e,c);f.ignoreMargins&&a.toIgnoreMargins(c,f);c.left=Math.ceil(c.left);c.top=Math.ceil(c.top);delete c.x;delete c.y;return c},setPositionCoordinates:function(a,b,f){var e=d.body,g=a.offset.y,n=a.offset.x,p=f==e?h.getScroll(c):h.getPosition(f),o=p.y,p=p.x,q=h.getSize(c);switch(a.position.x){case "left":b.x=p+n;break;case "right":b.x=p+n+f.offsetWidth;break;default:b.x=
p+(f==e?q.x:f.offsetWidth)/2+n}switch(a.position.y){case "top":b.y=o+g;break;case "bottom":b.y=o+g+f.offsetHeight;break;default:b.y=o+(f==e?q.y:f.offsetHeight)/2+g}},toMinMax:function(a,b){var d={left:"x",top:"y"},f;["minimum","maximum"].each(function(c){["left","top"].each(function(e){f=b[c]?b[c][d[e]]:null;if(null!=f&&("minimum"==c?a[e]<f:a[e]>f))a[e]=f})})},toRelFixedPosition:function(a){var b=h.getScroll(c);a.top+=b.y;a.left+=b.x},toIgnoreScroll:function(a,b){var d=h.getScroll(a);b.top-=d.y;b.left-=
d.x},toIgnoreMargins:function(a,b){a.left+="right"===b.edge.x?b.dimensions["margin-right"]:"center"!==b.edge.x?-b.dimensions["margin-left"]:-b.dimensions["margin-left"]+(b.dimensions["margin-right"]+b.dimensions["margin-left"])/2;a.top+="bottom"===b.edge.y?b.dimensions["margin-bottom"]:"center"!==b.edge.y?-b.dimensions["margin-top"]:-b.dimensions["margin-top"]+(b.dimensions["margin-bottom"]+b.dimensions["margin-top"])/2},toEdge:function(a,b){var d,f;f=b.edge;var c=b.dimensions;switch(f.x){case "left":d=
0;break;case "right":d=-c.x-c.computedRight-c.computedLeft;break;default:d=-Math.round(c.totalWidth/2)}switch(f.y){case "top":f=0;break;case "bottom":f=-c.y-c.computedTop-c.computedBottom;break;default:f=-Math.round(c.totalHeight/2)}a.x+=d;a.y+=f},getCoordinateFromValue:function(a){if("string"!==typeof a)return a;a=a.toLowerCase();return{x:/left/.test(a)?"left":/right/.test(a)?"right":"center",y:/upper|top/.test(a)?"top":/bottom/.test(a)?"bottom":"center"}}};h.extend({position:function(a,d){if(d){if(null!=
d.x||null!=d.y)return f?f.apply(a,Array.from(arguments).slice(1)):this;if(e===b)e=g.support.fixedPosition;d.enforceFixed=d.enforceFixed&&e}var c=this.setStyle(a,"position",d&&d.enforceFixed?"fixed":"absolute").calculatePosition(a,d);return d&&d.returnPos?c:this.setStyles(a,c)},calculatePosition:function(b,d){return a.getPosition(b,d)}})},window);
Klass.run(function(a,c){function b(b,d){var i,o,n,p=[];i=a.type(b);o=d;o===c?o=f:"string"===typeof o&&j.test(o)?o=e(o.slice(1),f):o&&1!==o.nodeType&&9!==o.nodeType&&(o=null);d=o;if(!b)return null;if("string"===i)if(b=b.trim(),j.test(b))(i=e(b.slice(1),d))&&(p=[i]);else if(n=m.exec(b)){if(i=n[1],o=n[2],n=n[3],d=i?e(i,d):d)n?!i||b.contains(" ")?p=h(n,o,d):(i=e(i,d))&&k(i,n)&&(p=[i]):o&&(p=g(o,d))}else{if(a.slick)return a.slick(b,d);a.print("Unsupported selector: "+b)}else p="array"===i||"collection"===
i?b:[b];return p||[]}function e(a,b){return(9!==b.nodeType?b.ownerDocument:b).getElementById(a)}function g(a,b){return b.getElementsByTagName(a)}function h(a,b,d){var d=a=d.getElementsByClassName(a),f;if(b&&"*"!==b)for(var d=[],c=0,e=a.length;c<e;++c)f=a[c],n(f,b)&&d.push(f);return d}function d(a,d){if(p)try{return p.call(a,d.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(f){}var c=b(d);if(!c.length)return!0;var e,g;for(e=0;g=c[e++];)if(g===a)return!0;return!1}var f=this.document,i=
f.documentElement,j=/^#[\w-]+$/,m=/^(?:#([\w-]+))?\s*((?:[\w-]*:?)[\w-]+|\*)?\.?([\w-]+)?$/,l=a.dom,k=l.hasClass,n=l.nodeName,p=i.matchesSelector||i.mozMatchesSelector||i.webkitMatchesSelector;if(p)try{p.call(i,":klass"),p=null}catch(o){}(function(a){var b=a.createElement("div");b.appendChild(a.createComment(""));b.getElementsByTagName("*").length&&(g=function(a,b){var d=b.getElementsByTagName(a);if("*"===a){for(var f=[],c=0,e;e=d[c++];)1===e.nodeType&&(f[f.length]=e);d=f}return d})})(f);f.getElementsByClassName||
(h=f.querySelectorAll?function(a,b,d){return d&&d.querySelectorAll((b||"")+"."+a)}:function(a,b,d){for(var b=d.getElementsByTagName(b||"*"),f=[],c=0,e=b.length;c<e;++c)d=b[c],k(d,a)&&f.push(d);return f});l.parse=function(a,d){if("string"===typeof a){for(var f=[],c=a.split(","),e=0,g=c.length;e<g;e++)f.push(b(c[e],d));return f.flatten()}return b(a,d)};l.extend({match:function(a,b){var f;if(!(f=!b))f=!a||!b?!1:!b||b===a?!0:d(a,b);return f},parse:function(a,d){if("string"===typeof a){for(var f=[],c=
a.split(","),e=0,g=c.length;e<g;e++)f.push(b(c[e],d));return f.flatten()}return b(a,d)}})});
Klass.run(function(a){var c=a.dom,b=a.event={extend:Function.prototype.extend,addEvent:function(b,d,f,i){var j=c.retrieve(b,"events",{});j[d]||(j[d]={keys:[],values:[],stop:!1,pause:!1});if(j[d].keys.contains(f))return this;j[d].keys.push(f);var m=d,l=e[d],k=f,n=this;l&&(l.onAdd&&l.onAdd.call(this,f,d),l.condition&&(k=function(a){return l.condition.call(b,a,d)?f.call(this,a):!0}),l.base&&(m=Function.from(l.base).call(b,d)));var p=function(){return f.call(n)},o=g[m];o&&(2===o&&(p=function(f){f=new a.DOMEvent(f,
c.getWindow(b));if(j[d].pause)return!1;if(j[d].stop)return j[d].stop=!1;!1===k.call(n,f)&&f.stop()}),c.addListener(b,m,p,i));j[d].values.push(p);return this},removeEvent:function(a,b,f,i){var j=c.retrieve(a,"events");if(!j||!j[b])return this;var m=j[b],l=m.keys.indexOf(f);if(-1==l)return this;j=m.values[l];delete m.keys[l];delete m.values[l];if(m=e[b])m.onRemove&&m.onRemove.call(this,f,b),m.base&&(b=Function.from(m.base).call(a,b));return g[b]?c.removeListener(a,b,j,i):this},stopEvent:function(a,
b){var f=c.retrieve(a,"events");if(f&&f[b])f[b].stop=!0;return this},pauseEvent:function(a,b){var f=c.retrieve(a,"events");if(f&&f[b])f[b].pause=!0;return this},restartEvent:function(a,b){var f=c.retrieve(a,"events");if(f&&f[b])f[b].pause=!1;return this},addEvents:function(a,d){for(var f in d)b.addEvent.call(this,a,f,d[f]);return this},removeEvents:function(a,d){var f;if("object"===typeof d){for(f in d)b.removeEvent.call(this,a,f,d[f]);return this}var e=c.retrieve(a,"events");if(!e)return this;if(d)e[d]&&
(e[d].keys.each(function(f){b.removeEvent.call(this,a,d,f)},this),delete e[d]);else{for(f in e)b.removeEvents.call(this,a,f);c.eliminate(a,"events")}return this},fireEvent:function(a,b,f,e){var g=c.retrieve(a,"events");if(!g||!g[b])return this;f=Array.from(f);g[b].keys.each(function(a){if(g[b].pause)return!1;e?a.delay(e,this,f):a.apply(this,f)},this);return this},cloneEvents:function(a,d,f){var d=c.id(d),e=c.retrieve(d,"events");if(!e)return this;if(f)e[f]&&e[f].keys.each(function(d){b.addEvent.call(this,
a,f,d)},this);else for(var g in e)b.cloneEvents.call(this,a,d,g);return this}},e=b.Events={},g=b.nativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,dragenter:2,dragover:2,drop:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,
unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,hashchange:1,popstate:2,animationend:1,webkitAnimationEnd:1,error:1,abort:1,scroll:1};c.hooks.events={set:function(a){b.addEvents.call(this,this,a)}}});
Klass.run(function(a,c){var b=a.dom,e=a.event,g=e.Events,e=e.nativeEvents,h=c.document.documentElement;g.animationend={base:c.WebKitAnimationEvent?"webkitAnimationEnd":"animationend"};g.mousewheel={base:a.env.firefox?"DOMMouseScroll":"mousewheel"};if("onmouseenter"in h)e.mouseenter=e.mouseleave=2;else{var d=function(a){a=a.relatedTarget;return null==a?!0:!a?!1:a!=this&&"xul"!==a.prefix&&9!==this.nodeType&&!b.contains(this,a)};g.mouseenter={base:"mouseover",condition:d};g.mouseleave={base:"mouseout",
condition:d}}"onfocusin"in h?e.focusin=e.focusout=2:(g.focusin={base:"focus"},g.focusout={base:"blur"});if(!c.addEventListener)e.propertychange=2,g.change={base:function(){var a=this.type;return b.nodeName(this,"input")&&("radio"===a||"checkbox"===a)?"propertychange":"change"},condition:function(a){return"radio"!==this.type||"checked"===a.event.propertyName&&this.checked}}},window);
Klass.run(function(a){a.DOMEvent.defineKeys({16:"shift",17:"control",18:"alt",20:"capslock",33:"pageup",34:"pagedown",35:"end",36:"home",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",107:"+"}).defineKey(a.env.firefox?109:189,"-")});
Klass.run(function(a,c){var b=a.dom,e=function(a,e,d){if(a&&!(3===a.nodeType||8===a.nodeType||!a.style))if(d!==c)b.setStyle(a,e,d);else return b.getStyle(a,e)};a.node.extend({css:function(e){return a.exec(this,e,c,b.getComputedStyle)},style:function(b,c){return a.exec(this,b,c,e)}});["show","hide","toggle"].each(function(c){a.node[c]=function(){var a=Array.from(arguments);return this.each(function(){b[c].apply(b,[this].concat(a))})}});"parent,parents,prev,next,prevAll,nextAll,siblings,children,contents".split(",").each(function(c){a.node[c]=
function(a){return this.map(b[c],a)}})});
Klass.run(function(a){var c=a.event;a.node.extend({on:function(b,e,g,h){var d=typeof b;"string"===d&&(b=b.trim().split(" "));if(h)var f=e,e=function(b){a(this).off(b&&b.type);f.apply(this,arguments)};return this.each(function(){if(!(3===this.nodeType||8===this.nodeType||!b||!e&&"string"===d)){if("object"===d)return c.addEvents(this,b);for(var a,f=0,h=b.length;f<h;f++)a=b[f],a+=g?":relay("+g+")":"",c.addEvent.call(this,this,a,e)}})},off:function(a,e){return this.each(function(){c[e?"removeEvent":"removeEvents"](this,
a,e)})},fire:function(a,e,g){return this.each(function(){(!this||!(3===this.nodeType||8===this.nodeType))&&c.fireEvent.call(this,this,a,e,g)})},once:function(a,c){return this.on(a,c,null,!0)},hover:function(a,c){this.mouseenter(a).mouselevel(c||a)},live:function(b,c){a(this.context).on(b,c,this.selector);return this},die:function(b,c){a(this.context).off(b,c,this.selector)},delegate:function(a,c,g){return this.on(c,g,a)},undelegate:function(a,c,g){return this.off(c,g,a)}});"blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" ").each(function(b){a.node[b]=
function(a){return arguments.length?this.on(b,a):this.fire(b)}})});
Klass.run(function(a,c){var b=a.dom,e={before:"before",after:"after",bottom:"append",inside:"append",top:"prepend"},g=function(b,f){var c=b[0],e;if(a.isFunction(c))return this.each(function(){var e=a(this);b[0]=c.call(this,e.html());g.call(e,b,f)});if(this[0]){e=h(b);for(var m=0,l=this.length;m<l;m++)f.call(this[m],e)}return this},h=function(a){for(var f,c,e,g=[],h=0,k=a.length;h<k;h++)(e=b.create(a[h]))&&g.push(e);g.length&&(g=Array.flatten(g));g[0]&&(f=g[0].ownerDocument||g[0]);f&&!f.createDocumentFragment&&
(f=document);c||(c=f.createDocumentFragment());for(h=0,k=g.length;h<k;h++)(e=g[h])&&c.appendChild(e);return c};a.node.extend({inject:function(b,f){var c=e[f||"bottom"];return a(b)[c](this)},clone:function(a,f){return this.map(function(){return b.clone(this,a,f)})},html:function(d){if(d===c)return this[0]&&1===this[0].nodeType?this[0].innerHTML:null;if("string"===typeof d)return this.each(function(){1===this.nodeType&&b.set(this,"html",d)});if(a.isFunction(d))return this.each(function(){var b=a(this);
b.html(d.call(this,b.html()))});this.empty().append(d);return this},text:function(d){return a.isFunction(d)?this.each(function(b){var c=a(this);c.text(d.call(this,b,c.text()))}):"object"!==typeof d&&d!==c?this.each(function(){b.set(this,"text",d)}):b.get(this[0],"text")},wrap:function(b){var f=a.isFunction(b);return this.each(function(){a(this).wraps(f?b.call(this):b)})},wraps:function(b){if(a.isFunction(b))return this.each(function(){a(this).wraps(b.call(this))});var f=this[0],c;f&&(c=a(b,f.ownerDocument).eq(0).clone(!0),
f.parentNode&&c.insertBefore(f),c.map(function(){}));return this}});["destroy","dispose","empty"].each(function(d){a.node[d]=function(){return this.each(function(){if(1===this.nodeType)b[d](this)})}});["append","prepend"].each(function(d){a.node[d]=function(){return g.call(this,arguments,function(a){if(1===this.nodeType)b[d](a,this)})}});["after","before"].each(function(d){a.node[d]=function(){if(this[0]&&this[0].parentNode)return g.call(this,arguments,function(a){b[d](a,this)})}});Object.each({appendTo:"append",
prependTo:"prepend",insertAfter:"after",insertBefore:"before"},function(b,f){a.node[f]=function(f){var c,e=[],f=a(f);if((c=1===this.length&&this[0].parentNode)&&11===c.nodeType&&1===c.childNodes.length&&1===f.length)return f[b](this[0]);for(var g=0,h=f.length;g<h;g++)c=Array.slice(this),a(f[g])[b](c),e=e.concat(c);return this.stack(e)}})});
Klass.run(function(a,c){var b=a.dom;a.node.extend({offset:function(){var a=this[0];return a&&a.ownerDocument?b.getOffsets(a):null},offsetParent:function(){return this.map(b.getOffsetParent)},pos:function(a){return this[0]?b.getPosition(this[0],a):null},position:function(a){return this.each(function(){1===this.nodeType&&b.position(this,a)})}});["Width","Height"].each(function(e,g){var h=e.toLowerCase();a.node[h]=function(d){var f=this[0];if(!f)return null==d?null:this;if(a.isFunction(d))return this.each(function(){var b=
a(this);b[h](d.call(this,b[h]()))});return d===c?(d=b.getSize(f),d[g?"y":"x"]):this.style(h,d)}});["Left","Top",""].each(function(e,g){a.node["scroll"+e]=function(a){var d,f,i,j;return a===c?(d=this[0],!d?void 0:(f=b.getScroll(d))&&(!e?f:f[g?"x":"y"])):this.each(function(){i=a.x||!g&&a;j=a.y||g&&a;b.scrollTo(this,i,j)})}})});
Klass.run(function(a){var c=a.dom,b=function(b,c,h){var d,c=c||0;a.isFunction(c)?d=function(a){return!!c.call(a,a)===h}:c.nodeType&&(d=function(a){return a===c===h});return Array.filter(b,d||function(a){return-1!==Array.indexOf(c,a)===h})};a.node.extend({find:function(a){for(var b=this.stack("","find",a),h,d,f,i=0,j=this.length;i<j;i++)if(h=b.length,b.merge(c.parse(a,this[i])),0<i)for(d=h;d<b.length;d++)for(f=0;f<h;f++)if(b[f]===b[d]){b.splice(d--,1);break}return b},filter:function(a){return this.stack(b(this,
a,!0),"filter",a)},not:function(a){return this.stack(b(this,a,!1),"not",a)},has:function(b){var g=a(b);return this.filter(function(){for(var a=0,b=g.length;a<b;a++)if(c.contains(this,g[a]))return!0})},is:function(){},index:function(b){return!b?this[0]&&this[0].parentNode?this.prevAll().length:-1:"string"===typeof b?Array.indexOf(this[0],a(b)):Array.indexOf(b.version?b[0]:b,this)}})});Klass.utils={};if("undefined"===typeof JSON)this.JSON={};
(function(a){var c={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},b=function(a){return c[a]||"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(a){a=a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(a)};JSON.encode=JSON.stringify?function(a){return JSON.stringify(a)}:function(c){c&&c.toJSON&&
(c=c.toJSON());switch(a.type(c)){case "string":return'"'+c.replace(/[\x00-\x1f\\"]/g,b)+'"';case "array":return"["+c.map(JSON.encode).clean()+"]";case "object":var g=[];Object.each(c,function(a,b){var f=JSON.encode(a);f&&g.push(JSON.encode(b)+":"+f)});return"{"+g+"}";case "number":case "boolean":return""+c;case "null":return"null"}return null};JSON.decode=function(a,b){if("string"!==typeof a)return null;if(b||JSON.secure){if(JSON.parse)return JSON.parse(a);if(!JSON.validate(a))throw Error("JSON could not decode the input; security is enabled and the value is not secure.");
}return eval("("+a+")")}})(Klass);
Klass.run(function(a){var c=a.utils.Color=function(a,c){3<=arguments.length?(a=Array.slice(arguments,0,3),c=arguments[3]):"string"===typeof a&&(a=a.match(/rgb/)?a.rgbToHex().hexToRgb(!0):a.match(/hsb/)?a.hsbToRgb():a.hexToRgb(!0));switch(c||"rgb"){case "hsb":var g=a,a=a.hsbToRgb();a.hsb=g;break;case "hex":a=a.hexToRgb(!0)}a.rgb=a.slice(0,3);a.hsb=a.hsb||a.rgbToHsb();a.hex=a.rgbToHex();return Object.append(a,this)};c.prototype={mix:function(){var a=Array.slice(arguments),e="number"===typeof a.getLast()?
a.pop():50,g=this.slice();a.each(function(a){for(var a=new c(a),b=0;3>b;b++)g[b]=Math.round(g[b]/100*(100-e)+a[b]/100*e)});return new c(g,"rgb")},invert:function(){return new c(this.map(function(a){return 255-a}))},setHue:function(a){return new c([a,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(a){return new c([this.hsb[0],a,this.hsb[2]],"hsb")},setBrightness:function(a){return new c([this.hsb[0],this.hsb[1],a],"hsb")}};Array.implement({rgbToHsb:function(){var a=this[0],c=this[1],g=this[2],
h=0,d=Math.max(a,c,g),f=Math.min(a,c,g),i=d-f,f=d/255,j=0!=d?i/d:0;if(0!=j){var h=(d-a)/i,m=(d-c)/i,g=(d-g)/i,h=(a==d?g-m:c==d?2+h-g:4+m-h)/6;0>h&&h++}return[Math.round(360*h),Math.round(100*j),Math.round(100*f)]},hsbToRgb:function(){var a=Math.round(255*(this[2]/100));if(0==this[1])return[a,a,a];var c=this[0]%360,g=c%60,h=Math.round(255*(this[2]*(100-this[1])/1E4)),d=Math.round(255*(this[2]*(6E3-this[1]*g)/6E5)),g=Math.round(255*(this[2]*(6E3-this[1]*(60-g))/6E5));switch(Math.floor(c/60)){case 0:return[a,
g,h];case 1:return[d,a,h];case 2:return[h,a,g];case 3:return[h,d,a];case 4:return[g,h,a];case 5:return[a,h,d]}return!1}});String.implement({rgbToHsb:function(){var a=this.match(/\d{1,3}/g);return a?a.rgbToHsb():null},hsbToRgb:function(){var a=this.match(/\d{1,3}/g);return a?a.hsbToRgb():null}})});
Klass.run(function(a){if(a&&!a.Editor)a.Editor=(new Class({Implements:[Class.Events,Class.Options]})).extend({timestamp:"AEO9LPV",version:"0.5.8",revision:"0",status:"unloaded",storage:{},basePath:function(){var a,b;b=document.getElementsByTagName("script");for(var e=0,g=b.length;e<g;e++){var h=b[e].src.match(/(^|.*[\\\/])editor(?:_basic)?(?:_source)?.js(?:\?.*)?$/i);if(h&&(a=h[1]))break}a&&-1==a.indexOf("://")&&(b=0===a.indexOf("/")?/^.*?:\/\/[^\/]*/:/^[^\?]*\/(?:)/,a=location.href.match(b)+a);return a}(),
getUrl:function(a){-1==a.indexOf("://")&&0!==a.indexOf("/")&&(a=this.basePath+a);this.timestamp&&"/"!=a.charAt(a.length-1)&&!/[&?]t=/.test(a)&&(a+=(0<=a.indexOf("?")?"&":"?")+"t="+this.timestamp);return a}})});
Klass.Editor.$=Klass.Editor.constants={ENTER_P:1,ENTER_BR:2,ENTER_DIV:3,ELEMENT_MODE_NONE:0,ELEMENT_MODE_REPLACE:1,ELEMENT_MODE_APPENDTO:2,TRISTATE_ON:1,TRISTATE_OFF:2,TRISTATE_DISABLED:0,SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3,NODE_ELEMENT:1,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT:9,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,POSITION_AFTER_START:1,POSITION_BEFORE_END:2,
POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,STARTEND:3,SHRINK_ELEMENT:1,SHRINK_TEXT:2,STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3};
Klass.Editor.config={autoUpdateElement:!0,enableLivePreview:!0,contentsCss:Klass.Editor.basePath+"contents.css",contentsDirection:"ui",language:"",defaultLanguage:"zh-cn",enterMode:Klass.Editor.$.ENTER_P,forceEnterMode:!1,shiftEnterMode:Klass.Editor.$.ENTER_BR,docType:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',bodyId:"",bodyClass:"",fullPage:!1,height:300,plugins:"about,basicstyles,clipboard,color,elementspath,entities,filebrowser,fileupload,flash,format,font,horizontalrule,htmldataprocessor,iframe,indent,image,justify,keyenter,link,list,maximize,menu,mode,pastefromword,pastetext,preview,print,pseudos,removeformat,resize,selection,smiley,sourcearea,specialchar,statusbar,styles,toolbar,undo,widget,wysiwygarea",
extraPlugins:"",tabIndex:0,theme:"default",skin:"default",width:"",baseFloatZIndex:1E4,autoFloatZIndex:!1,useComputedState:!0};
Klass.run(function(a){var c=a.Editor;c.lang={languages:{af:1,ar:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,lt:1,lv:1,mn:1,ms:1,nb:1,nl:1,no:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,sk:1,sl:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,uk:1,vi:1,"zh-cn":1,zh:1},load:function(a,c,g){if(!a||!this.languages[a])a=this.detect(c,a);if(this[a])g(a,this[a]);else throw"The language is not supported";
},detect:function(a,e){var g=this.languages,e=e||navigator.userLanguage||navigator.language||a,h=e.toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/),d=h[1],h=h[2];g[d+"-"+h]?d=d+"-"+h:g[d]||(d=null);c.lang.detect=d?function(){return d}:function(a){return a};return d||a}}});
Klass.Editor.lang.en={source:"Source",save:"Save",preview:"Preview",cut:"Cut",copy:"Copy",paste:"Paste",print:"Print",bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike Through",selectAll:"Select All",subscript:"Subscript",superscript:"Superscript",indent:"Increase Indent",outdent:"Decrease Indent",bulletedlist:"Insert/Remove Bulleted List",numberedlist:"Insert/Remove Numbered List",blockquote:"Block Quote",removeFormat:"Remove Format",date:"Insert Date",horizontalrule:"Insert Horizontal Line",
unlink:"Unlink",undo:"Undo",redo:"Redo",common:{upload:"Upload",button:"Button",name:"Name",ok:"OK",cancel:"Cancel",yes:"Yes",no:"No",close:"Close",preview:"Preview",general:"General",advanced:"Advanced",options:"Options",target:"Target",loop:"Loop",auto:"Auto",autoPlay:"Auto Play",width:"Width",height:"Height",align:"Alignment",alignLeft:"Left",alignRight:"Right",alignCenter:"Center",alignTop:"Top",alignMiddle:"Middle",alignBottom:"Bottom",localFiles:"Local Files",webAddress:"Web Address",emptyTooltip:"Please input %t.",
invalidTooltip:"Please input correct %t.",invalidWidth:"Width must be a number.",invalidHeight:"Height must be a number.",invalidLength:"%l must be a positive number, can with a valid measurement unit (px or %).",confirmCancel:"Some of the options have been changed. Are you sure you want to close the dialog?"},font:{label:"Font",panelTitle:"Font Name"},fontsize:{label:"Size",panelTitle:"Font Size"},format:{label:"Format",panelTitle:"Paragraph Format",tag_p:"Normal",tag_pre:"Formatted",tag_address:"Address",
tag_h1:"Heading 1",tag_h2:"Heading 2",tag_h3:"Heading 3",tag_h4:"Heading 4",tag_h5:"Heading 5",tag_h6:"Heading 6",tag_div:"Normal(DIV)"},styles:{label:"Styles",panelTitle:"Formatting Styles",panelTitle1:"Block Styles",panelTitle2:"Inline Styles",panelTitle3:"Object Styles"},color:{selectColor:"Select Color",textColor:"Text Color",bgColor:"Background Color",standard:"Standard Colors",theme:"Theme Colors",auto:"Automatic",more:"More Colors..."},colors:{"000":"Black",8E5:"Maroon","8B4513":"Saddle Brown",
"2F4F4F":"Dark Slate Gray","008080":"Teal","000080":"Navy","4B0082":"Indigo",696969:"Dark Gray",B22222:"Fire Brick",A52A2A:"Brown",DAA520:"Golden Rod","006400":"Dark Green","40E0D0":"Turquoise","0000CD":"Medium Blue",800080:"Purple",808080:"Gray",F00:"Red",FF8C00:"Dark Orange",FFD700:"Gold","008000":"Green","0FF":"Cyan","00F":"Blue",EE82EE:"Violet",A9A9A9:"Dim Gray",FFA07A:"Light Salmon",FFA500:"Orange",FFFF00:"Yellow","00FF00":"Lime",AFEEEE:"Pale Turquoise",ADD8E6:"Light Blue",DDA0DD:"Plum",D3D3D3:"Light Grey",
FFF0F5:"Lavender Blush",FAEBD7:"Antique White",FFFFE0:"Light Yellow",F0FFF0:"Honeydew",F0FFFF:"Azure",F0F8FF:"Alice Blue",E6E6FA:"Lavender",FFF:"White"},justify:{left:"Left Justify",center:"Center Justify",right:"Right Justify",block:"Block Justify"},link:{label:"Link",toolbar:"Link",menu:"Edit Link",title:"Link",info:"Link Info",type:"Link Type",url:"URL for the link",displayText:"Text to display",emailAddress:"Email address for the link",emailSubject:"Message Subject",toWebAddress:"Web Address",
toEmailAddress:"Email Address",testLink:"Test the link",emptyEmail:"Please input e-mail address.",emptyUrl:"Please input link URL.",invalidEmail:"Please input correct e-mail address.",invalidUrl:"Please input correct link URL."},image:{label:"Image",title:"Image Properties",menu:"Image Properties",url:"Paste Image URL",alt:"Alternative Text",emptyUrl:"Please input image URL.",invalidUrl:"Please input correct image URL.",limitQueueDesc:"You can only upload <strong>%d</strong> images at one time",description:"If the URL you entered was correct, you can preview the pictures here.<br />Large images may take a few minutes to upload."},
flash:{label:"Flash",title:"Flash Properties",menu:"Flash Properties",url:"Flash URL",size:"Flash \u5c3a\u5bf8",fullscreen:"Allow Fullscreen",emptyUrl:"Please input flash URL.",invalidUrl:"Please input correct flash URL."},video:{label:"\u89c6\u9891",title:"\u6807\u9898",url:"\u6765\u6e90\u5730\u5740"},iframe:{label:"IFrame",title:"IFrame Properties",border:"Show border",scrolling:"Enable scrollbars"},filebrowser:{image:"Image Browser"},fileupload:{success:"Files uploaded successfully.",failure:"Files failed to upload.",
timeout:"Upload timed out.",reupload:"Upload again",wait:"File Uploading",start:"Start uploading",stop:"Stop uploading",selectFile:"Select Files",largeFile:"The file is too large.",invalidFile:"Invalid file.",invalidFileType:"Invalid file type.",dragdrop:"You can drag the images to this area to upload directly.",size:"Size Supported",format:"Format Supported",imageDimension:"Image Dimension Supported",confirmCancel:"Some of the files have not been uploaded. Are you sure to close the dialog?",serverFailure:"Upload service is temporarily unavailable, please try again later!",
successAndSort:"Uploading has been successful. You can change the file order by dragging.",lastQueueDesc:'You still have <strong></strong> uploads pending from last time. Do you want to <a href="#">continue uploading</a> or <a href="#">clear these files</a>\uff1f',uncertainError:"Uploading failed. Please select the correct file.",limitQueueError:"Upload limit exceeded: You can only upload %d files at one time.",fileSizeError:"The file is too large: Please upload a file that is less than %d.",fileTypeError:"Invalid file type: Only %d is supported."},
smiley:{toolbar:"Smiley",title:"Insert a Smiley"},specialChar:{toolbar:"Insert Special Character",title:"Select Special Character",selected:"Selected Special Character"},widget:{toolbar:"Insert Document Widget",label:"Insert Document Widget",title:"Document Widget",emptyList:"(No widgets defined)"},pseudos:{anchor:"Anchor",flash:"Flash Animation",iframe:"IFrame",widget:"Document Widget",unknown:"Unknown Object"},clipboard:{title:"Paste",cutError:"Your browser security settings don't permit the editor to automatically execute cutting operations. Please use the keyboard for that (Windows: Ctrl+X/Mac: Cmd+X).",
copyError:"Your browser security settings don't permit the editor to automatically execute copying operations. Please use the keyboard for that (Windows: Ctrl+C/Mac: Cmd+C).",pasteMsg:"Please paste inside the following box using the keyboard (<strong>Windows: Ctrl+V/Mac: Cmd+V</strong>) and hit OK",securityMsg:"Because of your browser security settings, the editor is not able to access your clipboard data directly. You are required to paste it again in this window.",pasteArea:"Paste Area"},pasteText:"Paste as plain text",
pastefromword:{label:"Paste from Word",error:"It was not possible to clean up the pasted data due to an internal error",cleanup:"The text you want to paste seems to be copied from Word. Do you want to clean it before pasting?"},maximize:"Maximize",restore:"Restore",elementspath:"%1 element",wordcount:"\u8fd8\u53ef\u4ee5\u8f93\u5165<em>{number}</em>\u5b57",toolbar:{collapse:"Collapse Toolbar",expand:"Expand Toolbar"},resize:{drop:"Drag to resize",larger:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller:"\u51cf\u5c0f\u7f16\u8f91\u533a\u57df"}};
Klass.Editor.lang.zh={source:"\u539f\u59cb\u78bc",save:"\u4fdd\u5b58",preview:"\u9810\u89bd",cut:"\u526a\u4e0b",copy:"\u8907\u88fd",paste:"\u8cbc\u4e0a",print:"\u5217\u5370",bold:"\u7c97\u9ad4",italic:"\u659c\u9ad4",underline:"\u5e95\u7dda",strike:"\u5220\u9664\u7dda",selectAll:"\u5168\u9078",subscript:"\u4e0b\u6a19",superscript:"\u4e0a\u6a19",indent:"\u589e\u52a0\u7e2e\u6392",outdent:"\u51cf\u5c11\u7e2e\u6392",bulletedlist:"\u9805\u76ee\u6e05\u55ae",numberedlist:"\u7de8\u865f\u6e05\u55ae",blockquote:"\u5757\u5f15\u7528",
removeFormat:"\u6e05\u9664\u683c\u5f0f",date:"\u63d2\u5165\u65e5\u671f",horizontalrule:"\u63d2\u5165\u6c34\u5e73\u7ebf",unlink:"\u79fb\u9664\u8d85\u9023\u7d50",undo:"\u5fa9\u539f",redo:"\u91cd\u8907",common:{upload:"\u4e0a\u50b3",button:"\u6309\u9215",name:"\u540d\u7a31",ok:"\u78ba\u5b9a",cancel:"\u53d6\u6d88",yes:"\u662f",no:"\u5426",close:"\u5173\u95ed",preview:"\u9810\u89bd",general:"\u4e00\u822c",advanced:"\u9032\u968e",options:"\u9078\u9805",target:"\u76ee\u6807\u7a97\u53e3",loop:"\u91cd\u8907",
auto:"\u81ea\u52d5",autoPlay:"\u81ea\u52d5\u64ad\u653e",width:"\u5bec\u5ea6",height:"\u9ad8\u5ea6",align:"\u5c0d\u9f4a",alignLeft:"\u9760\u5de6\u5c0d\u9f4a",alignRight:"\u9760\u53f3\u5c0d\u9f4a",alignCenter:"\u7f6e\u4e2d",alignTop:"\u9760\u4e0a\u5c0d\u9f4a",alignMiddle:"\u7f6e\u4e2d\u5c0d\u9f4a",alignBottom:"\u9760\u4e0b\u5c0d\u9f4a",localFiles:"\u672c\u5730\u6587\u4ef6",webAddress:"\u7db2\u7d61\u5730\u5740",emptyTooltip:"\u8acb\u8f38\u5165%t",invalidTooltip:"\u8acb\u8f38\u5165\u6e96\u78ba\u7684%t",
invalidWidth:"\u5bec\u5ea6\u5fc5\u9808\u70ba\u6578\u5b57\u683c\u5f0f",invalidHeight:"\u9ad8\u5ea6\u5fc5\u9808\u70ba\u6578\u5b57\u683c\u5f0f",invalidLength:"%l\u5fc5\u9808\u70ba\u6b63\u6578\uff0c\u5141\u8a31\u5305\u542b\u4e00\u500b\u6709\u6548\u7684\u9577\u5ea6\u55ae\u4f4d(px \u6216 %)",confirmCancel:"\u90e8\u4efd\u9078\u9805\u5c1a\u672a\u5132\u5b58\uff0c\u8981\u95dc\u9589\u5c0d\u8a71\u76d2\uff1f"},font:{label:"\u5b57\u9ad4",panelTitle:"\u5b57\u9ad4"},fontsize:{label:"\u5927\u5c0f",panelTitle:"\u5927\u5c0f"},
format:{label:"\u683c\u5f0f",panelTitle:"\u683c\u5f0f",tag_p:"\u4e00\u822c",tag_pre:"\u5df2\u683c\u5f0f\u5316",tag_address:"\u4f4d\u5740",tag_h1:"\u6a19\u984c 1",tag_h2:"\u6a19\u984c 2",tag_h3:"\u6a19\u984c 3",tag_h4:"\u6a19\u984c 4",tag_h5:"\u6a19\u984c 5",tag_h6:"\u6a19\u984c 6",tag_div:"\u4e00\u822c(DIV)"},styles:{label:"\u6837\u5f0f",panelTitle:"\u6837\u5f0f",panelTitle1:"\u5757\u7ea7\u5143\u7d20\u6837\u5f0f",panelTitle2:"\u5185\u8054\u5143\u7d20\u6837\u5f0f",panelTitle3:"\u5bf9\u8c61\u5143\u7d20\u6837\u5f0f"},
color:{selectColor:"\u9078\u64c7\u984f\u8272",textColor:"\u6587\u5b57\u984f\u8272",bgColor:"\u80cc\u666f\u984f\u8272",standard:"\u6a19\u6e96\u8272",theme:"\u4e3b\u984c\u984f\u8272",auto:"\u81ea\u52d5",more:"\u66f4\u591a\u984f\u8272\u2026"},colors:{"000":"\u9ed1",8E5:"\u8910\u7ea2","8B4513":"\u6df1\u8910","2F4F4F":"\u58a8\u7eff","008080":"\u7eff\u677e\u77f3","000080":"\u6d77\u519b\u84dd","4B0082":"\u975b\u84dd",696969:"\u6697\u7070",B22222:"\u7816\u7ea2",A52A2A:"\u8910",DAA520:"\u91d1\u9ec4","006400":"\u6df1\u7eff",
"40E0D0":"\u84dd\u7eff","0000CD":"\u4e2d\u84dd",800080:"\u7d2b",808080:"\u7070",F00:"\u7ea2",FF8C00:"\u6df1\u6a59",FFD700:"\u91d1","008000":"\u7eff","0FF":"\u9752","00F":"\u84dd",EE82EE:"\u7d2b\u7f57\u5170",A9A9A9:"\u6df1\u7070",FFA07A:"\u4eae\u6a59",FFA500:"\u6a59",FFFF00:"\u9ec4","00FF00":"\u6c34\u7eff",AFEEEE:"\u7c89\u84dd",ADD8E6:"\u4eae\u84dd",DDA0DD:"\u6885\u7ea2",D3D3D3:"\u6de1\u7070",FFF0F5:"\u6de1\u7d2b\u7ea2",FAEBD7:"\u53e4\u8463\u767d",FFFFE0:"\u6de1\u9ec4",F0FFF0:"\u871c\u767d",F0FFFF:"\u5929\u84dd",
F0F8FF:"\u6de1\u84dd",E6E6FA:"\u6de1\u7d2b",FFF:"\u767d"},justify:{left:"\u9760\u5de6\u5c0d\u9f4a",center:"\u7f6e\u4e2d",right:"\u9760\u53f3\u5c0d\u9f4a",block:"\u5de6\u53f3\u5c0d\u9f4a"},link:{label:"\u63d2\u5165/\u7de8\u8f2f\u8d85\u9023\u7d50",toolbar:"\u63d2\u5165/\u7de8\u8f2f\u8d85\u9023\u7d50",menu:"\u7de8\u8f2f\u8d85\u9023\u7d50",title:"\u8d85\u9023\u7d50",info:"\u8d85\u9023\u7d50\u8cc7\u8a0a",type:"\u8d85\u9023\u63a5\u985e\u578b",url:"\u7db2\u7ad9\u7684\u9023\u7d50\u5730\u5740",displayText:"\u8981\u986f\u793a\u7684\u6587\u672c",
emailAddress:"\u96fb\u5b50\u90f5\u4ef6\u9023\u7d50\u5730\u5740",emailSubject:"\u96fb\u5b50\u90f5\u4ef6\u4e3b\u65e8",toWebAddress:"\u7db2\u7ad9\u9023\u7d50",toEmailAddress:"\u96fb\u5b50\u90f5\u4ef6\u4f4d\u5740",testLink:"\u6e2c\u8a66\u93c8\u63a5",emptyEmail:"\u8acb\u8f38\u5165\u96fb\u5b50\u90f5\u4ef6\u4f4d\u5740",emptyUrl:"\u8acb\u8f38\u5165\u6b32\u9023\u7d50\u7684 URL",invalidEmail:"\u8acb\u8f38\u5165\u6e96\u78ba\u7684\u96fb\u5b50\u90f5\u4ef6\u4f4d\u5740",invalidUrl:"\u8acb\u6e96\u78ba\u8f38\u5165\u6b32\u9023\u7d50\u7684 URL"},
image:{label:"\u5716\u50cf",title:"\u5716\u50cf\u5c6c\u6027",menu:"\u5716\u50cf\u5c6c\u6027",url:"\u5728\u6b64\u8655\u7c98\u5e16\u5716\u7247\u7db2\u5740",alt:"\u66ff\u4ee3\u6587\u5b57",emptyUrl:"\u8acb\u8f38\u5165\u5f71\u50cf URL",invalidUrl:"\u8acb\u8f38\u5165\u6e96\u78ba\u7684\u5f71\u50cf URL",limitQueueDesc:"\u6bcf\u6b21\u6700\u591a\u53ef\u4ee5\u4e0a\u4f20<strong>%d</strong>\u5f20\u5716\u7247",description:"\u5982\u679c\u60a8\u8f38\u5165\u7684\u7db2\u5740\u6b63\u78ba\uff0c\u5247\u53ef\u4ee5\u5728\u6b64\u8655\u9810\u89bd\u6548\u679c\u3002<br />\u5c0d\u65bc\u5927\u5716\u7247\uff0c\u53ef\u80fd\u9700\u8981\u5e7e\u5206\u9418\u624d\u80fd\u986f\u793a\u51fa\u4f86\u3002"},
flash:{label:"Flash",title:"Flash \u5c6c\u6027",menu:"Flash \u5c6c\u6027",url:"\u6765\u6e90\u5730\u5740",size:"Flash \u5c3a\u5bf8",fullscreen:"\u555f\u52d5\u5168\u87a2\u5e55\u986f\u793a",emptyUrl:"\u8acb\u8f38\u5165\u6b32\u9023\u7d50\u7684 URL",invalidUrl:"\u8acb\u6e96\u78ba\u8f38\u5165\u6b32\u9023\u7d50\u7684 URL"},video:{label:"\u89c6\u9891",title:"\u6807\u9898",url:"\u6765\u6e90\u5730\u5740"},iframe:{label:"IFrame",title:"IFrame \u5c6c\u6027",border:"\u986f\u793a\u908a\u6846",scrolling:"\u5141\u8a31\u6efe\u52d5\u689d"},
filebrowser:{image:"\u5716\u7247\u700f\u89bd\u5668"},fileupload:{success:"\u4e0a\u8f09\u6210\u529f",failure:"\u4e0a\u8f09\u5931\u6557",timeout:"\u4e0a\u8f09\u8d85\u6642",reupload:"\u91cd\u65b0\u4e0a\u8f09",wait:"\u7b49\u5f85\u4e0a\u8f09",start:"\u958b\u59cb\u4e0a\u8f09",stop:"\u505c\u6b62\u4e0a\u8f09",selectFile:"\u9078\u64c7\u6587\u4ef6",largeFile:"\u6587\u4ef6\u8fc7\u5927",invalidFile:"\u65e0\u6548\u7684\u6587\u4ef6",invalidFileType:"\u65e0\u6548\u7684\u6587\u4ef6\u7c7b\u578b",dragdrop:"\u62d6\u52d5\u5716\u7247\u81f3\u865b\u7dda\u6846\u5167\u5373\u53ef\u76f4\u63a5\u4e0a\u8f09",
size:"\u652f\u6301\u7684\u6587\u4ef6\u5927\u5c0f",format:"\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f",imageDimension:"\u652f\u6301\u7684\u5716\u50cf\u5c3a\u5bf8",confirmCancel:"\u90e8\u5206\u6587\u4ef6\u5c1a\u672a\u4e0a\u8f09\uff0c\u8981\u95dc\u9589\u5c0d\u8a71\u76d2?",serverFailure:"\u4e0a\u8f09\u670d\u52d9\u66ab\u6642\u4e0d\u53ef\u7528\uff0c\u8acb\u7a0d\u5f8c\u518d\u8a66\uff01",successAndSort:"\u4e0a\u8f09\u6210\u529f\uff0c\u4f60\u53ef\u4ee5\u901a\u904e\u62d6\u62fd\u5df2\u4e0a\u8f09\u7684\u6587\u4ef6\u9032\u884c\u6392\u5e8f",
lastQueueDesc:'\u4e0a\u4e00\u6b21\u7684\u4e0a\u8f09\u968a\u5217\u9084\u6709<strong></strong>\u500b\u6587\u4ef6\u5c1a\u672a\u4e0a\u8f09\u3002\u4f60\u8981<a href="#">\u7e7c\u7e8c\u4e0a\u8f09</a>\u9084\u662f<a href="#">\u653e\u68c4</a>\uff1f',uncertainError:"\u4e0a\u8f09\u5931\u6557\uff0c\u8acb\u6b63\u78ba\u9078\u64c7\u9700\u8981\u4e0a\u8f09\u7684\u6587\u4ef6\uff01",limitQueueError:"\u8d85\u51fa\u6700\u5927\u4e0a\u8f09\u6578\u9650\u5236\uff1a\u6bcf\u6b21\u6700\u591a\u4e0a\u8f09%d\u500b\u6587\u4ef6",
fileSizeError:"\u6587\u4ef6\u904e\u5927\uff1a\u8acb\u9078\u64c7\u5c0f\u65bc%d\u7684\u6587\u4ef6",fileTypeError:"\u7121\u6548\u7684\u6587\u4ef6\u985e\u578b\uff1a\u652f\u6301%d"},smiley:{toolbar:"\u8868\u60c5\u7b26",title:"\u63d2\u5165\u8868\u60c5\u5716\u6807"},specialChar:{toolbar:"\u63d2\u5165\u7279\u6b8a\u7b26\u865f",title:"\u8acb\u9078\u64c7\u7279\u6b8a\u7b26\u865f",selected:"\u5df2\u9078\u64c7\u7684\u7279\u6b8a\u7b26\u865f"},widget:{toolbar:"\u63d2\u5165\u6587\u6a94\u90e8\u4ef6",label:"\u63d2\u5165\u6587\u6a94\u90e8\u4ef6",
title:"\u6587\u6a94\u90e8\u4ef6",emptyList:"(\u7121\u5b9a\u7fa9\u7684\u6587\u6a94\u90e8\u4ef6)"},pseudos:{anchor:"\u9328\u9ede",flash:"Flash \u52d5\u756b",iframe:"IFrame",widget:"\u6587\u6863\u90e8\u4ef6",unknown:"\u4e0d\u660e\u7269\u4ef6"},clipboard:{title:"\u8cbc\u4e0a",cutError:"\u700f\u89bd\u5668\u7684\u5b89\u5168\u6027\u8a2d\u5b9a\u4e0d\u5141\u8a31\u7de8\u8f2f\u5668\u81ea\u52d5\u57f7\u884c\u526a\u4e0b\u52d5\u4f5c\u3002\u8acb\u4f7f\u7528\u5feb\u6377\u9375 (Ctrl/Cmd+X) \u526a\u4e0b\u3002",copyError:"\u700f\u89bd\u5668\u7684\u5b89\u5168\u6027\u8a2d\u5b9a\u4e0d\u5141\u8a31\u7de8\u8f2f\u5668\u81ea\u52d5\u57f7\u884c\u8907\u88fd\u52d5\u4f5c\u3002\u8acb\u4f7f\u7528\u5feb\u6377\u9375 (Ctrl/Cmd+C) \u8907\u88fd\u3002",
pasteMsg:"\u8acb\u4f7f\u7528\u5feb\u6377\u9375 (<strong>Ctrl/Cmd+V</strong>) \u8cbc\u5230\u4e0b\u65b9\u5340\u57df\u4e2d\u4e26\u6309\u4e0b <strong>\u78ba\u5b9a</strong>",securityMsg:"\u56e0\u70ba\u700f\u89bd\u5668\u7684\u5b89\u5168\u6027\u8a2d\u5b9a\uff0c\u672c\u7de8\u8f2f\u5668\u7121\u6cd5\u76f4\u63a5\u5b58\u53d6\u60a8\u7684\u526a\u8cbc\u7c3f\u8cc7\u6599\uff0c\u8acb\u60a8\u81ea\u884c\u5728\u672c\u8996\u7a97\u9032\u884c\u8cbc\u4e0a\u52d5\u4f5c\u3002"},pasteText:"\u8cbc\u70ba\u7d14\u6587\u5b57\u683c\u5f0f",
pastefromword:{label:"\u81ea Word \u8cbc\u4e0a",error:"It was not possible to clean up the pasted data due to an internal error",cleanup:"\u60a8\u60f3\u8cbc\u4e0a\u7684\u6587\u5b57\u4f3c\u4e4e\u662f\u81ea Word \u8907\u88fd\u800c\u4f86\uff0c\u8acb\u554f\u60a8\u662f\u5426\u8981\u5148\u6e05\u9664 Word \u7684\u683c\u5f0f\u5f8c\u518d\u884c\u8cbc\u4e0a\uff1f"},maximize:"\u6700\u5927\u5316",restore:"\u6062\u5fa9",elementspath:"%1 \u5143\u7d20",wordcount:"\u8fd8\u53ef\u4ee5\u8f93\u5165<em>{number}</em>\u5b57",
toolbar:{collapse:"\u6298\u53e0\u5de5\u5177\u680f",expand:"\u5c55\u5f00\u5de5\u5177\u680f"},resize:{drop:"\u62d6\u62fd\u4ee5\u6539\u53d8\u5c3a\u5bf8",larger:"\u589e\u5927\u7f16\u8f91\u533a\u57df",smaller:"\u51cf\u5c0f\u7f16\u8f91\u533a\u57df"}};
Klass.Editor.lang["zh-cn"]={source:"\u6e90\u4ee3\u7801",save:"\u4fdd\u5b58",preview:"\u9884\u89c8",cut:"\u526a\u5207",copy:"\u590d\u5236",paste:"\u7c98\u8d34",print:"\u6253\u5370",bold:"\u52a0\u7c97",italic:"\u503e\u659c",underline:"\u4e0b\u5212\u7ebf",strike:"\u5220\u9664\u7ebf",selectAll:"\u5168\u9009",subscript:"\u4e0b\u6807",superscript:"\u4e0a\u6807",indent:"\u589e\u52a0\u7f29\u8fdb\u91cf",outdent:"\u51cf\u5c11\u7f29\u8fdb\u91cf",bulletedlist:"\u9879\u76ee\u5217\u8868",numberedlist:"\u7f16\u53f7\u5217\u8868",
blockquote:"\u5757\u5f15\u7528",removeFormat:"\u6e05\u9664\u683c\u5f0f",date:"\u63d2\u5165\u65e5\u671f",horizontalrule:"\u63d2\u5165\u6c34\u5e73\u7ebf",unlink:"\u53d6\u6d88\u8d85\u94fe\u63a5",undo:"\u64a4\u9500",redo:"\u91cd\u505a",common:{upload:"\u4e0a\u4f20",button:"\u6309\u94ae",name:"\u540d\u79f0",ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88",yes:"\u662f",no:"\u5426",close:"\u5173\u95ed",preview:"\u9884\u89c8",general:"\u5e38\u89c4",advanced:"\u9ad8\u7ea7",options:"\u9009\u9879",target:"\u76ee\u6807\u7a97\u53e3",
loop:"\u5faa\u73af",auto:"\u81ea\u52a8",autoPlay:"\u81ea\u52a8\u64ad\u653e",width:"\u5bbd\u5ea6",height:"\u9ad8\u5ea6",align:"\u5bf9\u9f50\u65b9\u5f0f",alignLeft:"\u5de6\u5bf9\u9f50",alignRight:"\u53f3\u5bf9\u9f50",alignCenter:"\u5c45\u4e2d",alignTop:"\u9876\u7aef",alignMiddle:"\u5c45\u4e2d",alignBottom:"\u5e95\u90e8",url:"\u6765\u6e90\u5730\u5740",localFiles:"\u672c\u5730\u6587\u4ef6",webAddress:"\u7f51\u7edc\u5730\u5740",emptyTooltip:"\u8bf7\u8f93\u5165%t",invalidTooltip:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684%t",
invalidWidth:"\u5bbd\u5ea6\u5fc5\u987b\u4e3a\u6570\u5b57\u683c\u5f0f",invalidHeight:"\u9ad8\u5ea6\u5fc5\u987b\u4e3a\u6570\u5b57\u683c\u5f0f",invalidLength:"%l\u5fc5\u987b\u4e3a\u6b63\u6570\uff0c\u5141\u8bb8\u5305\u542b\u4e00\u4e2a\u6709\u6548\u7684\u957f\u5ea6\u5355\u4f4d(px \u6216 %)",confirmCancel:"\u90e8\u5206\u4fee\u6539\u5c1a\u672a\u4fdd\u5b58\uff0c\u662f\u5426\u786e\u8ba4\u5173\u95ed\u5bf9\u8bdd\u6846\uff1f"},font:{label:"\u5b57\u4f53",panelTitle:"\u5b57\u4f53"},fontsize:{label:"\u5b57\u53f7",
panelTitle:"\u5b57\u53f7"},format:{label:"\u683c\u5f0f",panelTitle:"\u683c\u5f0f",tag_p:"\u666e\u901a",tag_pre:"\u5df2\u7f16\u6392\u683c\u5f0f",tag_address:"\u5730\u5740",tag_h1:"\u6807\u9898 1",tag_h2:"\u6807\u9898 2",tag_h3:"\u6807\u9898 3",tag_h4:"\u6807\u9898 4",tag_h5:"\u6807\u9898 5",tag_h6:"\u6807\u9898 6",tag_div:"\u6bb5\u843d(DIV)"},styles:{label:"\u6837\u5f0f",panelTitle:"\u6837\u5f0f",panelTitle1:"\u5757\u7ea7\u5143\u7d20\u6837\u5f0f",panelTitle2:"\u5185\u8054\u5143\u7d20\u6837\u5f0f",
panelTitle3:"\u5bf9\u8c61\u5143\u7d20\u6837\u5f0f"},color:{selectColor:"\u9009\u62e9\u989c\u8272",textColor:"\u6587\u672c\u989c\u8272",bgColor:"\u80cc\u666f\u989c\u8272",standard:"\u6807\u51c6\u8272",theme:"\u4e3b\u9898\u989c\u8272",auto:"\u81ea\u52a8",more:"\u5176\u4ed6\u989c\u8272..."},colors:{"000":"\u9ed1",8E5:"\u8910\u7ea2","8B4513":"\u6df1\u8910","2F4F4F":"\u58a8\u7eff","008080":"\u7eff\u677e\u77f3","000080":"\u6d77\u519b\u84dd","4B0082":"\u975b\u84dd",696969:"\u6697\u7070",B22222:"\u7816\u7ea2",
A52A2A:"\u8910",DAA520:"\u91d1\u9ec4","006400":"\u6df1\u7eff","40E0D0":"\u84dd\u7eff","0000CD":"\u4e2d\u84dd",800080:"\u7d2b",808080:"\u7070",F00:"\u7ea2",FF8C00:"\u6df1\u6a59",FFD700:"\u91d1","008000":"\u7eff","0FF":"\u9752","00F":"\u84dd",EE82EE:"\u7d2b\u7f57\u5170",A9A9A9:"\u6df1\u7070",FFA07A:"\u4eae\u6a59",FFA500:"\u6a59",FFFF00:"\u9ec4","00FF00":"\u6c34\u7eff",AFEEEE:"\u7c89\u84dd",ADD8E6:"\u4eae\u84dd",DDA0DD:"\u6885\u7ea2",D3D3D3:"\u6de1\u7070",FFF0F5:"\u6de1\u7d2b\u7ea2",FAEBD7:"\u53e4\u8463\u767d",
FFFFE0:"\u6de1\u9ec4",F0FFF0:"\u871c\u767d",F0FFFF:"\u5929\u84dd",F0F8FF:"\u6de1\u84dd",E6E6FA:"\u6de1\u7d2b",FFF:"\u767d"},justify:{left:"\u5de6\u5bf9\u9f50",center:"\u5c45\u4e2d\u5bf9\u9f50",right:"\u53f3\u5bf9\u9f50",block:"\u4e24\u7aef\u5bf9\u9f50"},link:{label:"\u63d2\u5165/\u7f16\u8f91\u8d85\u94fe\u63a5",toolbar:"\u63d2\u5165/\u7f16\u8f91\u8d85\u94fe\u63a5",menu:"\u7f16\u8f91\u8d85\u94fe\u63a5",title:"\u8d85\u94fe\u63a5",info:"\u8d85\u94fe\u63a5\u4fe1\u606f",type:"\u8d85\u94fe\u63a5\u7c7b\u578b",
url:"\u7f51\u7ad9\u7684\u94fe\u63a5\u5730\u5740",displayText:"\u8981\u663e\u793a\u7684\u6587\u672c",emailAddress:"\u7535\u5b50\u90ae\u4ef6\u7684\u94fe\u63a5\u5730\u5740",emailSubject:"\u7535\u5b50\u90ae\u4ef6\u7684\u4e3b\u9898",toWebAddress:"\u7f51\u7ad9\u5730\u5740",toEmailAddress:"\u7535\u5b50\u90ae\u4ef6\u5730\u5740",testLink:"\u6d4b\u8bd5\u94fe\u63a5",emptyEmail:"\u8bf7\u8f93\u5165\u7535\u5b50\u90ae\u4ef6\u5730\u5740",emptyUrl:"\u8bf7\u8f93\u5165\u7f51\u7ad9\u94fe\u63a5\u5730\u5740",invalidEmail:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740",
invalidUrl:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7f51\u7ad9\u94fe\u63a5\u5730\u5740"},image:{label:"\u56fe\u50cf",title:"\u56fe\u50cf\u5c5e\u6027",menu:"\u56fe\u50cf\u5c5e\u6027",url:"\u5728\u6b64\u5904\u7c98\u5e16\u56fe\u7247\u7f51\u5740",alt:"\u66ff\u6362\u6587\u672c",emptyUrl:"\u8bf7\u8f93\u5165\u56fe\u50cf\u5730\u5740",invalidUrl:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u56fe\u50cf\u5730\u5740",limitQueueDesc:"\u6bcf\u6b21\u6700\u591a\u53ef\u4ee5\u4e0a\u4f20<strong>%d</strong>\u5f20\u56fe\u7247",
description:"\u5982\u679c\u60a8\u8f93\u5165\u7684\u7f51\u5740\u6b63\u786e\uff0c\u5219\u53ef\u4ee5\u5728\u6b64\u5904\u9884\u89c8\u6548\u679c\u3002<br />\u5bf9\u4e8e\u5927\u56fe\u7247\uff0c\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\u624d\u80fd\u663e\u793a\u51fa\u6765\u3002"},flash:{label:"Flash",title:"Flash \u5c5e\u6027",menu:"Flash \u5c5e\u6027",url:"\u6765\u6e90\u5730\u5740",size:"Flash \u5c3a\u5bf8",fullscreen:"\u542f\u7528\u5168\u5c4f",emptyUrl:"\u8bf7\u8f93\u5165Flash \u6765\u6e90\u5730\u5740",
invalidUrl:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684Flash \u6765\u6e90\u5730\u5740"},video:{label:"\u89c6\u9891",title:"\u89c6\u9891\u5c5e\u6027",url:"\u6765\u6e90\u5730\u5740"},iframe:{label:"IFrame",title:"IFrame \u5c5e\u6027",border:"\u663e\u793a\u8fb9\u6846",scrolling:"\u5141\u8bb8\u6eda\u52a8\u6761"},filebrowser:{image:"\u56fe\u7247\u6d4f\u89c8\u5668"},fileupload:{success:"\u4e0a\u4f20\u6210\u529f",failure:"\u4e0a\u4f20\u5931\u8d25",timeout:"\u4e0a\u4f20\u8d85\u65f6",reupload:"\u91cd\u65b0\u4e0a\u4f20",
wait:"\u7b49\u5f85\u4e0a\u4f20",start:"\u5f00\u59cb\u4e0a\u4f20",stop:"\u505c\u6b62\u4e0a\u4f20",selectFile:"\u9009\u62e9\u6587\u4ef6",largeFile:"\u6587\u4ef6\u8fc7\u5927",invalidFile:"\u65e0\u6548\u7684\u6587\u4ef6",invalidFileType:"\u65e0\u6548\u7684\u6587\u4ef6\u7c7b\u578b",dragdrop:"\u62d6\u52a8\u56fe\u7247\u81f3\u865a\u7ebf\u6846\u5185\u5373\u53ef\u76f4\u63a5\u4e0a\u4f20",size:"\u652f\u6301\u7684\u6587\u4ef6\u5927\u5c0f",format:"\u652f\u6301\u7684\u6587\u4ef6\u683c\u5f0f",imageDimension:"\u652f\u6301\u7684\u56fe\u7247\u5c3a\u5bf8",
confirmCancel:"\u90e8\u5206\u6587\u4ef6\u5c1a\u672a\u4e0a\u4f20\uff0c\u662f\u5426\u786e\u8ba4\u5173\u95ed\u5bf9\u8bdd\u6846?",serverFailure:"\u4e0a\u4f20\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff01",successAndSort:"\u4e0a\u4f20\u6210\u529f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u62d6\u62fd\u5df2\u4e0a\u4f20\u7684\u6587\u4ef6\u8fdb\u884c\u6392\u5e8f",lastQueueDesc:'\u4e0a\u4e00\u6b21\u7684\u4e0a\u4f20\u961f\u5217\u8fd8\u6709<strong></strong>\u4e2a\u6587\u4ef6\u5c1a\u672a\u4e0a\u4f20\u3002\u4f60\u8981<a href="#">\u7ee7\u7eed\u4e0a\u4f20</a>\u8fd8\u662f<a href="#">\u653e\u5f03</a>\uff1f',
uncertainError:"\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u6b63\u786e\u9009\u62e9\u9700\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\uff01",limitQueueError:"\u8d85\u51fa\u6700\u5927\u4e0a\u4f20\u6570\u9650\u5236\uff1a\u6bcf\u6b21\u6700\u591a\u4e0a\u4f20%d\u4e2a\u6587\u4ef6",fileSizeError:"\u6587\u4ef6\u8fc7\u5927\uff1a\u8bf7\u9009\u62e9\u5c0f\u4e8e%d\u7684\u6587\u4ef6",fileTypeError:"\u65e0\u6548\u7684\u6587\u4ef6\u7c7b\u578b\uff1a\u652f\u6301%d"},smiley:{toolbar:"\u8868\u60c5\u7b26",title:"\u63d2\u5165\u8868\u60c5\u56fe\u6807"},
specialChar:{toolbar:"\u63d2\u5165\u7279\u6b8a\u5b57\u7b26",title:"\u9009\u62e9\u7279\u6b8a\u5b57\u7b26",selected:"\u9009\u4e2d\u7684\u7279\u6b8a\u5b57\u7b26"},widget:{toolbar:"\u63d2\u5165\u6587\u6863\u90e8\u4ef6",label:"\u63d2\u5165\u6587\u6863\u90e8\u4ef6",title:"\u6587\u6863\u90e8\u4ef6",emptyList:"(\u6ca1\u6709\u5df2\u5b9a\u4e49\u7684\u6587\u6863\u90e8\u4ef6)"},pseudos:{anchor:"\u951a\u70b9",flash:"Flash \u52a8\u753b",iframe:"IFrame",widget:"\u6587\u6863\u90e8\u4ef6",unknown:"\u672a\u77e5\u5bf9\u8c61"},
clipboard:{title:"\u7c98\u8d34",cutError:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c, \u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copyError:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",pasteMsg:"\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(<STRONG>Ctrl/Cmd+V</STRONG>)\u628a\u5185\u5bb9\u7c98\u8d34\u5230\u4e0b\u9762\u7684\u65b9\u6846\u91cc\uff0c\u518d\u6309 <STRONG>\u786e\u5b9a</STRONG>",
securityMsg:"\u56e0\u4e3a\u4f60\u7684\u6d4f\u89c8\u5668\u7684\u5b89\u5168\u8bbe\u7f6e\u539f\u56e0, \u672c\u7f16\u8f91\u5668\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\u4f60\u7684\u526a\u8d34\u677f\u5185\u5bb9, \u4f60\u9700\u8981\u5728\u672c\u7a97\u53e3\u91cd\u65b0\u7c98\u8d34\u4e00\u6b21",pasteArea:"\u7c98\u8d34\u533a\u57df"},pasteText:"\u7c98\u8d34\u4e3a\u65e0\u683c\u5f0f\u6587\u672c",pastefromword:{label:"\u4ece MS Word \u7c98\u8d34",error:"\u7531\u4e8e\u5185\u90e8\u9519\u8bef\u65e0\u6cd5\u6e05\u7406\u8981\u7c98\u8d34\u7684\u6570\u636e",
cleanup:"\u60a8\u8981\u7c98\u8d34\u7684\u5185\u5bb9\u597d\u50cf\u662f\u6765\u81ea MS Word, \u662f\u5426\u8981\u6e05\u9664 MS Word \u683c\u5f0f\u540e\u518d\u7c98\u8d34?"},maximize:"\u5168\u5c4f",restore:"\u8fd8\u539f",elementspath:"%1 \u5143\u7d20",wordcount:"\u8fd8\u53ef\u4ee5\u8f93\u5165<em>{number}</em>\u5b57",toolbar:{collapse:"\u6298\u53e0\u5de5\u5177\u680f",expand:"\u5c55\u5f00\u5de5\u5177\u680f"},resize:{drop:"\u62d6\u62fd\u4ee5\u6539\u53d8\u5c3a\u5bf8",larger:"\u589e\u5927\u7f16\u8f91\u533a\u57df",
smaller:"\u51cf\u5c0f\u7f16\u8f91\u533a\u57df"}};
Klass.Editor.markup={mainContainer:'<div id="{baseCls}{uid}" class="{baseCls}"><div></div></div>',iframeContainer:'<iframe frameborder="0" allowtransparency="true" tabindex="{tabIndex}" src="{src}" style="width:100%; height:100%;"></iframe>',iframeContent:'<!DOCTYPE html><html dir="{direction}"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>{title}</title>{contentsCss}<style type="text/css">{baseCss}{externalCss}</style>{baseHead}{externalHead}</head><body>{content}</body></html><script type="text/javascript" id="kse-script" data-rte-temp="1">{script}<\/script>',button:'<span class="kse-icon"></span><span class="kse-label">{title}</span>',
select:'<span class="kse-label kse-inline">{label}</span><span class="kse-handle"><span class="kse-arrow"></span></span>',panelBlock:'<div class="kse-panel-block" tabIndex="-1"><ul></ul></div>',comboPanel:'<div class="kse-richcombo"></div>',comboPanelContent:'<!DOCTYPE html><html dir="{direction}"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>{title}</title>{contentsCss}<style type="text/css">{baseCss} {externalCss}</style>{baseHead}{externalHead}</head><body class="kse-panel-frame"></body></html>',
resize:'<div class="x-rte-resize"><div class="x-rte-resize-larger" title="{larger}">{larger}</div><div class="x-rte-resize-smaller" title="{smaller}">{smaller}</div></div>',dialog:'<div class="kse-skin kse-dialog {browserCSSClass}"><div class="kse-dialog-title">{title}</div><div class="kse-dialog-close" title="{close}">{close}</div><div class="kse-dialog-main"><div class="kse-dialog-tabs"></div><div class="kse-dialog-tips"><div class="kse-tip kse-error"></div></div><div class="kse-dialog-contents">{contents}</div><div class="kse-dialog-buttons"></div></div></div>',
richCombo:{item:'<span class="x-rte-richcombo-selected"></span>{preview}<span class="x-rte-richcombo-snapshot"></span>'},color:{button:'<span class="kse-icon"></span><span class="kse-label">{label}</span><span class="kse-buttonarrow"></span><div class="kse-colorbar"></div>',block:"",panel:""},palette:{wrap:'<div class="kse-palette"><div class="kse-palette-inherit"><a class="kse-palette-color-auto" href="javascript:void(0);" hidefocus="true"><table class="kse-palette-table" width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="kse-palette-cell"><span class="kse-palette-restore"></span></td><td colspan="7">{autoInherit}</td></tr></tbody></table></a></div><div class="kse-palette-standard"><h4>{standardColors}</h4>{standardColorTable}</div><div class="kse-palette-theme"><h4>{themeColors}</h4>{themesTable}</div><div class="kse-palette-themes">{themeColorsTable}</div><div class="kse-palette-more" style="display:{enableMore};"><a class="kse-palette-color-more" href="javascript:void(0);" kse-color="?">{moreColors}</a></div></div>',
table:'<table class="kse-palette-table" cellspacing="0" cellpadding="0"><tbody class="kse-palette-body">{rows}</tbody></table>',row:'<tr class="kse-palette-row">{cells}</tr>',cell:'<td class="kse-palette-cell">{item}</td>',ul:'<ul class="kse-palette-ul">{lists}</ul>',li:'<li class="kse-palette-li">{items}</li>',item:'<a class="kse-palette-color" href="javascript:void(0);" hidefocus="true" kse-color="{color}"><span class="kse-palette-color" style="background-color:#{color};"></span></a>'}};
Klass.Editor.dtd=function(){var a=Object.merge,c=function(a,b){for(var d=Object.clone(a),f=1;f<arguments.length;f++){var b=arguments[f],c;for(c in b)delete d[c]}return d},b={},e={},g={style:1},h={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},d={command:1,link:1,meta:1,noscript:1,script:1,style:1},f={},i={"#":1},j={tr:1},m={li:1},l={center:1,dir:1,
noframes:1};a(b,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,"var":1,video:1,wbr:1},i,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1});a(e,h,b,l);a(g,e);return{$block:a({audio:1,
dd:1,dt:1,figcaption:1,li:1,video:1},h,l),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,
br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:b,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:a({base:1,body:1,head:1,html:1,title:1},d),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,
bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,"var":1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,
optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},a:c(b,{a:1,button:1}),abbr:b,address:e,area:f,article:g,aside:g,audio:a({source:1,track:1},e),b:b,base:f,bdi:b,bdo:b,blockquote:e,body:e,br:f,button:c(b,{a:1,button:1}),canvas:b,caption:e,cite:b,code:b,col:f,colgroup:{col:1},command:f,datalist:a({option:1},b),dd:e,del:b,details:a({summary:1},e),dfn:b,div:g,dl:{dd:1,dt:1},dt:e,em:b,embed:f,fieldset:a({legend:1},e),figcaption:e,figure:a({figcaption:1},e),footer:e,form:e,
h1:b,h2:b,h3:b,h4:b,h5:b,h6:b,head:a({base:1,title:1},d),header:e,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:f,html:a({head:1,body:1},e,d),i:b,iframe:i,img:f,input:f,ins:b,kbd:b,keygen:f,label:b,legend:b,li:e,link:f,map:e,mark:b,menu:a({li:1},e),meta:f,meter:c(b,{meter:1}),nav:e,noscript:a({link:1,meta:1,style:1},b),object:a({param:1},b),ol:m,optgroup:{option:1},option:i,output:b,p:b,param:f,pre:b,progress:c(b,{progress:1}),q:b,rp:b,rt:b,ruby:a({rp:1,rt:1},b),s:b,samp:b,script:i,section:g,select:{optgroup:1,
option:1},small:b,source:f,span:b,strong:b,style:i,sub:b,summary:b,sup:b,table:{caption:1,colgroup:1,tbody:1,tfoot:1,thead:1,tr:1},tbody:j,td:e,textarea:i,tfoot:j,th:e,thead:j,time:c(b,{time:1}),title:i,tr:{td:1,th:1},track:f,u:b,ul:m,"var":b,video:a({source:1,track:1},e),wbr:f,acronym:b,applet:a({param:1},e),basefont:f,big:b,center:e,dialog:f,dir:m,font:b,isindex:f,noframes:e,strike:b,tt:b}}();
(function(a,c){var b=a.document,e=[];c.Editor.utils={unique:function(){var a=0;return function(){return++a}}(),isCustomDomain:function(){var e=b.domain,h=a.location.hostname;return c.env.ie&&e!=h&&e!="["+h+"]"},initIFrameDocument:function(a,c){if(!a)return b;var a=a[0]||a,d=(a.contentWindow||a.contentDocument).document;c&&(d.open(),d.write(c),d.close());return new Klass.DOM.document(d)},buildStyleHtml:function(a){for(var a=[].concat(a),b,d=[],f=0,c=a.length;f<c;f++)b=a[f],/@import|[{}]/.test(b)?d.push("<style>"+
b+"</style>"):d.push('<link type="text/css" rel="stylesheet" href="'+b+'">');return d.join("")},htmlEncode:function(a){var b=function(a){return(new c.DOM.createElement("span")).text(a).html()},d="<br>"==b("\n").toLowerCase()?function(a){return b(a).replace(/<br>/gi,"\n")}:b,f=">"==b(">")?function(a){return d(a).replace(/>/g,"&gt;")}:d;this.htmlEncode="&nbsp; "==b("  ")?function(a){return f(a).replace(/&nbsp;/g," ")}:f;return this.htmlEncode(a)},escapeHTML:function(a){return a.replace(/"/g,"&quot;").replace(/</g,
"&lt;").replace(/>/g,"&gt;")},isEmpty:function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},addFunction:function(a,b){return e.push(function(){return a.apply(b||this,arguments)})-1},removeFunction:function(a){e[a]=null},callFunction:function(b){return(b=e[b])&&b.apply(a,Array.prototype.slice.call(arguments,1))},arrayCompare:function(a,b){return!a&&!b?!0:!a||!b||a.length!==b.length?!1:a&&a.compare&&b?a.compare(b):!1},clone:function(a){var b;if(a&&a instanceof Array){b=[];for(var d=0,
f=a.length;d<f;d++)b[d]=this.clone(a[d]);return b}if(null===a||"object"!==typeof a||a instanceof String||a instanceof Number||a instanceof Boolean||a instanceof Date||a instanceof RegExp)return a;b=new a.constructor;for(d in a)b[d]=this.clone(a[d]);return b},convertToPx:function(){var a;return function(b){if(!a){var d=c.Editor.document;a=c.DOM.create('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',d);d.body().append(a)}return!/%$/.test(b)?(a.style("width",
b),a[0].clientWidth):b}}(),parseHTML:function(){var a=/\s*(\w+)=(?:"|')([^'"]+)(?:"|')\s*/g;return function(b){var d,f,e,j,m=Array.prototype.splice.call(arguments,1);for(d=0,f=m.length;d<f;d++)e=m[d],j=j||RegExp("^(<"+e+"[^>]*>.*<\\/"+e+">)$","i").test(b);if(j=j&&{})if(b.replace(a,function(a,b,d){b&&d&&(j[b.toLowerCase()]=d)}),!c.isEmptyObject(j))return j;return null}}(),isURL:function(){var a=/^((?:http|https|ftp|news):\/\/)?(.*)$/;return function(b){return b&&a.test(b)}}()}})(window,Klass);
Array.implement({compare:function(a){if(!a.length)return!1;for(var c=0,b=a.length;c<b;c++)if(this[c]!=a[c])return!1;return!0}});String.implement({ltrim:function(){return this.replace(/^[ \t\n\r]+/g,"")},rtrim:function(){return this.replace(/[ \t\n\r]+$/g,"")}});
(function(a){var c=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,b={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};a.htmlParser=new Class({initialize:function(){this.htmlPartsRegex=RegExp("<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)--\>)|(?:([^\\s>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'>])*)\\/?>))","g")},onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},
onComment:function(){},parse:function(e){for(var g,h,d=0,f;g=this.htmlPartsRegex.exec(e);){h=g.index;h>d&&(d=e.substring(d,h),f?f.push(d):this.onText(d));d=this.htmlPartsRegex.lastIndex;if(h=g[1])if(h=h.toLowerCase(),f&&a.dtd.$cdata[h]&&(this.onCDATA(f.join("")),f=null),!f){this.onTagClose(h);continue}if(f)f.push(g[0]);else if(h=g[3]){if(h=h.toLowerCase(),!/="/.test(h)){var i={},j;g=g[4];var m=!!(g&&"/"==g.charAt(g.length-1));if(g)for(;j=c.exec(g);){var l=j[1].toLowerCase();j=j[2]||j[3]||j[4]||"";
i[l]=!j&&b[l]?l:j}this.onTagOpen(h,i,m);!f&&a.dtd.$cdata[h]&&(f=[])}}else if(h=g[2])this.onComment(h)}if(e.length>d)this.onText(e.substring(d,e.length))}})})(Klass.Editor);
Klass.Editor.htmlParser.basicWriter=new Class({initialize:function(){this.output=[]},openTag:function(a){this.output.push("<",a)},openTagClose:function(a,c){this.output.push(c?" />":">")},attribute:function(a,c){"string"===typeof c&&(c=Klass.Editor.utils.escapeHTML(c));this.output.push(" ",a,'="',c,'"')},closeTag:function(a){this.output.push("</",a,">")},text:function(a){this.output.push(a)},comment:function(a){this.output.push("<\!--",a,"--\>")},write:function(a){this.output.push(a)},reset:function(){this.output=
[];this.indent=!1},getHtml:function(a){var c=this.output.join("");a&&this.reset();return c}});
(function(a){a.htmlWriter=new Class({Extends:a.htmlParser.basicWriter,initialize:function(){this.parent();this.indentationChars="\t";this.selfClosingEnd=" />";this.lineBreakChars="\n";this.forceSimpleAmpersand=0;this.sortAttributes=1;this.indent=0;this.indents="";this.inPre=0;this.rules={};var c=a.dtd,b;for(b in Object.merge({},c.$nonBodyContent,c.$block,c.$listItem,c.$tableContent))this.setRules(b,{indent:1,breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("br",
{breakAfterOpen:1});this.setRules("title",{indent:0,breakAfterOpen:0});this.setRules("style",{indent:0,breakBeforeClose:1});this.setRules("pre",{indent:0})},openTag:function(a){var b=this.rules[a];this.indent?this.indentation():b&&b.breakBeforeOpen&&(this.lineBreak(),this.indentation());this.output.push("<",a)},openTagClose:function(a,b){var e=this.rules[a];b?this.output.push(this.selfClosingEnd):(this.output.push(">"),e&&e.indent&&(this.indents+=this.indentationChars));e&&e.breakAfterOpen&&this.lineBreak();
"pre"===a&&(this.inPre=1)},attribute:function(c,b){"string"==typeof attValue&&(this.forceSimpleAmpersand&&(b=b.replace(/&amp;/g,"&")),b=a.utils.escapeHTML(b));this.output.push(" ",c,'="',b,'"')},closeTag:function(a){var b=this.rules[a];if(b&&b.indent)this.indents=this.indents.substr(this.indentationChars.length);this.indent?this.indentation():b&&b.breakBeforeClose&&(this.lineBreak(),this.indentation());this.output.push("</",a,">");"pre"==a&&(this.inPre=0);b&&b.breakAfterClose&&this.lineBreak()},text:function(a){this.indent&&
(this.indentation(),!this.inPre&&(a=a.ltrim()));this.output.push(a)},comment:function(a){this.indent&&this.indentation();this.output.push("<\!--",a,"--\>")},lineBreak:function(){!this.inPre&&0<this.output.length&&this.output.push(this.lineBreakChars);this.indent=1},indentation:function(){this.inPre||this.output.push(this.indents);this.indent=0},setRules:function(a,b){var e=this.rules[a];e?Object.append(e,b):this.rules[a]=b}})})(Klass.Editor);
(function(a){a.htmlParser.node=new Class({remove:function(){var a=this.parent.children,b=a.indexOf(this),e=this.previous,g=this.next;e&&(e.next=g);g&&(g.previous=e);a.splice(b,1);this.parent=null},replaceWith:function(a){var b=this.parent.children,e=b.indexOf(this),g=a.previous=this.previous,h=a.next=this.next;g&&(g.next=a);h&&(h.previous=a);b[e]=a;a.parent=this.parent;this.parent=null},insertAfter:function(a){var b=a.parent.children,e=b.indexOf(a),g=a.next;b.splice(e+1,0,this);this.next=a.next;this.previous=
a;a.next=this;g&&(g.previous=this);this.parent=a.parent},insertBefore:function(a){var b=a.parent.children,e=b.indexOf(a);b.splice(e,0,this);this.next=a;(this.previous=a.previous)&&(a.previous.next=this);a.previous=this;this.parent=a.parent},getAscendant:function(a){var b="function"==typeof a?a:"string"==typeof a?function(b){return b.name===a}:function(b){return b.name in a},e=this.parent;for(;e&&e.$element;){if(b(e))return e;e=e.parent}return null},wrapWith:function(a){this.replaceWith(a);a.add(this);
return a},getIndex:function(){return this.parent.children.indexOf(this)},getFilterContext:function(a){return a||{}}})})(Klass.Editor);(function(a){a.htmlParser.cdata=new Class({Implements:a.htmlParser.node,initialize:function(c){this.value=c;this.type=a.$.NODE_TEXT;this.$text=1},filter:function(){},writeHtml:function(a){a.write(this.value)}})})(Klass.Editor);
Klass.Editor.htmlParser.comment=new Class({Implements:Klass.Editor.htmlParser.node,initialize:function(a){this.value=a;this.parent=null;this.type=Klass.Editor.$.NODE_COMMENT;this.$comment=1;this.isBlockLike=!1},filter:function(a,c){var b=this.value;if(!(b=a.onComment(this,c)))return this.remove(),!1;if("string"!==typeof b)return this.replaceWith(b),!1;this.value=b;return!0},writeHtml:function(a,c){c&&this.filter(c);a.comment(this.value)}});
(function(a,c){function b(a,b,d){if(b){var f,c;for(c in b)f=a[c]=a[c]||new e,f.add(b[c],d)}}var e=a.htmlParser.filterRulesGroup=new Class({initialize:function(){this.rules=[]},add:function(a,b){a&&this.rules.splice(this.findIndex(b.priority),0,{value:a,options:b})},addMany:function(a,b){if(a){for(var d=[this.findIndex(b.priority),0],f=0,c=a.length;f<c;f++)d.push({value:a[f],options:b});this.rules.splice.apply(this.rules,d)}},findIndex:function(a){for(var b=this.rules,d=b.length-1;0<=d&&a<b[d].options.priority;)d--;
return d+1},exec:function(b,e){var d=e instanceof a.htmlParser.node||e instanceof a.htmlParser.fragment,f=Array.prototype.slice.call(arguments,1),i=this.rules,j=i.length,m,l,k,n;for(n=0;n<j;n++){if(d)m=e.type,l=e.name;k=i[n];if(!(b.nonEditable&&!k.options.applyToAll||b.nestedEditable&&k.options.excludeNestedEditable)){k=k.value.apply(null,f);if(!1===k||d&&k&&(k.name!==l||k.type!==m))return k;k!=c&&(f[0]=e=k)}}return e},filterName:function(a,b){for(var d=0,f=this.rules,c=f.length,e;b&&d<c;d++)e=f[d],
!(a.nonEditable&&!e.options.applyToAll||a.nestedEditable&&e.options.excludeNestedEditable)&&(b=b.replace(e.value[0],e.value[1]));return b}});a.htmlParser.filter=new Class({initialize:function(a){this.id=Klass.uniqueID();this.elementNameRules=new e;this.attributeNameRules=new e;this.elementsRules={};this.attributesRules={};this.textRules=new e;this.commentRules=new e;this.rootRules=new e;a&&this.addRules(a)},addRules:function(a,c){var d=typeof c,f="number"===d?c:10,c="object"===d?c:{};c.priority=c.priority||
f;this.elementNameRules.addMany(a.elementNames,c);this.attributeNameRules.addMany(a.attributeNames,c);b(this.elementsRules,a.elements,c);b(this.attributesRules,a.attributes,c);this.textRules.add(a.text,c);this.commentRules.add(a.comment,c);this.rootRules.add(a.root,c)},applyTo:function(a){a.filter&&a.filter(this)},onElementName:function(a,b){return this.elementNameRules.filterName(b,a)},onAttributeName:function(a,b){return this.attributeNameRules.filterName(b,a)},onText:function(a,b){return this.textRules.exec(b,
a)},onComment:function(a,b){return this.commentRules.exec(b,a.value,a)},onRoot:function(a,b){return this.rootRules.exec(b,a)},onElement:function(a,b){for(var d=[this.elementsRules["^"],this.elementsRules[a.name],this.elementsRules.$],f,c=0;3>c;c++)if(f=d[c]){f=f.exec(b,a,this);if(!1===f)return null;if(f&&f!=a)return this.onNode(f,b);if(a.parent&&!a.name)break}return a},onNode:function(b,c){return b.$element?this.onElement(b,c):b.$text?new a.htmlParser.text(this.onText(b.value,c)):b.$comment?new a.htmlParser.comment(this.onComment(b,
c)):null},onAttribute:function(a,b,d,f){return(b=this.attributesRules[b])?b.exec(f,d,a,this):d}})})(Klass.Editor);
(function(a,c){function b(a){return a.attributes["data-kse-survive"]?!1:"a"===a.name&&a.attributes.href||e.$removeEmpty[a.name]}var e=a.dtd,g=a.htmlParser,h=Object.merge({table:1,ul:1,ol:1,dl:1},e.table,e.ul,e.ol,e.dl),d={ol:1,ul:1},f=Object.merge({html:1},e.html,e.body,e.head,{style:1,script:1});g.fragment=new Class({initialize:function(){this.children=[];this.parent=null;this.type=a.$.NODE_DOCUMENT_FRAGMENT;this.$fragment=1;this.isBlockLike=!0;this.hasInlineStarted=!1},add:function(a,b){isNaN(b)&&
(b=this.children.length);var d=0<b?this.children[b-1]:null;if(d){if(a.isBlockLike&&d.$text&&(d.value=d.value.rtrim(),0===d.value.length)){this.children.pop();this.add(a);return}d.next=a}a.previous=d;a.parent=this;this.children.splice(b,0,a);if(!this.hasInlineStarted)this.hasInlineStarted=a.$text||a.$element&&!a.isBlockLike},filter:function(a,b){b=this.getFilterContext(b);a.onRoot(this,b);this.filterChildren(a,!1,b)},filterChildren:function(a,b,d){if(this.childrenFilteredBy!=a.id){d=this.getFilterContext(d);
if(b&&!this.parent)a.onRoot(this,d);this.childrenFilteredBy=a.id;for(b=0;b<this.children.length;b++)!1===this.children[b].filter(a,d)&&b--}},writeHtml:function(a,b){b&&this.filter(b);this.writeChildrenHtml(a)},writeChildrenHtml:function(a,b,d){var f=this.getFilterContext();if(d&&!this.parent&&b)b.onRoot(this,f);b&&this.filterChildren(b,!1,f);b=0;d=this.children;for(f=d.length;b<f;b++)d[b].writeHtml(a)},forEach:function(a,b,d){if(!d&&(!b||this.type===b))var f=a(this);if(!1!==f)for(var d=this.children,
c=0;c<d.length;c++)f=d[c],f.$element?f.forEach(a,b):(!b||f.type===b)&&a(f)},getFilterContext:function(a){return a||{}}});g.fragment.fromHtml=function(a,j,m){function l(a){var b;if(0<s.length)for(var d=0;d<s.length;d++){var f=s[d],c=f.name,g=e[c],i=t.name&&e[t.name];(!i||i[c])&&(!a||!g||g[a]||!e[a])?(b||(k(),b=1),f=f.clone(),f.parent=t,t=f,s.splice(d,1),d--):c==t.name&&(o(t,t.parent,1),d--)}}function k(){for(;x.length;)o(x.shift(),t)}function n(a){return"textarea"===(a.name||a)}function p(a){if(a.isBlockLike&&
"pre"!==(a.name||a)&&!n(a)){var b=a.children.length,d=a.children[b-1],f;if(d&&d.$text)(f=d.value.rtrim())?d.value=f:a.children.length=b-1}}function o(a,d,f){var d=d||t||r,e=t;if(a.previous===c){if(q(d,a))t=d,v.onTagOpen(m,{}),a.returnPoint=d=t;p(a);(!b(a)||a.children.length)&&d.add(a);"pre"===(a.name||a)&&(C=!1);n(a)&&(A=!1)}a.returnPoint?(t=a.returnPoint,delete a.returnPoint):t=f?d:e}function q(a,b){if((a==r||"body"===a.name)&&m&&(!a.name||e[a.name][m])){var d,f=b.attributes&&(d=b.attributes["data-kse-real-element-type"])?
d:b.name;return f&&f in e.$inline&&!(f in e.head)&&!b.isOrphan||b.$text&&b.value.trim()}}function w(a,b){return a in e.$listItem||a in e.$tableContent?a===b||"dt"===a&&"dd"===b||"dd"===a&&"dt"===b:!1}var v=new g,r=j instanceof g.element?j:"string"===typeof j?new g.element(j):new g.fragment,s=[],x=[],t=r,A=n(r),C="pre"===(r.name||r);v.onTagOpen=function(a,c,i,j){c=new g.element(a,c);if(c.isUnknown&&i)c.isEmpty=!0;c.isOptionalClose=j;if(b(c))return s.push(c);if("pre"===(a.name||a))C=!0;else{if("br"===
(a.name||a)&&C)return t.add(new g.text("\n"));n(a)&&(A=!0)}if("br"===(a.name||a))return x.push(c);for(;;)if(j=(i=t.name)?e[i]||(t.isBlockLike?e.div:e.span):f,!c.isUnknown&&!t.isUnknown&&!j[a])if(t.isOptionalClose)v.onTagClose(i);else if(a in d&&i in d)i=t.children,(i=i[i.length-1])&&"li"===i.name||o(i=new g.element("li"),t),c.returnPoint=c.returnPoint||t,t=i;else if(a in e.$listItem&&!w(a,i))v.onTagOpen("li"===a?"ul":"dl",{},0,1);else if(i in h&&!w(a,i))c.returnPoint=c.returnPoint||t,t=t.parent;else if(i in
e.$inline&&s.unshift(t),t.parent)o(t,t.parent,1);else{c.isOrphan=1;break}else break;l(a);k();c.parent=t;c.isEmpty?o(c):t=c};v.onTagClose=function(a){for(var b=s.length-1;0<=b;b--)if(a==s[b].name){s.splice(b,1);return}for(var d=[],f=[],c=t;c!=r&&c.name!==a;)c.isBlockLike||f.unshift(c),d.push(c),c=c.returnPoint||c.parent;if(c!=r){for(b=0;b<d.length;b++){var e=d[b];o(e,e.parent)}t=c;c.isBlockLike&&k();o(c,c.parent);if(c==t)t=t.parent;s=s.concat(f)}"body"===a&&(m=!1)};v.onText=function(a){if((!t.hasInlineStarted||
x.length)&&!C&&!A)if(a=a.ltrim(),0===a.length)return;var b=t.name,c=b?e[b]||e[t.isBlockLike?"div":"span"]:f;if(!A&&!c["#"]&&b in h)v.onTagOpen(b in d?"li":"dl"===b?"dd":"table"===b?"tr":"tr"===b?"td":""),v.onText(a);else{k();l();!C&&!A&&(a=a.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," "));a=new g.text(a);if(q(t,a))this.onTagOpen(m,{},0,1);t.add(a)}};v.onCDATA=function(a){t.add(new g.cdata(a))};v.onComment=function(a){k();l();t.add(new g.comment(a))};v.parse(a);for(k();t!=r;)o(t,t.parent,1);p(r);return r}})(Klass.Editor);
(function(a){function c(a){return function(b){return b.$element&&("string"===typeof a?b.name===a:b.name in a)}}var b=a.dtd,e=a.htmlParser,g=e.fragment.prototype,h=function(a,b){a=a[0];b=b[0];return a<b?-1:a>b?1:0};e.cssStyle=function(a){var b={};((a instanceof e.element?a.attributes.style:a)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,d,c){"font-family"===d&&(c=c.replace(/["']/g,""));b[d.toLowerCase()]=c});return{rules:b,populate:function(a){var b=this.toString();
if(b)a instanceof Klass.DOM.element?a.setAttribute("style",b):a instanceof e.element?a.attributes.style=b:a.style=b},toString:function(){var a=[],d;for(d in b)b[d]&&a.push(d,":",b[d],";");return a.join("")}}};e.element=new Class({Implements:e.node,initialize:function(d,f){this.name=d;this.attributes=f||(f={});this.children=[];this.parent=null;this.type=a.$.NODE_ELEMENT;this.$element=1;var c=f["data-kse-real-element-type"]||d||"",e=c.match(/^kse:(.*)/);e&&(c=e[1]);c=!(!b.$nonBodyContent[c]&&!b.$block[c]&&
!b.$listItem[c]&&!b.$tableContent[c]&&!(b.$nonEditable[c]||"br"===c));this.isEmpty=e=!!b.$empty[d];this.isUnknown=!b[d];this.isBlockLike=c;this.hasInlineStarted=e||!c},add:g.add,clone:function(){return new e.element(this.name,this.attributes)},filter:function(b,f){var c=this,e,g,f=c.getFilterContext(f);if(f.off)return!0;if(!c.parent)b.onRoot(c,f);for(;;){e=c.name;if(!(g=b.onElementName(e,f)))return this.remove(),!1;c.name=g;if(!(c=b.onElement(c,f)))return this.remove(),!1;if(c!==this)return this.replaceWith(c),
!1;if(c.name===e)break;if(c.type!==a.$.NODE_ELEMENT)return this.replaceWith(c),!1;if(!c.name)return this.replaceWithChildren(),!1}e=c.attributes;var h,k;for(h in e){k=h;for(g=e[h];;)if(k=b.onAttributeName(h,f))if(k!==h)delete e[h],h=k;else break;else{delete e[h];break}k&&(!1===(g=b.onAttribute(c,k,g,f))?delete e[k]:e[k]=g)}c.isEmpty||this.filterChildren(b,!1,f);return!0},filterChildren:g.filterChildren,writeHtml:function(a,b){b&&this.filter(b);var c=this.name,e=this.attributes,g=[],l,k;a.openTag(c,
e);for(l in e)g.push([l,e[l]]);a.sortAttributes&&g.sort(h);for(e=0,k=g.length;e<k;e++)l=g[e],a.attribute(l[0],l[1]);a.openTagClose(c,this.isEmpty);this.writeChildrenHtml(a);this.isEmpty||a.closeTag(c)},writeChildrenHtml:g.writeChildrenHtml,replaceWithChildren:function(){for(var a=this.children,b=a.length;b;)a[--b].insertAfter(this);this.remove()},forEach:g.forEach,getFirst:function(a){if(!a)return this.children[0]||null;"function"!==typeof a&&(a=c(a));for(var b=0,e=this.children.length;b<e;++b)if(a(this.children[b]))return this.children[b];
return null},getHtml:function(){var a=new e.basicWriter;this.writeChildrenHtml(a);return a.getHtml()},setHtml:function(a){for(var a=this.children=e.fragment.fromHtml(a).children,b=0,c=a.length;b<c;++b)a[b].parent=this},getOuterHtml:function(){var a=new e.basicWriter;this.writeHtml(a);return a.getHtml()},split:function(a){for(var b=this.children.splice(a,this.children.length-a),c=this.clone(),e=0;e<b.length;++e)b[e].parent=c;c.children=b;if(b[0])b[0].previous=null;if(0<a)this.children[a-1].next=null;
this.parent.add(c,this.getIndex()+1);return c},removeClass:function(a){var b=this.attributes["class"];(b=b&&b.replace(RegExp("(?:\\s+|^)"+a+"(?:\\s+|$)")," ").trim())?this.attributes["class"]=b:delete this.attributes["class"]},hasClass:function(a){var b=this.attributes["class"];return b?RegExp("(?:^|\\s)"+a+"(?=\\s|$)").test(b):!1},getFilterContext:function(a){var b={},a=a||{off:!1,nonEditable:!1,nestedEditable:!1};if(!a.off&&"off"===this.attributes["data-kse-processor"])b.off=!0;if(!a.nonEditable&&
"false"===this.attributes.contenteditable)b.nonEditable=!0;else if("body"!==this.name&&!a.nestedEditable&&"true"===this.attributes.contenteditable)b.nestedEditable=!0;return Object.append(a,b)}})})(Klass.Editor);
(function(a){a.htmlParser.text=new Class({Implements:a.htmlParser.node,initialize:function(c){this.value=c;this.type=a.$.NODE_TEXT;this.$text=1;this.isBlockLike=!1},filter:function(a,b){if(!(this.value=a.onText(this.value,b)))return this.remove(),!1},writeHtml:function(a,b){b&&this.filter(b);a.text(this.value)}})})(Klass.Editor);Klass.DOM=function(a){a&&(this[0]=a)};Klass.DOM.prototype={equals:function(a){return a&&a[0]===this[0]},nodeType:function(a){a=("node_"+a).toUpperCase();return Klass.Editor.constants[a]}};
Klass.DOM.extend({create:function(a,c){return(new Klass.DOM.element("div",null,c)).html(a).first().dispose()},createElement:function(a,c,b){return new Klass.DOM.element(a,c,b)}});Object.append(document,{get:function(a){if("string"===typeof a)return a=this.getElementById(a),this.node(a)},node:function(a){return null==a?null:a.$type||!a.nodeName?a:new Klass.DOM.node(a)}});
(function(a){var c=a.dom,b=function(a){return function(){var b=Array.from(arguments),b=c[a].apply(c,[this[0]].concat(b));return b===c?this:b}};Array.forEach(["store","retrieve","eliminate"],function(c){a.DOM.implement(c,b(c))})})(Klass);Klass.DOM.window=function(a){if(!(a&&a[0]==a)&&a.document)this[0]=a,this.uid=Klass.uidOf(a);else return a};Klass.DOM.window.prototype=new Klass.DOM;
Klass.DOM.window.implement({getWindow:function(){return this[0]},getDocument:function(){return this[0].document},focus:function(){Klass.env.webkit&&this[0].parent&&this[0].parent.focus();this[0].focus()}});Klass.DOM.document=function(a){if(a&&a.$document)return a;this.window=a.parentWindow||a.defaultView;this.$document=!0;this[0]=a;this.uid=Klass.uidOf(a);if(!a.html||a.html!==a.documentElement)a.html=a.documentElement;if(!a.head)a.head=a.getElementsByTagName("head")[0]};
Klass.DOM.document.prototype=new Klass.DOM;
Klass.DOM.document.implement({getWindow:function(){return new Klass.DOM.window(this.window)},getDocument:function(){return this[0]},html:function(){return this.createElement(this[0].html)},body:function(){return this.createElement(this[0].body)},head:function(){return this.createElement(this[0].head)},createText:function(a,c){return new Klass.DOM.text(a,c||this)},createElement:function(a,c,b){return new Klass.DOM.element(a,c,b||this)},getElementByAddress:function(a,c){for(var b=this[0].html,e=0,g=
a.length;b&&e<g;e++){var h=a[e];if(c)for(var d=-1,f=0,i=b.childNodes.length;f<i;f++){var j=b.childNodes[f];if(!(!0===c&&3===j.nodeType&&j.previousSibling&&3===j.previousSibling.nodeType)&&(d++,d==h)){b=j;break}}else b=b.childNodes[h]}return b?document.node(b):null},get:function(a){return(a=this[0].getElementById(a))?new Klass.DOM.element(a):null},createStyleSheet:function(a){this[0].createStyleSheet?this[0].createStyleSheet(a):(a=this.createElement("link",{href:a,type:"text/css",rel:"stylesheet"}),
this.head().append(a))},createStyleText:function(a){this[0].createStyleSheet?this[0].createStyleSheet("").cssText=a:(a=this.createElement("style").append(this.createText(a)),this.head().append(a))},focus:function(){this.getWindow().focus()},write:function(a){this[0].open("text/html","replace");Klass.Editor.utils.isCustomDomain()&&(this[0].domain=document.domain);this[0].write(a);this[0].close()}});
(function(a,c){var b=a.document,e=c.Editor.constants,g=c.DOM;g.node=function(a){if(a)switch(a.nodeType){case e.NODE_DOCUMENT:return new g.document(a);case e.NODE_ELEMENT:return new g.element(a);case e.NODE_TEXT:return new g.text(a)}this[0]=a};g.node.prototype=new g;g.node.implement({clone:function(a,f){var c=this[0].cloneNode(a),g=function(b){if(b.nodeType===e.NODE_ELEMENT&&(f||b.removeAttribute("id",!1),b.removeAttribute("data-kse-expando",!1),a))for(var b=b.childNodes,c=b.length,i=0;i<c;i++)g(b[i])};
g(c);return b.node(c)},hasPrevious:function(){return!!this[0].previousSibling},hasNext:function(){return!!this[0].nextSibling},normalize:function(){var a=this[0];this.$text?this.parent().normalize():a.normalize&&a.normalize();return this},getAddress:function(a){for(var b=[],c=this[0],e=this.getDocument()[0].documentElement;c&&c!==e;){var g=c.parentNode,h=-1;if(g){for(var k=0,n=g.childNodes.length;k<n;k++){var p=g.childNodes[k];if(!a||!(3==p.nodeType&&p.previousSibling&&3==p.previousSibling.nodeType))if(h++,
p==c)break}b.unshift(h)}c=g}return b},getDocument:function(){return new g.document(this[0].ownerDocument||this[0].parentNode.ownerDocument)},index:function(a){for(var b=this[0],c=0;b=b.previousSibling;)(!a||!(3===b.nodeType&&(!b.nodeValue.length||b.previousSibling&&3===b.previousSibling.nodeType)))&&c++;return c},getNextSourceNode:function(a,b,c){if(c&&!c.call)var e=c,c=function(a){return!a.equals(e)};var a=!a&&this.first&&this.first(),g;if(!a){if(this.$element&&c&&!1===c(this,!0))return null;a=this.next()}for(;!a&&
(g=(g||this).parent());){if(c&&!1===c(g,!0))return null;a=g.next()}return!a||c&&!1===c(a)?null:b&&b!=a.type?a.getNextSourceNode(!1,b,c):a},getPreviousSourceNode:function(a,b,c){if(c&&!c.call)var e=c,c=function(a){return!a.equals(e)};var a=!a&&this.last&&this.last(),g;if(!a){if(this.$element&&c&&!1===c(this,!0))return null;a=this.prev()}for(;!a&&(g=(g||this).parent());){if(c&&!1===c(g,!0))return null;a=g.prev()}return!a||c&&!1===c(a)?null:b&&a.type!=b?a.getPreviousSourceNode(!1,b,c):a},parent:function(a){var c=
this[0].parentNode;if(a&&"string"===typeof a)for(;c&&!(c.tagName.toLowerCase()===a);)c=c.parentNode;return c&&1===c.nodeType?b.node(c):null},parents:function(a){var b=this,c=[];do c[a?"push":"unshift"](b);while(b=b.parent());return c},prev:function(a){var c=this[0],e;do e=(c=c.previousSibling)&&10!==c.nodeType&&b.node(c);while(e&&a&&!a(e));return e},next:function(a){var c=this[0],e;do e=(c=c.nextSibling)&&b.node(c);while(e&&a&&!a(e));return e},adopt:function(){var a=this[0],c,e=Array.flatten(arguments),
g=e.length;1<g&&(a=c=b.createDocumentFragment());for(var h=0;h<g;h++){var l=b.node(e[h])[0];l&&a.appendChild(l)}c&&this[0].appendChild(c);return this},dispose:function(a){var b=this[0],c=b.parentNode;if(c){if(a)for(;a=b.firstChild;)c.insertBefore(b.removeChild(a),b);c.removeChild(b)}return this},getCommonAncestor:function(a){if(a.equals(this))return this;if(a.contains&&a.contains(this))return a;var b=this.contains?this:this.parent();do if(b.contains(a))return b;while(b=b.parent());return null},compareDocumentPosition:function(a){var b=
this[0],c=a[0];if(b.compareDocumentPosition)return b.compareDocumentPosition(c);if(b==c)return e.POSITION_IDENTICAL;if(this.$element&&a.$element){if(b.contains){if(b.contains(c))return e.POSITION_CONTAINS+e.POSITION_PRECEDING;if(c.contains(b))return e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING}if("sourceIndex"in b)return 0>b.sourceIndex||0>c.sourceIndex?e.POSITION_DISCONNECTED:b.sourceIndex<c.sourceIndex?e.POSITION_PRECEDING:e.POSITION_FOLLOWING}for(var b=this.getAddress(),a=a.getAddress(),c=Math.min(b.length,
a.length),g=0;g<=c-1;g++)if(b[g]!=a[g]){if(g<c)return b[g]<a[g]?e.POSITION_PRECEDING:e.POSITION_FOLLOWING;break}return b.length<a.length?e.POSITION_CONTAINS+e.POSITION_PRECEDING:e.POSITION_IS_CONTAINED+e.POSITION_FOLLOWING},getAscendant:function(a,c){var e=this[0];if(!c)e=e.parentNode;for(;e;){if(e.nodeName&&e.nodeName.toLowerCase()==a)return b.node(e);e=e.parentNode}return null},hasAscendant:function(a,b){var c=this[0];if(!b)c=c.parentNode;for(;c;){if(c.nodeName&&c.nodeName.toLowerCase()==a)return!0;
c=c.parentNode}return!1},move:function(a,b){a[b?"prepend":"append"](this.dispose())},replaces:function(a){this.injectBefore(a);a.dispose()},trim:function(){return this.ltrim().rtrim()},ltrim:function(){for(var a;this.first&&(a=this.first());){if(a.$text){var b=a.text().ltrim(),c=a.length();if(b)b.length<c&&(a.split(c-b.length),this[0].removeChild(this[0].firstChild));else{a.dispose();continue}}break}return this},rtrim:function(){for(var a;this.last&&(a=this.last());){if(a.$text){var b=a.text().rtrim(),
e=a.length();if(b)b.length<e&&(a.split(b.length),this[0].lastChild.parentNode.removeChild(this[0].lastChild));else{a.dispose();continue}}break}if(!c.env.ie&&!c.env.opera)(a=this[0].lastChild)&&1==a.type&&"br"==a.nodeName.toLowerCase()&&a.parentNode.removeChild(a);return this},isReadOnly:function(){var a=this;this.type!=e.NODE_ELEMENT&&(a=this.parent());if(a&&"undefined"!==typeof a[0].isContentEditable)return!(a[0].isContentEditable||a.data("kse-editable"));for(;a&&!a.is("body")&&!a.data("kse-editable");){if("false"===
a.getProperty("contentEditable"))return!0;if("true"===a.getProperty("contentEditable"))break;a=a.parent()}return!1}});var h={before:function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)},after:function(a,b){if(b.parentNode){var c=b.nextSibling;c?b.parentNode.insertBefore(a,c):b.parentNode.appendChild(a)}},bottom:function(a,b){b.appendChild(a)},top:function(a,b){var c=b.firstChild;c?b.insertBefore(a,c):b.appendChild(a)}};h.inside=h.bottom;g.node.implement({inject:function(a,b){h[b||"bottom"](this[0],
a[0]);return this}});(function(a){var b=a.dom,c=a.DOM,e=function(a){"string"===typeof a&&(a=this.getDocument().createElement(a));return a[0]||a};Object.forEach({before:"injectBefore",after:"injectAfter",append:"appendTo",prepend:"prependTo"},function(a,d){c.node.implement(d,function(a){b[d](e(a),this[0]);return this});c.node.implement(a,function(a){b[d](this[0],e(a));return this})})})(c)})(window,Klass);
Klass.DOM.nodes=function(a,c){c=Object.append({ddup:!0,cash:!0},c);a=a||[];if(c.ddup||c.cash){for(var b=[],e=0,g=a.length;e<g;e++){var h=document.node(a[e],!c.cash);h&&b.push(h)}a=b}return a};
(function(a,c,b){function e(a,b,d){var f=c.dom,g={x:0,y:0};if(!f.nodeName(a,d?"body":"html")){var j=a.getBoundingClientRect();g.x=j.left;g.y=j.top}a=f.getWindow(a);f.equals(a,b)||(b=e(f.id(a.frameElement),b,d),g.x+=b.x,g.y+=b.y);return g}function g(a,b){return parseInt(c.dom.getComputedStyle(a,"margin-"+b),10)||0}function h(a,b,d,f){var j,h,i;!b&&(b=this.getWindow(a));var m=this.getDocument(b);h="BackCompat"==m.compatMode;c.isWindow(b)&&(b=h?m.body:m.documentElement);i=this.getWindow(b);var m=e(a,
i,h),l=e(b,i,h),k=a.offsetHeight;j=a.offsetWidth;var A=b.clientHeight,C=b.clientWidth;h=m.x-g(a,"left")-l.x||0;i=m.y-g(a,"top")-l.y||0;j=m.x+j+g(a,"right")-(l.x+C)||0;a=m.y+k+g(a,"bottom")-(l.y+A)||0;if(0>i||0<a)this.scrollBy(b,0,!0===d?i:!1===d?a:0>i?i:a);if(f&&(0>h||0<j))this.scrollBy(b,0>h?h:j,0)}var d=a.document,f=c.env,i=c.DOM,j=c.support.cssFloat?"cssFloat":"styleFloat",m=function(a){return"float"===a?j:a.replace(/-./g,function(a){return a.substr(1).toUpperCase()})},l=c.Editor,k=l.dtd;i.element=
function(a,b,f){if(a&&a.$element)return null!=b&&a.set(b),a;"string"===typeof a&&(f=f&&f[0]||d,a=f.createElement(a));this[0]=a;this.$element=!0;this.type=this.nodeType("element");this.uid=c.uidOf(a);null!=b&&this.set(b)};i.element.prototype=new c.DOM.node;i.element.implement({id:function(a){return this.getDocument().get(a)},getWindow:function(){return this.getDocument().getWindow()},getFrameDocument:function(){var a=this[0];return a&&new c.DOM.document(a.contentWindow.document)},set:function(a,b){c.dom.set(Array(this[0]),
a,b)},get:function(a){return c.dom.get(this[0],a)}.overloadGetter(),setProperties:function(a){for(var b in a)this.setProperty(b,a[b]);return this},getProperties:function(){var a={};Array.flatten(arguments).forEach(function(b){a[b]=this.getProperty(b)},this);return a},removeProperties:function(){Array.flatten(arguments).each(this.removeProperty,this);return this},copyAttributes:function(a,b){for(var c=this[0],d=c.attributes,b=b||{},e=0,g=d.length;e<g;e++){var j=d[e],h=j.nodeName.toLowerCase(),i;if(!(h in
b))if("checked"==h&&(i=this.getProperty(h)))a.setProperty(h,i);else if(j.specified||f.ie&&j.nodeValue&&"value"==h){i=this.getProperty(h);if(null===i)i=j.nodeValue;a.setProperty(h,i)}}if(""!==c.style.cssText)a[0].style.cssText=c.style.cssText},hasAttributes:function(){var a=this[0].attributes,b=a.length;if(f.ie&&(f.ie6||f.ie7)){for(var c=0;c<b;c++){var d=a[c];switch(d.nodeName){case "class":if(this.getProperty("class"))return!0;case "uniqueNumber":continue;case "data-kse-expando":continue;default:if(d.specified)return!0}}return!1}c=
{"data-kse-expando":1,uid:1,_moz_dirty:1};return 0<b&&(2<b||!c[a[0].nodeName]||2===b&&!c[a[1].nodeName])},contains:function(a){var b=this[0],a=a[0]||a;return b.contains?1!==a.nodeType?b.contains(a.parentNode):b!=a&&b.contains(a):b===a||!!(b.compareDocumentPosition(a)&16)},unselectable:function(){if(f.ie||f.opera){var a=this[0],b,c=0;for(a.unselectable="on";b=a.all[c++];)switch(b.tagName.toLowerCase()){case "iframe":case "textarea":case "input":case "select":break;default:b.unselectable="on"}}if(f.firefox||
f.webkit)this[0].style[f.firefox?"MozUserSelect":"KhtmlUserSelect"]="none",this.addEvent("dragstart",function(a){a.preventDefault()});return this},is:function(){for(var a=this.name(),b=0,c=arguments.length;b<c;b++)if(arguments[b]==a)return!0;return!1},isEditable:function(a){var b=this.name();if(this.isReadOnly()||"none"===this.getComputedStyle("display")||"hidden"===this.getComputedStyle("visibility")||this.is("a")&&this.data("kse-saved-name")&&!this.length()||k.$nonEditable[b]||k.$empty[b])return!1;
return!1!==a?(a=k[b]||k.span)&&a["#"]:!0},isIdentical:function(a){if(this.name()!=a.name())return!1;for(var b=this[0].attributes,c=a[0].attributes,d=b.length,e=c.length,g=0;g<d;g++){var j=b[g];if("_moz_dirty"!=j.nodeName&&(!f.ie||j.specified&&"data-kse-expando"!=j.nodeName)&&j.nodeValue!=a.getProperty(j.nodeName))return!1}if(f.ie)for(g=0;g<e;g++)if(j=c[g],j.specified&&"data-kse-expando"!=j.nodeName&&j.nodeValue!=this.getProperty(j.nodeName))return!1;return!0},isRealElement:function(a){return this.data("kse-real-element-type")===
a},isEmptyInlineRemoveable:function(){if(!k.$removeEmpty[this.name()])return!1;for(var a=this.children(),b=0,c=a.length;b<c;b++){var d=a[b];if(!d.$element||!d.data("kse-bookmark"))if(d.$element&&!d.isEmptyInlineRemoveable()||d.$text&&d.text().trim())return!1}return!0},dtd:function(){return k[this.name()]},name:function(){var a=this[0].nodeName.toLowerCase();if(f.ie&&!(8<d.documentMode)){var b=this[0].scopeName;"HTML"!=b&&(a=b.toLowerCase()+":"+a)}return a},rename:function(a){if(!this.is(a)){var b=
this[0],c=this.getDocument(),a=new i.element(a,null,c);this.copyAttributes(a);this.moveChildren(a);this.parent()&&b.parentNode.replaceChild(a[0],b);a[0]["data-kse-expando"]=b["data-kse-expando"];this[0]=a[0]}},style:function(a,d){var f=this[0];if(d===b)return c.dom.getStyle(f,a);c.dom.setStyle(f,a,d);return this},removeStyle:function(a){var b=this[0],a=m(a);b.style[a]="";b.style.removeAttribute&&b.style.removeAttribute(a);b.style.cssText||b.removeAttribute("style")},styles:function(a){var b=arguments,
c={};if("string"===typeof a||1<b.length)return Array.flatten(b).each(function(a){c[a]=this.style(a)},this),c;for(var d in a)this.style(d,a[d]);return this},first:function(a){var b=this[0].firstChild;(b=b&&d.node(b))&&a&&!a(b)&&(b=b.next(a));return b},last:function(a){var b=this[0].lastChild;(b=b&&d.node(b))&&a&&!a(b)&&(b=b.prev(a));return b},outerHTML:function(){var a,b=this[0];if(b.outerHTML)return b.outerHTML.replace(/<\?[^>]*>/,"");a=b.ownerDocument.createElement("div");a.appendChild(b.cloneNode(!0));
return a.innerHTML},appendHtml:function(a){if(this.length){var b=new i.element("div",null,this.getDocument());b.html(a);b.moveChildren(this)}else this.html(a);return this},appendText:function(a){this[0].text!==b?this[0].text+=a:this.append(new i.text(a))},appendBogus:function(){for(var a=this.last();a&&a.$text&&!a.text().rtrim();)a=a.prev();if(!a||!a.is||!a.is("br"))a=f.opera?this.getDocument().createText(""):this.getDocument().createElement("br"),f.firefox&&a[0].setAttribute("type","_moz"),this.append(a)},
breakParent:function(a){var b=new i.range(this.getDocument());b.setStartAfter(this);b.setEndAfter(a);a=b.extractContents();b.insertNode(this.dispose());a.insertAfterNode(this)},moveChildren:function(a,b){var c=this[0],a=a[0];if(c==a)return this;var d;if(b)for(;d=c.lastChild;)a.insertBefore(c.removeChild(d),a.firstChild);else for(;d=c.firstChild;)a.appendChild(c.removeChild(d));return this},mergeSiblings:function(){var a=function(a,b,c){if(b&&b.$element){for(var d=[];b.data("kse-bookmark")||b.isEmptyInlineRemoveable();)if(d.push(b),
b=c?b.next():b.prev(),!b||!b.$element)return;if(a.isIdentical(b)){for(var f=c?a.last():a.first();d.length;)d.shift().move(a,!c);b.moveChildren(a,!c);b.dispose();f&&f.$element&&f.mergeSiblings()}}};if(k.$removeEmpty[this.name()]||this.is("a"))a(this,this.next(),!0),a(this,this.prev())},scrollIntoView:function(a){var b=this.parent();if(b){do{var d=b[0];(d.clientWidth&&d.clientWidth<d.scrollWidth||d.clientHeight&&d.clientHeight<d.scrollHeight)&&h.call(c.dom,this[0],d,a,1);if(b.is("html")){d=b.getWindow();
try{var f=d[0].frameElement;f&&(b=new i.element(f))}catch(e){}}}while(b=b.parent())}},hover:function(a,b){return b||f.ie6?this.addEvents({mouseover:function(){this.addClass(a)},mouseout:function(){this.removeClass(a)}}):this},length:function(){return this[0].childNodes.length},child:function(a){var b=this[0];if(a.slice)for(;0<a.length&&b;)b=b.childNodes[a.shift()];else b=b.childNodes[a];return b?d.node(b):null},children:function(){return new c.DOM.nodes(this[0].childNodes)},getDirection:function(a){return a?
this.getComputedStyle("direction"):this.style("direction")||this.getProperty("dir")},focus:function(a){var b=function(){try{this[0].focus()}catch(a){}};a?b.delay(100,this):b.call(this)},insertFirst:function(a,b){return(new i.element("div",{html:a},this.getDocument())).first().inject(this,b||"bottom")}});[i.window,i.document,i.element].invoke("implement",{width:function(){return this.getSize().x},height:function(){return this.getSize().y}});i.element.setMarker=function(a,b,c,d){var f=b.retrieve("list_marker_id")||
b.store("list_marker_id",l.utils.unique()).retrieve("list_marker_id"),e=b.retrieve("list_marker_names")||b.store("list_marker_names",{}).retrieve("list_marker_names");a[f]=b;e[c]=1;return b.store(c,d)};i.element.clearMarker=function(a,b,c){var d=b.retrieve("list_marker_names"),f=b.retrieve("list_marker_id"),e;for(e in d)b.eliminate(e);b.eliminate("list_marker_names");c&&(b.eliminate("list_marker_id"),delete a[f])};i.element.clearMarkers=function(a){for(var b in a)i.element.clearMarker(a,a[b],1)};
(function(a,b){var c=a.dom,d=a.DOM,f=function(a){return function(){var b=Array.from(arguments),b=c[a].apply(c,[this[0]].concat(b));return b===c?this:b}};Array.forEach("hasClass,addClass,removeClass,toggleClass,swapClass,hasAttribute,setProperty,getProperty,removeProperty,getComputedStyle,getComputedSize,getOffsets,getPosition,show,hide,toggle,isDisplayed,isVisible,empty,destroy,position,data,erase".split(","),function(a){d.element.implement(a,f(a))});Array.forEach(["addListener","removeListener",
"getScroll","getScrollSize","getSize"],function(a){[d.window,d.document,d.element].invoke("implement",a,f(a))});Array.forEach(["html","text","value"],function(a){d.element.implement(a,function(d){if(d===b)return c.get(this[0],a);null===d&&c.erase(this[0],a);this.set(a,d);return this})});[d.document,d.element].invoke("implement","find",function(a,b){var f=c.parse(a,this[0]||this),f=f&&f.length?new d.nodes(f):[];return b?f[0]:f});c.hooks.state={set:function(a){switch(a){case 0:c.swapClass(this,"kse-active",
"kse-disabled");break;case 1:c.swapClass(this,"kse-disabled","kse-active");break;default:c.removeClass(this,"kse-active"),c.removeClass(this,"kse-disabled")}}}})(c)})(window,Klass);
(function(a){var c=a.Editor.dtd,b={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},e={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};a.DOM.elementPath=new Class({initialize:function(a){var h=null,d=null,f=[];for(a&&a.is&&a.is("html")&&(a=a.getDocument().body());a;){if(a.$element){var i=a.name();if(!this.lastElement)this.lastElement=a;if(!d&&(!h&&b[i]&&(h=a),e[i])){var j;if(j=!h)if(j="div"==i){a:{j=a.children();for(var m=0,l=j.length;m<l;m++){var k=
j[m];if(k.$element&&c.$block[k.name()]){j=!0;break a}}j=!1}j=!j}j?h=a:d=a}f.push(a);if("body"===i)break}a=a.parent()}this.block=h;this.blockLimit=d;this.elements=f},compare:function(a){var b=this.elements,a=a&&a.elements;if(!a||b.length!=a.length)return!1;for(var c=0,f=b.length;c<f;c++)if(!b[c].equals(a[c]))return!1;return!0},contains:function(a){for(var b=this.elements,c=0,f=b.length;c<f;c++)if(b[c].name()in a)return b[c];return null}})})(Klass);
Klass.DOM.text=function(a,c){if(a&&a.$text)return a;c=c&&c[0]||document;"string"===typeof a&&(a=c.createTextNode(a));this[0]=a;this.$text=!0;this.type=this.nodeType("text")};Klass.DOM.text.prototype=new Klass.DOM.node;
Klass.DOM.text.implement({text:function(a){if(void 0===a)return this[0].nodeValue;this[0].nodeValue=a},length:function(){return this[0].nodeValue.length},split:function(a){var c=this.getDocument();if(Klass.env.ie&&a==this.length())return c.createText("").injectAfter(this);a=new Klass.DOM.text(this[0].splitText(a,c));Klass.env.mode&&(new Klass.DOM.text("",c)).injectAfter(a).dispose();return a},substring:function(a,c){var b=this.text();return"number"!==typeof c?b.substr(a):b.substring(a,c)}});
(function(a){var c=a.DOM,b=a.event,e=function(a){return function(){var c=Array.from(arguments);return b[a].apply(this,[this[0]].concat(c))}};Array.forEach("addEvent,addEvents,removeEvent,removeEvents,stopEvent,pauseEvent,restartEvent,fireEvent".split(","),function(a){[c.window,c.document,c.element].invoke("implement",a,e(a))});Object.append(b.nativeEvents,{beforedeactivate:2,beforecut:1,cut:1,copy:1,beforepaste:2});a.DOMEvent.implement({getTarget:function(){return this.target?document.node(this.target):
null}})})(Klass);
(function(a,c){c.DOM.fragment=function(b){b=b&&b[0]||a;this[0]=b.createDocumentFragment();this.type=this.nodeType("DOCUMENT_FRAGMENT");this.$fragment=!0};c.DOM.fragment.prototype=new c.DOM;c.DOM.fragment.prototype.insertAfterNode=function(a){a=a[0];a.parentNode.insertBefore(this[0],a.nextSibling)};var b={append:1,appendTo:1,appendBogus:1,moveChildren:1,first:1,last:1,inject:1,injectBefore:1,replaces:1,trim:1,ltrim:1,rtrim:1,getDocument:1,child:1,children:1,length:1};(function(){if(b){var a=c.DOM.fragment,
g=c.DOM.element.prototype,h;for(h in b)h in g&&a.implement(h,g[h])}})()})(document,Klass);
(function(a){function c(a,b){if(this.storage.end)return null;var c,d=this.range,f,e=this.guard,g=this.type,o=a?"getPreviousSourceNode":"getNextSourceNode";if(!this.storage.start&&(this.storage.start=1,d.trim(),d.collapsed))return this.end(),null;if(!a&&!this.storage.guardLTR){var h=d.endContainer,w=h.child(d.endOffset);this.storage.guardLTR=function(a,b){return(!b||!h.equals(a))&&(!w||!a.equals(w))&&(!a.$element||!b||"body"!=a.name())}}if(a&&!this.storage.guardRTL){var v=d.startContainer,r=0<d.startOffset&&
v.child(d.startOffset-1);this.storage.guardRTL=function(a,b){return(!b||!v.equals(a))&&(!r||!a.equals(r))&&(!a.$element||!b||"body"!=a.name())}}var s=a?this.storage.guardRTL:this.storage.guardLTR;f=e?function(a,b){return!1===s(a,b)?!1:e(a,b)}:s;this.current?c=this.current[o](!1,g,f):a?(c=d.endContainer,0<d.endOffset?(c=c.child(d.endOffset-1),!1===f(c)&&(c=null)):c=!1===f(c,!0)?null:c.getPreviousSourceNode(!0,g,f)):(c=d.startContainer,(c=c.child(d.startOffset))?!1===f(c)&&(c=null):c=!1===f(d.startContainer,
!0)?null:d.startContainer.getNextSourceNode(!0,g,f));for(;c&&!this.storage.end;){this.current=c;if(!this.evaluator||!1!==this.evaluator(c)){if(!b)return c}else if(b&&this.evaluator)return!1;c=c[o](!1,g,f)}this.end();return this.current=null}function b(a){for(var b,d=null;b=c.call(this,a);)d=b;return d}var e=a.Editor.dtd;a.DOM.walker=new Class({initialize:function(a){this.range=a;this.storage={}},end:function(){this.storage.end=1},next:function(){return c.call(this)},previous:function(){return c.call(this,
1)},checkForward:function(){return!1!==c.call(this,0,1)},checkBackward:function(){return!1!==c.call(this,1,1)},lastForward:function(){return b.call(this)},lastBackward:function(){return b.call(this,1)},reset:function(){delete this.current;this.storage={}}});var g={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1};a.DOM.walker.extend({blockBoundary:function(a){return function(b){return!(b.$element&&
b.isBlockBoundary(a))}},listItemBoundary:function(){return this.blockBoundary({br:1})},bookmark:function(a,b){function c(a){return a&&a.is&&a.is("span")&&a.data("kse-bookmark")}return function(d){var f,e;f=d&&!d.name&&(e=d.parent())&&c(e);f=a?f:f||c(d);return!!(b^f)}},whitespaces:function(b){return function(c){c=c&&c.$text&&(!c.text().trim()||a.env.webkit&&"\u200b"===c.text());return!!(b^c)}},invisible:function(b){var c=a.DOM.walker.whitespaces();return function(a){a=c(a)||a.is&&!a[0].offsetHeight;
return!!(b^a)}},nodeType:function(a,b){return function(c){return!!(b^c.type==a)}},bogus:function(b){function c(a){return!d(a)&&!f(a)}return function(d){var f=!a.env.ie?d.is&&d.is("br"):d.text&&h.test(d.text());f&&(f=d.parent(),d=d.next(c),f=f.isBlockBoundary()&&(!d||d.$element&&d.isBlockBoundary()));return!!(b^f)}}});var h=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,d=a.DOM.walker.whitespaces(),f=a.DOM.walker.bookmark();a.DOM.element.implement({isBlockBoundary:function(a){a=Object.append(e.$block,a||{});return"none"===
(this.getComputedStyle("float")||"none")&&g[this.getComputedStyle("display")]||a[this.name()]},getBogus:function(){var b=this;do b=b.getPreviousSourceNode();while(f(b)||d(b)||b.$element&&b.name()in e.$inline&&!(b.name()in e.$empty));return b&&(!a.env.ie?b.is&&b.is("br"):b.text&&h.test(b.text()))?b:!1}})})(Klass);
(function(a){function c(a){var b=!1,c=j.walker.bookmark(!0),d=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/;return function(f){if(c(f))return!0;if(f.$text)if(h.ie&&d.test(f.text())&&!b&&(!a||!f.next()))b=!0;else{if(f.text().trim().length)return!1}else if(f.$element&&!m[f.name()])if(!h.ie&&f.is("br")&&!b&&(!a||!f.next()))b=!0;else return!1;return!0}}function b(a){return!a.$text&&a.name()in f.$removeEmpty||!a.text().trim()||!!a.parent().data("kse-bookmark")}function e(a){return!n(a)&&!p(a)}var g=a.Editor,h=a.env,d=
g.constants,f=g.dtd,i=g.utils,j=a.DOM,m={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1},l=function(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer.equals(a.endContainer)&&a.startOffset==a.endOffset},k=function(a,b,c){a.optimizeBookmark();var d=a.startContainer,f=a.endContainer,e=a.startOffset,g=a.endOffset,j,h;f.$text?f=f.split(g):0<f.length()&&(g>=f.length()?
(f=a.document.createText("").appendTo(f),h=!0):f=f.child(g));d.$text?(d.split(e),d.equals(f)&&(f=d.next())):e?e>=d.length()?(d=a.document.createText("").appendTo(d),j=!0):d=d.child(e).prev():(d=a.document.createText("").injectBefore(d.first()),j=!0);var e=d.parents(),g=f.parents(),i,m,l;for(i=0;i<e.length&&!(m=e[i],l=g[i],!m.equals(l));i++);for(var u=c,n,p,k,D=i;D<e.length;D++){n=e[D];u&&!n.equals(d)&&(p=n.clone().appendTo(u));for(n=n.next();n&&!n.equals(g[D])&&!n.equals(f);){k=n.next();2==b?u.append(n.clone(!0)):
(n.dispose(),1==b&&u.append(n));n=k}u&&(u=p)}u=c;for(c=i;c<g.length;c++){n=g[c];0<b&&!n.equals(f)&&(p=n.clone().appendTo(u));if(!e[c]||n[0].parentNode!=e[c][0].parentNode)for(n=n.prev();n&&!n.equals(e[c])&&!n.equals(d);){k=n.prev();2==b?u[0].insertBefore(n[0].cloneNode(!0),u[0].firstChild):(n.dispose(),1==b&&u[0].insertBefore(n[0],u[0].firstChild));n=k}u&&(u=p)}if(2==b)l=a.startContainer,l.$text&&(l[0].data+=l[0].nextSibling.data,l[0].parentNode.removeChild(l[0].nextSibling)),a=a.endContainer,a.$text&&
a[0].nextSibling&&(a[0].data+=a[0].nextSibling.data,a[0].parentNode.removeChild(a[0].nextSibling));else{if(m&&l&&(d[0].parentNode!=m[0].parentNode||f[0].parentNode!=l[0].parentNode))b=l.index(),j&&l[0].parentNode==d[0].parentNode&&b--,a.setStart(l.parent(),b);a.collapse(!0)}j&&d.dispose();h&&f[0].parentNode&&f.dispose()},n=new a.DOM.walker.whitespaces,p=new a.DOM.walker.bookmark;a.DOM.range=new Class({initialize:function(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null;
this.collapsed=!0;this.document=a},clone:function(){var a=new j.range(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=!0},cloneContents:function(){var a=new j.fragment(this.document);this.collapsed||
k(this,2,a);return a},deleteContents:function(){this.collapsed||k(this,0)},extractContents:function(){var a=new j.fragment(this.document);this.collapsed||k(this,1,a);return a},createBookmark:function(a){var b,c,f,e,g=this.collapsed;b=this.document.createElement("span");b.data("kse-bookmark",1);b.style("display","none");b.html("&nbsp;");a&&(f="kse-bm-"+i.unique(),b.setProperty("id",f+"S"));g||(c=b.clone(),c.html("&nbsp;"),a&&c.setProperty("id",f+"E"),e=this.clone(),e.collapse(),e.insertNode(c));e=
this.clone();e.collapse(!0);e.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,d.POSITION_AFTER_END);return{startNode:a?f+"S":b,endNode:a?f+"E":c,serializable:a,collapsed:g}},createBookmark2:function(a){var b=this.startContainer,c=this.endContainer,d=this.startOffset,f=this.endOffset,e=this.collapsed,g,j;if(!b||!c)return{start:0,end:0};if(a){if(b.$element){if((g=b.child(d))&&g.$text&&0<d&&g.prev().$text)b=g,d=0;g&&g.$element&&(d=g.index(1))}for(;b.$text&&(j=b.prev())&&
j.$text;)b=j,d+=j.length();if(!e){if(c.$element){if((g=c.child(f))&&g.$text&&0<f&&g.prev().$text)c=g,f=0;g&&g.$element&&(f=g.index(1))}for(;c.$text&&(j=c.prev())&&j.$text;)c=j,f+=j.length()}}return{start:b.getAddress(a),end:e?null:c.getAddress(a),startOffset:d,endOffset:f,normalized:a,collapsed:e,is2:!0}},moveToBookmark:function(a){if(a.is2){var b=this.document.getElementByAddress(a.start,a.normalized),c=a.startOffset,d=a.end&&this.document.getElementByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(b,
c);d?this.setEnd(d,a):this.collapse(!0)}else b=(c=a.serializable)?this.document.get(a.startNode):a.startNode,a=c?this.document.get(a.endNode):a.endNode,this.setStartBefore(b),b.dispose(),a?(this.setEndBefore(a),a.dispose()):this.collapse(!0)},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,f=this.endOffset,e;if(a.$element)if(e=a.length(),e>c)a=a.child(c);else if(1>e)a=a.getPreviousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=document.node(a);
a=a.getNextSourceNode()||a}if(b.$element)if(e=b.length(),e>f)b=b.child(f).getPreviousSourceNode(!0);else if(1>e)b=b.getPreviousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=document.node(b)}a.compareDocumentPosition(b)&d.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},getCommonAncestor:function(a,b){var c=this.startContainer,d=this.endContainer,c=c.equals(d)?a&&c.$element&&this.startOffset==this.endOffset-1?c.child(this.startOffset):c:c.getCommonAncestor(d);return b&&!c.is?c.parent():
c},optimize:function(){var a=this.startContainer,b=this.startOffset;a.$element||(b?b>=a.length()&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a.$element||(b?b>=a.length()&&this.setEndAfter(a):this.setEndBefore(a))},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a.is&&a.is("span")&&a.data("kse-bookmark")&&this.setStartAt(a,d.POSITION_BEFORE_START);b&&b.is&&b.is("span")&&b.data("kse-bookmark")&&this.setEndAt(b,d.POSITION_AFTER_END)},
trim:function(a,b){var c=this.startContainer,d=this.startOffset,f=this.collapsed;if((!a||f)&&c&&c.$text){if(d)if(d>=c.length())d=c.index()+1,c=c.parent();else{var e=c.split(d),d=c.index()+1,c=c.parent();this.startContainer.equals(this.endContainer)?this.setEnd(e,this.endOffset-this.startOffset):c.equals(this.endContainer)&&(this.endOffset+=1)}else d=c.index(),c=c.parent();this.setStart(c,d);if(f){this.collapse(!0);return}}c=this.endContainer;d=this.endOffset;!b&&!f&&c&&c.$text&&(d?(d>=c.length()||
c.split(d),d=c.index()+1):d=c.index(),c=c.parent(),this.setEnd(c,d))},enlarge:function(a){switch(a){case d.ENLARGE_ELEMENT:if(this.collapsed)break;var a=this.getCommonAncestor(),b=this.document.body(),c,e,g,h,i,m=!1,l,n;l=this.startContainer;n=this.startOffset;if(l.$text){if(n&&(l=!l.substring(0,n).trim().length&&l,m=!!l),l&&!(h=l.prev()))g=l.parent()}else n&&(h=l.child(n-1)||l.last()),h||(g=l);for(;g||h;){if(g&&!h){!i&&g.equals(a)&&(i=!0);if(!b.contains(g))break;if(!m||"inline"!=g.getComputedStyle("display"))m=
!1,i?c=g:this.setStartBefore(g);h=g.prev()}for(;h;){l=!1;if(h.$text)n=h.text(),/[^\s\ufeff]/.test(n)&&(h=null),l=/[\s\ufeff]$/.test(n);else if(0<h[0].offsetWidth&&!h.data("kse-bookmark"))if(m&&f.$removeEmpty[h.name()]){n=h.text();if(/[^\s\ufeff]/.test(n))h=null;else for(var p=h[0].all||h[0].getElementsByTagName("*"),k=0,u;u=p[k++];)if(!f.$removeEmpty[u.nodeName.toLowerCase()]){h=null;break}h&&(l=!!n.length)}else h=null;l&&(m?i?c=g:g&&this.setStartBefore(g):m=!0);if(h){l=h.prev();if(!g&&!l){g=h;h=
null;break}h=l}else g=null}g&&(g=g.parent())}l=this.endContainer;n=this.endOffset;g=h=null;i=m=!1;if(l.$text){if(l=!l.substring(n).trim().length&&l,m=!(l&&l.length()),l&&!(h=l.next()))g=l.parent()}else(h=l.child(n))||(g=l);for(;g||h;){if(g&&!h){!i&&g.equals(a)&&(i=!0);if(!b.contains(g))break;if(!m||"inline"!=g.getComputedStyle("display"))m=!1,i?e=g:g&&this.setEndAfter(g);h=g.next()}for(;h;){l=!1;if(h.$text)n=h.text(),/[^\s\ufeff]/.test(n)&&(h=null),l=/^[\s\ufeff]/.test(n);else if(0<h[0].offsetWidth&&
!h.data("kse-bookmark"))if(m&&f.$removeEmpty[h.name()]){n=h.text();if(/[^\s\ufeff]/.test(n))h=null;else{p=h[0].all||h[0].getElementsByTagName("*");for(k=0;u=p[k++];)if(!f.$removeEmpty[u.nodeName.toLowerCase()]){h=null;break}}h&&(l=!!n.length)}else h=null;l&&m&&(i?e=g:this.setEndAfter(g));if(h){l=h.next();if(!g&&!l){g=h;h=null;break}h=l}else g=null}g&&(g=g.parent())}c&&e&&(a=c.contains(e)?e:c,this.setStartBefore(a),this.setEndAfter(a));break;case d.ENLARGE_BLOCK_CONTENTS:case d.ENLARGE_LIST_ITEM_CONTENTS:g=
new j.range(this.document);b=this.document.body();g.setStartAt(b,d.POSITION_AFTER_START);g.setEnd(this.startContainer,this.startOffset);g=new j.walker(g);var B,H,y=j.walker.blockBoundary(a==d.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),D=function(a){var b=y(a);b||(B=a);return b};c=function(a){var b=D(a);!b&&a.is&&a.is("br")&&(H=a);return b};g.guard=D;g=g.lastBackward();B=B||b;this.setStartAt(B,!B.is("br")&&(!g&&this.checkStartOfBlock()||g&&B.contains(g))?d.POSITION_AFTER_START:d.POSITION_AFTER_END);if(a===
d.ENLARGE_LIST_ITEM_CONTENTS){g=this.clone();var F=j.walker.whitespaces(),G=j.walker.bookmark();g=new j.walker(g);g.evaluator=function(a){return!F(a)&&!G(a)};if((g=g.previous())&&g.$element&&g.is("br"))break}g=this.clone();g.collapse();g.setEndAt(b,d.POSITION_BEFORE_END);g=new j.walker(g);g.guard=a===d.ENLARGE_LIST_ITEM_CONTENTS?c:D;B=null;g=g.lastForward();B=B||b;this.setEndAt(B,!g&&this.checkEndOfBlock()||g&&B.contains(g)?d.POSITION_BEFORE_END:d.POSITION_BEFORE_START);H&&this.setEndAfter(H)}},shrink:function(a,
b){if(!this.collapsed){var a=a||d.SHRINK_TEXT,c=this.clone(),f=this.startContainer,e=this.endContainer,g=this.startOffset,h=this.endOffset,i=1,m=1;f&&f.$text&&(g?g>=f.length()?c.setStartAfter(f):(c.setStartBefore(f),i=0):c.setStartBefore(f));e&&e.$text&&(h?h>=e.length()?c.setEndAfter(e):(c.setEndAfter(e),m=0):c.setEndBefore(e));var c=new j.walker(c),l=j.walker.bookmark();c.evaluator=function(b){return b.type==(a==d.SHRINK_ELEMENT?d.NODE_ELEMENT:d.NODE_TEXT)};var n;c.guard=function(b,c){if(l(b))return!0;
if(a==d.SHRINK_ELEMENT&&b.$text||c&&b.equals(n))return!1;!c&&b.$element&&(n=b);return!0};i&&(f=c[a==d.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(f,b?d.POSITION_AFTER_START:d.POSITION_BEFORE_START);m&&(c.reset(),(c=c[a==d.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(c,b?d.POSITION_BEFORE_END:d.POSITION_AFTER_END));return!(!i&&!m)}},insertNode:function(a){this.optimizeBookmark();this.trim(!1,!0);var b=this.startContainer,c=b.child(this.startOffset);c?a.injectBefore(c):b.append(a);
a.parent()&&(a.parent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(a))},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(!0)},selectNodeContents:function(a){this.setStart(a,0);this.setEnd(a,a.length())},setStart:function(a,b){a.$element&&f.$empty[a.name()]&&(b=a.index(),a=a.parent());this.startContainer=a;this.startOffset=b;if(!this.endContainer)this.endContainer=a,this.endOffset=b;l(this)},setEnd:function(a,b){a.$element&&f.$empty[a.name()]&&(b=a.index()+1,a=a.parent());
this.endContainer=a;this.endOffset=b;if(!this.startContainer)this.startContainer=a,this.startOffset=b;l(this)},setStartAfter:function(a){this.setStart(a.parent(),a.index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a.index())},setEndAfter:function(a){this.setEnd(a.parent(),a.index()+1)},setEndBefore:function(a){this.setEnd(a.parent(),a.index())},setStartAt:function(a,b){switch(b){case d.POSITION_AFTER_START:this.setStart(a,0);break;case d.POSITION_BEFORE_END:this.setStart(a,a.length());
break;case d.POSITION_BEFORE_START:this.setStartBefore(a);break;case d.POSITION_AFTER_END:this.setStartAfter(a)}l(this)},setEndAt:function(a,b){switch(b){case d.POSITION_AFTER_START:this.setEnd(a,0);break;case d.POSITION_BEFORE_END:this.setEnd(a,a.length());break;case d.POSITION_BEFORE_START:this.setEndBefore(a);break;case d.POSITION_AFTER_END:this.setEndAfter(a)}l(this)},fixBlock:function(a,b){var c=this.createBookmark(),f=this.document.createElement(b);this.collapse(a);this.enlarge(d.ENLARGE_BLOCK_CONTENTS);
f.append(this.extractContents()).trim();h.ie||f.appendBogus();this.insertNode(f);this.moveToBookmark(c);return f},splitBlock:function(a){var b=new j.elementPath(this.startContainer),c=new j.elementPath(this.endContainer),f=b.block,e=c.block,g=null;if(!b.blockLimit.equals(c.blockLimit))return null;if("br"!=a){if(!f)f=this.fixBlock(!0,a),e=(new j.elementPath(this.endContainer)).block;e||(e=this.fixBlock(!1,a))}a=f&&this.checkStartOfBlock();b=e&&this.checkEndOfBlock();this.deleteContents();f&&f.equals(e)&&
(b?(g=new j.elementPath(this.startContainer),this.moveToPosition(e,d.POSITION_AFTER_END),e=null):a?(g=new j.elementPath(this.startContainer),this.moveToPosition(f,d.POSITION_BEFORE_START),f=null):(e=this.splitElement(f),!h.ie&&!f.is("ul","ol")&&f.appendBogus()));return{previousBlock:f,nextBlock:e,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:g}},splitElement:function(a){if(!this.collapsed)return null;this.setEndAt(a,d.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(!1);c.append(b).injectAfter(a);
this.moveToPosition(a,d.POSITION_AFTER_END);return c},checkBoundaryOfElement:function(a,c){var f=c==d.START,e=this.clone();e.collapse(f);e[f?"setStartAt":"setEndAt"](a,f?d.POSITION_AFTER_START:d.POSITION_BEFORE_END);e=new j.walker(e);e.evaluator=b;return e[f?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var a=this.startContainer,b=this.startOffset;if(b&&a.$text&&a.substring(0,b).ltrim().length)return!1;a=new j.elementPath(this.startContainer);b=this.clone();b.collapse(!0);b.setStartAt(a.block||
a.blockLimit,d.POSITION_AFTER_START);a=new j.walker(b);a.evaluator=c(!0);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,b=this.endOffset;if(a.$text&&a.substring(b).rtrim().length)return!1;a=new j.elementPath(this.endContainer);b=this.clone();b.collapse(!1);b.setEndAt(a.block||a.blockLimit,d.POSITION_BEFORE_END);a=new j.walker(b);a.evaluator=c(!1);return a.checkForward()},checkReadOnly:function(){function a(b,c){for(;b;){if(b.$element){var d=b.getProperty("contentEditable");
if("false"==d&&!b.data("kse-editable"))return 0;if(b.is("html")||"true"==d&&(b.contains(c)||b.equals(c)))break}b=b.parent()}return 1}return function(){var b=this.startContainer,c=this.endContainer;return!(a(b,c)&&a(c,b))}}(),moveToElementEditablePosition:function(a,b){var c=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/;if(a.$element&&!a.isEditable(!1))return this.moveToPosition(a,b?d.POSITION_AFTER_END:d.POSITION_BEFORE_START),!0;for(var f=0;a;){if(a.$text){b&&this.checkEndOfBlock()&&c.test(a.text())?this.moveToPosition(a,
d.POSITION_BEFORE_START):this.moveToPosition(a,b?d.POSITION_AFTER_END:d.POSITION_BEFORE_START);f=1;break}a.$element&&(a.isEditable()?(this.moveToPosition(a,b?d.POSITION_BEFORE_END:d.POSITION_AFTER_START),f=1):b&&a.is("br")&&this.checkEndOfBlock()&&this.moveToPosition(a,d.POSITION_BEFORE_START));var g=a,h=f,j=void 0;g.$element&&g.isEditable(!1)&&(j=g[b?"last":"first"](e));!h&&!j&&(j=g[b?"prev":"next"](e));a=j}return!!f},moveToElementEditStart:function(a){return this.moveToElementEditablePosition(a)},
moveToElementEditEnd:function(a){return this.moveToElementEditablePosition(a,!0)},getEnclosedNode:function(){var a=this.clone();a.optimize();if(!a.startContainer.$element||!a.endContainer.$element)return null;var b=new j.walker(a),c=j.walker.bookmark(!0),d=j.walker.whitespaces(!0);a.evaluator=function(a){return d(a)&&c(a)};a=b.next();b.reset();return a&&a.equals(b.previous())?a:null},getTouchedStartNode:function(){var a=this.startContainer;return this.collapsed||!a.$element?a:a.child(this.startOffset)||
a},getTouchedEndNode:function(){var a=this.endContainer;return this.collapsed||!container$element?a:a.child(this.endOffset-1)||a}})})(Klass);
(function(a,c){function b(a,b,c){var f=a.serializable,e=b[c?"endContainer":"startContainer"],j=c?"endOffset":"startOffset",m=f?b.document.get(a.startNode):a.startNode,a=f?b.document.get(a.endNode):a.endNode;e.equals(m.prev())?(b.startOffset=b.startOffset-e.getLength()-a.prev().getLength(),e=a.next()):e.equals(a.prev())&&(b.startOffset-=e.getLength(),e=a.next());e.equals(m.parent())&&b[j]++;e.equals(a.parent())&&b[j]++;b[c?"endContainer":"startContainer"]=e;return b}a.DOM.ranges=function(b){if(b instanceof
a.DOM.ranges)return b;b?b instanceof a.DOM.range&&(b=[b]):b=[];return Object.append(b,e)};var e={createIterator:function(){var b=this,e=a.DOM.walker.bookmark(),d=[],f;return{getNextRange:function(a){f=f==c?0:f+1;var j=b[f];if(j&&1<b.length){if(!f)for(var m=b.length-1;0<=m;m--)d.unshift(b[m].createBookmark(!0));if(a)for(var l=0;b[f+l+1];){for(var k=j.document,a=0,m=k.get(d[l].endNode),k=k.get(d[l+1].startNode);;){m=m.getNextSourceNode(!1);if(k.equals(m))a=1;else if(e(m)||m.$element&&m.isBlockBoundary())continue;
break}if(!a)break;l++}for(j.moveToBookmark(d.shift());l--;)m=b[++f],m.moveToBookmark(d.shift()),j.setEnd(m.endContainer,m.endOffset)}return j}}},createBookmarks:function(a){for(var c=[],d,f=0;f<this.length;f++){c.push(d=this[f].createBookmark(a,!0));for(var e=f+1;e<this.length;e++)this[e]=b(d,this[e]),this[e]=b(d,this[e],!0)}return c},createBookmarks2:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c].createBookmark2(a));return b},moveToBookmarks:function(a){for(var b=0;b<this.length;b++)this[b].moveToBookmark(a[b])}}})(Klass);
(function(a,c,b){function e(a){function b(a){return a&&a.$element&&a.name()in h.dtd.$removeEmpty}function c(b){var d=a.document.body();return!b.is("body")&&1==d.length()}var d=a.startContainer,f=a.startOffset;return d.$text?!1:!d.html().trim()?b(d)||c(d):b(d.child(f-1))||b(d.child(f))}function g(a){var b=a&&a.retrieve("kse-fillingChar");if(b&&a.eliminate("kse-fillingChar")){var c,d=(a=a.getSelection().getSelection())&&"None"!==a.type&&a.getRangeAt(0);if(1<b.length()&&d&&d.intersectsNode(b[0])){c=
[a.anchorOffset,a.focusOffset];d=a.focusNode==b[0]&&0<a.focusOffset;a.anchorNode==b[0]&&0<a.anchorOffset&&c[0]--;d&&c[1]--;var f;if(!a.isCollapsed)f=a.getRangeAt(0),f.setStart(a.anchorNode,a.anchorOffset),f.setEnd(a.focusNode,a.focusOffset),f=f.collapsed;f&&c.unshift(c.pop())}b.text(b.text().replace(/\u200B/g,""));c&&(b=a.getRangeAt(0),b.setStart(b.startContainer,c[0]),b.setEnd(b.startContainer,c[1]),a.removeAllRanges(),a.addRange(b))}}var h=c.Editor,d=c.env,f=h.constants,i=a.document,j={img:1,hr:1,
li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};h.implement({getSelection:function(){return this.document&&this.document.getSelection()},forceNextSelectionCheck:function(){delete this.storage.selectionPreviousPath}});c.DOM.document.implement("getSelection",function(){var a=new c.DOM.selection(this);return!a||a.isInvalid?null:a});c.DOM.selection=new Class({initialize:function(a){var b=a.retrieve("kse-locked-selection");
if(b)return b;this.document=a;this.isLocked=0;this.storage={};if(d.ie&&(a=this.getSelection().createRange(),!a||a.item&&a.item(0).ownerDocument!=this.document[0]||a.parentElement&&a.parentElement().ownerDocument!=this.document[0]))this.isInvalid=!0},getSelection:function(){return this.storage.selection?this.storage.selection:d.ie?this.storage.selection=this.document[0].selection:this.storage.selection=this.document.window.getSelection()},getRange:function(){var a=this.getSelection();return!a?null:
0<a.rangeCount?a.getRangeAt(0):a.createRange()},getNode:function(){var a=this.getRange();if(!d.ie){var b=null;if(a){b=a.commonAncestorContainer;for(!a.collapsed&&a.startContainer==a.endContainer&&2>a.startOffset-a.endOffset&&a.startContainer.hasChildNodes()&&(b=a.startContainer.childNodes[a.startOffset]);"element"!==c.type(b);)b=b.parentNode}return i.node(b)}return i.node(a.item?a.item(0):a.parentElement())},getType:function(){var a=this.storage;if(a.type)return a.type;var b=this.getSelection(),c;
if(d.ie){c=f.SELECTION_NONE;try{var e=b.type;"Text"==e&&(c=f.SELECTION_TEXT);"Control"==e&&(c=f.SELECTION_ELEMENT);b.createRange().parentElement&&(c=f.SELECTION_TEXT)}catch(g){}}else if(c=f.SELECTION_TEXT,b||(c=f.SELECTION_NONE),1==b.rangeCount)b=b.getRangeAt(0),e=b.startContainer,e==b.endContainer&&1===e.nodeType&&1==b.endOffset-b.startOffset&&j[e.childNodes[b.startOffset].nodeName.toLowerCase()]&&(c=f.SELECTION_ELEMENT);return a.type=c},getTextRange:function(){var a=function(a,b){a=a.duplicate();
a.collapse(b);for(var c=a.parentElement(),d=c.childNodes,f,e=0,g=d.length;e<g;e++){var h=d[e];if(1==h.nodeType){f=a.duplicate();f.moveToElementText(h);var h=f.compareEndPoints("StartToStart",a),j=f.compareEndPoints("EndToStart",a);f.collapse();if(0<h)break;else{if(!h||1==j&&-1==h)return{container:c,offset:e};if(!j)return{container:c,offset:e+1}}f=null}}f||(f=a.duplicate(),f.moveToElementText(c),f.collapse(!1));f.setEndPoint("StartToStart",a);f=f.text.replace(/(\r\n|\r)/g,"\n").length;try{for(;0<f;)f-=
d[--e].nodeValue.length}catch(i){f=0}return 0===f?{container:c,offset:e}:{container:d[e],offset:-f}},b=this.getSelection(),d=b&&b.createRange(),e=this.getType();if(!b)return[];if(e===f.SELECTION_TEXT)return b=new c.DOM.range(this.document),e=a(d,!0),b.setStart(i.node(e.container),e.offset),e=a(d),b.setEnd(i.node(e.container),e.offset),b.endContainer.compareDocumentPosition(b.startContainer)&f.POSITION_PRECEDING&&b.endOffset<=b.startContainer.index()&&b.collapse(),[b];if(e==f.SELECTION_ELEMENT){for(var a=
[],e=0,g=d.length;e<g;e++){for(var h=d.item(e),j=h.parentNode,m=0,b=new c.DOM.range(this.document);m<j.childNodes.length&&j.childNodes[m]!=h;m++);b.setStart(i.node(j),m);b.setEnd(i.node(j),m+1);a.push(b)}return a}return[]},getRanges:function(a){var b=function(){if(c.env.ie)return this.getTextRange();var a=[],b,d=this.getSelection(),f=this.document;if(!d)return a;d.rangeCount||(b=new c.DOM.range(f),b.moveToElementEditStart(f.body()),a.push(b));for(var e=0,g=d.rangeCount;e<g;e++){var h=d.getRangeAt(e);
b=new c.DOM.range(f);b.setStart(i.node(h.startContainer),h.startOffset);b.setEnd(i.node(h.endContainer),h.endOffset);a.push(b)}return a},d=this.storage;if(d.ranges&&!a)return d.ranges;if(!d.ranges)d.ranges=new c.DOM.ranges(b.call(this));if(a)for(var e=d.ranges,g=0;g<e.length;g++){var h=e[g];h.getCommonAncestor().isReadOnly()&&e.splice(g,1);if(!h.collapsed){if(h.startContainer.isReadOnly())for(a=h.startContainer;a&&!a.is("body")&&a.isReadOnly();){a.$element&&"false"==a.getProperty("contentEditable")&&
h.setStartAfter(a);a=a.parent()}var a=h.startContainer,b=h.endContainer,j=h.startOffset,m=h.endOffset,l=h.clone();a&&a.$text&&(j>=a.length()?l.setStartAfter(a):l.setStartBefore(a));b&&b.$text&&(m?l.setEndAfter(b):l.setEndBefore(b));a=new c.DOM.walker(l);a.evaluator=function(a){if(a.$element&&a.isReadOnly()){var b=h.clone();h.setEndBefore(a);h.collapsed&&e.splice(g--,1);a.compareDocumentPosition(l.endContainer)&f.POSITION_CONTAINS||(b.setStartAfter(a),b.collapsed||e.splice(g+1,0,b));return!0}return!1};
a.next()}}return d.ranges},getStartElement:function(){var a=this.storage;if(a.startElement!==b)return a.startElement;var d;switch(this.getType()){case f.SELECTION_ELEMENT:return this.getSelectedElement();case f.SELECTION_TEXT:var e=this.getRanges()[0];if(e){if(e.collapsed)d=e.startContainer,d.$element||(d=d.parent());else{for(e.optimize();;)if(d=e.startContainer,e.startOffset==d.length()&&!d.isBlockBoundary())e.setStartAfter(d);else break;d=e.startContainer;if(!d.$element)return d.parent();d=d.child(e.startOffset);
if(!d||!d.$element)d=e.startContainer;else for(e=d.first();e&&e.$element;)d=e,e=e.first()}d=d[0]}}return a.startElement=d?new c.DOM.element(d):null},getSelectedElement:function(){var a=this.storage;if(a.selectedElement!==b)return a.selectedElement;var d=this,e=Function.attempt(function(){return d.getSelection().createRange().item(0)},function(){var a,b,e=d.getRanges()[0],g=e.getCommonAncestor(1,1),j={table:1,ul:1,ol:1,dl:1},i;for(i in j)if(a=g.getAscendant(i,1))break;if(a){g=new c.DOM.range(this.document);
g.setStartAt(a,f.POSITION_AFTER_START);g.setEnd(e.startContainer,e.startOffset);var m=Object.merge(j,h.dtd.$listItem,h.dtd.$tableContent),j=new c.DOM.walker(g);i=function(a,b){return function(c,d){if(c.$text&&(!c.text().trim()||c.parent().data("kse-bookmark")))return!0;var f;if(c.$element&&(f=c.name(),"br"==f&&b&&c.equals(c.parent().getBogus())||d&&f in m||f in h.dtd.$removeEmpty))return!0;a.halted=1;return!1}};j.guard=i(j);if(j.checkBackward()&&!j.halted)j=new c.DOM.walker(g),g.setStart(e.endContainer,
e.endOffset),g.setEndAt(a,f.POSITION_BEFORE_END),j.guard=i(j,1),j.checkForward()&&!j.halted&&(b=a[0])}if(!b)throw 0;return b},function(){for(var a=d.getRanges()[0],b,c,e=2;e&&(!(b=a.getEnclosedNode())||!b.$element||!j[b.name()]||!(c=b));e--)a.shrink(f.SHRINK_ELEMENT);return c[0]});return a.selectedElement=e?new c.DOM.element(e):null},getSelectedText:function(){var a=this.storage;if(a.selectedText!==b)return a.selectedText;var c="",e=this.getSelection();this.getType()==f.SELECTION_TEXT&&(c=d.ie?e.createRange().text:
e.toString());return a.selectedText=c},lock:function(){this.getRanges();this.getStartElement();this.getSelectedElement();this.getSelectedText();this.storage.selection={};this.isLocked=1;this.document.store("kse-locked-selection",this)},unlock:function(a){var b=this.document,c=b.retrieve("kse-locked-selection");if(c&&(b.store("kse-locked-selection",null),a)){var b=c.getSelectedElement(),d=!b&&c.getRanges();this.isLocked=0;this.reset();b?this.selectElement(b):this.selectRanges(d)}if(!c||!a)this.isLocked=
0,this.reset()},reset:function(){this.storage={}},selectElement:function(a){var b=this.document,d;this.isLocked?(d=new c.DOM.range(b),d.setStartBefore(a),d.setEndAfter(a),this.storage.selectedElement=a,this.storage.startElement=a,this.storage.ranges=new c.DOM.ranges(d),this.storage.type=f.SELECTION_ELEMENT):(d=new c.DOM.range(a.getDocument()),d.setStartBefore(a),d.setEndAfter(a),d.select(),b.fireEvent("selectionchange"),this.reset())},selectRanges:function(a){if(this.isLocked)this.storage.selectedElement=
null,this.storage.startElement=a[0]&&a[0].getTouchedStartNode(),this.storage.ranges=new c.DOM.ranges(a),this.storage.type=f.SELECTION_TEXT;else{if(d.ie){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getSelection();if(!b)return;a.length&&(b.removeAllRanges(),d.webkit&&g(this.document));for(var h=0;h<a.length;h++){if(h<a.length-1){var j=a[h],i=a[h+1],m=j.clone();m.setStart(j.endContainer,j.endOffset);m.setEnd(i.startContainer,i.startOffset);
if(!m.collapsed){m.shrink(f.NODE_ELEMENT,!0);var l=m.getCommonAncestor(),m=m.getEnclosedNode();if(l.isReadOnly()||m&&m.isReadOnly()){i.setStart(j.startContainer,j.startOffset);a.splice(h--,1);continue}}}j=a[h];i=this.document[0].createRange();l=j.startContainer;j.collapsed&&d.opera&&l.$element&&!l.length()&&l.appendText("");if(j.collapsed&&d.webkit&&e(j)){m=this.document;g(m);var k=m.createText("\u200b");m.store("kse-fillingChar",k);m=k;j.insertNode(m);(k=m.next())&&!m.prev()&&k.$element&&"br"===
k.name()?(g(this.document),j.moveToPosition(k,f.POSITION_BEFORE_START)):j.moveToPosition(m,f.POSITION_AFTER_END)}i.setStart(l[0],j.startOffset);try{i.setEnd(j.endContainer[0],j.endOffset)}catch(x){if(0<=x.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))j.collapse(1),i.setEnd(j.endContainer[0],j.endOffset);else throw x;}b.addRange(i)}this.document.fireEvent("selectionchange")}this.reset()}},createBookmarks:function(a){return this.getRanges().createBookmarks(a)},createBookmarks2:function(a){return this.getRanges().createBookmarks2(a)},
selectBookmarks:function(a){for(var b=[],d=0,f=a.length;d<f;d++){var e=new c.DOM.range(this.document);e.moveToBookmark(a[d]);b.push(e)}this.selectRanges(b);return this},selectNode:function(a,b){var c=this.getRange(),d=this.getSelection();c.moveToElementText?Function.attempt(function(){c.moveToElementText(a);c.select()}):d.addRange?(b?c.selectNodeContents(a):c.selectNode(a),d.removeAllRanges(),d.addRange(c)):d.setBaseAndExtent(a,0,a,1);return a},getCommonAncestor:function(){var a=this.getRanges();
return a[0].startContainer.getCommonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){this.getStartElement().scrollIntoView()}});var m=c.DOM.walker.whitespaces(!0),l=/\ufeff|\u00a0/,k={table:1,tbody:1,tr:1};c.DOM.range.implement("select",d.ie?function(a){var b=this.document,c=b[0].body,d=this.collapsed,e,g,j,h=this.getEnclosedNode();if(h)try{j=c.createControlRange();j.addElement(h[0]);j.select();return}catch(i){}(this.startContainer.$element&&this.startContainer.name()in k||this.endContainer.$element&&
this.endContainer.name()in k)&&this.shrink(f.NODE_ELEMENT,!0);j=this.createBookmark();var h=j.startNode,t;if(!d)t=j.endNode;j=c.createTextRange();j.moveToElementText(h[0]);j.moveStart("character",1);t?(a=c.createTextRange(),a.moveToElementText(t[0]),j.setEndPoint("EndToEnd",a),j.moveEnd("character",-1)):(e=h.next(m),e=!(e&&e.text&&e.text().match(l))&&(a||!h.hasPrevious()||h.prev().is&&h.prev().is("br")),g=b.createElement("span",{html:"&#65279;"}).injectBefore(h),e&&b.createText("\ufeff").injectBefore(h));
this.setStartBefore(h);h.dispose();d?(e?(j.moveStart("character",-1),j.select(),b[0].selection.clear()):j.select(),this.moveToPosition(g,f.POSITION_BEFORE_START),g.dispose()):(this.setEndBefore(t),t.dispose(),j.select());b.fireEvent("selectionchange")}:function(){this.document.getSelection().selectRanges([this])})})(window,Klass);
(function(a){function c(a,b,c){for(a=a.getNextSourceNode(b,null,c);!h(a);)a=a.getNextSourceNode(b,null,c);return a}var b=a.DOM,e=a.Editor.constants,g=/^[\r\n\t ]+$/,h=b.walker.bookmark(!1,!0),d=b.walker.whitespaces(!0),f=function(a){return h(a)&&d(a)},i=new Class({initialize:function(a){if(!(1>arguments.length))this.range=a,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0},getNextParagraph:function(d){var m,i,k,n,p,o;if(!this.started){i=this.range.clone();i.shrink(e.NODE_ELEMENT,!0);
n=i.endContainer.hasAscendant("pre",!0)||i.startContainer.hasAscendant("pre",!0);i.enlarge(this.forceBrBreak&&!n||!this.enlargeBr?e.ENLARGE_LIST_ITEM_CONTENTS:e.ENLARGE_BLOCK_CONTENTS);if(!i.collapsed){n=new b.walker(i);var q=b.walker.bookmark(!0,!0);n.evaluator=q;this.nextNode=n.next();n=new b.walker(i);n.evaluator=q;n=n.previous();if((this.lastNode=n.getNextSourceNode(!0))&&this.lastNode.$text&&!this.lastNode.text().trim()&&this.lastNode.parent().isBlockBoundary())if(q=new b.range(i.document),q.moveToPosition(this.lastNode,
e.POSITION_AFTER_END),q.checkEndOfBlock())q=new b.elementPath(q.endContainer),this.lastNode=(q.block||q.blockLimit).getNextSourceNode(!0);if(!this.lastNode)this.lastNode=this.docEndMarker=i.document.createText("").injectAfter(n);i=null}this.started=1}q=this.nextNode;n=this.lastNode;for(this.nextNode=null;q;){var w=0,v=q.hasAscendant("pre"),r=!q.$element,s=0;if(r)q.$text&&g.test(q.text())&&(r=0);else{var x=q.name();if(q.isBlockBoundary(this.forceBrBreak&&!v&&{br:1})){if("br"===x)r=1;else if(!i&&!q.length()&&
"hr"!==x){m=q;k=q.equals(n);break}if(i&&(i.setEndAt(q,e.POSITION_BEFORE_START),"br"!==x))this.nextNode=q;w=1}else{if(q.first()){i||(i=new b.range(this.range.document),i.setStartAt(q,e.POSITION_BEFORE_START));q=q.first();continue}r=1}}r&&!i&&(i=new b.range(this.range.document),i.setStartAt(q,e.POSITION_BEFORE_START));k=(!w||r)&&q.equals(n);if(i&&!w)for(;!q.next(f)&&!k;){x=q.parent();if(x.isBlockBoundary(this.forceBrBreak&&!v&&{br:1})){w=1;r=0;k||x.equals(n);i.setEndAt(x,e.POSITION_BEFORE_END);break}q=
x;r=1;k=q.equals(n);s=1}r&&i.setEndAt(q,e.POSITION_AFTER_END);q=c(q,s,n);if((k=!q)||w&&i)break}if(!m){if(!i)return this.docEndMarker&&this.docEndMarker.dispose(),this.nextNode=null;m=new b.elementPath(i.startContainer);q=m.blockLimit;w={div:1,th:1,td:1};m=m.block;if(!m&&!this.enforceRealBlocks&&w[q.name()]&&i.checkStartOfBlock()&&i.checkEndOfBlock())m=q;else if(!m||this.enforceRealBlocks&&"li"===m.name())m=this.range.document.createElement(d||"p"),i.extractContents().appendTo(m),m.trim(),i.insertNode(m),
p=o=!0;else if("li"!==m.name()){if(!i.checkStartOfBlock()||!i.checkEndOfBlock())m=m.clone(!1),m.append(i.extractContents()).trim(),o=i.splitBlock(),p=!o.wasStartOfBlock,o=!o.wasEndOfBlock,i.insertNode(m)}else if(!k)this.nextNode=m.equals(n)?null:c(i.getBoundaryNodes().endNode,!0,n)}p&&(i=m.prev())&&i.$element&&("br"==i.name()?i.dispose():i.last()&&"br"===i.last()[0].nodeName.toLowerCase()&&i.last().dispose());o&&(i=m.last())&&i.$element&&"br"===i.name()&&(a.env.ie||i.prev(h)||i.next(h))&&i.dispose();
if(!this.nextNode)this.nextNode=k||m.equals(n)||!n?null:c(m,!0,n);return m}});b.range.implement("createIterator",function(){return new i(this)})})(Klass);
(function(a,c){var b=c.Editor;b.extend({instances:{},document:new c.DOM.document(a),add:function(a){this.instances[a.name]=a;a.addEvents({blur:function(){if(b.currentInstance===a)b.currentInstance=null},focus:function(){if(b.currentInstance!==a)b.currentInstance=a}})},get:function(a){return this.instances[a]},has:function(a){return!!this.instances[a.name]},create:function(){},destroy:function(a){delete this.instances[a.name]}})})(document,Klass);
Klass.ui=new Class({Implements:[Class.Options,Class.Events],options:{container:"body"},initialize:function(a){this.setOptions(a);this.container=Klass(this.options.container);this.render()},toElement:function(){return this.element},render:function(){this.bounds={lambda:Function.from(!1),externalClick:function(a){this.checkExternalClick?this.checkExternalClick(a)&&this.hide():this.hide();return!1}.bind(this)};this.fireEvent("render");this.hidden=!0;return this},toggle:function(a){return this[(this.hidden=
null!=a?a:this.hidden)?"show":"hide"]()},show:function(){if(!this.hidden)return this;this.options.hideOnClick&&this.container.click(this.bounds.externalClick);this.fireEvent("beforeShow");this.element.show();this.position();this.fireEvent("show");this.hidden=!1;return this},hide:function(){if(this.hidden)return this;this.options.hideOnClick&&this.container.off("click",this.bounds.externalClick);this.fireEvent("beforeHide");this.element.hide();this.fireEvent("hide");this.hidden=!0;return this},destroy:function(){this.hide();
this.element.destroy();this.fireEvent("destroy")}});
Klass.ui.mask=new Class({Implements:[Class.Options,Class.Events],options:{style:{},"class":"ui-mask",margins:!1,shim:!0,shimOptions:{}},property:"mask",initialize:function(a,c){this.target=document.node(a||document.body);this.target.store(this.property,this);this.setOptions(c);this.render();this.inject()},toElement:function(){return this.element},render:function(){var a=this.options;this.element=Klass.DOM.createElement("div",{"class":a["class"],id:a.id||"mask-"+Klass.uniqueID(),styles:Object.merge({},
a.style,{display:"none"}),events:{click:function(c){this.fireEvent("click",c);a.hideOnClick&&this.hide()}.bind(this)}});this.hidden=!0;this.isBody=this.target[0]==document.body},inject:function(a,c){var d;var b=this.options,c=c||b.where||this.isBody?"inside":"after",a=a||b.target||this.target;this.element.inject(a,c);if(b.shim)d=this.shim=new Klass.ui.shim(this.element,b.shimOptions),b=d,this.addEvents({show:b.show.bind(b),hide:b.hide.bind(b),destroy:b.destroy.bind(b)})},position:function(){var a=
this.options;this.resize(a.width,a.height);this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!a.margins,ignoreScroll:this.isBody});return this},resize:function(a,c){var b={styles:["padding","border"]};this.options.margins&&b.styles.push("margin");b=this.target.getComputedSize(b);if(this.isBody){this.element.styles({width:0,height:0});var e=(new Klass.DOM.window(window)).getScrollSize();if(b.totalHeight<e.y)b.totalHeight=e.y;if(b.totalWidth<e.x)b.totalWidth=e.x}this.element.styles({width:Array.pick([a,
b.totalWidth,b.x]),height:Array.pick([c,b.totalHeight,b.y])});return this},show:function(){if(!this.hidden)return this;(new Klass.DOM.window(window)).addEvent("resize",this.position.bind(this));this.position();this.showMask.apply(this,arguments);return this},showMask:function(){this.element.show();this.hidden=!1;this.fireEvent("show")},hide:function(){if(this.hidden)return this;(new Klass.DOM.window(window)).removeEvent("resize",this.position);this.hideMask.apply(this,arguments);return this.options.destroyOnHide?
this.destroy():this},hideMask:function(){this.element.hide();this.hidden=!0;this.fireEvent("hide")},toggle:function(a){this[(null!=a?a:this.hidden)?"show":"hide"]()},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");this.target.eliminate("mask")}});Klass.DOM.element.implement({mask:function(a){a&&this.set("mask",a);this.get("mask").show();return this},unmask:function(){this.get("mask").hide();return this}});
Klass.run(function(a){var c=a.dom;c.hooks.mask={set:function(a){var e=c.retrieve(this,"mask");e&&e.destroy();return c.eliminate(this,"mask").store(this,"mask:options",a)},get:function(){var b=c.retrieve(this,"mask");b||(b=new a.ui.mask(this,c.retrieve(this,"mask:options")),c.store(this,"mask",b));return b}}});
Klass.ui.shim=new Class({Implements:[Class.Options,Class.Events,Class.Occlude],options:{className:"ui-iframe-shim",src:'javascript:false;document.write("");',display:!1,zIndex:null,margin:0,offset:{x:0,y:0},browsers:Klass.env.ie6||Klass.env.firefox&&3>Klass.env.version&&Klass.env.mac},property:"ui-iframe-shim",initialize:function(a,c){this.element=document.node(a);if(this.occlude())return this.occluded;this.setOptions(c);this.make();return this},make:function(){var a=this.options;if(a.browsers){var c=
this.element,b=parseInt(c.style("zIndex"),10);if(!b){var b=1,e=c.style("position");("static"===e||!e)&&c.style("position","relative");c.style("zIndex",b)}b=(null!=a.zIndex||0===a.zIndex)&&b>a.zIndex?a.zIndex:b-1;0>b&&(b=1);this.shim=Klass.DOM.createElement("iframe",{src:a.src,scrolling:"no",frameborder:0,styles:{zIndex:b,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":a.className}).store(this.property,this);b=function(){this.shim.inject(c,
"after");this[a.display?"show":"hide"]();this.fireEvent("inject")}.bind(this);Klass.ui.shim.ready?b():(new Klass.DOM.window(window)).addEvent("load",b)}else this.position=this.hide=this.show=this.dispose=Function.from(this)},position:function(){if(!Klass.ui.shim.ready||!this.shim)return this;var a=this.options,c=this.element.measure(function(){return this.size()});void 0!=a.margin&&(c.x-=2*a.margin,c.y-=2*a.margin,a.offset.x+=a.margin,a.offset.y+=a.margin);this.shim.set({width:c.x,height:c.y}).position({relativeTo:this.element,
offset:a.offset});return this},show:function(){this.shim&&this.shim.show();return this.position()},hide:function(){this.shim&&this.shim.hide();return this},dispose:function(){this.shim&&this.shim.dispose();return this},destroy:function(){this.shim&&this.shim.destroy();return this}});(new Klass.DOM.window(window)).addEvent("load",function(){Klass.ui.shim.ready=!0});
Klass.run(function(a){function c(a,b){return parseInt(a.css(b),10)||0}function b(a){a=a.height()-c(a,"border-top-width")-c(a,"border-bottom-width");return 0>a?0:a}function e(a){a=a.width()-c(a,"border-left-width")-c(a,"border-right-width");return 0>a?0:a}function g(a){var b=a.code;if(a.shift)return!1;if(!(b in h||95<b&&106>b))if(!(111<b&&124>b)&&(48>b||57<b))if("hex"!==a.target.name||65>b||70<b)return!1}var h={8:1,9:1,46:1,37:1,39:1};a.ui.Colorpicker=new Class({Extends:a.ui,options:{prefix:"ui-colorpicker",
startColor:[255,0,0],markup:{palette:'<div class="{mainClass}"><div class="{mainClass}-palette"><div class="{mainClass}-picker"><div class="{mainClass}-canvas"></div><div class="{mainClass}-overlay"><div class="{mainClass}-marker"></div></div><div class="{mainClass}-slider"><div class="{mainClass}-slider-handle"></div></div></div><div class="{mainClass}-adjust"><div class="{mainClass}-booth"><div class="{mainClass}-backup-color"></div><div class="{mainClass}-current-color"></div></div><div class="{mainClass}-rgb"><label><em>R:</em><input type="number" name="red" maxlength="3" min="0" max="255" /></label><label><em>G:</em><input type="number" name="green" maxlength="3" min="0" max="255" /></label><label><em>B:</em><input type="number" name="blue" maxlength="3" min="0" max="255" /></label></div><div class="{mainClass}-hsl"><label class="{mainClass}-hue"><em>H:</em><input type="number" name="hue" maxlength="3" min="0" max="359" /></label><label class="{mainClass}-sat"><em>S:</em><input type="number" name="sat" maxlength="3" min="0" max="100" /></label><label class="{mainClass}-lum"><em>L:</em><input type="number" name="lum" maxlength="3" min="0" max="100" /></label></div><div class="{mainClass}-hex"><label><em>Hex:</em><input type="text" name="hex" maxlength="7" /></label></div></div></div><div class="{mainClass}-footer"></div></div>',
button:'<button class="ui-button">{name}</button>'},wheel:!1},initialize:function(b,c){this.target=a(b);this.sets={rgb:[],hsb:[],hex:[]};this.pickerPos={x:0,y:0};this.layouts||this.parent(c)},render:function(){var b=this.options,c=b.markup,c=c.palette.substitute({mainClass:b.prefix}),e=this.element=b.element?a(b.element):a(c).appendTo(this.container),c=this.getElement("picker",e),e=this.getElement("adjust",e),g=this.getElement("rgb",e,0),h=this.getElement("hsl",e,0),l=this.getElement("hex",e,0),g=
a("input",g),h=a("input",h),l=a("input",l)[0];this.layouts={picker:c,overlay:this.getElement("overlay",c),canvas:this.getElement("canvas",c),marker:this.getElement("marker",c),slider:this.getElement("slider",c),sliderHandle:this.getElement("slider-handle",c),chooseColor:this.getElement("backup-color",e),backup:this.getElement("current-color",e),inputs:a("input",e),rgbArray:g,hsbArray:h,rRGB:g[0],gRGB:g[1],bRGB:g[2],hHSB:h[0],sHSB:h[1],bHSB:h[2],hex:l};this.target.click(this.show.bind(this));this.boundEvents();
this.boundDragEvents();b.wheel&&this.wheelEvents();b=b.startColor;"string"!==typeof b&&(b=b.rgbToHex());this.currentColor=b;this.layouts.backup.style("background-color",b);this.layouts.canvas.style("background-color",b);this.parent()},boundEvents:function(){var a=this.layouts;a.inputs.on({keydown:g,keyup:function(a){var b=a.code,c=a.target,d=c.value,e=d.length,k="#"===d.charAt(0)?7:6,e="hex"===c.name?e!==k:3<e;d&&!e&&!(b in h||!1===g(a))&&this.updateColors(c)}.bind(this),blur:function(a){var a=a.target,
b=a.name,c=a.value,d=c.length,e="hex"===b,g=e?"#"===c.charAt(0)?7:6:3,c=!d?0:d>g?c.substr(0,g):e?c:parseInt(c,10);/red|green|blue/.test(b)?c=255<c?255:0>c?0:c:e||(c=/hue/.test(b)?359<c?0:0>c?0:c:100<c?100:0>c?0:c);if(c!=a.value)a.value=c,this.updateColors(a)}.bind(this)});a.backup.click(function(){this.manualPopulate(this.currentColor);this.fireEvent("change",this.sets)}.bind(this))},boundDragEvents:function(){var d=this.layouts,f=this.snippet.bind(this),g=0,h=0,m,l=function(){this.setRainbow(this.parseColors(),
"hsb");this.layouts.canvas.style("background-color",[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex());this.fireEvent("change",this.sets)}.bind(this),k=new a.ui.Draggable(d.sliderHandle,{modifiers:{x:!1},onBeforeStart:l,onStart:l,onDrag:l,snap:0});d.slider.mousedown(function(a){g||(g=f("slider")-f("sliderY",!0));if(!k.options.limit)k.options.limit={y:[0+g,b(d.slider)+g]};if(!m)m=k.options.limit.y;var c=a.page.y-d.slider.pos().y+g,c=Math.min(Math.min(c,m[1]),Math.max(c,m[0]));d.sliderHandle.style("top",
c);k.start(a)});var n=function(){var a=f("markerSize",1);return{x:[-a.x,e(d.canvas)-a.x],y:[-a.y,b(d.canvas)-a.y]}},l=function(){this.reposPicker();this.setRainbow(this.parseColors(),"hsb");this.fireEvent("change",this.sets)}.bind(this),p=new a.ui.Draggable(d.marker,{limit:n(),onBeforeStart:l,onStart:l,onDrag:l,snap:0});d.overlay.mousedown(function(b){var e=d.canvas,g=e.pos(),i;h||(i=f("markerSize",1),h={x:c(e,"border-left-width"),y:c(e,"border-top-width")},a.env.ie&&(h.x+=i.x,h.y+=i.y));if(!(p.options.limit.x&&
(p.options.limit.x[0]||p.options.limit.x[1])||p.options.limit.y&&(p.options.limit.y[0]||p.options.limit.y[1])))p.options.limit=n();d.marker.style({top:b.page.y-g.y-h.y,left:b.page.x-g.x-h.x});p.start(b)})},wheelEvents:function(){var a=this,b=this.layouts,c=function(c,e){var e=c.target,g=c.wheel,h;if("keydown"===c.type)if("up"===c.key)g=1;else if("down"===c.key)g=-1;else return;else g&&(g=0<g?1:-1);if("input"!==e.tagName.toLowerCase())e=b.hHSB;h=parseInt(e.value,10);g&&(h+=g);e.value=/red|green|blue/.test(e.name)?
255<h?255:0>h?0:h:/hue/.test(e.name)?359<h?0:0>h?0:h:100<h?100:0>h?0:h;a.updateColors(e);c.stop()};[b.rgbArray,b.hsbArray].each(function(a){a.on({keydown:c,mousewheel:c})});[b.slider,b.sliderHandle].each(function(a){a.on({mousewheel:c,keydown:c})})},getElement:function(b,c,e){var g=this.options.prefix+"-";return(c=(b=b?"."+g+b:null)&&a(b,c))&&null!=e?c[e]:c},manualPopulate:function(a,b){var c=this.normalizeColors(a,b);this.setRainbow(c);this.autoPopulate(c.hsb)},autoPopulate:function(a){var c=this.snippet("markerSize",
1),g=e(this.layouts.canvas),h=b(this.layouts.canvas),m=b(this.layouts.slider),l=this.snippet("sliderY",!0),g=Math.round(g*a[1]/100-c.x),c=Math.round(-(h*a[2]/100)+h-c.y),a=Math.round(m*a[0]/360),l=m-(360==a?0:a)+this.snippet("slider")-l,m=[this.sets.hsb[0],100,100].hsbToRgb().rgbToHex();this.layouts.marker.style({top:c,left:g});this.layouts.sliderHandle.style("top",l);this.layouts.canvas.style("background-color",m);this.reposPicker()},setRainbow:function(a,b){var c=this.layouts,e=b?this.normalizeColors(a,
b):a,g=e.rgb,h=e.hsb;this.sets=e;!this.pickerPos.x&&0!==this.pickerPos.x&&this.autoPopulate(h);c.rRGB.value=g[0];c.gRGB.value=g[1];c.bRGB.value=g[2];c.hHSB.value=h[0];c.sHSB.value=h[1];c.bHSB.value=h[2];c.hex.value=e.hex.toUpperCase();c.chooseColor.style("background-color",g.rgbToHex());this.backupColor=g},normalizeColors:function(a,b){var c,e,g;"hsb"===b?(e=a,c=a.hsbToRgb(),g=c.rgbToHex()):"hex"===b?(g=a,c=a.hexToRgb(!0),e=c.rgbToHsb()):(c=a,e=a.rgbToHsb(),g=a.rgbToHex());return{rgb:c,hsb:e,hex:g}},
parseColors:function(a,c,g){var h=this.pickerPos,m=this.layouts,l=e(m.canvas),k=b(m.canvas),m=b(m.slider),n=this.snippet("sliderY",!0),a=a||h.x,c=c||h.y,g=g||this.snippet("sliderPos"),a=Math.round(100*a/l),k=100-Math.round(100*c/k),c=359-Math.round(360*g/m)+this.snippet("slider")-n;return[360<=c||m-n===g?0:0>c?0:c,100<a?100:0>a?0:a,100<k?100:0>k?0:k]},updateColors:function(a){var b=a.name,c=parseInt(a.value,10)||0,e=this.sets.rgb,g=this.sets.hsb,h;if(/red|green|blue/.test(b)){if(0>c||255<c)return;
switch(b){case "red":a=[c,e[1],e[2]];break;case "green":a=[e[0],c,e[2]];break;case "blue":a=[e[0],e[1],c];break;default:a=e}}else if("hex"!==b){if(/hue/.test(b)&&(0>c||359<c)||/sat|lum/.test(b)&&(0>c||100<c))return;switch(b){case "hue":a=[c,g[1],g[2]];break;case "sat":a=[g[0],c,g[2]];break;case "lum":a=[g[0],g[1],c];break;default:a=g}h="hsb"}else if(a=a.value.hexToRgb(!0),!a||isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))return;this.manualPopulate(a,h);this.fireEvent("change",this.sets)},reposPicker:function(){var a=
this.snippet("markerSize",1),b=this.snippet("markerPos");this.pickerPos={x:b.x+a.x,y:b.y+a.y}},setColor:function(a){a=a||this.options.startColor;"string"===typeof a&&(a=a.hexToRgb(!0));this.currentColor=a;this.manualPopulate(a);this.layouts.backup.style("background-color",a.rgbToHex());return this},position:function(){},show:function(a){this.parent();this.reposPicker();this.setColor(a);return this},complete:function(){this.hide();this.setColor(this.backupColor);this.fireEvent("complete",this.sets);
return this},snippet:function(a,b){var c,e;e=this.layouts.marker;c=this.layouts.sliderHandle;switch(a){case "sliderPos":c=parseInt(c.style("top"),10);break;case "sliderY":c=c.height();c=b?parseInt(c/2,10):c;break;case "markerPos":c={x:parseInt(e.style("left"),10),y:parseInt(e.style("top"),10)};break;case "slider":c=parseInt(this.layouts.slider.style("marginTop"),10);break;default:c=e.height(),e=e.width(),c={x:b?parseInt(e/2,10):e,y:b?parseInt(c/2,10):c}}return c}})});
Klass.run(function(a){var c=this.document,b=a.dom;a.ui.Draggable=new Class({Implements:[Class.Events,Class.Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,preventDefault:!1,stopPropagation:!1,modifiers:{x:"left",y:"top"}},initialize:function(e,g){this.setOptions(g);this.element=b.id(e);this.document=a(b.getDocument(this.element));this.handles=a(this.options.handle||this.element);this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=a.env.ie?"selectstart":
"mousedown";if(a.env.ie&&!a.ui.Draggable.ondragstartFixed)c.ondragstart=Function.from(!1),a.ui.Draggable.ondragstartFixed=!0;this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(!1)};this.attach()},attach:function(){this.handles.mousedown(this.bound.start);return this},detach:function(){this.handles.off("mousedown",this.bound.start);return this},start:function(c){var g=this.options;
if(!c.rightClick){g.preventDefault&&c.preventDefault();g.stopPropagation&&c.stopPropagation();this.mouse.start=c.page;this.fireEvent("beforeStart",this.element);var h=g.limit;this.limit={x:[],y:[]};var d,f;for(d in g.modifiers)if(g.modifiers[d]){var i=b.getStyle(this.element,g.modifiers[d]);i&&!i.match(/px$/)&&(f||(f=b.getCoordinates(this.element,b.getOffsetParent(this.element))),i=f[g.modifiers[d]]);this.value.now[d]=g.style?parseInt(i,10)||0:this.element[g.modifiers[d]];g.invert&&(this.value.now[d]*=
-1);this.mouse.pos[d]=c.page[d]-this.value.now[d];if(h&&h[d])for(i=2;i--;){var j=h[d][i];if(j||0===j)this.limit[d][i]="function"===typeof j?j():j}}if("number"==a.type(this.options.grid))this.options.grid={x:this.options.grid,y:this.options.grid};c={mousemove:this.bound.check,mouseup:this.bound.cancel};c[this.selection]=this.bound.eventStop;this.document.on(c)}},check:function(a){this.options.preventDefault&&a.preventDefault();Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-
this.mouse.start.y,2)))>this.options.snap&&(this.cancel(),this.document.on({mousemove:this.bound.drag,mouseup:this.bound.stop}),this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element))},drag:function(a){var c=this.options;c.preventDefault&&a.preventDefault();this.mouse.now=a.page;for(var h in c.modifiers)if(c.modifiers[h]){this.value.now[h]=this.mouse.now[h]-this.mouse.pos[h];c.invert&&(this.value.now[h]*=-1);if(c.limit&&this.limit[h])if((this.limit[h][1]||0===this.limit[h][1])&&this.value.now[h]>
this.limit[h][1])this.value.now[h]=this.limit[h][1];else if((this.limit[h][0]||0===this.limit[h][0])&&this.value.now[h]<this.limit[h][0])this.value.now[h]=this.limit[h][0];c.grid[h]&&(this.value.now[h]-=(this.value.now[h]-(this.limit[h][0]||0))%c.grid[h]);c.style?b.setStyle(this.element,c.modifiers[h],this.value.now[h]+c.unit):this.element[c.modifiers[h]]=this.value.now[h]}this.fireEvent("drag",[this.element,a])},cancel:function(a){this.document.off({mousemove:this.bound.check,mouseup:this.bound.cancel});
a&&(this.document.off(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(a){var b={mousemove:this.bound.drag,mouseup:this.bound.stop};b[this.selection]=this.bound.eventStop;this.document.off(b);a&&this.fireEvent("complete",[this.element,a])}})});
Klass.run(function(a){var c=this.document,b=a.dom;b.extend({computePosition:function(a,c){return{left:c.x-(parseInt(b.getComputedStyle(a,"margin-left"),10)||0),top:c.y-(parseInt(b.getComputedStyle(a,"margin-top"),10)||0)}},setPosition:function(a,b){return this.setStyles(a,this.computePosition(a,b))}});a.ui.Droppable=new Class({Extends:a.ui.Draggable,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(c,g){this.parent(c,g);c=this.element;this.container=
b.id(this.options.container);this.droppables=Array.from(a(this.options.droppables));if(this.options.style){if("left"===this.options.modifiers.x&&"top"===this.options.modifiers.y){var h=b.getOffsetParent(c),d=b.getStyles(c,"left","top");h&&("auto"===d.left||"auto"===d.top)&&b.setPosition(c,b.getPosition(c,h))}"static"===b.getStyle(c,"position")&&b.setStyle(c,"position","absolute")}this.addEvent("start",this.checkDroppables,!0);this.overed=null},start:function(a){if(this.container)this.options.limit=
this.calculateLimit();if(this.options.precalculate)this.positions=this.droppables.map(function(a){return b.getCoordinates(a)});this.parent(a)},calculateLimit:function(){var e=this.element,g=this.container,h=b.getOffsetParent(e)||c.body,d=b.getCoordinates(g,h),f={},i={},j={},m={};["top","right","bottom","left"].each(function(a){f[a]=parseInt(b.getStyle(e,"margin-"+a),10);parseInt(b.getStyle(e,"border-"+a),10);i[a]=parseInt(b.getStyle(g,"margin-"+a),10);j[a]=parseInt(b.getStyle(g,"border-"+a),10);m[a]=
parseInt(b.getStyle(h,"padding-"+a),10)},this);var l=0,k=0,n=d.right-j.right-(e.offsetWidth+f.left+f.right),p=d.bottom-j.bottom-(e.offsetHeight+f.top+f.bottom);this.options.includeMargins?(l+=f.left,k+=f.top):(n+=f.right,p+=f.bottom);"relative"===b.getStyle(e,"position")?(d=b.getCoordinates(e,h),d.left-=parseInt(b.getStyle(e,"left"),10),d.top-=parseInt(b.getStyle(e,"top"),10),l-=d.left,k-=d.top,"relative"!==b.getStyle(g,"position")&&(l+=j.left,k+=j.top),n+=f.left-d.left,p+=f.top-d.top,g!=h&&(l+=i.left+
m.left,k+=(a.env.ie6||a.env.ie7?0:i.top)+m.top)):(l-=f.left,k-=f.top,g!=h&&(l+=d.left+j.left,k+=d.top+j.top));return{x:[l,n],y:[k,p]}},getDroppableCoordinates:function(c){var g=b.getCoordinates(c);"fixed"===b.getStyle(c,"position")&&(c=a(window).scroll(),g.left+=c.x,g.right+=c.x,g.top+=c.y,g.bottom+=c.y);return g},checkDroppables:function(){var a=this.droppables.filter(function(a,b){var a=this.positions?this.positions[b]:this.getDroppableCoordinates(a),c=this.mouse.now;return c.x>a.left&&c.x<a.right&&
c.y<a.bottom&&c.y>a.top},this).getLast();if(this.overed!=a)this.overed&&this.fireEvent("leave",[this.element,this.overed]),a&&this.fireEvent("enter",[this.element,a]),this.overed=a},drag:function(a){this.parent(a);this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(a){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,a]);this.overed=null;return this.parent(a)}})});
Klass.run(function(a){var c=a.dom;a.ui.Sortables=new Class({Implements:[Class.Events,Class.Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{}},initialize:function(b,c){this.setOptions(c);this.elements=[];this.lists=[];this.idle=!0;this.addLists(a(b));if(!this.options.clone)this.options.revert=!1},attach:function(){this.addLists(this.lists);return this},detach:function(){this.lists=this.removeLists(this.lists);return this},addItems:function(){Array.flatten(arguments).each(function(b){this.elements.push(b);
var e=a(b),g=c.retrieve(b,"sortables:start",function(a){this.start.call(this,a,b)}.bind(this));(this.options.handle?e.find(this.options.handle)||e:e).mousedown(g)},this);return this},addLists:function(){Array.flatten(arguments).each(function(a){this.lists.include(a);this.addItems(c.children(a))},this);return this},removeItems:function(){return Array.flatten(arguments).map(function(b){this.elements.erase(b);var e=c.retrieve(b,"sortables:start"),g=a(b);(this.options.handle?g.find(this.options.handle)||
g:g).off("mousedown",e);return b},this)},removeLists:function(){return Array.flatten(arguments).map(function(a){this.lists.erase(a);this.removeItems(c.children(a));return a},this)},getClone:function(b,e){var g=this.options.clone;if(!g)return g=c.newElement(c.get(e,"tag")),c.append(g,document.body),g;if("function"===typeof g)return g.call(this,b,e,this.list);g=c.clone(e,!0);c.setStyles(g,{margin:0,position:"absolute",visibility:"hidden",width:c.getStyle(e,"width")});a.event.addEvent(g,"mousedown",
function(a){c.fireEvent(e,"mousedown",a)});/radio/.test(c.get(g,"html"))&&g.getElements("input[type=radio]").each(function(a,b){a.set("name","clone_"+b);a.get("checked")&&e.getElements("input[type=radio]")[b].set("checked",!0)});c.append(g,this.list);c.setPosition(g,c.getPosition(e,c.getOffsetParent(e)));return g},getDroppables:function(){var a=c.children(this.list),a=this.elements.length===a.length-1?a.erase(this.clone).erase(this.element):this.elements;this.options.constrain||a.append(this.lists).erase(this.list);
return a},insert:function(a,e){var g="inside";this.lists.contains(e)?(this.list=e,this.drag.droppables=this.getDroppables()):g=c.prevAll(this.element).contains(e)?"before":"after";c[g](this.element,e);c.after(a,e);this.fireEvent("sort",[this.element,this.clone])},start:function(b,e){if(this.idle&&!b.rightClick&&!["button","input","a","textarea"].contains(c.get(b.target,"tag")))this.idle=!1,this.element=e,this.opacity=c.getStyle(e,"opacity"),this.list=c.parent(e),this.clone=c.id(this.getClone(b,e)),
this.drag=(new a.ui.Droppable(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions))).addEvents({onSnap:function(){b.stop();c.setStyle(this.element,"opacity",this.options.opacity||0);c.setStyle(this.clone,"visibility","visible");this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),c.before(this.clone,this.element),this.drag.start(b)},end:function(){this.drag.detach();
c.setStyle(this.element,"opacity",this.opacity);if(this.effect){var a=c.getStyles(this.element,"width","height"),e=this.clone,g=c.computePosition(e,c.getPosition(this.element,c.getOffsetParent(this.clone))),h=function(){this.removeEvent("cancel",h);c.destroy(e)};this.effect.element=e;this.effect.start({top:g.top,left:g.left,width:a.width,height:a.height,opacity:0.25}).addEvent("cancel",h).chain(h)}else c.destroy(this.clone);this.reset()},reset:function(){this.idle=!0;this.fireEvent("complete",this.element)},
serialize:function(a,e){var g=this.lists.map(function(e){return c.children(e).map(a||function(a){return c.get(a,"id")},this)},this);1==this.lists.length&&(e=0);return(e||0===e)&&0<=e&&e<this.lists.length?g[e]:g}})});
Klass.Editor.ui=new Class({options:{},initialize:function(a){if(a.ui)return a.ui;this.items={};this.handlers={};this.editor=a;this.markup=a.markup;this.mixComponent=!1},add:function(a,c,b){this.items[a]={type:c,command:b.command||null,args:Array.prototype.slice.call(arguments,2)}},create:function(a){var c=this.items[a],b=c&&this.handlers[c.type],a=c&&c.command&&this.editor.getCommand(a),c=b&&b.create.apply(this,c.args);a&&a.uiItems.push(c);return c},addHandler:function(a,c){this.handlers[a]=c}});
Klass.Editor.ui.extend({BUTTON:1,RICHCOMBO:2,PANEL:3,PANELBUTTON:4,MENUBUTTON:5});
Klass.Editor.ui.component=new Class({Implements:[Class.Events,Class.Options],options:{},initialize:function(a,c){this.setOptions(c);this.editor=a;this.prefixCls=a.prefixCls;this.markup=this.options.markup||a.markup;delete this.options.markup;this.container=document.node(this.options.container||Klass.Editor.document.body());delete this.options.container;if(this.options.className)this.wrapClass=this.prefixCls+this.options.className+"-panel",delete this.options.className;this.items={}},toEditor:function(){return this.editor},
toElement:function(){return this.element},getElement:function(a,c){var b=this.toElement();return a?b.find(a,c||1):b}});Klass.Editor.ui.instances={};
Klass.Editor.ui.panel=new Class({Extends:Klass.Editor.ui.component,options:{css:["skins/default/richcombo.css","skins/default/palette.css"],baseCls:"kse-editor"},initialize:function(a,c){this.parent(a,c);this.blocks={};this.css=[];this.uid=Klass.Editor.utils.unique();var b=Klass.dom.getOffsetParent(a.container[0]);if(b&&"HTML"!==b.tagName)this.container=document.node(b);for(var b=0,e=this.options.css.length;b<e;b++)this.css.push(Klass.Editor.getUrl(this.options.css[b]));this.render()},render:function(){var a=
this.markup,c=this.container,b=this.element=(new Klass.DOM.element("div",{"class":"kse-panel",html:a.comboPanel,styles:{zIndex:this.editor.baseZIndex("SELECT")}})).appendTo(c),b=(new Klass.DOM.element("iframe",{id:"kse_panel_iframe_"+this.uid,src:"javascript:void(0)",frameborder:0})).appendTo(document.node(b[0].firstChild)),a=a.comboPanelContent.substitute({baseCss:"*{margin: 0; padding: 0;}",externalCss:"ul, ol{list-style-type: none}",direction:Klass.Editor.config.contentsDirection,baseHead:Klass.Editor.utils.buildStyleHtml(this.css)});
this.document=Klass.Editor.utils.initIFrameDocument(b,a);c=this.document.body().unselectable();c.style("opacity",0);c.addEvent("mousedown",function(){return!1});(Klass.env.ie?b:new Klass.DOM.window(b[0].contentWindow)).addEvent("blur",this.fireEvent.bind(this,"collapse"),!0);a=function(){c.style("opacity",1);this.fireEvent("render")}.bind(this);Klass.env.ie&&window.frames[b[0].id].window?a():b.addListener("load",a);this.iframe=b;this.container=c},mixBlock:function(){},position:function(a){this.toElement().position({relativeTo:a||
this.container,position:"bottomLeft"})},createBlock:function(a){return this.container.insertFirst(a||this.markup.panelBlock)},showBlock:function(a){for(var c=this.container.children(),b=0,e=c.length;b<e;b++)c[b].hide();this.currentBlock=this.blocks[a].show();setTimeout(this.focus.bind(this),0)},focus:function(){this.iframe[0].contentWindow.focus()},addBlock:function(a,c){var b=this.blocks[a],b=b?b:this.createBlock(c);return this.blocks[a]=b}});
Klass.Editor.ui.button=new Class({Extends:Klass.Editor.ui.component,initialize:function(a,c){this.name=a;this.prefixCls=c.prefixCls;var b=c.getCommand(a)||a;this.markup=c.markup;this.editor=c;this.config=b.config||c.config[a];this.title=b.label||c.lang[a]||"";this.item=b;this.bound={click:this.execCommand.bind(this)};this.render();b.button=this;b.element=this.toElement()},render:function(){var a=this.item,c=Klass.env.mac?"Cmd":"Ctrl",b=(this.config||{}).shortcut||a.shortcut||"",e=b.split("+"),g=this.prefixCls+
"button",h=this.prefixCls+"hover";1<b.length&&-1!=b.indexOf("+")?(c=b,b=e[e.length-1]||"+"):c=c+"+"+b;if(b&&!a.specialKey)(this.editor.specialKeys=this.editor.specialKeys||{})[b]=1<e.length?{command:this.name,keystrokes:c}:this.name;b=this.title+(b?" ["+c.capitalize()+"]":"");e=this.markup.button.substitute({title:b});g=g+" "+g+"-"+this.name;this.element=(new Klass.DOM.element("span",{html:e,title:b,"class":g,events:this.bound})).hover(h).unselectable();a&&a.addEvent&&(a.addEvent("state",function(){this.element.set("state",
a.state)}.bind(this)),this.element.set("state",a.state))},execCommand:function(){this.editor.execCommand(this.name,!1);return!1},enable:function(){if(!this.disabled)return this;this.active&&this.element.removeClass("kse-active");this.element.removeClass("kse-disabled");this.disabled=!1;return this},disable:function(){if(this.disabled)return this;this.element.addClass("kse-disabled");this.disabled=!0;return this},setDisabled:function(a){return this[a?"disable":"enable"]()},activate:function(){if(this.disabled)return this;
this.element.addClass("kse-button-active");this.active=!0;return this},deactivate:function(){this.element.removeClass("kse-button-active");this.active=!1;return this}});
Klass.Editor.ui.richCombo=new Class({Extends:Klass.Editor.ui.component,options:{maxHeight:328},initialize:function(a,c){this.parent(a,c);Object.merge(this,c);this.collapsed=!0;this.modes={wysiwyg:1};this.bound={click:function(a){a.stop();this.state!==Klass.Editor.$.TRISTATE_DISABLED&&this.toggleCollapse()}.bind(this),mouseover:function(b){a.ui.mixComponent&&(b.stop(),this.expand())}.bind(this)};this.render()},add:function(a,c){this.items[a]=c||a},render:function(){var a=this.title,c=this.markup.select.substitute({label:a});
this.element=new Klass.DOM.element("span",{html:c,title:a,"class":this.prefixCls+"select",events:this.bound});this.labelElement=this.element.find(".kse-label",1);this.editor.addEvent("mode",this.updateState.bind(this));!this.readOnly&&this.editor.addEvent("readOnly",this.updateState.bind(this));this.fireEvent("render")},getValue:function(){return this.value||""},setValue:function(a,c){c=c||a;this.value=a;this.labelElement.html(c||this.label);this.labelElement[c?"removeClass":"addClass"]("kse-inline")},
getPanel:function(){var a=this.container.retrieve("kse-floatpanel",null);a||(a=new Klass.Editor.ui.panel(this.editor,{onRender:this.resize.bind(this)}),this.container.store("kse-floatpanel",a));a.addEvent("collapse",this.collapse.bind(this));this.panel=a;this.wrap=this.panel.element.first();return a},initList:function(){if(!this.list){this.init&&this.init();var a={},c=[],b=this.getPanel();this.list=b.element;var e=b.addBlock(this.name),g=b.document;Object.each(this.items,function(b,d){var f=g.createElement("li",
{title:d,html:b,"class":"kse-list-item",events:{click:function(a){this.fireEvent("click",a);this.collapse()}.pass(d,this)}});this.addHandler&&this.addHandler(f,d);c.push(f);a[d]=f},this);e.find("ul",1).adopt(c);this.listItems=a;this.listBlock=e}},resize:function(){if(this.listBlock){var a=this.listBlock.height();this.wrap.style("height",Math.min(a,this.options.maxHeight||a))}},collapseCurrentList:function(){var a=this.container.retrieve("kse-richcombo",null);a&&a!==this.list&&a.collapse();this.container.store("kse-richcombo",
this);return this},show:function(){this.list.show();this.panel.position(this.element);this.panel.showBlock(this.name);this.container.addEvent("mouseover",this.mix.bind(this));this.resize();return this},toggleState:function(){this.setState(Klass.Editor.$[this.collapsed?"TRISTATE_OFF":"TRISTATE_ON"]);this.unmark().mark(this.getValue())},updateState:function(){var a=this.editor,c=Klass.Editor.$[this.modes[a.mode]?"TRISTATE_OFF":"TRISTATE_DISABLED"];this.setState(a.readOnly&&!this.readOnly?Klass.Editor.$.TRISTATE_DISABLED:
c);this.setValue("")},setState:function(a){if(this.state!==a)this.element.set("state",a),this.state=a},toggleCollapse:function(){this[this.collapsed?"expand":"collapse"]();return this},collapse:function(){if(!this.collapsed)return this.fireEvent("beforeCollapse"),this.collapsed=!0,this.list.hide(),this.removeClass(),this.container.removeEvent("mouseover",this.mix.bind(this)),this.editor.ui.mixComponent=!1,this.fireEvent("collapse"),this.toggleState(),this},mix:function(a){a.getTarget().hasClass("kse-button")&&
this.collapse();return!1},expand:function(){if(this.collapsed)return this.list||this.initList(),this.fireEvent("beforeExpand"),this.collapseCurrentList(),this.collapsed=!1,this.editor.ui.mixComponent=!0,this.addClass(),this.show(),this.fireEvent("expand"),this.toggleState(),this},addClass:function(){this.wrap.addClass(this.wrapClass);this.element.style("z-index",this.editor.baseZIndex("COMBO"))},removeClass:function(){this.wrap.removeClass(this.wrapClass);this.wrap.style("height",null);this.element.style("z-index",
null)},mark:function(a){(a=this.listItems[a])&&a.addClass("kse-selected");return this},unmark:function(a){var c=this.listItems;if(a=c[a])a.removeClass("kse-selected");else for(var b in c)c[b].removeClass("kse-selected");return this},activate:function(){}});Klass.Editor.ui.richCombo.handler={create:function(a){return new Klass.Editor.ui.richCombo(this.editor,a)}};Klass.Editor.ui.prototype.addRichCombo=function(a,c){this.add(a,this.constructor.RICHCOMBO,c)};
Klass.Editor.ui.panelButton=new Class({Extends:Klass.Editor.ui.component,initialize:function(a,c){this.parent(a,c);Object.merge(this,this.options);this.collapsed=!0;this.modes={wysiwyg:1};this.bound={click:function(a){a.stop();this.state!==Klass.Editor.$.TRISTATE_DISABLED&&this.toggleCollapse()}.bind(this),mouseover:function(a){this.editor.ui.mixComponent&&(a.stop(),this.expand())}.bind(this)};this.render()},getPanel:function(){var a=this.container.retrieve("kse-floatpanel",null);a||(a=new Klass.Editor.ui.panel(this.editor),
this.container.store("kse-floatpanel",a));a.addEvent("collapse",this.collapse.bind(this));this.panel=a;this.wrap=this.panel.element.first();return a},initList:function(){if(!this.list){var a=this.listItems={},c=this.getPanel();this.list=c.element;for(var c=c.addBlock(this.name,this.build()).find("a"),b=0,e=c.length;b<e;b++){var g=c[b],h=g.getProperty("kse-color")||"";h&&(g.removeProperty("kse-color"),a[h]=g,this.addHandler(g,h));g.addEvent("click",function(a){this.fireEvent("click",a);this.collapse()}.pass(h,
this))}}},render:function(){var a=("string"===typeof this.markup?this.markup:this.markup.panelButton).substitute({label:this.label});this.element=new Klass.DOM.element("span",{"class":this.prefixCls+"button "+this.prefixCls+this.iconCls,title:this.title,html:a,styles:{position:"relative"},events:this.bound});this.editor.addEvent("mode",this.updateState.bind(this));!this.readOnly&&this.editor.addEvent("readOnly",this.updateState.bind(this));this.fireEvent("render")},collapseCurrentList:function(){var a=
this.container.retrieve("kse-richcombo",null);a&&a!==this.list&&a.collapse();this.container.store("kse-richcombo",this);return this},show:function(){this.list.show();this.panel.position(this.element);this.panel.showBlock(this.name);this.panel.document.html().style("overflow","hidden");this.container.addEvent("mouseover",this.mix.bind(this));return this},toggleState:function(){this.setState(Klass.Editor.$[this.collapsed?"TRISTATE_OFF":"TRISTATE_ON"])},updateState:function(){var a=this.editor,c=Klass.Editor.$[this.modes[a.mode]?
"TRISTATE_OFF":"TRISTATE_DISABLED"];this.setState(a.readOnly&&!this.readOnly?Klass.Editor.$.TRISTATE_DISABLED:c);this.setValue("")},setState:function(a){if(this.state!==a)this.element.set("state",a),this.state=a},toggleCollapse:function(){this[this.collapsed?"expand":"collapse"]();return this},collapse:function(){if(!this.collapsed)return this.fireEvent("beforeCollapse"),this.collapsed=!0,this.list.hide(),this.removeClass(),this.panel.document.html().style("overflow","auto"),this.container.removeEvent("mouseover",
this.mix.bind(this)),this.editor.ui.mixComponent=!1,this.fireEvent("collapse"),this.toggleState(),this},mix:function(a){a.getTarget().hasClass("kse-button")&&this.collapse();return!1},expand:function(){if(this.collapsed)return this.list||this.initList(),this.fireEvent("beforeExpand"),this.collapseCurrentList(),this.collapsed=!1,this.editor.ui.mixComponent=!0,this.addClass(),this.show(),this.fireEvent("expand"),this.toggleState(),this},setValue:function(a){this.value=a||"";return this},addClass:function(){this.wrap.addClass(this.wrapClass)},
removeClass:function(){this.wrap.removeClass(this.wrapClass)},mark:function(a){(a=this.listItems[a])&&a.addClass("kse-selected");return this},unmark:function(a){var c=this.listItems;if(a=c[a])a.removeClass("kse-selected");else for(var b in c)c[b].removeClass("kse-selected");return this}});Klass.Editor.ui.panelButton.handler={create:function(a){return new Klass.Editor.ui.panelButton(this.editor,a)}};Klass.Editor.ui.prototype.addColorButton=function(a,c){this.add(a,this.constructor.PANELBUTTON,c)};
Klass.run(function(a){function c(a){return n(a)&&!a.getProperty("checked")?a.data("uncheck")||!1:a.value()}function b(a,b){null==b&&(b="");n(a)?a.setProperty("checked",b===a.value()):a.value(b)}function e(a){a&&a.addClass("kse-disabled").setProperty("disabled",!0)}function g(a){a&&a.removeClass("kse-disabled").removeProperty("disabled")}var h=a.Editor,d=a.env,f=h.document,i=f[0],j=f.getWindow(),m={},l=/^[a-zA-Z]/,k=function(a){return a.isVisible()&&(!a.is("input")||!a.getProperty("disabled"))},n=
function(a){var b=a.getProperty("type");return a.is("input")&&("checkbox"===b||"radio"===b)};h.dialog={dialogs:{},add:function(a,b){this.dialogs[a]||(this.dialogs[a]=b)}};h.dialogCommand=new Class({initialize:function(a,b){this.name=a;if(b)this.label=b.label||null,this.shortcut=b.shortcut||null,this.startDisabled=b.startDisabled||null},execute:function(a){d.opera?a.openDialog.delay(0,this,this.name):a.openDialog(this.name)},canUndo:!1,editorFocus:d.ie||d.webkit});h.implement({openDialog:function(a,
b){if("wysiwyg"===this.mode&&d.ie){var c=this.getSelection();c&&c.lock()}var f=this.getDialog(a);if(!f&&(c=h.dialog.dialogs[a],"function"===typeof c&&(c=c(this)),"object"===typeof c)){if(f=h.dialog.validate.getRules(a))c.customValidationRules=f;f=this.addDialog(a,new h.ui.dialog(this,c))}if(f)return b&&b.call(f),f.show()}});h.ui.dialog=new Class({Extends:h.ui.component,options:{width:"600px",height:"auto",forms:{},buttons:["ok","cancel"],modal:!0,fixed:!0,tabs:{},tabBarMode:!0,tabIndex:0},initialize:function(a,
b){this.parent(a,b);this.rules=this.options.customValidationRules||{};delete this.options.customValidationRules;this.disabledButtons=[];this.buttons={};this.render()},getSelectedElement:function(){return this.selectedElement||this.toEditor().getSelection().getSelectedElement()},getContentElement:function(a){return a?this.element.find(a,1)||null:this.contentElement},getValidationRules:function(a){return this.rules[a]},addValidationRules:function(a,b){this.rules[a]=b},walk:function(a){var b=this.options.forms,
c=this.formElements,d,f,e;for(f in b)if(e=b[f],(d=c[f])&&e&&!0===a.call(d,e))return!1;return!0},setupContent:function(a){a.$element&&(a=a.getProperties(this.formFields));this.walk(function(c){var d=c.disable,c=c.name||c;b(this,a[c.toLowerCase()]||a[c]);d&&(!0===d||d.call(this))&&e(this)});return this},commitContent:function(b){var d=this,f=h.dialog.validate,e=function(b){var c=!0,d;if("object"===a.type(b))for(var e in b){if(d=f[e])if(c=c&&d.call(f,b[e]),"function"===typeof c&&(c=c.call(this)),!0!==
c)break}else b.slice?(d=f[b[0]])&&(c=d.apply(f,b.slice(1))):b.call&&(c=b.call(this));"function"===typeof c&&(c=c.call(this));return c};return this.walk(function(a){var f=a.validate||null,a=a.name||a,g,h,j=!0;if(k(this)){f&&(j=e.call(this,f));if(!0===j&&(h=d.getValidationRules(a)))j=e.call(this,h);g="string"===typeof j||!1===j;b[a]=c(this)||null}d.disabledClose=g;d.handleFieldValidated(this,j);this.data("value",null);return g})},checkContent:function(){return this.walk(function(){var a=this.data("value");
return k(this)&&null!==a&&a!==c(this)})},initContent:function(){this.walk(function(){this.data("value",c(this))});return this},resetContent:function(){var a=this;this.walk(function(c){c.disable&&!0!==c.disable&&g(this);b(this,this.data("initial"));this.data("value",null);a.handleFieldValidated(this)});return this},handleFieldValidated:function(a,b){var c="string"===typeof b;a[c?"addClass":"removeClass"]("kse-tip-input-error");c&&a.focus();this.handleTooltip(b)},handleTooltip:function(b,c){var d="string"===
typeof b,f=d&&l.test(b),e=this.tipElement;if(e){var c=(c=c&&"error"!==c&&c)&&a.isNumeric(c)?m[c]||null:c,g=e.retrieve("kse-tooltip-type",c),h="kse-"+g;c?(g!==c?e.swapClass(h,"kse-"+c):e.addClass("kse-"+c),e.store("kse-tooltip-type",c)):g&&e.removeClass(h).eliminate("kse-tooltip-type");d?e.style("width",b.length*(f?6:12)).show().html(b):e.hide()}return this},getButtons:function(){var a=this.options.buttons,b=[];"string"===typeof a?a=[a]:null==a&&(a=[]);a.each&&a.each(function(a){var c=this.addButton(a);
this.buttons[a]=c;b.push(c)}.bind(this));return b.length?b:null},addButton:function(b){return a.DOM.createElement("button",{text:this.editor.lang.common[b],events:{click:function(){this.fireEvent(b);this.disabledClose?delete this.disabledClose:this.close()}.bind(this)}})},disableButton:function(a){var b=this.buttons[a];b?(e(b),this.disabledButtons.include(a)):a||this.disabledButtons.each(function(a){e(this.buttons[a])},this)},enableButton:function(a){g(this.buttons[a])},render:function(){var b=this.options,
d=this.editor,f=d.themes.dialog(d,{title:b.title,contents:b.contents,close:d.lang.common.close}),e=f.parts,g=this.element=f.element;g.styles(Object.merge({},b.styles,{zIndex:d.baseZIndex("OVERLAY")+1,display:"none"}));(d=this.getButtons())&&e.buttons.adopt(d);f.close.addEvent("click",this.close.bind(this));this.enforceFixed=!a.support.fixedPosition&&b.fixed;this.container.append(g);this.contentElement=e.contents||null;this.tipElement=e.tips||null;d=b.tabs;f=b.tabIndex;if(a.isArray(d)&&1<d.length)e=
"string"===typeof d[0]&&g.find(d[0]),d="string"===typeof d[1]&&g.find(d[1]),e&&e.each&&e.each(function(a,b){a.addEvent("click",function(){this.toggleTabPage(b)}.bind(this));a.hover("kse-hover")},this),d&&d.each&&d.each(function(a){a.hide()}),this.tabs=[e,d],this.defaultTabIndex=f,this.showTabPage(f);var b=b.forms,h,f={},e=[];if("object"===typeof b)for(h in b)if(d=b[h],e.include(d.name||d),d=g.find(h,1))f[h]=d,d.data("initial",c(d));this.formFields=e;this.formElements=Object.append({},f);this.fireEvent("render");
this.modal();this.hidden=!0},modal:function(){if(this.options.modal){var b=new a.ui.mask(this.container,{"class":"kse-mask",hideOnClick:this.options.hideOnClick,shim:!1,style:{zIndex:this.editor.baseZIndex("OVERLAY")}});this.addEvents({show:b.show.bind(b),hide:b.hide.bind(b),destroy:b.destroy.bind(b)})}},toggle:function(a){return this[(this.hidden=null!=a?a:this.hidden)?"show":"hide"]()},show:function(){if(!this.hidden)return this;var a=this.container,b=a.retrieve("kse-dialog",null);if(b===this&&
!b.hidden)return this;a.store("kse-dialog",this);this.options.autoResize&&(j.addEvent("resize",this.position),this.enforceFixed&&j.addEvent("scroll",this.position));for(var c in{keyup:1,keydown:1,keypress:1})this.element.addEvent(c,o);return this.showActivity()},hide:function(){if(this.hidden)return this;this.options.autoResize&&(j.removeEvent("resize",this.position),this.enforceFixed&&j.removeEvent("scroll",this.position));this.tipElement&&this.tipElement.hide();for(var a in{keyup:1,keydown:1,keypress:1})this.element.removeEvent(a,
o);this.hideActivity();this.container.eliminate("kse-dialog");return this},showActivity:function(){this.fireEvent("beforeShow");this.element.show();this.position();this.fireEvent("show");this.editor.fireEvent("dialogShow");this.initContent();this.toggleTabPage(this.currentFocusIndex||0);this.hidden=!1;if("wysiwyg"===this.editor.mode&&d.ie){var a=this.editor.document[0],b=a.selection.createRange();if(b&&(b.parentElement&&b.parentElement().ownerDocument==a||b.item&&b.item(0).ownerDocument==a))a=i.body.createTextRange(),
a.moveToElementText(this.toElement().first()[0]),a.collapse(!0),a.select()}this.fireEvent("afterShow");return this},hideActivity:function(){this.fireEvent("beforeHide");this.element.hide();this.resetContent();this.resetTabPage();this.fireEvent("hide");this.editor.fireEvent("dialogHide");this.hidden=!0;var a=this.editor;a.focus();"wysiwyg"===a.mode&&d.ie&&(a=a.getSelection())&&a.unlock(!0);this.fireEvent("afterHide");return this},toggleTabPage:function(a){var b=this.currentTabIndex;return!this.tabs||
b===a?this:this.hideTabPage(b).showTabPage(a).fireEvent("toggleTabPage")},showTabPage:function(a){var b=this.tabs[0][a],c=this.tabs[1][a];if(b&&c)b.data("kse-disabled")?this.showTabPage(this.currentTabIndex):(c.show(),b.addClass("kse-active"),this.currentTabIndex=a);return this},hideTabPage:function(a){var b=this.tabs[0][a],c=this.tabs[1][a],d=this;if(b&&c)c.hide(),b.removeClass("kse-active"),this.currentTabIndex=a,this.walk(function(){d.handleFieldValidated(this)});return this},resetTabPage:function(){var a=
this.defaultTabIndex||0;if(this.currentFocusIndex)this.currentFocusIndex=a;return this.toggleTabPage(a)},disableTab:function(a){(a=this.tabs[0][a])&&a.data("kse-disabled",1).hide();return this},isCurrentTabPage:function(a){var b=this.tabs[0][a];return b&&b.isVisible()&&this.currentTabIndex===a},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");return this},close:function(){this.fireEvent("beforeClose");!this.prohibitClose&&(this.checkContent()||confirm(this.editor.lang.common.confirmCancel))&&
this.hide().fireEvent("close");return this},position:function(){this.resize();this.element.position({enforceFixed:this.options.fixed});return this},resize:function(a,b){var c=this.options;this.element.styles({width:a||c.width,height:b||c.height});return this}});var p={27:1,13:1},o=function(a){a.code in p&&a.stop()},q=/^([a]|[^a])+$/,w=/^\d*$/,v=/^\d*(?:\.\d+)?$/,r=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,s=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,x=/^(\s*[\w-]+\s*:\s*[^:;]+(?:;|$))*$/,
t=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,
A=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,
C=/^((?:http|https|ftp|news):\/\/)?(.*)$/,E=function(a){var b=a.match(C),a=b[1]||"http://";return(b=b[2].trim())?0===b.indexOf("/")?b:a+b:""},z=h.constants;z.VALIDATE_OR=1;z.VALIDATE_AND=2;z.TIP_TYPE_ERROR=0;z.TIP_TYPE_SUCCESS=1;z.TIP_TYPE_WARNING=2;m[z.TIP_TYPE_ERROR]="error";m[z.TIP_TYPE_SUCCESS]="success";m[z.TIP_TYPE_WARNING]="warning";h.dialog.validate={rules:{},addRules:function(a,b){return this.rules[a]=b},getRules:function(a){return this.rules[a]},functions:function(){var a=arguments;return function(){var b=
this&&this.value?this.value():a[0],c=void 0,d=z.VALIDATE_AND,f=[],e;for(e=0;e<a.length;e++)if("function"==typeof a[e])f.push(a[e]);else break;e<a.length&&"string"===typeof a[e]&&(c=a[e],e++);e<a.length&&"number"===typeof a[e]&&(d=a[e]);var g=d==z.VALIDATE_AND?!0:!1;for(e=0;e<f.length;e++)g=d==z.VALIDATE_AND?g&&f[e](b):g||f[e](b);return!g?c:!0}},regex:function(a,b){return function(c){c=this&&this.value?this.value():c;return!a.test(c)?b:!0}},required:function(a){return this.regex(q,a)},integer:function(a){return this.regex(w,
a)},number:function(a){return this.regex(v,a)},url:function(a){return this.functions(function(a){return t.test(E(a))},a)},email:function(a){return this.regex(A,a)},cssLength:function(a){return this.functions(function(a){return s.test(a.trim())},a)},htmlLength:function(a){return this.functions(function(a){return r.test(a.trim())},a)},inlineStyle:function(a){return this.functions(function(a){return x.test(a.trim())},a)},equals:function(a,b){return this.functions(function(b){return b==a},b)},notEqual:function(a,
b){return this.functions(function(b){return b!=a},b)}}});
(function(a){function c(a){for(var b,c;(a=a.parent())&&!a.is("body");)if(a.getProperty("data-nostyle"))b=a;else if(!c){var d=a.getProperty("contentEditable");"false"==d?b=a:"true"==d&&(c=1)}return b}function b(b){var d=b.document;if(b.collapsed)d=q(this,d),b.insertNode(d),b.moveToPosition(d,y.POSITION_BEFORE_END);else{var f=this.element,e=this.styleDefinition,g,h=e.includeReadonly;void 0==h&&(h=d.retrieve("kse-includeReadonly"));var j=B.dtd[f]||(g=!0,B.dtd.span);b.enlarge(y.ENLARGE_ELEMENT);b.trim();
var i=b.createBookmark(),m=i.startNode,l=i.endNode,k=m,p,o=c(m),C=c(l);o&&(k=o.getNextSourceNode(!0));C&&(l=C);for(k.compareDocumentPosition(l)==y.POSITION_FOLLOWING&&(k=0);k;){o=!1;if(k.equals(l))k=null,o=!0;else{var r=k.$element?k.name():null,C=r&&"false"==k.getProperty("contentEditable"),z=r&&k.getProperty("data-nostyle");if(r&&k.data("kse-bookmark")){k=k.getNextSourceNode(!0);continue}if(!r||j[r]&&!z&&(!C||h)&&(k.compareDocumentPosition(l)|y.POSITION_PRECEDING|y.POSITION_IDENTICAL|y.POSITION_IS_CONTAINED)==
y.POSITION_PRECEDING+y.POSITION_IDENTICAL+y.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(k))){var F=k.parent();if(F&&((F.dtd()||B.dtd.span)[f]||g)&&(!e.parentRule||e.parentRule(F))){if(!p&&(!r||!B.dtd.$removeEmpty[r]||(k.compareDocumentPosition(l)|y.POSITION_PRECEDING|y.POSITION_IDENTICAL|y.POSITION_IS_CONTAINED)==y.POSITION_PRECEDING+y.POSITION_IDENTICAL+y.POSITION_IS_CONTAINED))p=new a.DOM.range(d),p.setStartBefore(k);if(k.$text||C||k.$element&&!k.length()){for(var r=k,v;(o=!r.next(u))&&(v=
r.parent(),j[v.name()])&&(v.compareDocumentPosition(m)|y.POSITION_FOLLOWING|y.POSITION_IDENTICAL|y.POSITION_IS_CONTAINED)==y.POSITION_FOLLOWING+y.POSITION_IDENTICAL+y.POSITION_IS_CONTAINED&&(!e.childRule||e.childRule(v));)r=v;p.setEndAfter(r)}}else o=!0}else o=!0;k=k.getNextSourceNode(z||C)}if(o&&p&&!p.collapsed){for(var o=q(this,d),C=o.hasAttributes(),z=p.getCommonAncestor(),r={},F={},E={},s={},t,D,w;o&&z;){if(z.name()==f){for(t in e.attributes)if(!s[t]&&(w=z.getProperty(t)))o.getProperty(t)==w?
F[t]=1:s[t]=1;for(D in e.styles)if(!E[D]&&(w=z.style(D)))o.style(D)==w?r[D]=1:E[D]=1}z=z.parent()}for(t in F)o.removeProperty(t);for(D in r)o.removeStyle(D);C&&!o.hasAttributes()&&(o=null);o?(p.extractContents().appendTo(o),n(this,o),p.insertNode(o),o.mergeSiblings(),e.replication&&o.html(e.replication),a.env.ie||o[0].normalize()):(o=a.DOM.createElement("span"),p.extractContents().appendTo(o),p.insertNode(o),n(this,o),o.dispose(!0));p=null}}b.moveToBookmark(i);b.shrink(y.SHRINK_TEXT)}}function e(b){b.enlarge(y.ENLARGE_ELEMENT);
var c=b.createBookmark(),d=c.startNode;if(b.collapsed){for(var e=new a.DOM.elementPath(d.parent()),f,g=0,h;g<e.elements.length&&(h=e.elements[g])&&!(h==e.block||h==e.blockLimit);g++)if(this.checkElementRemovable(h)){var j;b.collapsed&&(b.checkBoundaryOfElement(h,y.END)||(j=b.checkBoundaryOfElement(h,y.START)))?(f=h,f.match=j?"start":"end"):(h.mergeSiblings(),k(this,h))}if(f){h=d;for(g=0;;g++){j=e.elements[g];if(j.equals(f))break;else if(j.match)continue;else j=j.clone();j.append(h);h=j}h["start"==
f.match?"injectBefore":"injectAfter"](f)}}else{var i=c.endNode,m=this,e=function(){for(var b=new a.DOM.elementPath(d.parent()),c=new a.DOM.elementPath(i.parent()),f=null,e=null,g=0;g<b.elements.length;g++){var h=b.elements[g];if(h==b.block||h==b.blockLimit)break;m.checkElementRemovable(h)&&(f=h)}for(g=0;g<c.elements.length;g++){h=c.elements[g];if(h==c.block||h==c.blockLimit)break;m.checkElementRemovable(h)&&(e=h)}e&&i.breakParent(e);f&&d.breakParent(f)};e();for(f=d.next();!f.equals(i);)g=f.getNextSourceNode(),
f.$element&&this.checkElementRemovable(f)&&(f.is(this.element)?k(this,f):p(f,r(this)[f.name()]),g.$element&&g.contains(d)&&(e(),g=d.next())),f=g}b.moveToBookmark(c)}function g(a){(a=a.getCommonAncestor(!0,!0).getAscendant(this.element,!0))&&w(a,this)}function h(a){if(a=a.getCommonAncestor(!0,!0).getAscendant(this.element,!0)){var b=this.styleDefinition,c=b.attributes;B.style.getStyleText(b);if(c)for(var d in c)a.removeProperty(d,c[d]);if(b.styles)for(var f in b.styles)b.styles.hasOwnProperty(f)&&
a.removeStyle(f)}}function d(a){var b=a.createBookmark(!0),c=a.createIterator();c.enforceRealBlocks=!0;if(this.enterMode)c.enlargeBr=this.enterMode!=y.ENTER_BR;for(var d,f=a.document;d=c.getNextParagraph();){var e=q(this,f,d);i(d,e)}a.moveToBookmark(b)}function f(a){var b=a.createBookmark(1),c=a.createIterator();c.enforceRealBlocks=!0;c.enlargeBr=this.enterMode!=y.ENTER_BR;for(var d;d=c.getNextParagraph();)if(this.checkElementRemovable(d))if(d.is("pre")){var f=this.enterMode==y.ENTER_BR?null:a.document.createElement(this.enterMode==
y.ENTER_P?"p":"div");f&&d.copyAttributes(f);i(d,f)}else k(this,d,1);a.moveToBookmark(b)}function i(b,c){var d=!c;d&&(c=b.getDocument().createElement("div"),b.copyAttributes(c));var f=c&&c.is("pre"),e=b.is("pre"),g=!f&&e;if(f&&!e){e=c;(g=b.getBogus())&&g.dispose();g=b.html();g=m(g,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"");g=g.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1");g=g.replace(/([ \t\n\r]+|&nbsp;)/g," ");g=g.replace(/<br\b[^>]*>/gi,"\n");if(a.env.ie){var h=b.getDocument().createElement("div").append(e);
e[0].outerHTML="<pre>"+g+"</pre>";e.copyAttributes(h.first());e=h.first().dispose()}else e.html(g);c=e}else g?c=l(d?[b.html()]:j(b),c):b.moveChildren(c);c.replaces(b);if(f){var d=c,i;if((i=d.prev(D))&&i.is&&i.is("pre"))f=m(i.html(),/\n$/,"")+"\n\n"+m(d.html(),/^\n/,""),a.env.ie?d[0].outerHTML="<pre>"+f+"</pre>":d.html(f),i.dispose()}else d&&o(c)}function j(a){a.name();var b=[];m(a.outerHTML(),/(\S\s*)\n(?:\s|(<span[^>]+data-kse-bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,c){b.push(c)});return b}function m(a,b,c){var d="",f="",a=a.replace(/(^<span[^>]+data-kse-bookmark.*?\/span>)|(<span[^>]+data-kse-bookmark.*?\/span>$)/gi,function(a,b,c){b&&(d=b);c&&(f=c);return""});return d+a.replace(b,c)+f}function l(b,c){for(var d=new a.DOM.fragment(c.getDocument()),f=0,e=b.length;f<e;f++){var g=b[f],g=g.replace(/(\r\n|\r)/g,"\n"),g=m(g,/^[ \t]*\n/,""),g=m(g,/\n$/,""),g=m(g,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp":b?" "+"&nbsp".repeat(a.length-1):
"&nbsp".repeat(a.length-1)+" "}),g=g.replace(/\n/g,"<br>"),g=g.replace(/[ \t]{2,}/g,function(a){return"&nbsp".repeat(a.length-1)+" "});d?c.clone().html(g).appendTo(d):c.html(g)}return d||c}function k(a,b){var c=a.styleDefinition,d=Object.merge({},c.attributes,r(a)[b.name()]),f=c.styles,e=H.isEmpty(d)&&H.isEmpty(f),g;for(g in d)("class"==g||a.styleDefinition.fullMatch)&&b.getProperty(g)!=s(g,d[g])||(e=b.hasAttribute(g),b.removeProperty(g));for(var h in f)a.styleDefinition.fullMatch&&b.style(h)!=s(h,
f[h],!0)||(e=e||!!b.style(h),b.removeStyle(h));e&&(c.alwaysRemoveElement?o(b,!0):!B.dtd.$block[b.name()]||a.enterMode==y.ENTER_BR&&!b.hasAttributes()?o(b):b.rename(a.enterMode==y.ENTER_P?"p":"div"))}function n(a,b){for(var c=a.styleDefinition,d=r(a),f=b.find(a.element),e=f.length;0<=--e;)k(a,f[e]);if(c.removed&&!d[c.removed])d=Object.clone(d),d[c.removed]=c.removed;for(var g in d)if(g!=a.element){f=b.find(g);for(e=f.length-1;0<=e;e--)p(f[e],d[g])}}function p(a,b){var c=b&&b.attributes;if(c)for(var d=
0,f=c.length;d<f;d++){var e=c[d][0],g;if(g=a.getProperty(e)){var h=c[d][1];(null===h||h.test&&h.test(g)||"string"==typeof h&&g==h)&&a.removeProperty(e)}}o(a)}function o(a,b){if(!a.hasAttributes()||b)if(B.dtd.$block[a.name()]){var c=a.prev(D),d=a.next(D);c&&(c.$text||!c.isBlockBoundary({br:1}))&&a.prepend("br");d&&(d.$text||!d.isBlockBoundary({br:1}))&&a.append("br");a.dispose(!0)}else c=a.first(),d=a.last(),a.dispose(!0),c&&(c.$element&&c.mergeSiblings(),d&&!c.equals(d)&&d.$element&&d.mergeSiblings())}
function q(b,c,d){var f;f=b.element;"*"==f&&(f="span");f=a.DOM.createElement(f,null,c);d&&d.copyAttributes(f);f=w(f,b);c.retrieve("doc_processing_style")&&f.hasAttribute("id")?f.removeProperty("id"):c.store("doc_processing_style",1);return f}function w(a,b){var c=b.styleDefinition,d=c.attributes,c=B.style.getStyleText(c);if(d)for(var f in d)a.setProperty(f,d[f]);c&&a.setProperty("style",c);return a}function v(a,b){for(var c in a)a[c]=a[c].replace(F,function(a,c){return b[c]})}function r(b){if(b.overrides)return b.overrides;
var c=b.overrides={},d=b.styleDefinition.overrides;if(d){a.isArray(d)||(d=[d]);for(var f=0;f<d.length;f++){var e=d[f],g,h;"string"==typeof e?g=e.toLowerCase():(g=e.element?e.element.toLowerCase():b.element,h=e.attributes);e=c[g]||(c[g]={});if(h){var e=e.attributes=e.attributes||[],j;for(j in h)e.push([j.toLowerCase(),h[j]])}}}return c}function s(b,c,d){var f=a.DOM.createElement("span");f[d?"style":"setProperty"](b,c);return f[d?"style":"getProperty"](b)}function x(b,c){var d;!1!==c?(d=a.DOM.createElement("span"),
d.setProperty("style",b),d=d.getProperty("style")||""):d=b;return d.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").replace(/\"/g,"").toLowerCase()}function t(a){var b={};a.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,d){b[c]=d});return b}function A(a,b,c){for(var d=a.getSelection(),f=d.createBookmarks(1),e=d.getRanges(),b=b?this.removeFromRange:this.applyToRange,g,h=e.createIterator();g=h.getNextRange();)(!c||!g.collapsed)&&b.call(this,
g);1==f.length&&f[0].collapsed?(d.selectRanges(e),a.get(f[0].startNode).dispose()):d.selectBookmarks(f);a.eliminate("doc_processing_style")}var C={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},E={a:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},z=/\s*(?:;\s*|$)/,u=a.DOM.walker.bookmark(0,1),B=a.Editor,H=B.utils,y=B.constants;B.style=new Class({initialize:function(a,b){b&&(a=H.clone(a),v(a.attributes,b),v(a.styles,b));var c=this.element=(a.element||
"*").toLowerCase();this.styleDefinition=a;this.syncType(a.type||(C[c]?y.STYLE_BLOCK:E[c]?y.STYLE_OBJECT:y.STYLE_INLINE));"object"===typeof c&&this.syncType(y.STYLE_OBJECT)},syncType:function(a){if(a){this.type=a;if(y.STYLE_BLOCK===a)this.$block=!0;if(y.STYLE_OBJECT===a)this.$object=!0;if(y.STYLE_INLINE===a)this.$inline=!0}},apply:function(a,b){A.call(this,a,!1,b)},remove:function(a,b){A.call(this,a,!0,b)},applyToRange:function(a){return(this.$inline?b:this.$block?d:this.$object?g:null).call(this,
a)},removeFromRange:function(a){return(this.$inline?e:this.$block?f:this.$object?h:null).call(this,a)},applyToObject:function(a){w(a,this)},checkActive:function(a){switch(this.type){case y.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,!0);case y.STYLE_OBJECT:case y.STYLE_INLINE:for(var b=a.elements,c=0,d,f=b.length;c<f;c++)if(d=b[c],!this.$inline||!(d==a.block||d==a.blockLimit))if((!this.$object||d.name()in E)&&this.checkElementRemovable(d,!0))return!0}return!1},checkApplicable:function(a){switch(this.type){case y.STYLE_OBJECT:return a.lastElement.getAscendant(this.element,
!0)}return!0},checkElementMatch:function(a,b){var c=this.styleDefinition;if(!a||!c.ignoreReadonly&&a.isReadOnly())return!1;var d=a.name();if("string"===typeof this.element?d===this.element:d in this.element){if(!b&&!a.hasAttributes())return!0;if(d=c._AC)c=d;else{var d={},f=0,e=c.attributes;if(e)for(var g in e)f++,d[g]=e[g];if(g=B.style.getStyleText(c))d.style||f++,d.style=g;d._length=f;c=c._AC=d}if(c._length){for(var h in c)if("_length"!=h){f=a.getProperty(h)||"";if("style"==h)a:{d=c[h];f=x(f,!1);
"string"==typeof d&&(d=t(d));"string"==typeof f&&(f=t(f));g=void 0;for(g in d)if(!(g in f&&(f[g]==d[g]||"inherit"==d[g]||"inherit"==f[g]))){d=!1;break a}d=!0}else d=c[h]==f;if(d){if(!b)return!0}else if(b)return!1}if(b)return!0}else return!0}return!1},checkElementRemovable:function(a,b){if(this.checkElementMatch(a,b))return!0;var c=r(this)[a.name()];if(c){if(!(attributes=c.attributes))return!0;for(var c=0,d=attributes.length;c<d;c++){attribute=attributes[c][0];var f=a.getProperty(attribute);if(f){var e=
attributes[c][1];if(null===e||"string"==typeof e&&f==e||e.test(f))return!0}}}return!1},buildPreview:function(){var a=this.styleDefinition,b=[],c=a.element;"bdo"==c&&(c="span");var b=["<",c],d=a.attributes;if(d)for(var f in d)b.push(" ",f,'="',d[f],'"');(d=B.style.getStyleText(a))&&b.push(' style="',d,'"');b.push(">",a.name,"</",c,">");return b.join("")}});B.style.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",d="";c.length&&(c=c.replace(z,
";"));for(var f in b){var e=b[f],g=(f+":"+e).replace(z,";");"inherit"==e?d+=g:c+=g}c.length&&(c=x(c));return a._ST=c+d};var D=a.DOM.walker.whitespaces(!0),F=/#\((.+?)\)/g;B.styleCommand=new Class({initialize:function(a){this.style=a;this.config=a.styleDefinition||{}},execute:function(a){a.focus();(a=a.document)&&(this.state==y.TRISTATE_OFF?this.style.apply(a):this.state==y.TRISTATE_ON&&this.style.remove(a));return!!a}});B.implement({attachStyleStateChange:function(a,b){var c=this.storage.styleStateChangeCallbacks;
if(!c)c=this.storage.styleStateChangeCallbacks=[],this.addEvent("selectionChange",function(a){for(var b=0,d=c.length;b<d;b++){var f=c[b],e=f.style.checkActive(a.path)?y.TRISTATE_ON:y.TRISTATE_OFF;if(f.state!==e)f.fn.call(this,e),f.state=e}});c.push({style:a,fn:b})}})})(Klass);Klass.Editor.plugins=new Class({initialize:function(){this.basePath=Klass.Editor.getUrl("plugins/")},getPath:function(a){return this.basePath+a+"/"},getLang:function(a,c){return(this.$constructor.lang[a]||{})[c]||{}}});
Klass.Editor.plugins.lang={};Klass.Editor.plugins.addLang=function(a,c,b){a=this.lang[a]||(this.lang[a]={});c=a[c]||(a[c]={});Object.append(c,b)};
(function(a,c){function b(){var a,b=this.commands,c=this.mode;if(c)for(var d in b)a=b[d],a.disable&&a[a.startDisabled?"disable":this.readOnly&&!a.readOnly?"disable":a.modes[c]?"enable":"disable"]()}var e=a.document,g=c.Editor,h=g.constants,d=g.markup;g.implement({options:{baseCls:"kse-editor",prefixCls:"kse-"},initialize:function(a,d){"string"===typeof a&&(a="#"+a);if(a&&(a=c(a))){this.setOptions(d);this.loadConfig();a=a[0];this.element=new c.DOM.element(a);this.startupMode=this.options.mode||h.ELEMENT_MODE_REPLACE;
this.name=a.id||a.name||"editor"+c.uidOf(a);this.uid=c.uidOf(a);if(g.has(this))return g.get(this.name);this.tabIndex=this.config.tabIndex||a.getAttribute("tabindex")||0;this.readOnly=this.config.readOnly||a.getAttribute("disabled");this.baseCls=this.options.baseCls;this.prefixCls=this.options.prefixCls;this.plugins={};this.commands={};this.dialogs={};this.storage={styles:[]};this.ui=new g.ui(this);this.ui.addHandler(g.ui.RICHCOMBO,g.ui.richCombo.handler);this.ui.addHandler(g.ui.PANELBUTTON,g.ui.panelButton.handler);
this.focusManager=new g.manager.Focus(this);this.addEvents({mode:b.bind(this),readOnly:b.bind(this)});this.render();g.add(this)}},loadConfig:function(){var a=this.config=g.config||{};Object.merge(this.config,this.options);g.lang.load(a.language,a.defaultLanguage,function(b,d){if(!d.dir)d.dir="ltr";if(c.env.firefox&&3>c.env.version&&"rtl"===d.dir)d.dir="ltr";"ui"==a.contentsLangDirection&&(a.contentsLangDirection=d.dir);this.langCode=b;this.lang=Object.clone(d)}.bind(this));this.markup=g.markup||{}},
loadPlugins:function(){var a=this.config,b=a.plugins,a=a.extraPlugins,c=new g.plugins,d;a&&(d=RegExp("(?:^|,)(?:"+a.replace(/\s*,\s*/g,"|")+")(?=,|$)","g"),b=b.replace(d,""),b+=","+a);b.split(",").each(function(a){var b=c[a];if(b)this.plugins[a]=b,b.path=c.getPath(a),c[a](this)},this);this.fireEvent("afterInitPlugins");this.fireEvent("editingBlockReady");this.ui.createToolbar(this,this.tbar);this.fireEvent("uiReady")},createElement:function(a,b){var c=e.createElement("div");c.className=this.prefixCls+
a;this[a]=e.node(b.appendChild(c))},render:function(){this.fireEvent("berforeReader");var a=this.element,b=c.DOM.create(d.mainContainer.substitute({baseCls:this.baseCls,uid:this.uid})),h=this.config,m=a.getSize(),l=m.x,m=m.y,k=parseInt(a.style("width"),10),n=parseInt(a.style("height"),10),l=h.width||l||(isNaN(k)?"auto":k),m=h.height||m||(isNaN(n)?0:n),b=b.style("width",l)[0],h=b.firstChild;this.createElement("tbar",h);this.createElement("bwrap",h);this.createElement("bbar",h);this.container=a[0].parentNode.insertBefore(b,
a[0]);this.container=e.node(this.container);m&&this.bwrap.style("height",m);a[0].style.display="none";this.themes=g.themes();this.fireEvent("render");this.fireEvent("beforeInitPlugins");this.loadPlugins()},addCSSRules:function(){this.storage.styles.append(arguments)},addDialog:function(a,b){return this.dialogs[a]=b},getDialog:function(a){return this.dialogs[a]},useDialog:function(){},addCommand:function(a,b){return this.commands[a]=b.execute?new g.command(this,b):b},getCommand:function(a){return this.commands[a]},
hasCommand:function(a){return!!this.commands[a]},execCommand:function(a,b){var c=this.getCommand(a);if(c&&c.state!==h.TRISTATE_DISABLED){if(!0!==this.fireEvent("beforeCommandExec",c)){var d=typeof c;"function"===d&&c.call(this,a);"object"===d&&c.execute&&c.execute(this);if(!c.async&&!0!==this.fireEvent("afterCommandExec",c))return!1}return this}c||this.document[0].execCommand(a,!1,b||!1)},getContent:function(){var a=this.element;return a&&this.startupMode===h.ELEMENT_MODE_REPLACE?a[a.is("textarea")?
"value":"html"]():""},setContent:function(a){var b=this.element;if(b&&this.startupMode===h.ELEMENT_MODE_REPLACE)b[b.is("textarea")?"value":"html"](a);return this},syncData:function(a){this.updateData(a);this.fireEvent("syncData",a)},setData:function(a){this.fireEvent("setData",a);this.syncData(a)},getData:function(){this.fireEvent("beforeGetData");var a=this.storage;"string"!==typeof a.data&&this.updateData();this.fireEvent("getData",a);return a.data},updateData:function(a){this.storage.data="string"===
typeof a?a:this.getContent()},setReadOnly:function(a){a=void 0===a||a;if(this.readOnly!==a)this.readOnly=a,this.fireEvent("readOnly")},destroy:function(a){a&&this.updateElement();this.fireEvent("destroy");g.destroy(this);g.fireEvent("instanceDestroyed")},blur:function(){this.fireEvent("blur")},getSnapshot:function(){var a={};this.fireEvent("getSnapshot",a);a=a.snapshot;"string"!==typeof a&&(a=this.getContent());return a},loadSnapshot:function(a){this.fireEvent("loadSnapshot",a)},insertHTML:function(a){this.fireEvent("insertHTML",
a)},insertText:function(a){this.fireEvent("insertText",a)},insertElement:function(a){this.fireEvent("insertElement",a)},checkRecord:function(){return this.maybeRecord&&this.storage.previousValue!==this.getSnapshot()},resetRecord:function(){this.maybeRecord&&(this.storage.previousValue=this.getSnapshot())},livePreview:function(a){var b=this.document;this.config.useLivePreview&&(b[a?"pauseEvent":"restartEvent"]("selectionchange"),b.body()[a?"setProperty":"removeProperty"]("livepreview",a))},updateElement:function(){var a=
this.getData();this.config.escapeHTML&&(a=utils.htmlEncode(a));this.setContent(a)}})})(window,Klass);
Klass.Editor.ui.toolbar=new Class({initialize:function(a,c){this.container=document.node(c);this.editor=a;this.ui=a.ui;this.elements=[];this.render()},render:function(){var a=this.editor.config.toolbar;a[a.mode].each(function(a){Klass.isArray(a)&&(a.each(function(a){a&&this.addItem(a)}.bind(this)),this.createGroup());"/"===a&&this.createToolbar()}.bind(this))},addButton:function(a,c){a&&"object"===$type(c)&&this.items.include(a,c);return this},addRichCombo:function(a,c){$extend(c,{combo:!0});this.addButton(a,
c);return this},addCommand:function(){},addItem:function(a){if("-"===a)return this.addSeparator();this.elements.include((this.ui.items[a]?this.ui.create(a):new Klass.Editor.ui.button(a,this.editor)).toElement())},addSeparator:function(){this.elements.push(Klass.DOM.createElement("span",{"class":"kse-separator"}));return this},remove:function(){},createToolbar:function(){var a=this.container;if(!a[0].childNodes.length)this.container=Klass.DOM.createElement("div",{"class":"kse-toolbox",events:{mousedown:function(){return!1}}}).appendTo(a);
this.tbElement=Klass.DOM.createElement("div",{"class":"kse-toolbar"}).appendTo(this.container)},addPlugins:function(){for(var a=this.config.plugins.split(","),c=0,b=a.length;c<b;c++){var e=a[c];if(this[e])this[e](this.editor,this)}this.addPlugins1()},addPlugins1:function(){this.getToolbar().each(function(a){"array"===$type(a)&&(a.each(function(a){a&&this.addItem(a)}.bind(this)),this.createGroup());"/"===a&&this.createToolbar()}.bind(this))},createGroup:function(){this.tbElement||this.createToolbar();
Klass.DOM.createElement("span",{"class":"kse-group"}).adopt(this.elements).unselectable().appendTo(this.tbElement);this.elements.empty()}});Klass.Editor.ui.implement("createToolbar",function(a,c){return new Klass.Editor.ui.toolbar(a,c)});
Klass.Editor.config.toolbar={mode:"default",location:"top",enableCollapse:!0,startupExpanded:!0,"default":["bold,italic,underline,strike,-,subscript,superscript,-".split(","),["justifyleft","justifycenter","justifyright","justifyblock","-"],"outdent,indent,-,bulletedlist,numberedlist,-".split(","),"selectAll,removeFormat,-,undo,redo,-,print,maximize,-,source".split(","),"/",["font","fontsize","format","-"],"cut,copy,paste,pastetext,pastefromword,-".split(","),"textcolor,bgcolor,-,link,unlink,-,image,imageBrowser,widget,-,preview".split(",")]};
Klass.Editor.manager={};
Klass.Editor.manager.Focus=new Class({initialize:function(a){if(a.focusManager)return a.focusManager;this.owner=a;this.hasFocus=!1},focus:function(){this.timer&&clearTimeout(this.timer);if(!this.hasFocus){Klass.Editor.currentInstance&&Klass.Editor.currentInstance.focusManager.forceBlur();this.hasFocus=!0;var a=this.owner;a.container.child(0).addClass("kse-focus");a.fireEvent("focus")}},blur:function(){var a=this;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(function(){delete a.timer;a.forceBlur()},
100)},forceBlur:function(){if(this.hasFocus){this.hasFocus=!1;var a=this.owner;a.container.child(0).removeClass("kse-focus");a.fireEvent("blur")}}});Klass.run(function(a){var c=a.Editor;c.manager.zIndex={MAXIMIZE:900,SELECT:1200,COMBO:1300,OVERLAY:9999};c.baseZIndex=function(a){a="string"===typeof a?c.manager.zIndex[a.toUpperCase()]:a;return(c.config.baseFloatZIndex||1E4)+("number"===typeof a?a:0)};c.implement("baseZIndex",c.baseZIndex)});
(function(a,c){var b=a.Editor,e=b.constants;b.command=new Class({Implements:Class.Events,initialize:function(a,b){this.uiItems=[];this.state=e.TRISTATE_OFF;this.modes=b.modes||{wysiwyg:1};this.editorFocus=1;this.execute=function(c){if(this.state===e.TRISTATE_DISABLED)return!1;this.editorFocus&&a.focus();return!1!==b.execute.call(this,a,c)};if("object"===typeof b)for(var d in b)this[d]===c&&(this[d]=b[d])},enable:function(){this.state==e.TRISTATE_DISABLED&&this.set(!this.preserveState||typeof this.previousState===
c?e.TRISTATE_OFF:this.previousState)},disable:function(){this.set(e.TRISTATE_DISABLED)},set:function(a){if(this.state==a)return!1;this.previousState=this.state;this.state=a;this.fireEvent("state");return!0},toggle:function(){this.state==e.TRISTATE_OFF?this.set(e.TRISTATE_ON):this.state==e.TRISTATE_ON&&this.set(e.TRISTATE_OFF)}})})(Klass);
(function(a){a.Editor.themes=function(){var c="kse-browser-"+a.env.browser;return{build:function(){},dialog:function(b,e){var g=b.markup.dialog;if("object"===typeof e)e.browserCSSClass=c,g=g.substitute(e);var g=a.DOM.create(g),h=g.child(0),d=g.child(1),f=g.child(2);h.unselectable();d.unselectable();return{element:g,title:h,close:d,parts:{tabs:f.child(0),tips:f.child([1,0]),contents:f.child(2),buttons:f.child(3)}}}}}})(Klass);
(function(a){a.plugins.implement("basicstyles",function(c){var b=function(b,g){var h=new a.style(g),d=c.addCommand(b,new a.styleCommand(h));c.attachStyleStateChange(h,function(a){!c.readOnly&&d.set(a)})};"bold,italic,underline,strike,subscript,superscript".split(",").each(function(a){b(a,c.config.basicstyles[a])})});a.config.basicstyles={bold:{element:"strong",overrides:"b",shortcut:"b"},italic:{element:"em",overrides:"i",shortcut:"i"},underline:{element:"u",shortcut:"u"},strike:{element:"strike",
shortcut:"d"},subscript:{element:"sub",removed:"sup",shortcut:"alt+="},superscript:{element:"sup",removed:"sub",shortcut:"alt+shift++"}}})(Klass.Editor);
(function(a,c){function b(b,d,e){var g=this.document;if(!g.get("kse_pastebin")){if("text"===d&&b&&b.event.clipboardData){var h=b.event.clipboardData.getData("text/plain");if(h){b.preventDefault();e(h);return}}var j=this.getSelection(),b=new c.DOM.range(g),m=new c.DOM.element("text"===d?"textarea":c.env.webkit?"body":"div",{id:"kse_pastebin",styles:{position:"absolute",top:j.getStartElement().getOffsets().y+"px",width:"1px",height:"1px",overflow:"hidden"}},g);c.env.webkit&&m.append(g.createText("\u00a0"));
g.body().append(m);m.style("ltr"==this.config.contentsDirection?"left":"right","-1000px");var i=j.createBookmarks();this.pauseEvent("selectionChange");"text"!==d?(b.setStartAt(m,f.POSITION_AFTER_START),b.setEndAt(m,f.POSITION_BEFORE_END),b.select(!0)):m[0].focus();var l=this;a.setTimeout(function(){var o;g.body().focus();l.restartEvent("selectionChange");m.dispose();j.selectBookmarks(i);var a;o=c.env.webkit&&(a=m.first())&&a.is&&a.hasClass("Apple-style-span")?a:m,m=o;e(m["text"==d?"value":"html"]())},
0)}}function e(a){if(c.env.ie){var b,d=a.getSelection();if(d.getType()==f.SELECTION_ELEMENT&&(b=d.getSelectedElement())){var e=d.getRanges()[0],g=a.document.createText("").injectBefore(b);e.setStartBefore(g);e.setEndAfter(b);d.selectRanges([e]);setTimeout(function(){b.parent()&&(g.dispose(),d.selectElement(b))},0)}}}function g(a,b){var d;if(j&&a in{Cut:1,Paste:1})return f.TRISTATE_DISABLED;if("Paste"===a){c.env.ie&&(i=1);try{d=b.document[0].queryCommandEnabled(a)||c.env.webkit}catch(e){}i=0}else{var g=
(d=b.getSelection())&&d.getRanges();d=d&&!(1===g.length&&g[0].collapsed)}return d?f.TRISTATE_OFF:f.TRISTATE_DISABLED}function h(){"wysiwyg"===this.mode&&(this.getCommand("cut").set(g("Cut",this)),this.getCommand("copy").set(g("Copy",this)),this.fireEvent("pasteState",g("Paste",this)))}var d=c.Editor,f=d.$,i,j,m=function(a,b){var d=a.document,e=d.body(),f=!1,g=function(){f=!0};e.addEvent(b,g);(7<c.env.version?d[0]:d[0].selection.createRange()).execCommand(b);e.removeEvent(b,g);return f},l=new Class({initialize:function(a){this.type=
a;this.startDisabled=!0;this.canUndo="cut"===this.type},execute:function(a){"cut"===this.type&&e(a);var b;var d=this.type;if(c.env.ie)b=m(a,d);else try{b=a.document[0].execCommand(d,!1,null)}catch(f){b=!1}b||alert(a.lang.clipboard[this.type+"Error"]);return b}}),k={canUndo:!1,execute:c.env.ie?function(a){a.focus();if(a.document.body().fireEvent("beforepaste")&&!m(a,"paste"))return a.fireEvent("pasteDialog"),!1}:function(a){try{if(a.document.body().fireEvent("beforepaste")&&!a.document[0].execCommand("Paste",
!1,null))throw 0;}catch(b){return setTimeout(function(){a.fireEvent("pasteDialog")},0),!1}}},n={v:function(){var a=c.env;(a.opera||a.firefox)&&this.document.body().fireEvent("paste")},x:function(){var a=this;this.fireEvent("saveSnapshot");setTimeout(function(){a.fireEvent("saveSnapshot")},0)}};d.plugins.implement("clipboard",function(a){a.addEvents({paste:function(b){this.fireEvent("pasteFilter",b);b.skip||(b.html&&this.insertHTML(b.html),b.text&&this.insertText(b.text),setTimeout(function(){a.fireEvent("afterPaste")},
0))},pasteDialog:function(){setTimeout(function(){a.openDialog("paste")},0)},pasteState:function(a){this.getCommand("paste").set(a)},selectionChange:function(a){j=a.selection.getRanges()[0].checkReadOnly();h.call(this)},contentDOMReady:function(){var d=this.document.body();Object.append(this.specialKeys,n);d.addEvent(!c.env.ie?"paste":"beforepaste",function(c){if(!i){var d={mode:"html"};a.fireEvent("beforePaste",d);b.call(a,c,d.mode,function(b){if(b=b.replace(/<span[^>]+data-kse-bookmark[^<]*?<\/span>/ig,
"").trim()){var c={};c[d.mode]=b;a.fireEvent("paste",c)}})}});d.addEvents({contextmenu:function(){i=1;setTimeout(function(){i=0},10)},beforecut:function(){!i&&e(a)},mouseup:function(){h.delay(0,a)},keyup:h.bind(a)})}});["cut","copy","paste"].forEach(function(b){var c=Object.append("paste"===b?k:new l(b),a.config.clipboard[b]);a.addCommand(b,c)})});d.config.clipboard={cut:{shortcut:"x",specialKey:!0},copy:{shortcut:"c",specialKey:!0},paste:{shortcut:"v",specialKey:!0}}})(window,Klass);
Klass.Editor.dialog.add("paste",function(a){function c(a){var a=new Klass.DOM.document(a.document),c=a[0],d=a.get("kse_actscrpt");d&&d.destroy();b.ie?c.body.contentEditable="true":c.designMode="on";b.ie&&8>b.version&&a.getWindow().addEvent("blur",function(){c.selection.empty()})}var b=Klass.env,e=a.lang.clipboard,g=Klass.Editor.utils,h=g.isCustomDomain(),d='document.open();document.domain="'+document.domain+'";document.close();',d=b.air?"javascript:void(0)":h?"javascript:void((function(){"+d+"})())":
"",h='<p class="kse-dialog-text">{securityMsg}</p><p class="kse-dialog-text">{pasteMsg}</p><p id="kse-dialog-pasteframe"></p>'.substitute({securityMsg:e.securityMsg,pasteMsg:e.pasteMsg});return{title:e.title,width:380,contents:h,onRender:function(){},onBeforeShow:function(){var f="window.parent.Klass.Editor.utils.callFunction("+g.addFunction(c)+", this);",h=Klass.DOM.createElement("iframe",{"class":"kse-pasteframe","aria-label":e.pasteArea,allowtransparency:"true",frameborder:0,src:d}),j='<html dir="{direction}"><head><style>{style}</style></head><body><script type="text/javascript" id="kse_actscrpt">{script}<\/script></body></html>'.substitute({direction:a.config.contentsDirection,
script:f});h.addEvent("load",function(){this.removeEvents("load");h.getFrameDocument().write(j)});f=document.get("kse-dialog-pasteframe");f.html("").append(h);if(b.ie){var m=Klass.DOM.create('<span tabindex="-1" style="position:absolute;" role="presentation"></span>');m.addEvent("focus",function(){h[0].contentWindow.focus()}).appendTo(f);this.focus=function(){m.focus();this.fireEvent("focus")}}this.getInputElement=function(){return h}},onShow:function(){var a=this.getInputElement()[0].contentWindow;
setTimeout(function(){a.focus()},500)},onOk:function(){var b=this.getInputElement().getFrameDocument().body(),c=b.getBogus(),d;c&&c.destroy();d=b.html();setTimeout(function(){a.fireEvent("paste",{html:d})},0)}}});
Klass.Editor.plugins.implement("color",function(a){function c(a){return"false"==a.getProperty("contentEditable")||a.getProperty("data-kse-nostyle")}function b(){for(var a=f.standardColors.split(","),b=[],c=[],e=0,g=a.length;e<g;e++)if(c.push(m.replace(/{item}/,d.item).replace(/{color}/g,a[e])),e&&0===(e+1)%10)b.push(j.replace(/{cells}/,c.join(""))),c.length=0;return d.table.replace(/{rows}/,b.join(""))}function e(){for(var a=f.themeColors,b=d.table,c=[],e=[],g=[],h=0,i=a.length;h<i;h++)for(var v=
0,r=a[h].length;v<r;v++)if(0===v)c.push(m.replace(/{item}/,d.item).replace(/{color}/g,a[h][0]));else if(g.push(d.item.replace(/{color}/g,a[h][v])),v===r-1)e.push(d.li.replace(/{items}/,g.join(""))),g.length=0;a={};c=j.replace(/{cells}/,c.join(""));a.themeColorsTable=d.ul.replace(/{lists}/,e.join(""));a.themesTable=b.replace(/{rows}/,c);return a}function g(a,b){a&&("null"===""+b&&(b=null),b=b&&b.contains?b.contains("#")?b:"#"+b:null,a[b?"style":"removeStyle"]("background-color",b))}var h=a.lang.color,
d=a.markup.palette,f=a.config.color,i=function(j,m,i){var p={};a.ui.addColorButton(j,{name:j,label:i,title:i,markup:a.markup.color.button,iconCls:"button-"+j,className:"color",build:function(){var a=Object.append({standardColorTable:b(),standardColors:h.standard,themeColors:h.theme,autoInherit:h.auto,moreColors:h.more,enableMore:f.enableMore?"":"none"},e());return d.wrap.substitute(a)},addHandler:function(b,c){a.config.useLivePreview&&(b.addEvents({click:function(){this.stopEvent("mouseleave")},mouseenter:this.preview.bind(this,
c),mouseleave:this.restore.bind(this,c)}),this.panel.toElement().addEvents({mouseenter:function(){this.style("opacity",0.5)},mouseleave:function(){this.style("opacity",1)}}))},execute:function(b,d){var e,g=f[m+"style"];p.inherit||(p.inherit=new Klass.Editor.style(g,{color:"inherit"}));p.inherit.remove(a.document,d);if(b&&"string"===typeof b&&"?"!==b)g.childRule=function(a){return"back"===m?c(a):"a"!==a.name()||c(a)},e="#"===b.charAt(0)?"":"#",b=e+b.replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3"),p[b]||(p[b]=
new Klass.Editor.style(g,{color:b})),p[b].apply(a.document,d)},preview:function(b){this.value!=b&&(a.livePreview(!0),this.execute(b,!0))},restore:function(b){var c=a.document;this.value!=b&&(p[this.value]?p[this.value].apply(c,!0):p.inherit&&p.inherit.remove(c,!0),a.livePreview())},onRender:function(){this.colorHolderElement=this.getElement(".kse-colorbar")},onExpand:function(){var b=a.getSelection(),c=b&&b.getStartElement(),b=c&&c.getComputedStyle("back"===m?"background-color":"color")||"transparent",
d={transparent:1},b=-1!==b.indexOf("rgb")?b.rgbToHex():b;c&&this.unmark();!b||d[b]?this.setValue(""):(b=b.toUpperCase(),c=b.replace(/^#/,"").replace(/(.)\1+(.)\2+(.)\3+/,"$1$2$3"),this.setValue(b),this.listItems[c]&&this.mark(c))},onCollapse:function(){a.livePreview();this.panel.toElement().style("opacity",1)},onClick:function(b){b=b.toUpperCase();a.config.useLivePreview&&this.restore(b);if("?"===b){var c=this,d={show:function(){this.colorPicker&&this.colorPicker.setColor(c.value)},close:function(){this.removeEvents(d)},
complete:arguments.callee.bind(c)};a.openDialog("color",function(){this.addEvents(d)})}else a.focus(),a.fireEvent("saveSnapshot"),this.execute(b),g(this.colorHolderElement,b),a.fireEvent("saveSnapshot")}})},j=d.row,m=d.cell;i("textcolor","fore",h.textColor);i("bgcolor","back",h.bgColor)});
Klass.Editor.config.color={enableMore:!0,standardColors:"C00000,F00,FFC000,FF0,92D050,00B050,00B0F0,0070C0,002060,7030A0",themeColors:["FFF,F2F2F2,D8D8D8,BFBFBF,A5A5A5,7F7F7F".split(","),"000,767676,595959,3F3F3F,262626,0C0C0C".split(","),"EEECE1,DDD9C3,C4BD97,938953,494429,1D1B10".split(","),"4F81BD,DBE5F1,B8CCE4,95B3D7,366092,244061".split(","),"C0504D,F2DCDB,E5B9B7,D99694,953734,632423".split(","),"9BBB59,EBF1DD,D7E3BC,C3D69B,76923C,4F6128".split(","),"8064A2,E5E0EC,CCC1D9,B2A2C7,5F497A,3F3151".split(","),
"C149BA,E6B6E3,DA92D6,C75CC1,742C70,4D1D4A".split(","),"4BACC6,DBEEF3,B7DDE8,92CDDC,31859B,205867".split(","),"F79646,FDEADA,FBD5B5,FAC08F,E36C09,974806".split(",")],backstyle:{element:"span",styles:{"background-color":"#(color)"}},forestyle:{element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}]}};
Klass.Editor.dialog.add("color",function(a){return{width:465,title:a.lang.color.selectColor,onRender:function(){this.colorPicker=(new Klass.ui.Colorpicker(null,{container:this.getContentElement()[0]})).show()},onOk:function(){this.fireEvent("complete",this.colorPicker.sets.hex)}}});
Klass.run(function(a){function c(a,c){var g={},h=[],d={nbsp:"\u00a0",shy:"\u00ad",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'},a=a.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,function(a,b){var f=c?"&"+b+";":d[b];g[f]=c?d[b]:"&"+b+";";h.push(f);return""});if(!c&&a){var a=a.split(","),f=document.createElement("div"),i;f.innerHTML="&"+a.join(";&")+";";i=f.innerHTML;f=null;for(f=0;f<i.length;f++){var j=i.charAt(f);g[j]="&"+a[f]+";";h.push(j)}}g.regex=h.join(c?"|":"");return g}a=a.Editor;a.plugins.implement("entities",
function(a){function e(a){return h[a]}function g(a){return"force"==i.processNumerical||!j[a]?"&#"+a.charCodeAt(0)+";":j[a]}var h=c("nbsp,gt,lt,amp,shy",!0),d=RegExp(h.regex,"g"),f=[],i=a.config.entities;!1!==i.basic&&f.push("nbsp,gt,lt,amp");i.entities&&(f.length&&f.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),
i.latin&&f.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),i.greek&&f.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),
i.additional&&f.push(i.additional));var j=c(f.join(",")),m=j.regex?"["+j.regex+"]":"a^";delete j.regex;i.entities&&i.processNumerical&&(m="[^ -~]|"+m);m=RegExp(m,"g");a.addEvent("afterInitPlugins",function(){var a=this.dataProcessor;(a=a&&a.htmlFilter)&&a.addRules({text:function(a){return a.replace(d,e).replace(m,g)}})})});a.config.entities={basic:!0,entities:!0,latin:!0,greek:!0,additional:"#39"}});
(function(a){function c(a){for(var b=a.children.length,c=a.children[b-1];c&&c.$text&&!c.value.trim();)c=a.children[--b];return c}function b(b,d){var e=b.children,f=c(b);f&&((d||!a.env.ie)&&f.$element&&"br"===f.name&&e.pop(),f.$text&&o.test(f.value)&&e.pop())}function e(d,e){return function(f){b(f,!d);var g;g=!d;!g&&(!e||"function"===typeof e&&!1===e(f))||g&&a.env.ie&&(7<document.documentMode||f.name in p.tr||f.name in p.$listItem)?g=!1:(g=c(f),g=!g||g&&(g.$element&&"br"===g.name||"form"===f.name&&
"input"===g.name));g&&f.add(d||a.env.ie?new n.htmlParser.text("\u00a0"):new n.htmlParser.element("br",{}))}}function g(a){a=a.attributes;"false"!=a.contenteditable&&(a["data-kse-editable"]=a.contenteditable?"true":1);a.contenteditable="false"}function h(a){a=a.attributes;switch(a["data-kse-editable"]){case "true":a.contenteditable="true";break;case "1":delete a.contenteditable}}function d(a){return a.replace(A,function(a,b,c){return"<"+b+c.replace(C,function(a,b){return-1==c.indexOf("data-kse-saved-"+
b)?" data-kse-saved-"+a+" "+a:a})+">"})}function f(a){return a.replace(E,function(a){return"<kse:encoded>"+encodeURIComponent(a)+"</kse:encoded>"})}function i(a){return a.replace(z,function(a,b){return decodeURIComponent(b)})}function j(a){return a.replace(/<\!--(?!{kse_protected})[\s\S]+?--\>/g,function(a){return"<\!--"+q+"{C}"+encodeURIComponent(a).replace(/--/g,"%2D%2D")+"--\>"})}function m(a){return a.replace(/<\!--\{kse_protected\}\{C\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)})}
function l(a,b){var c=b.storage.dataStore;return a.replace(/<\!--\{kse_protected\}([\s\S]+?)--\>/g,function(a,b){return decodeURIComponent(b)}).replace(/\{kse_protected_(\d+)\}/g,function(a,b){return c&&c[b]||""})}function k(a,b){for(var c=[],d=b.config.protectedSource,e=b.storage.dataStore||(b.storage.dataStore={id:1}),f=/<\!--\{kse_temp(comment)?\}(\d*?)--\>/g,d=[/<script[\s\S]*?<\/script>/gi,/<noscript[\s\S]*?<\/noscript>/gi].concat(d),a=a.replace(/<\!--[\s\S]*?--\>/g,function(a){return"<\!--{kse_tempcomment}"+
(c.push(a)-1)+"--\>"}),g=0,h=d.length;g<h;g++)a=a.replace(d[g],function(a){a=a.replace(f,function(a,b,d){return c[d]});return/kse_temp(comment)?/.test(a)?a:"<\!--{kse_temp}"+(c.push(a)-1)+"--\>"});a=a.replace(f,function(a,b,d){return"<\!--"+q+(b?"{C}":"")+encodeURIComponent(c[d]).replace(/--/g,"%2D%2D")+"--\>"});return a.replace(/(['"]).*?\1/g,function(a){return a.replace(/<\!--\{kse_protected\}([\s\S]+?)--\>/g,function(a,b){e[e.id]=decodeURIComponent(b);return"{kse_protected_"+e.id++ +"}"})})}var n=
a.Editor,p=n.dtd,o=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,q="{kse_protected}",w="caption,colgroup,col,thead,tfoot,tbody".split(","),v=Object.merge({},p.$block,p.$listItem,p.$tableContent),r;for(r in v)"br"in p[r]||delete v[r];delete v.pre;var s={elements:{},attributeNames:[[/^on/,"data-kse-pa-on"]]},x={elements:{}};for(r in v)x.elements[r]=e();var t={elementNames:[[/^kse:(?!widget)/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-kse-(saved|pa)-/,""],[/^data-kse-.*/,""],["hidefocus",""],["uid",""],["uniqueNumber",
""]],elements:{$:function(a){var b=a.attributes;if(b){if(b["data-kse-temp"])return!1;for(var c=["name","href","src"],d,e=0,f=c.length;e<f;e++)d="data-kse-saved-"+c[e],d in b&&delete b[c[e]]}return a},table:function(a){a.children.sort(function(a,b){return a.$element&&b.type===a.type?w.indexOf(a.name)>w.indexOf(b.name)?1:-1:0})},embed:function(a){var b=a.parent;if(b&&"object"===b.name){var c=b.attributes.width,b=b.attributes.height;c&&(a.attributes.width=c);b&&(a.attributes.height=b)}},param:function(a){a.children=
[];a.isEmpty=!0;return a},a:function(a){if(!a.children.length&&!a.attributes.name&&!a.attributes["data-kse-saved-name"])return!1},span:function(a){"Apple-style-span"==a.attributes["class"]&&delete a.name},pre:function(c){a.env.ie&&b(c)},html:function(a){delete a.attributes.contenteditable;delete a.attributes["class"]},body:function(a){delete a.attributes.spellcheck;delete a.attributes.contenteditable},style:function(a){var b=a.children[0];b&&b.value&&(b.value=b.value.trim());if(!a.attributes.type)a.attributes.type=
"text/css"},title:function(a){var b=a.children[0];b&&(b.value=a.attributes["data-kse-title"]||"")}},attributes:{"class":function(a){return a.replace(/(?:^|\s+)kse-[^\s]*/g,"").ltrim()||!1}}};if(a.env.ie)t.attributes.style=function(a){return a.replace(/(^|;)([^\:]+)/g,function(a){return a.toLowerCase()})};for(r in{input:1,textarea:1})s.elements[r]=g,t.elements[r]=h;var A=/<(a|area|img|input)\b([^>]*)>/gi,C=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,E=/(?:<style(?=[ >])[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,
z=/<kse:encoded>([^<]*)<\/kse:encoded>/gi,u=/(<\/?)((?:object|embed|param|html|body|head|title)[^>]*>)/gi,B=/(<\/?)kse:((?:html|body|head|title)[^>]*>)/gi,H=/<kse:(param|embed)([^>]*?)\/?>(?!\s*<\/kse:\1)/gi;n.htmlDataProcessor=new Class({initialize:function(a){this.editor=a;this.writer=new n.htmlWriter;this.dataFilter=new n.htmlParser.filter;this.htmlFilter=new n.htmlParser.filter},toHTML:function(b,c){var b=k(b,this.editor),b=d(b),b=f(b),b=b.replace(u,"$1kse:$2"),b=b.replace(H,"<kse:$1$2></kse:$1>"),
b=b.replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2"),e=new a.DOM.element("div");e.html("a"+b);var b=e.html().substr(1),b=b.replace(B,"$1$2"),b=i(b),b=m(b),e=n.htmlParser.fragment.fromHtml(b,"body",c),g=new n.htmlParser.basicWriter;e.writeHtml(g,this.dataFilter);b=g.getHtml(!0);return b=j(b)},toDataFormat:function(a,b){var c=this.writer,d=n.htmlParser.fragment.fromHtml(a,null,b);c.reset();d.writeHtml(c,this.htmlFilter);c=c.getHtml(!0);c=m(c);return c=l(c,this.editor)}});n.plugins.implement("htmldataprocessor",
function(a){var b=a.dataProcessor=new n.htmlDataProcessor(a);b.writer.forceSimpleAmpersand=a.config.forceSimpleAmpersand;b.dataFilter.addRules(s);b.dataFilter.addRules(x);b.htmlFilter.addRules(t);var c={elements:{}},d;for(d in v)c.elements[d]=e(!0,a.config.fillEmptyBlocks);b.htmlFilter.addRules(c)})})(Klass);Klass.Editor.config.fillEmptyBlocks=!0;
Klass.run(function(a){var c=a.Editor;c.plugins.implement("filebrowser",function(a){var e=a.config.filebrowser,g=a.lang.filebrowser.image;a.addCommand("imageBrowser",new c.dialogCommand("imageBrowser",{label:g,startDisabled:!e.imageBrowseUrl}));c.dialog.add("imageBrowser",{title:g,buttons:null,fixed:!1,width:e.width||600,contents:'<iframe src="{browserUrl}" width="{width}" height="{height}" frameBorder="0"></iframe>'.substitute({browserUrl:e.imageBrowseUrl,height:e.height||400,width:"100%"})})});c.config.filebrowser=
{}});
Klass.Editor.plugins.implement("font",function(a){var c=a.config,b=function(b,c,h){for(var d=a.lang[b],f=h.split(";"),h="font"===b?"family":"size",i={},j=0,m=f.length;j<m;j++){var l=f[j];if(l){var l=l.split("/"),k={},n=f[j]=l[0];k[h]=l[1]||n;i[n]=new Klass.Editor.style(c.style,k);i[n].styleDefinition.name=n}else f.splice(j--,1)}a.ui.addRichCombo(b,{name:b,label:d.label,title:d.panelTitle,className:b,panel:{multiSelect:!1,attributes:{"aria-label":d.panelTitle}},init:function(){for(var a=0;a<f.length;a++){var b=f[a];
this.add(b,i[b].buildPreview())}},addHandler:function(b,c){a.config.useLivePreview&&(b.addEvents({mouseenter:this.preview.bind(this,c),mouseleave:this.restore.bind(this,c)}),this.panel.toElement().addEvents({mouseenter:function(){this.style("opacity",0.5)},mouseleave:function(){this.style("opacity",1)}}))},preview:function(b){!this.collapsed&&this.getValue()!==b&&(a.livePreview(!0),i[b].apply(a.document,!0))},restore:function(b){var c=this.getValue();!this.collapsed&&c!==b&&(i[c||b][c?"apply":"remove"](a.document,
!0),a.livePreview())},onCollapse:function(){a.livePreview();this.panel.toElement().style("opacity",1)},onClick:function(b){a.config.useLivePreview&&this.restore(b);a.focus();a.fireEvent("saveSnapshot");var c=this.getValue()===b;i[b][c?"remove":"apply"](a.document);a.fireEvent("saveSnapshot")},onRender:function(){a.addEvent("selectionChange",function(a){for(var b=this.getValue(),a=a.path.elements,c=0,d;c<a.length;c++){d=a[c];for(var e in i)if(i[e].checkElementRemovable(d,!0)){e!=b&&this.setValue(e);
return}}this.setValue("")}.bind(this))}})};b("font",c.font,c.font.names);b("fontsize",c.fontsize,c.fontsize.sizes)});
Klass.Editor.config.font={defaultLabel:"",names:"Arial/Arial, Helvetica, sans-serif;Comic Sans MS/Comic Sans MS, cursive;Courier New/Courier New, Courier, monospace;Georgia/Georgia, serif;Lucida Sans Unicode/Lucida Sans Unicode, Lucida Grande, sans-serif;Tahoma/Tahoma, Geneva, sans-serif;Times New Roman/Times New Roman, Times, serif;Trebuchet MS/Trebuchet MS, Helvetica, sans-serif;Verdana/Verdana, Geneva, sans-serif",style:{element:"span",styles:{"font-family":"#(family)"},overrides:[{element:"font",
attributes:{face:null}}]}};Klass.Editor.config.fontsize={defaultLabel:"",sizes:"8/8px;9/9px;10/10px;11/11px;12/12px;14/14px;16/16px;18/18px;20/20px;22/22px;24/24px;26/26px;28/28px;36/36px;48/48px;72/72px",style:{element:"span",styles:{"font-size":"#(size)"},overrides:[{element:"font",attributes:{size:null}}]}};
Klass.Editor.plugins.implement("format",function(a){for(var c=a.config.format,b=a.lang.format,e=c.tags.split(";"),g={},h=0,d=e.length;h<d;h++){var f=e[h];g[f]=new Klass.Editor.style(c[f]);g[f].enterMode=a.config.enterMode}a.ui.addRichCombo("format",{name:"format",label:b.label,title:b.panelTitle,className:"format",panel:{multiSelect:!1,attributes:{"aria-label":b.panelTitle}},init:function(){for(var a in g){var c=b["tag_"+a];this.add(a,"<"+a+">"+c+"</"+a+">",c)}},addHandler:function(b,c){a.config.useLivePreview&&
(b.addEvents({click:function(){this.stopEvent("mouseleave")},mouseenter:this.preview.bind(this,c),mouseleave:this.restore.bind(this,c)}),this.panel.toElement().addEvents({mouseenter:function(){this.style("opacity",0.5)},mouseleave:function(){this.style("opacity",1)}}))},preview:function(b){var c=this.getValue();c&&c!==b&&(a.livePreview(!0),g[b].apply(a.document))},restore:function(b){var c=this.getValue();c&&c!=b&&(g[c].apply(a.document),a.livePreview())},onCollapse:function(){a.livePreview();this.panel.toElement().style("opacity",
1)},onClick:function(b){var c=a.config.useLivePreview;c&&this.restore(b);a.focus();a.fireEvent("saveSnapshot");var b=g[b],d=new Klass.DOM.elementPath(a.getSelection().getStartElement());b[!c&&b.checkActive(d)?"remove":"apply"](a.document);setTimeout(function(){a.fireEvent("saveSnapshot")},0)},onRender:function(){a.addEvent("selectionChange",function(a){var c=this.getValue(),a=a.path,d;for(d in g)if(g[d].checkActive(a)){d!==c&&this.setValue(d,b["tag_"+d]);return}this.setValue("")}.bind(this))}})});
Klass.Editor.config.format={tags:"p;h1;h2;h3;h4;h5;h6;pre;address;div",p:{element:"p"},div:{element:"div"},pre:{element:"pre"},address:{element:"address"},h1:{element:"h1"},h2:{element:"h2"},h3:{element:"h3"},h4:{element:"h4"},h5:{element:"h5"},h6:{element:"h6"}};
Klass.Editor.plugins.implement("image",function(a){a.addCommand("image",new Klass.Editor.dialogCommand("image",{label:a.lang.image.label}));a.addEvent("doubleclick",function(a){var b=a.element;if(b.is("img")&&!b.data("kse-realelement")&&!b.isReadOnly())a.dialog="image"})});Klass.Editor.config.image={removeLinkByEmptyURL:!0};
Klass.Editor.dialog.add("image",function(a){function c(){D&&D.value("");F&&F.value("");H&&H.show();M(u,B)}function b(a,b){var c=(""+a).match(w);return c?("%"===c[2]&&(c[1]+="%"),c[1]):b}function e(a){var b=(""+a).match(w);return b&&"%"===b[2]?b[1]/100:a}function g(a,c){var d=a.getProperty(c),e="";d&&(e=b(d,e));return b(a.style(c),e)}function h(a){var b=a.originalElement;if(!b||!B)return 1;var c=b.getProperty("src");setTimeout(function(){var a=d(b,B.parent()),e={alt:"",src:c};a&&Object.append(e,a);
B.setProperties(e)},0);return 0}function d(a,b){var c=b.getSize(),d=D&&D.value(),f=F&&F.value(),d=e(d||a.width),f=e(f||a.height),g=parseInt(b.style("width"),10)||0,h=parseInt(b.style("height"),10)||0;c.x=g?Math.min(c.x,g):c.x;c.y=h?Math.min(c.y,h):c.y;d=1>d?c.x*d:d;f=1>f?c.y*f:f;return 0<d&&0<f?(d/f>=c.x/c.y?d>c.x?(h=c.x,g=f*c.x/d):(h=d,g=f):f>c.y?(g=c.y,h=d*c.y/f):(h=d,g=f),{width:h,height:g}):null}function f(){P&&P.store("kse-upload-sandbox-style",P.getProperty("style")).styles({top:-9999,left:-9999})}
function i(){if(P){var a=P.retrieve("kse-upload-sandbox-style",null);a&&P.eliminate("kse-upload-sandbox-style").setProperty("style",a)}}function j(){for(var a=N.find("li"),b=0,c=a.length;b<c;b++){var d=a[b];d.find("img").each(function(a){a.destroy()});d.erase("id").erase("class").empty()}O.empty().removeClass("kse-spinner").removeClass("kse-progress");M(O,N);G&&G.show();i()}function m(){for(var a=I,b=a.length-1;0<=b;b--)a[b].status=J.FAILED;this.fireEvent("queueChanged");I.empty()}var l=a.lang.image,
k=a.lang.common,n=a.lang.fileupload,p=a.config,o=p.image,q=/\.(\w+)(?:\?.*|$)/,w=/^\s*(\d+)((px)|\%)?\s*$/i,v=/(^\s*(\d+)((px)|\%)?\s*$)|^$/i,r=Klass.Editor.document,s=o.uploadSettings||p.fileUploadSettings||{},x=s.resize&&s.resize.width||0,t=s.resize&&s.resize.height||0,A=o.allowedExtensions||p.fileAllowedExtensions||"*",C=A.replace(/(\s*),(\s*)/g,", ").toUpperCase(),E=o.maxSize||p.fileMaxSize||0,z=E.toUpperCase(),a='<div id="kse-dialog-image" class="kse-dialog-image"><table cellspacing="0"><tr><td class="kse-dialog-tab-bar"><div class="kse-tab-bar"><div class="kse-tab">{localFiles}</div><div class="kse-tab">{webAddress}</div></div></td><td class="kse-dialog-tab-content"><div id="kse-image-upload" class="kse-dialog-tab-content-inner kse-image-upload"><div id="kse-image-upload-container" class="kse-image-upload-container"><div id="kse-image-upload-dropzone" class="kse-image-upload-dropzone"><input id="kse-image-upload-handler" type="button" value="{selectFile}" /><p id="kse-image-last-queue-desc" class="kse-hide">{lastUploadQueueDesc}</p><p id="kse-image-dropupload-desc">{dropUpload}</p><p id="kse-image-limit-queue-desc"></p><dl id="kse-image-rest-image-dimension" class="kse-explain kse-hide"><dt>{dimension}</dt><dd>{limitWidth} x {limitHeight}</dd></dl><dl class="kse-explain"><dt>{format}</dt><dd>{allowedExtensions}</dd></dl><dl class="kse-explain"><dt>{size}</dt><dd>{maxSize}</dd></dl></div></div><div id="kse-image-upload-panel" class="kse-image-upload-panel kse-hide"><ul id="kse-image-upload-list"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul></div><div id="kse-image-upload-progress" class="kse-image-upload-progress kse-hide"></div></div><div class="kse-dialog-tab-content-inner"><table class="kse-image-url-view"><tr><td><label for="kse-image-url" style="width:120px;">{url}</label><input type="text" id="kse-image-url" class="kse-dialog-input" style="width:400px;" /></td></tr><tr><td><label for="kse-image-width" style="width:120px;">{width}</label><input type="text" id="kse-image-width" class="kse-dialog-input" style="width:60px;" /><label for="kse-image-height" style="width: 45px;">{height}</label><input type="text" id="kse-image-height" class="kse-dialog-input" style="width:60px;" /><label for="kse-image-align">{align}</label><select id="kse-image-align"><option value="">{auto}</option><option value="left">{alignLeft}</option><option value="right">{alignRight}</option></select></td></tr><tr><td><div class="kse-image-preview-area"><table><tr><td class="kse-explain"><div id="kse-image-preview-loader" class="kse-spinner"></div><img id="kse-image-preview-container" /><div id="kse-image-preview-description">{description}</div></td></tr></table></div></td></tr></table></div></td></tr></table></div>'.substitute({url:l.url,
upload:k.upload,width:k.width,height:k.height,auto:k.auto,align:k.align,alignLeft:k.alignLeft,alignRight:k.alignRight,localFiles:k.localFiles,webAddress:k.webAddress,dimension:n.imageDimension,format:n.format,size:n.size,dropUpload:n.dragdrop,selectFile:n.selectFile,lastUploadQueueDesc:n.lastQueueDesc,description:l.description,limitWidth:x,limitHeight:t,maxSize:E.toUpperCase(),allowedExtensions:A.replace(/(\s*),(\s*)/g,", ").toUpperCase()}),u,B,H,y,D,F,G,N,O,P,S=function(a){return r.get("kse-image-preview-"+
a)},T=function(a){return r.get("kse-image-upload-"+a)},L=function(){this.originalElement.store("isReady",!0);B&&B.show();M(u,H);if(!this.dontResetSize){var a=this.originalElement;if(a.retrieve("isReady")){var b=a[0].height;D&&D.value(a[0].width||"");F&&F.value(b||"")}}h(this);this.enableButton("ok");this.dontResetSize=!1},K=function(){this.originalElement.store("isReady",!1);this.originalElement.removeProperties("src","width","height");this.disableButton("ok");c()},Q=function(){h(this)},M=function(){for(var a=
arguments,b=a.length,c=0;c<b;c++)a[c]&&a[c].hide()},J=Klass.Uploader,I=[];return{width:750,title:l.title,contents:a,tabs:["#kse-dialog-image .kse-tab","#kse-dialog-image .kse-dialog-tab-content-inner"],forms:{"#kse-image-url":{name:"src",validate:{required:l.emptyUrl,url:l.invalidUrl}},"#kse-image-width":{name:"width",validate:function(){var a=this.value().match(v);return a&&0!==parseInt(a[1],10)?!0:k.invalidWidth}},"#kse-image-height":{name:"height",validate:function(){var a=this.value().match(v);
return a&&0!==parseInt(a[1],10)?!0:k.invalidHeight}},"#kse-image-align":"align"},onRender:function(){var a=this,b=this.toEditor(),e=this.toElement();(D=e.id("kse-image-width"))&&D.addEvent("change",Q.bind(this));(F=e.id("kse-image-height"))&&F.addEvent("change",Q.bind(this));(y=e.id("kse-image-url"))&&y.addEvent("change",function(){var b=this.value().trim();b.length?(u&&u.show(),M(B,H),a.originalElement.setProperty("src",b)):(c(),a.disableButton("ok"))});u=S("loader");B=S("container");H=S("description");
c();G=T("container");O=T("progress");N=T("panel");var g=Klass.DOM,h=new Klass.ui.Sortables("#kse-image-upload-list",{clone:!0,onStart:function(a,b){var a=new g.element(a),b=new g.element(b,{"class":"kse-move-shadow"}),c=a.style("background-color");"transparent"===c&&(c="#FFF");b.styles({color:c,backgroundColor:c});c=a.find("img")[0];a.addClass("kse-move-place");a.store("kse-sortables-contents",c?c:a.html());c?c.hide():a.empty()},onComplete:function(b){var b=new g.element(b),c,d=b.retrieve("kse-sortables-contents",
null);if(d)"string"!==typeof d&&(c=d),b.eliminate("kse-sortables-content"),b.removeProperty("style").removeClass("kse-move-place"),c?c.show():b.html(d),a.storedItems=this.serialize(function(a){return a.getElementsByTagName("img")[0]?a.getAttribute("id"):null}).clean()}}),e=o.uploadURL||p.fileUploadURL,j=N.find("li").length,k;P=(new g.element("div",{"class":"kse-upload-sandbox",styles:{position:"absolute",zIndex:b.baseZIndex("OVERLAY")+10}})).appendTo(r.body());this.storedItems=[];this.storedImages=
{};var v=Klass.Editor.constants,w,L=new Klass.Uploader(Object.append(s,{runtimes:"html5,flash,silverlight,html4",selectElement:"kse-image-upload-handler",dropElement:"kse-image-upload-dropzone",maxFileSize:E,maxQueued:j,container:P,url:e,filters:[{title:"Image files",extensions:A}],onStart:function(){k||(k=[],N.find("li").each(function(a){k.push(a[0])}));h.removeItems(k);w=!0;a.disableButton("ok")},onBeforeFilesAdded:a.handleTooltip.bind(a),onFilesAdded:m,onQueueChanged:function(){var a=this.total,
b=a.files,a=a.queued;if(1<a){for(var c=N.find("li"),d=0;d<a;d++)c[d]&&c[d].addClass("kse-spinner").setProperty("id",b[d].id);M(G,O);N&&N.show();f()}else 1===a&&(M(G,N),O&&O.show(),f());a&&this.start()},onFailed:function(b){var b=b||{},c=b.file,d,e;switch(b.code||0){case J.QUEUE_ERROR:d=n.limitQueueError.replace(/%d/,j);break;case J.FILE_SIZE_ERROR:d=n.fileSizeError.replace(/%d/,z);break;case J.FILE_EXTENSION_ERROR:d=n.fileTypeError.replace(/%d/,C);break;case J.SECURITY_ERROR:d=n.invalidFile;e=1;break;
case J.IMAGE_FORMAT_ERROR:case J.IMAGE_MEMORY_ERROR:case J.IMAGE_DIMENSIONS_ERROR:d=n.invalidFileType;e=1;break;case J.INIT_ERROR:case J.HTTP_ERROR:d=n.serverFailure;break;case J.IO_ERROR:d=n.timeout;break;default:d=n.uncertainError}if(e&&c&&(c=c.id,e=r.get(c))){e.erase("class").addClass("kse-stress").html(d);a.storedItems.erase(c);return}a.handleTooltip(d||b.message);M(O,N);G&&G.show();i();this.refresh()}})),K={progress:function(a){var b=r.get(a.id)||O;b&&b.swapClass("kse-spinner","kse-progress").html(a.percent+
"%")},beforeUpload:function(a){(a=r.get(a.id)||O)&&a.swapClass("kse-spinner","kse-progress").html("0%")},fileUploaded:function(b){var c=b.response&&JSON.decode(b.response);if(c){var b=b.file,e=b.id,f=r.get(e),g=parseInt(c.code,10),c=c.url,j,m;if(f&&(f.erase("class").empty(),c&&(j=r.createElement("img",{src:c,alt:"",events:{load:function(){var a=d(this,f);a&&(this.setAttribute("width",a.width),this.setAttribute("height",a.height));Klass.event.removeEvents(this)},error:function(){f.addClass("kse-stress").html(n.invalidFile);
Klass.event.removeEvents(this)}}}),f.append(j),h.addItems(f.addClass("kse-move")[0]),j=null),g)){switch(g){case v.ERROR_SECURITY:m=n.invalidFile;break;case v.ERROR_FILE_TYPE:m=n.invalidFileType;break;case v.ERROR_FILE_SIZE:m=n.largeFile;break;case v.ERROR_GENERIC:m=n.timeout;break;default:m=n.failure}f.addClass("kse-stress").html(m)}c&&!m&&(a.storedImages[e]={url:c,name:b.name.replace(q,"")},a.storedItems.push(e))}},complete:function(){var b=a.storedItems;w=!1;if(!b.length)return this.fireEvent("failed");
1===b.length?a.fireEvent("ok").close():a.handleTooltip(n.successAndSort,v.TIP_TYPE_SUCCESS).enableButton("ok")}};x&&t&&r.get("kse-image-rest-image-dimension").removeClass("kse-hide");L.features.dragdrop||r.get("kse-image-dropupload-desc").empty();r.get("kse-image-limit-queue-desc").html(l.limitQueueDesc.replace(/%d/,L.features.multiple?j:1));var R=r.get("kse-image-last-queue-desc"),b=R.find("a");b[0].addEvent("click",function(){L.fireEvent("queueChanged");I.empty();return!1});b[1].addEvent("click",
function(){m.call(L);R.hide();return!1});this.addEvents({afterHide:f,afterShow:function(){this.disableButton("ok");y&&y.fireEvent("change");var a=I.length;a&&R.show().find("strong")[0].html(a);i();L.addEvents(K);L.refresh()},beforeHide:function(){w=null;L.stop();L.removeEvents(K);for(var a=L.files,b,c=a.length-1;0<=c;c--)(b=a[c])&&b.status===J.QUEUED&&I.include(b);R.hide()},beforeClose:function(){this.prohibitClose=w&&!confirm(n.confirmCancel)},toggleTabPage:function(){this.enableButton("ok");this.isCurrentTabPage(0)&&
(!1!==w&&this.disableButton("ok"),i());this.isCurrentTabPage(1)&&(delete this.prohibitClose,f(),y&&!y.value()&&y.fireEvent("change"))}})},onShow:function(){var a=this.toEditor(),b=a.getSelection().getSelectedElement(),c=b&&b.getAscendant("a");this.imageElement=this.linkElement=null;this.dontResetSize=!1;this.disableButton("ok");this.originalElement=a.document.createElement("img",{alt:"",events:{load:L.bind(this),error:K.bind(this),abort:K.bind(this)}});if(c&&(this.linkElement=c,c=c.children(),1===
c.length&&(c=c[0],c.is("img"))))this.imageElement=c;if(b&&b.is("img")&&!b.data("kse-realelement"))this.imageElement=b;this.imageElement?(this.cleanImageElement=this.imageElement,this.imageElement=this.cleanImageElement.clone(!0,!0),this.setupContent({src:b.getProperty("src"),align:b.getProperty("align"),width:g(b,"width"),height:g(b,"height")}),this.dontResetSize=!0,this.currentFocusIndex=1):this.imageElement=a.document.createElement("img")},onHide:function(){if(this.originalElement)this.originalElement.removeEvents({load:L.bind(this),
error:K.bind(this),abort:K.bind(this)}).dispose(),this.originalElement=null;c();j();this.storedItems=[];this.storedImages={};delete this.linkElement;delete this.imageElement;delete this.cleanImageElement},onOk:function(){var a={},b=this.toEditor(),c=this.cleanImageElement||this.imageElement,d=this.storedItems,e=this.storedImages,f=d&&d.length,g=0;if(f&&this.isCurrentTabPage(0))for(;g<f;g++){if(a=d[g])c||(c=b.document.createElement("img")),b.insertElement(c.setProperties({src:e[a].url,alt:e[a].name||
""})),c=null}else{if(!this.commitContent(a)||!a.src)return!1;this.cleanImageElement||c.setProperty("alt","");this.linkElement&&b.getSelection().selectElement(this.linkElement);b.insertElement(c.setProperties(a))}}}});
(function(a){function c(a){var c=a.editor,e=(a=a.path)&&a.contains(d);if(!c.readOnly){if(e||!this.useIndentClasses&&"indent"==this.name)return this.set(h.TRISTATE_OFF);a=a.block||a.blockLimit;if(!a)return this.set(h.TRISTATE_DISABLED);if(this.useIndentClasses)return a=a[0].className.match(this.clsRegex),e=0,a&&(a=a[1],e=this.clsMap[a]),"outdent"==this.name&&!e||"indent"==this.name&&e==c.config.indentClasses.length?this.set(h.TRISTATE_DISABLED):this.set(h.TRISTATE_OFF);c=parseInt(a.style(b(a)),10);
isNaN(c)&&(c=0);return 0>=c?this.set(h.TRISTATE_DISABLED):this.set(h.TRISTATE_OFF)}}function b(a,b){return"ltr"==(b||a.getComputedStyle("direction"))?"margin-left":"margin-right"}function e(a){return a.is&&a.is("li")}var g=a.Editor,h=g.constants,d={ol:1,ul:1},f=a.DOM.walker.whitespaces(!0),i=a.DOM.walker.bookmark(!1,!0),j=new Class({initialize:function(a,b){var c=a.config.indentClasses,d=c&&c.length;this.name=b;if(this.useIndentClasses=!!d){this.clsMap={};this.clsRegex=RegExp("(?:^|\\s+)("+c.join("|")+
")(?=$|\\s)");for(var e=0;e<d;e++)this.clsMap[c[e]]=e+1}this.startDisabled="outdent"==b},execute:function(c){function j(b){for(var e=v.startContainer,h=v.endContainer;e&&!e.parent().equals(b);)e=e.parent();for(;h&&!h.parent().equals(b);)h=h.parent();if(e&&h){for(var l=e,e=[],k=!1;!k;)l.equals(h)&&(k=!0),e.push(l),l=l.next();if(!(1>e.length)){k=b.parents(!0);h=0;for(l=k.length;h<l;h++)if(k[h].name&&d[k[h].name()]){b=k[h];break}for(var l="indent"==p.name?1:-1,h=e[0],e=e[e.length-1],k=g.plugins.list.listToArray(b,
o),n=k[e.retrieve("listarray_index")].indent,h=h.retrieve("listarray_index");h<=e.retrieve("listarray_index");h++){k[h].indent+=l;var r=k[h].parent;k[h].parent=new a.DOM.element(r.name(),null,r.getDocument())}for(h=e.retrieve("listarray_index")+1;h<k.length&&k[h].indent>n;h++)k[h].indent+=l;e=g.plugins.list.arrayToList(k,o,null,c.config.enterMode,b.getDirection());if("outdent"==p.name){var t;if((t=b.parent())&&t.is("li"))for(var l=e.listNode.children(),s=[],G,h=l.length-1;0<=h;h--)(G=l[h])&&G.is&&
G.is("li")&&s.push(G)}e&&e.listNode.replaces(b);if(s&&s.length)for(h=0,l=s.length;h<l;h++){for(G=b=s[h];(G=G.next())&&G.is&&G.name()in d;)a.env.ie&&!b.first(function(a){return f(a)&&i(a)})&&b.append(v.document.createText("\u00a0")),b.append(G);b.injectAfter(t)}}}}function k(){var a=v.createIterator(),b=c.config.enterMode;a.enforceRealBlocks=!0;for(a.enlargeBr=b!=h.ENTER_BR;b=a.getNextParagraph();)n(b)}function n(d,e){if(d.retrieve("indent_processed"))return!1;if(p.useIndentClasses){var f=d[0].className.match(p.clsRegex),
g=0;f&&(f=f[1],g=p.clsMap[f]);"outdent"==p.name?g--:g++;if(0>g)return!1;g=Math.min(g,c.config.indentClasses.length);g=Math.max(g,0);d[0].className=d[0].className.replace(p.clsRegex,"").ltrim();0<g&&d.addClass(c.config.indentClasses[g-1])}else{f=b(d,e);g=parseInt(d.style(f),10);isNaN(g)&&(g=0);var h=c.config.indentOffset||40,g=g+("indent"==p.name?1:-1)*h;if(0>g)return!1;g=Math.max(g,0);g=Math.ceil(g/h)*h;d.style(f,g?g+(c.config.indentUnit||"px"):"");""===d.getProperty("style")&&d.removeProperty("style")}a.DOM.element.setMarker(o,
d,"indent_processed",1);return!0}for(var p=this,o={},q=c.getSelection(),w=q.createBookmarks(1),v,r=(q&&q.getRanges(1)).createIterator();v=r.getNextRange();){for(var s=v.getCommonAncestor();s&&(!s.$element||!d[s.name()]);)s=s.parent();if(!s){var x=v.getEnclosedNode();x&&x.$element&&x.name()in d&&(v.setStartAt(x,h.POSITION_AFTER_START),v.setEndAt(x,h.POSITION_BEFORE_END),s=x)}if(s&&v.startContainer.$element&&v.startContainer.name()in d)x=new a.DOM.walker(v),x.evaluator=e,v.startContainer=x.next();if(s&&
v.endContainer.$element&&v.endContainer.name()in d)x=new a.DOM.walker(v),x.evaluator=e,v.endContainer=x.previous();if(s){var x=s.first(e),t=!!x.next(e),A=v.startContainer;(!x.equals(A)&&!x.contains(A)||!("indent"==p.name||p.useIndentClasses||parseInt(s.style(b(s)),10))||!n(s,!t&&x.getDirection()))&&j(s)}else k()}a.DOM.element.clearMarkers(o);c.focus();c.forceNextSelectionCheck();q.selectBookmarks(w)}});g.plugins.implement("indent",function(a){["indent","outdent"].each(function(b){b=a.addCommand(b,
new j(a,b));a.addEvent("selectionChange",c.bind(b))})})})(Klass);
Klass.run(function(a){function c(a,b){var c;if(b)c=a.getComputedStyle("text-align");else{for(;!a.hasAttribute||!a.hasAttribute("align")&&!a.style("text-align");){c=a.parent();if(!c)break;a=c}c=a.style("text-align")||a.getProperty("align")||""}c&&(c=c.replace(/-moz-|-webkit-|start|auto/i,""));!c&&b&&(c="rtl"==a.getComputedStyle("direction")?"right":"left");return c}function b(a){if(!a.editor.readOnly){var b=a.editor.getCommand(this.name),f;f=a.editor;a=a.path;a=a.block||a.blockLimit;f=!a||a.is("body")?
e.TRISTATE_OFF:c(a,f.config.useComputedState)==this.value?e.TRISTATE_ON:e.TRISTATE_OFF;b.state=f;b.fireEvent("state")}}var a=a.Editor,e=a.constants,g=new Class({initialize:function(a,b,c){this.name=b;this.value=c;this.editor=a;if(a=a.config.justifyClasses){switch(c){case "left":this.cls=a[0];break;case "center":this.cls=a[1];break;case "right":this.cls=a[2];break;case "justify":this.cls=a[3]}this.clsRegex=RegExp("(?:^|\\s+)(?:"+a.join("|")+")(?=$|\\s)")}},execute:function(){var a=this.editor,b=a.getSelection(),
f=a.config.enterMode;if(b){for(var g=b.createBookmarks(),j=b.getRanges(!0),m=this.cls,l,k,n=a.config.useComputedState,p=j.length-1;0<=p;p--){l=j[p].createIterator();for(l.enlargeBr=f!=e.ENTER_BR;k=l.getNextParagraph();){k.removeProperty("align");k.removeStyle("text-align");var o=m&&(k[0].className=k[0].className.replace(this.clsRegex,"").ltrim()),q=this.state==e.TRISTATE_OFF&&(!n||c(k,!0)!=this.value);m?q?k.addClass(m):o||k.removeProperty("class"):q&&k.style("text-align",this.value)}}a.focus();a.forceNextSelectionCheck();
b.selectBookmarks(g)}}});a.plugins.implement("justify",function(a){var c=a.lang.justify,e=a.config.justify;["left","center","right","block"].each(function(i){var j="justify"+i,m="block"===i?"justify":i,j=a.addCommand(j,new g(a,j,m));j.label=c[i];j.shortcut=e[m].shortcut||null;a.addEvent("selectionChange",b.bind(j))})});a.config.justify={left:{shortcut:"l"},center:{shortcut:"e"},right:{shortcut:"r"},justify:{shortcut:"j"}}});
(function(a){function c(a){if("wysiwyg"!=a.mode)return!1;return a.getSelection().getStartElement().hasAscendant("pre",!0)?(setTimeout(function(){i(a,a.config.enterMode,null,!0)},0),!0):b(a,a.config.shiftEnterMode,1)}function b(a,b,c){c=a.config.forceEnterMode||c;if("wysiwyg"!=a.mode)return!1;if(!b)b=a.config.enterMode;setTimeout(function(){a.fireEvent("saveSnapshot");b==h.ENTER_BR||a.getSelection().getStartElement().hasAscendant("pre",1)?f(a,b,null,c):i(a,b,null,c)},0);return!0}function e(a){for(var a=
a.getSelection().getRanges(!0),b=a.length-1;0<b;b--)a[b].deleteContents();return a[0]}var g=a.env,h=a.Editor.constants;a.Editor.plugins.enterkey={enterBlock:function(b,c,d,f){if(d=d||e(b)){var i=d.document;if(d.checkStartOfBlock()&&d.checkEndOfBlock()){var o=(new a.DOM.elementPath(d.startContainer)).block;if(o&&(o.is("li")||o.parent().is("li"))){b.execCommand("outdent");return}}var q=c==h.ENTER_DIV?"div":"p",w=d.splitBlock(q);if(w){var b=w.previousBlock,c=w.nextBlock,o=w.wasStartOfBlock,v=w.wasEndOfBlock,
r;if(c)r=c.parent(),r.is("li")&&(c.breakParent(r),c.move(c.next(),1));else if(b&&(r=b.parent())&&r.is("li"))b.breakParent(r),d.moveToElementEditStart(b.next()),b.move(b.prev());if(!o&&!v){if(c.is("li")&&(r=c.first(a.DOM.walker.invisible(!0)))&&r.is&&r.is("ul","ol"))(g.ie?i.createText("\u00a0"):i.createElement("br")).injectBefore(r);c&&d.moveToElementEditStart(c)}else{var s,x;if(b){if(b.is("li")||!j.test(b.name()))s=b.clone()}else c&&(s=c.clone());s?f&&!s.is("li")&&s.rename(q):(s=i.createElement(q),
b&&(x=b.getDirection())&&s.setProperty("dir",x));if(f=w.elementPath){r=0;for(x=f.elements.length;r<x;r++){q=f.elements[r];if(q.equals(f.block)||q.equals(f.blockLimit))break;a.Editor.dtd.$removeEmpty[q.name()]&&(q=q.clone(),s.moveChildren(q).append(q))}}g.ie||s.appendBogus();d.insertNode(s);if(g.ie&&o&&(!v||!b.length()))d.moveToElementEditStart(v?b:s),d.select();d.moveToElementEditStart(o&&!v?c:s)}g.ie||(c?(i=i.createElement("span"),i.html("&nbsp;"),d.insertNode(i),i.scrollIntoView(),d.deleteContents()):
s.scrollIntoView());d.select()}}},enterBr:function(b,c,d,f){if(d=d||e(b)){var p=d.document,o=d.checkEndOfBlock(),q=new a.DOM.elementPath(b.getSelection().getStartElement()),w=q.block,v=w&&q.block.name(),q=!1;if(!f&&"li"==v)i(b,c,d,f);else{if(!f&&o&&j.test(v))(o=w.getDirection())?(p=p.createElement("div",{dir:o}).injectAfter(w),d.setStart(p,0)):(p.createElement("br").injectAfter(w),g.firefox&&p.createText("").injectAfter(w),d.setStartAt(w.next(),g.ie?h.POSITION_BEFORE_START:h.POSITION_AFTER_START));
else{w=(q="pre"==v)&&!g.firefox?p.createText(g.ie?"\r":"\n"):p.createElement("br");d.deleteContents();d.insertNode(w);g.ie||p.createText("\ufeff").injectAfter(w);o&&!g.ie&&w.parent().appendBogus();if(!g.ie)w.next()[0].nodeValue="";g.ie?d.setStartAt(w,h.POSITION_AFTER_END):d.setStartAt(w.next(),h.POSITION_AFTER_START);g.ie||(o=null,o=g.firefox?p.createElement("br"):p.createElement("span").html("&nbsp;"),o.injectBefore(w.next()),o.scrollIntoView(),o.dispose())}d.collapse(!0);d.select(q)}}}};var d=a.Editor.plugins.enterkey,
f=d.enterBr,i=d.enterBlock,j=/^h[1-6]$/;a.Editor.plugins.implement({keyenter:function(a){(a.specialKeys=a.specialKeys||{}).enter=function(d){(d.shift?c:b)(a);return!1}}})})(Klass);
Klass.Editor.plugins.implement("link",function(a){var c=Klass.Editor,b=c.constants,e=c.plugins.link,g=/^((?:https?|ftp|news):\/\/)?(.*)$/,h=/\b((https?|ftp):\/\/\w+|www)\.(([\w-]+)(\.?)(\w+))+\S*$/i,d=function(a){var b=a&&a.match(g);if(!b)return"";a=b[1]||"http://";(b=b[2]&&b[2].trim())&&-1===b.indexOf("/")&&(b+="/");return b?a+b:""},f={execute:function(a){for(var d=a.getSelection(),e=d.createBookmarks(),f=d.getRanges(),g,h=0,i=f.length;h<i;h++)g=f[h].getCommonAncestor(!0),(g=g.getAscendant("a",!0))&&
f[h].selectNodeContents(g);d.selectRanges(f);(new c.style({element:"a",type:b.STYLE_INLINE,alwaysRemoveElement:1})).remove(a.document);d.selectBookmarks(e)},startDisabled:!0};a.addEvent("selectionChange",function(a){if(!this.readOnly){var c=this.getCommand("unlink"),a=a.path.lastElement&&a.path.lastElement.getAscendant("a",!0);c.set(b[a&&"a"===a.name()&&a.getProperty("href")&&a.length()?"TRISTATE_OFF":"TRISTATE_DISABLED"])}});a.addEvent("doubleclick",function(a){var b=e.getSelectedLink(this)||a.element;
if(!b.isReadOnly())if(b.is("a"))a.dialog=b.getProperty("name")&&(!b.getProperty("href")||!b.length())?"anchor":"link",this.getSelection().selectElement(b);else if(e.tryRestoreFakeAnchor(this,b))a.dialog="anchor"});a.addCommand("link",new Klass.Editor.dialogCommand("link",{label:a.lang.link.toolbar,shortcut:a.config.link.shortcut}));a.addCommand("unlink",f);if(!e.autoCaptureLink&&a.config.link.enableAutoFormat){var i={8:1,13:1,32:1};a.addEvent("keystroke",function(c){var j;var e=c.code;if(e in i){var g=
a.getSelection(),k=g.getRanges(),n=k[0],p=n.getBoundaryNodes(),o=n.getCommonAncestor(!0),q=o.getAscendant("a",!0);if(n.collapsed)if(8===e){if(!q&&(g=0===n.endOffset?o.prev():p.startNode)&&g.is)if(g.is("br")&&(g=g.prev()),g&&(g.$text||g.is("a")))q=g.is?g:null,n.setEndAt(g,b.POSITION_BEFORE_END),n.select();q&&n.checkBoundaryOfElement(q,b.END)&&(a.fireEvent("saveSnapshot"),q.normalize(),n.setEndAt(q,b.POSITION_BEFORE_END),n.select(),f.execute(a),a.fireEvent("saveSnapshot"),c.preventDefault())}else if(!o.parent()||
!o.parent().is("a")){if(!o.$text)o=p.startNode;if(o.$text&&(e=n.createBookmark(),c=(c=(q=o.text()||null)&&q.match(h))&&c[0],n.moveToBookmark(e),c&&(e=RegExp("[^\\s\\u4E00-\\u9FA5]*"+c.escapeRegExp()),(j=(q=q.match(e))&&q[0],q=j)&&q===c)))a.fireEvent("saveSnapshot"),c=g.createBookmarks(),n.setStart(o,q.length===o.length()?0:o.length()-q.length),n.setEnd(o,o.length()),g.selectRanges(k),a.document[0].execCommand("CreateLink",!1,d(q)),g.selectBookmarks(c),a.fireEvent("saveSnapshot")}}})}});
Klass.Editor.plugins.link={getSelectedLink:function(a){try{var c=a.getSelection();if(c.getType()==Klass.Editor.$.SELECTION_ELEMENT){var b=c.getSelectedElement();if(b.is("a"))return b}var e=c.getRanges(!0)[0];e.shrink(Klass.Editor.$.SHRINK_TEXT);return e.getCommonAncestor().getAscendant("a",!0)}catch(g){return null}},getSelectedLinkText:function(a){try{var c=a.getSelection(),b=c.getRanges(),e=b[0].getBoundaryNodes(),g,h;if(c.getType()===Klass.Editor.$.SELECTION_TEXT)return h=c.getSelectedText(),1===
b.length&&e.startNode.equals(e.endNode)?h:"*";if(g=this.getSelectedLink(a)){for(var d=g.children(),a=0,f=d.length;a<f;a++)if(d[a].$element&&!d[a].is("br"))return"*";return g.text()}if(c.getSelectedElement())return"*"}catch(i){return null}},autoCaptureLink:Klass.env.ie,fakeAnchor:Klass.env.opera||Klass.env.webkit,synAnchorSelector:Klass.env.ie,emptyAnchorFix:Klass.env.ie&&8>Klass.env.version,tryRestoreFakeAnchor:function(a,c){if(c&&c.isRealElement("anchor")){var b=a.restoreRealElement(c);if(b.data("kse-saved-name"))return b}}};
Klass.Editor.config.link={shortcut:"k",enableAutoFormat:!0};
Klass.Editor.dialog.add("link",function(a){var c,b,e=Klass.Editor,g=a.lang.link,h=e.plugins.link,d='<div id="kse-dialog-link" class="kse-dialog-link"><table cellspacing="0"><tr><td><label class="kse-dialog-label" for="kse-link-info">{displayText}</label></td><td class="kse-dialog-header-content"><input type="text" id="kse-link-info" class="kse-dialog-input" /></td></tr><tr><td class="kse-dialog-tab-bar"><div class="kse-dialog-label">{type}</div><div class="kse-tab-bar"><div class="kse-tab">{toWebAddress}</div><div class="kse-tab">{toEmailAddress}</div></div></td><td class="kse-dialog-tab-content"><div class="kse-dialog-tab-content-inner"><table><tr><td><label class="kse-dialog-label kse-block" for="kse-link-address">{url}</label><input type="text" id="kse-link-address" class="kse-dialog-input" /></td></tr><tr><td class="kse-text-right"><a id="kse-link-test" href="#">{testLink}</a></td></tr></table></div><div class="kse-dialog-tab-content-inner"><table><tr><td><label class="kse-dialog-label kse-block" for="kse-link-email-address">{emailAddress}</label><input type="text" id="kse-link-email-address" class="kse-dialog-input" /></td></tr><tr><td><label class="kse-dialog-label kse-block" for="kse-link-email-subject">{emailSubject}</label><input type="text" id="kse-link-email-subject" class="kse-dialog-input" /></td></tr></table></div></td></tr></table></div>'.substitute({url:g.url,type:g.type,
testLink:g.testLink,displayText:g.displayText,emailAddress:g.emailAddress,emailSubject:g.emailSubject,toWebAddress:g.toWebAddress,toEmailAddress:g.toEmailAddress}),f=/^javascript:/,i=/^mailto:([^?]+)(?:\?(.+))?$/,j=/subject=([^;?:@&=$,\/]*)/,m=/body=([^;?:@&=$,\/]*)/,l=/^#(.*)$/,k=/^((?:http|https|ftp|news):\/\/)?(.*)$/,n=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,p=/^javascript:([^(]+)\(([^)]+)\)$/,o=function(a,d){var e=d&&(d.data("kse-saved-href")||
d.getProperty("href"))||"",g=h.getSelectedLinkText(a)||"",k,o={},C;e.match(f)&&("encode"===w?e=e.replace(n,function(a,b,c){return"mailto:"+String.fromCharCode.apply(String,b.split(","))+(c&&c.replace(/\\'/g,"'"))}):w&&e.replace(p,function(a,d,e){if(d==c){C=1;o.type="email";for(var a={},d=/(^')|('$)/g,e=e.match(/[^,\s]+/g),f=e.length,g,h,j=0;j<f;j++)g=decodeURIComponent,h=e[j].replace(d,"").replace(/\\'/g,"'"),h=g(h),g=b[j].toLowerCase(),a[g]=h;o.email=[a.name,a.domain].join("@")}}));if(!o.type)if(k=
e.match(l))o.type="anchor",o.anchor={},o.anchor.name=o.anchor.id=k[1];else if(k=e.match(i)){var E=e.match(j),e=e.match(m);C=1;o.type="email";o.email=k[1];E&&(o.subject=decodeURIComponent(E[1]));e&&(o.body=decodeURIComponent(e[1]))}else(e=q(e))?(o.type="url",o.url=e):o.type="url";d&&(e=function(a,b){var c=d.getProperty(b);null!==c&&(o[a]=c||"")},e("accessKey","accessKey"),e("tabIndex","tabindex"),e("target","target"),e("title","title"),e("rel","rel"));var e=o.anchors=[],z;if(h.emptyAnchorFix){var u=
a.document.find("a");for(k=0,E=u.length;k<E;k++)if(z=u[k],z.data("kse-saved-name")||z.hasAttribute("name"))e.push({name:z.data("kse-saved-name")||z.getProperty("name"),id:z.getProperty("id")})}else{u=new Klass.DOM.nodes(a.document[0].anchors);for(k=0,E=u.length;k<E;k++)z=u[k],e[k]={name:z.getProperty("name"),id:z.getProperty("id")}}if(h.fakeAnchor){u=a.document.find("img");for(k=0,E=u.length;k<E;k++)(z=h.tryRestoreFakeAnchor(a,u[k]))&&e.push({name:z.getProperty("name"),id:z.getProperty("id")})}o.textView=
g;this.selectedElement=d;this.currentFocusIndex=C;return o},q=function(a){var b=a&&a.match(k);if(!b)return"";a=b[1]||"http://";(b=b[2]&&b[2].trim())&&-1===b.indexOf("/")&&(b+="/");return b?a+b:""},w=a.config.link.emailProtection||"";w&&"encode"!==w&&(c=void 0,b=void 0,w.replace(/^([^(]+)\(([^)]+)\)$/,function(a,d,e){c=d;b=[];e.replace(/[^,\s]+/g,function(a){b.push(a)})}));return{width:500,title:g.title,contents:d,tabs:["#kse-dialog-link .kse-tab","#kse-dialog-link .kse-dialog-tab-content-inner"],
forms:{"#kse-link-info":{name:"textView",disable:function(){return"*"===this.value()}},"#kse-link-email-subject":"subject","#kse-link-address":{name:"url",validate:{required:g.emptyUrl,url:g.invalidUrl}},"#kse-link-email-address":{name:"email",validate:{required:g.emptyEmail,email:g.invalidEmail}}},onRender:function(){var b=this.toElement(),c=b.id("kse-link-info"),d=b.id("kse-link-address"),b=b.id("kse-link-test"),e=function(){!c.data("changed")&&c.value(this.value())},f=640,g=420,h=80;try{var j=
window.screen,f=Math.round(0.8*j.width),g=Math.round(0.7*j.height),h=Math.round(0.1*j.width)}catch(i){}var m="toolbar=yes,location=no,scrollbars=yes,resizable=yes,width="+f+",height="+g+",left="+h;d.addEvents({keydown:e,keyup:e});c.addEvent("keyup",function(){this.data("changed",this.value()?!0:null)});b.addEvent("click",function(){var a=q(d.value());a&&window.open(a,null,m);return!1});a.config.disableLinkTabPage&&this.disableTab(0);a.config.disableEmailTabPage&&this.disableTab(1)},onShow:function(){var a=
null,b=this.toEditor(),c=b.getSelection(),d=this.toElement().id("kse-link-info");(a=h.getSelectedLink(b))&&c.selectElement(a);this.setupContent(o.call(this,b,a));d.data("changed",d.value()?!0:null)},onOk:function(){var a={},b={},c=[],d=this.toEditor(),f=this.selectedElement;if(!this.commitContent(a))return this.disabledClose=!0,!1;a.url&&(b["data-kse-saved-href"]=q(a.url));if(a.anchor){var g=a.anchor.id;b["data-kse-saved-href"]="#"+(a.anchor.name||g||"")}if(a.email){var h;h=a.email;switch(w){case "":case "encode":var j=
encodeURIComponent(a.subject||""),i=encodeURIComponent(a.body||""),g=[];j&&g.push("subject="+j);i&&g.push("body="+i);g=g.length?"?"+g.join("&"):"";"encode"==w?(h=["javascript:void(location.href='mailto:'+",protectEmailAddressAsEncodedString(h)],g&&h.push("+'",g.replace(/'/g,"\\$&"),"'"),h.push(")")):h=["mailto:",h,g];break;default:g=h.split("@",2),email.name=g[0],email.domain=g[1],h=["javascript:",protectEmailLinkAsFunction(email)]}b["data-kse-saved-href"]=h.join("")}g=function(d,e){var f=a[d];f?
b[e]=f:c.push(e)};g("accessKey","accessKey");g("tabIndex","tabindex");g("target","target");g("title","title");g("rel","rel");b.href=b["data-kse-saved-href"];if(f){d=f.data("kse-saved-href");g=f.html();f.setProperties(b);f.removeProperties(c);if(a.textView&&g!==a.textView)f.html(g=a.textView);if(d==g||"email"==a.type&&-1!=g.indexOf("@"))f.html("email"==a.type?a.email:b["data-kse-saved-href"]);delete this.selectedElement}else f=d.getSelection(),h=f.getRanges(!0),g=a.textView,1==h.length&&h[0].collapsed&&
(j=new Klass.DOM.text(g?g:"email"===a.type?a.email:b["data-kse-saved-href"],d.document),g=null,h[0].insertNode(j),h[0].selectNodeContents(j),f.selectRanges(h)),(new e.style({element:"a",attributes:b,replication:g,type:e.$.STYLE_INLINE})).apply(d.document)}}});
(function(a){function c(a){if(a.editor.readOnly)return null;for(var b=a.path,a=b.blockLimit,b=b.elements,c,d=0,e=b.length;d<e&&(c=b[d])&&!c.equals(a);d++)if(j[b[d].name()])return this.set(this.type==b[d].name()?n.TRISTATE_ON:n.TRISTATE_OFF);return this.set(n.TRISTATE_OFF)}function b(a,b,c){function d(c){if((l=i[c?"first":"last"]())&&(!l.is||!l.isBlockBoundary())&&(k=b.root[c?"prev":"next"](m.walker.whitespaces(!0)))&&(!k.is||!k.isBlockBoundary({br:1})))a.document.createElement("br")[c?"injectBefore":
"injectAfter"](l)}for(var e=v.listToArray(b.root,c),f=[],g=0,h=b.contents.length;g<h;g++){var j=b.contents[g];if((j=j.getAscendant("li",!0))&&!j.retrieve("list_item_processed"))f.push(j),m.element.setMarker(c,j,"list_item_processed",!0)}h=null;for(g=0;g<f.length;g++)h=f[g].retrieve("listarray_index"),e[h].indent=-1;for(g=h+1;g<e.length;g++)if(e[g].indent>e[g-1].indent+1){f=e[g-1].indent+1-e[g].indent;for(h=e[g].indent;e[g]&&e[g].indent>=h;)e[g].indent+=f,g++;g--}var i=v.arrayToList(e,c,null,a.config.enterMode,
b.root.getProperty("dir")).listNode,l,k;d(!0);d();i.replaces(b.root)}function e(a,b,c,d){for(var e,f;e=a[d?"last":"first"](x);)(f=e.getDirection(1))!==b.getDirection(1)&&e.setProperty("dir",f),e.dispose(),c?e[d?"injectBefore":"injectAfter"](c):b.append(e,d)}function g(a){var b;(b=function(b){var c=a[b?"prev":"next"](w);c&&c.$element&&c.is(a.name())&&(e(a,c,null,!b),a.dispose(),a=c)})();b(1)}function h(b){return function(c){var d=c.children;a:{for(var e=c.children,f=e.length,g=0;g<f;g++)if(c=e[g],
c.name&&c.name in k.$list){c=g;break a}c=f}var e=(e=d[c])&&e.previous,h;if(e&&(e.name&&"br"==e.name||e.value&&(h=e.value.match(t))))(!h||!h.index)&&e==d[0]?d[0]=b||a.env.ie?new l.htmlParser.text("\u00a0"):new l.htmlParser.element("br",{}):"br"==e.name?d.splice(c-1,1):e.value=e.value.replace(t,"")}}function d(a){return a.$element&&(a.name()in k.$block||a.name()in k.$listItem)&&k[a.name()]["#"]}function f(a,b,c){a.fireEvent("saveSnapshot");c.enlarge(n.ENLARGE_LIST_ITEM_CONTENTS);var d=c.extractContents();
b.trim(!1,!0);var f=b.createBookmark(),h=new m.elementPath(b.startContainer),j=h.lastElement.getAscendant("li",1);(h=h.block.getBogus())&&h.dispose();(h=d.last())&&h.$element&&h.is("br")&&h.dispose();(h=b.startContainer.child(b.startOffset))?d.insertBefore(h):b.startContainer.append(d);d=new m.elementPath(c.startContainer);if(d=c.startContainer.getAscendant("li",1))if(h=i(d))j.contains(d)?(e(h,d.parent(),d),h.dispose()):j.append(h);for(;c.checkStartOfBlock()&&c.checkEndOfBlock();)d=new m.elementPath(c.startContainer),
j=d.block,j.is("li")&&(d=j.parent(),j.equals(d.last(w))&&j.equals(d.first(w))&&(j=d)),c.moveToPosition(j,n.POSITION_BEFORE_START),j.dispose();c=c.clone();j=a.document.body();c.setEndAt(j,n.POSITION_BEFORE_END);c=new m.walker(c);c.evaluator=function(a){return w(a)&&!q(a)};(c=c.next())&&c.$element&&c.name()in k.$list&&g(c);b.moveToBookmark(f);b.select();a.selectionChange(1);a.fireEvent("saveSnapshot")}function i(a){return(a=a.last(w))&&a.$element&&a.name()in j?a:null}var j={ol:1,ul:1},m=a.DOM,l=a.Editor,
k=l.dtd,n=l.constants,p=m.walker.whitespaces(),o=m.walker.bookmark(),q=m.walker.bogus(),w=function(a){return!(p(a)||o(a))},v=l.plugins.list={listToArray:function(a,b,c,d,e){if(!j[a.name()])return[];d||(d=0);c||(c=[]);for(var f=0,g=a.length();f<g;f++){var h=a.child(f);h.$element&&h.name()in k.$list&&v.listToArray(h,b,c,d+1);if("li"===h[0].nodeName.toLowerCase()){var i={parent:a,indent:d,element:h,contents:[]};if(e)i.grandparent=e;else if(i.grandparent=a.parent(),i.grandparent&&"li"===i.grandparent[0].nodeName.toLowerCase())i.grandparent=
i.grandparent.parent();b&&m.element.setMarker(b,h,"listarray_index",c.length);c.push(i);for(var l=0,n=h.length(),o;l<n;l++)o=h.child(l),o.$element&&j[o.name()]?v.listToArray(o,b,c,d+1,i.grandparent):i.contents.push(o)}}return c},arrayToList:function(b,c,d,e,f){d||(d=0);if(!b||b.length<d+1)return null;for(var g,h=b[d].parent.getDocument(),i=new m.fragment(h),l=null,o=d,p=Math.max(b[d].indent,0),r=null,q,t,s=e==n.ENTER_P?"p":"div";;){var x=b[o];g=x.grandparent;q=x.element.getDirection(1);if(x.indent==
p){if(!l||b[o].parent.name()!=l.name())l=b[o].parent.clone(!1,1),f&&l.setProperty("dir",f),i.append(l);r=x.element.clone(0,1).appendTo(l);q!=l.getDirection(1)&&r.setProperty("dir",q);for(g=0;g<x.contents.length;g++)r.append(x.contents[g].clone(1,1));o++}else if(x.indent==Math.max(p,0)+1)t=b[o-1].element.getDirection(1),o=v.arrayToList(b,null,o,e,t!=q?q:null),!r.length()&&a.env.ie&&!(7<h[0].documentMode)&&r.append(h.createText("\u00a0")),r.append(o.listNode),o=o.nextIndex;else if(-1==x.indent&&!d&&
g){j[g.name()]?(r=x.element.clone(!1,!0),q!=g.getDirection(1)&&r.setProperty("dir",q)):r=new m.fragment(h);var l=g.getDirection(1)!=q,A=x.element,Q=A.getProperty("class"),M=A.getProperty("style"),J=r.$fragment&&(e!=n.ENTER_BR||l||M||Q),I,W=x.contents.length;for(g=0;g<W;g++){I=x.contents[g];if(I.$element&&I.isBlockBoundary()){l&&!I.getDirection()&&I.setProperty("dir",q);var U=I,V=A.getProperty("style");V&&U.setProperty("style",V.replace(/([^;])$/,"$1;")+(U.getProperty("style")||""));Q&&I.addClass(Q)}else J&&
(t||(t=h.createElement(s),l&&t.setProperty("dir",q)),M&&t.setProperty("style",M),Q&&t.setProperty("class",Q),t.append(I.clone(1,1)));r.append(t||I.clone(1,1))}r.$fragment&&o!=b.length-1&&((q=r.last())&&q.$element&&"_moz"==q.getProperty("type")&&q.dispose(),r.last(w)&&q.$element&&q.name()in k.$block||r.append(h.createElement("br")));q=r[0].nodeName.toLowerCase();!a.env.ie&&("div"===q||"p"===q)&&r.appendBogus();i.append(r);l=null;o++}else return null;t=null;if(b.length<=o||Math.max(b[o].indent,0)<p)break}if(c)for(b=
i.first();b;){if(b.$element&&(m.element.clearMarker(c,b),b.name()in k.$listItem&&(d=b,h=f=e=void 0,e=d.getDirection()))){for(f=d.parent();f&&!(h=f.getDirection());)f=f.parent();e==h&&d.removeProperty("dir")}b=b.getNextSourceNode()}return{listNode:i,nextIndex:o}}},r=/^h[1-6]$/,s=new Class({initialize:function(a,b){this.name=a;this.type=b},execute:function(a){var c=a.config,d=a.document,e=a.getSelection(),f=e&&e.getRanges(!0);if(f&&!(1>f.length)){if(this.state==n.TRISTATE_OFF)if(d=d.body(),d.first(w)){var h=
1==f.length&&f[0];(c=h&&h.getEnclosedNode())&&c.is&&c.is(this.type)&&setState.call(this,a,n.TRISTATE_ON)}else c.enterMode==n.ENTER_BR?d.appendBogus():f[0].fixBlock(1,c.enterMode==n.ENTER_P?"p":"div"),e.selectRanges(f);for(var c=e.createBookmarks(!0),d=[],i={},f=f.createIterator(),l=0;(h=f.getNextRange())&&++l;){var k=h.getBoundaryNodes(),o=k.startNode,p=k.endNode;o.is&&o.is("td")&&h.setStartAt(k.startNode,n.POSITION_AFTER_START);p.is&&p.is("td")&&h.setEndAt(k.endNode,n.POSITION_BEFORE_END);h=h.createIterator();
for(h.forceBrBreak=this.state==n.TRISTATE_OFF;k=h.getNextParagraph();)if(!k.retrieve("list_block")){m.element.setMarker(i,k,"list_block",1);for(var q=new m.elementPath(k),o=q.elements,p=0,q=q.blockLimit,t,s=o.length-1;0<=s&&(t=o[s]);s--)if(j[t.name()]&&q.contains(t)){q.eliminate("list_group_object_"+l);(o=t.retrieve("list_group_object"))?o.contents.push(k):(o={root:t,contents:[k]},d.push(o),m.element.setMarker(i,t,"list_group_object",o));p=1;break}p||(p=q,p.retrieve("list_group_object_"+l)?p.retrieve("list_group_object_"+
l).contents.push(k):(o={root:p,contents:[k]},m.element.setMarker(i,p,"list_group_object_"+l,o),d.push(o)))}}for(t=[];0<d.length;)if(o=d.shift(),this.state==n.TRISTATE_OFF)if(j[o.root.name()]){k=a;f=o;o=i;l=t;p=v.listToArray(f.root,o);q=[];for(h=0;h<f.contents.length;h++)if(s=f.contents[h],(s=s.getAscendant("li",!0))&&!s.retrieve("list_item_processed"))q.push(s),m.element.setMarker(o,s,"list_item_processed",!0);for(var s=f.root.getDocument(),x=void 0,A=void 0,h=0;h<q.length;h++){var K=q[h].retrieve("listarray_index"),
x=p[K].parent;if(!x.is(this.type))A=s.createElement(this.type),x.copyAttributes(A,{start:1,type:1}),A.removeStyle("list-style-type"),p[K].parent=A}k=v.arrayToList(p,o,null,k.config.enterMode);o=void 0;p=k.listNode.length();for(h=0;h<p&&(o=k.listNode.child(h));h++)o.name()==this.type&&l.push(o);k.listNode.replaces(f.root)}else{p=a;k=o;h=t;q=k.contents;f=k.root.getDocument();l=[];1==q.length&&q[0].equals(k.root)&&(o=f.createElement("div"),q[0].moveChildren&&q[0].moveChildren(o),q[0].append(o),q[0]=
o);k=k.contents[0].parent();for(s=0;s<q.length;s++)k=k.getCommonAncestor(q[s].parent());x=p.config.useComputedState;p=o=void 0;x=void 0===x||x;for(s=0;s<q.length;s++)for(A=q[s];K=A.parent();){if(K.equals(k)){l.push(A);!p&&A.getDirection()&&(p=1);A=A.getDirection(x);null!==o&&(o=o&&o!=A?null:A);break}A=K}if(!(1>l.length)){q=l[l.length-1].next();s=f.createElement(this.type);h.push(s);for(x=h=void 0;l.length;)h=l.shift(),x=f.createElement("li"),h.is("pre")||r.test(h.name())?h.appendTo(x):(h.copyAttributes(x),
o&&h.getDirection()&&(h.removeStyle("direction"),h.removeProperty("dir")),h.moveChildren(x),h.dispose()),x.appendTo(s);o&&p&&s.setProperty("dir",o);q?s.injectBefore(q):s.appendTo(k)}}else this.state==n.TRISTATE_ON&&j[o.root.name()]&&b.call(this,a,o,i);for(s=0;s<t.length;s++)g(t[s]);m.element.clearMarkers(i);e.selectBookmarks(c);a.focus()}}}),x=m.walker.nodeType(n.NODE_ELEMENT),t=/[\t\r\n ]*(?:&nbsp;|\xa0)$/,A;for(A in k.$listItem)h();for(A in k.$listItem)h(!0);l.plugins.implement("list",function(a){var b=
a.addCommand("numberedlist",new s("numberedlist","ol")),e=a.addCommand("bulletedlist",new s("bulletedlist","ul"));a.addEvent("selectionChange",c.bind(b));a.addEvent("selectionChange",c.bind(e));a.addEvent("keystroke",function(b){var c=b.code;if("wysiwyg"===a.mode&&c in{8:1,46:1}&&(b=this.getSelection().getRanges()[0],b.collapsed)){var e=8===c,g=this.document.body(),h=new m.walker(b.clone());h.evaluator=function(a){return w(a)&&!q(a)};c=b.clone();if(e){var l,k;if((l=(new m.elementPath(b.startContainer)).contains(j))&&
b.checkBoundaryOfElement(l,n.START)&&(l=l.parent())&&l.is("li")&&(l=i(l)))k=l,l=l.prev(w),c.moveToPosition(l&&q(l)?l:k,n.POSITION_BEFORE_START);else if(h.range.setStartAt(g,n.POSITION_AFTER_START),h.range.setEnd(b.startContainer,b.startOffset),(l=h.previous())&&l.$element&&(l.name()in j||l.is("li"))){if(!l.is("li"))h.range.selectNodeContents(l),h.reset(),h.evaluator=d,l=h.previous();k=l;c.moveToElementEditEnd(k)}k&&f(a,c,b)}else if(k=b.startContainer.getAscendant("li",1))h.range.setEndAt(g,n.POSITION_BEFORE_END),
g=(l=k.last(w))&&d(l)?l:k,e=0,(k=h.next())&&k.$element&&k.name()in j&&k.equals(l)?(e=1,k=h.next()):b.checkBoundaryOfElement(g,n.END)&&(e=1),e&&k&&(b=b.clone(),b.moveToElementEditStart(k),f(a,c,b));setTimeout(function(){a.selectionChange(1)})}})})})(Klass);
Klass.run(function(a){function c(b){if(!b||!(b.$element&&"form"===b.name()))return[];for(var c=[],d=["style","className"],e=0,f=d.length;e<f;e++){var g=b[0].elements.namedItem(d[e]);g&&(g=new a.DOM.element(g),c.push([g,g.nextSibling]),g.dispose())}return c}function b(a,b){if(a&&a.$element&&"form"===a.name()&&0<b.length)for(var c=b.length-1;0<=c;c--){var d=b[c][0],e=b[c][1];e?d.injectBefore(e):d.appendTo(a)}}function e(a,d){var e=c(a),f={},g=a[0];if(!d)f["class"]=g.className||"",g.className="";f.inline=
g.style.cssText||"";if(!d)g.style.cssText="position: static; overflow: visible";b(e);return f}function g(a,d){var e=c(a);"class"in d&&a.setProperty("class",d["class"]);"inline"in d&&a.setProperty("style",d.inline);b(e)}function h(a){if("wysiwyg"===a.mode&&!a.readOnly){var b=a.document.body();b.setProperty("contentEditable",!1);b.setProperty("contentEditable",!0)}a.focusManager.hasFocus&&a.focus()}function d(b,c){var b=b[0]||b,c=c||{x:0,y:0},d=c.x,e=c.y;a.env.ie?setTimeout(function(){b.scrollTo(d,
e)},0):b.scrollTo(d,e)}var f=a.Editor;f.plugins.implement({maximize:function(b){function c(){var a=o.getSize();k.style("width",a.x-w.x);n.style("height",a.y-w.y)}function m(){[n,k].each(function(a){g(a,a.retrieve(r));a.eliminate(r)});for(var b=k;b=b.parent();)g(b,b.retrieve(r)),b.eliminate(r);d(o,x);a.env.webkit&&(k.style("display","inline"),setTimeout(function(){k.style("display","block")},0));v.first().removeClass("kse-icon-restore");v.last().text(l.maximize);v.setProperty("title",l.maximize);o.removeEvent("resize",
c);t=!0}var l=b.lang,k=b.container,n=b.bwrap,p=k.getDocument(),o=p.getWindow(),q=p.html(),w,v,r="maximize-saved-styles",s,x,t,A=f.$.TRISTATE_OFF;b.addCommand("maximize",{readOnly:1,canUndo:!1,editorFocus:!1,execute:function(){var g;"wysiwyg"===b.mode&&(s=(g=b.getSelection())&&g.getRanges());if(!v)v=this.element;if(this.state===f.$.TRISTATE_ON)m();else if(this.state===f.$.TRISTATE_OFF){x=o.getScroll();t=null;for(g=k;g=g.parent();)g.store(r,e(g)),g.style("z-index",b.baseZIndex("MAXIMIZE"));n.store(r,
e(n,!0));k.store(r,e(k,!0));q.styles({width:0,height:0,overflow:a.env.webkit?"":"hidden"});!a.env.firefox&&q.style("position","fixed");if(!w){g=k.getSize();var p=g.x,z=n.height(),u=parseInt(k.style("width"),10),B=parseInt(n.style("height"),10);w={x:p-u,y:g.y-z-(z-B)}}k.styles({position:"absolute",top:0,left:0,zIndex:b.baseZIndex("MAXIMIZE")});c();v.first().addClass("kse-icon-restore");v.last().text(l.restore);v.setProperty("title",l.restore);o.addEvent("resize",c);a.env.firefox&&h(b)}this.toggle();
"wysiwyg"===b.mode&&(s&&(a.env.firefox&&h(b),g=b.getSelection(),g.selectRanges(s),(g=g.getStartElement())&&g.scrollIntoView(!0)),d(o,t?x:null));s=null;A=this.state}});b.addEvent("mode",function(){var a=this.getCommand("maximize");a.state!==f.$.TRISTATE_DISABLED&&a.set(A)})}})});
Klass.run(function(a){var c=a.Editor,b;c.plugins.implement("mode",function(c){c.config.editingBlock&&c.addEvents({uiReady:function(){this.setMode(this.config.startupMode)},beforeGetData:function(){!b&&this.mode&&(b=!0,this.updateData(this.getMode().getData()),b=!1)},syncData:function(a){if(!b){var h=function(){b=!0;c.getMode().loadData(a||c.getData());b=!1};this.mode?h():this.addEvent("mode",function(){this.mode&&(h(),this.removeEvent("mode",arguments.callee))})}},getSnapshot:function(a){if(this.mode)a.snapshot=
this.getMode().getSnapshotData()},loadSnapshot:function(a){this.mode&&this.getMode().loadSnapshotData(a)},mode:function(){this.removeEvent("mode",arguments.callee);a.env.webkit&&this.container.addEvent("focus",function(){c.focus()});this.config.startupFocus&&this.focus();setTimeout(function(){c.fireEvent("instanceReady");c.removeEvents("instanceReady")},0)},destroy:function(){this.mode&&this.storage.modes[this.mode].unload()}})});c.implement({mode:"",addMode:function(a,b){(this.storage.modes||(this.storage.modes=
{}))[a]=b},getMode:function(a){return this.storage.modes&&this.storage.modes[a||this.mode]},setMode:function(a){this.fireEvent("beforeSetMode");var b,c=this.bwrap,d=this.checkRecord();if(this.mode){if(a===this.mode)return;this.fireEvent("beforeModeUnload");var f=this.getMode();b=f.getData(this);f.unload();this.mode=""}c.html("");f=this.getMode(a);if(!f)throw'[Klass.Editor.editor.setMode] Unknown mode "'+a+'".';d||this.addEvent("mode",function(){this.resetRecord();this.removeEvent("mode",arguments.callee)});
f.load(c,"string"!==typeof b?this.getData():b)},focus:function(){this.forceNextSelectionCheck();var a=this.getMode();a&&a.focus()}});c.config.startupMode="wysiwyg";c.config.editingBlock=!0});
(function(a){function c(a){a.mode="html"}function b(b){var c=a.cleanWord;c?b():a.getUrl(a.config.pasteFromWordCleanupFile||this.path+"filter/default.js");return!c}a.plugins.implement({pastefromword:function(e){var g=0,h=function(){this.removeEvents({beforePaste:c,afterPaste:h});g&&setTimeout(function(){g=0},0)};e.addCommand("pastefromword",{canUndo:!1,label:e.lang.pastefromword.label,execute:function(){g=1;e.addEvents({beforePaste:c,afterPaste:h});e.execCommand("paste","html")}});e.addEvents({pasteState:function(a){this.getCommand("pastefromword").set(a)},
pasteFilter:function(c){var f;if((f=c.html)&&(g||/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(f))){var h=b(function(){if(h)e.fireEvent("paste",c);else if(!e.config.pasteFromWordPromptCleanup||g||confirm(e.lang.pastefromword.cleanup))c.html=a.cleanWord(f,e)});c.skip=h}}})}})})(Klass.Editor);
(function(a,c){var b=function(b){var c=Function.attempt(function(){var b=a.clipboardData.getData("Text");if(!b)throw 0;return b}),h=b.config.forcePasteUseDialog;if(h&&h.cantains("pastetext")||!c)return b.openDialog("pastetext"),!1;b.fireEvent("paste",{text:c});return!0};c.plugins.implement("pastetext",function(a){a.addCommand("pastetext",{execute:b,label:a.lang.pasteText});a.config.forcePasteAsPlainText&&(a.addEvent("beforeCommandExec",function(b){var c=b.commandData;"paste"===b.name&&"html"!==c&&
a.execCommand("pastetext")}),a.addEvent("beforePaste",function(a){a.mode="text"}));a.addEvent("pasteState",function(b){a.getCommand("pastetext").set(b)})})})(window,Klass.Editor);
Klass.Editor.dialog.add("pastetext",function(a){var c=a.lang,b='<p class="kse-dialog-text">{pasteMsg}</p><p class="kse-pastetext"><textarea cols="20" rows="5"></textarea></p>'.replace(/{pasteMsg}/,c.clipboard.pasteMsg);return{title:c.pasteText,width:380,contents:b,onRender:function(){var b=this.toElement().find("textarea",1);b.style("direction",a.config.contentsDirection);this.getInputElement=function(){return b}},onShow:function(){var a=this.getInputElement();a.value("");a.focus()},onOk:function(){var b=
this.getInputElement().value();setTimeout(function(){a.fireEvent("paste",{text:b})},0)}}});
Klass.Editor.plugins.implement({preview:function(a){a.addCommand("preview",{execute:function(){var c;c=a.config;var b=a.lang.preview,e=e=c.baseHref?'<base href="'+c.baseHref+'"/>':"",g=Klass.Editor.utils.isCustomDomain();if(c.fullPage)c=a.getData().replace(/<head>/,"$&"+e).replace(/[^>]*(?=<\/title>)/,b);else{var h="<body ",d=a.document&&a.document.body();d&&(d.getProperty("id")&&(h+='id="'+d.getProperty("id")+'" '),d.getProperty("class")&&(h+='class="'+d.getProperty("class")+'" '));c=c.docType+'<html dir="'+
c.contentsDirection+'"><head>'+e+"<title>"+b+"</title>"+Klass.Editor.utils.buildStyleHtml(c.contentsCss)+"</head>"+(h+">")+a.getData()+"</body></html>"}b=640;e=420;h=80;try{var f=window.screen,b=Math.round(0.8*f.width),e=Math.round(0.7*f.height),h=Math.round(0.1*f.width)}catch(i){}f="";if(g)window._kse_htmlToLoad=c,f='javascript:void((function(){document.open();document.domain="'+document.domain+'";document.write( window.opener._kse_htmlToLoad );document.close();window.opener._kse_htmlToLoad = null;})() )';
f=window.open(f,null,"toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+b+",height="+e+",left="+h);g||(f.document.open(),f.document.write(c),f.document.close())},canUndo:!1,readOny:1,modes:{wysiwyg:1,source:1}})}});
Klass.run(function(a,c){function b(a,b){var c=h.exec(a),d=h.exec(b);if(c){if(!c[2]&&"px"===d[2])return d[1];if("px"===c[2]&&!d[2])return d[1]+"px"}return b}var e=a.Editor,g=e.htmlParser.cssStyle,h=/^((?:\d*(?:\.\d+))|(?:\d+))(.*)?$/i,d={};e.plugins.implement("pseudos",function(a){a.addCSSRules("img.kse-pseudo {width: 60px; height: 60px;}");a.addEvent("afterInitPlugins",function(){var a=this.dataProcessor;(a=a&&a.htmlFilter)&&a.addRules({elements:{$:function(a){var i;var c=a.attributes;if((c=(i=(c=
c&&c["data-kse-realelement"])&&new e.htmlParser.fragment.fromHtml(decodeURIComponent(c)),c=i)&&c.children[0])&&a.attributes["data-kse-resizable"]){var d=(new g(a)).rules,a=c.attributes,f=d.width,d=d.height;f&&(a.width=b(a.width,f));d&&(a.height=b(a.height,d))}return c}}})})});e.extend({definePseudo:function(a,b){var c=b||{},e=c.extend&&this.lookupPseudo(c.extend);d[a]=e?Object.append({},e,c):c},lookupPseudo:function(a){return d[a]}});e.implement({createPseudoElement:function(a,b,c){var d=this.lang.pseudos,
d=b.getProperty("title")||d[a]||d.unknown,h=e.lookupPseudo(a),a={"class":("kse-pseudo "+(h.className||"")).trim(),"data-kse-realelement":encodeURIComponent(b.outerHTML()),"data-kse-real-node-type":b.type,src:h.image||e.getUrl("images/spacer.gif"),align:b.getProperty("align")||null,alt:d,title:d};if(h.type)a["data-kse-real-element-type"]=h.type;if(h.resizable)a["data-kse-resizable"]=h.resizable,d=new g,h=b.getProperty("width"),b=b.getProperty("height"),h&&(d.rules.width=cssLength(h)),b&&(d.rules.height=
cssLength(b)),d.populate(a);c&&Object.append(a,c);return this.document.createElement("img",a)},createPseudoParserElement:function(a,b,d){var h=this.lang.pseudos,l=b.attributes,k=e.lookupPseudo(a),a=l.title||h[a]||h.unknown,h=b.getOuterHtml(),b={"class":("kse-pseudo "+(k.className||"")).trim(),"data-kse-realelement":encodeURIComponent(h),"data-kse-real-node-type":b.type,src:k.image||e.getUrl("images/spacer.gif"),alt:a,title:a};if(l.align)b.align=l.align;if(k.type)b["data-kse-real-element-type"]=k.type;
if(k.resizable)b["data-kse-resizable"]=k.resizable,k=new g,a=l.width,l=l.height,a!==c&&(k.rules.width=cssLength(a)),l!==c&&(k.rules.height=cssLength(l)),k.populate(b);d&&Object.append(b,d);return new e.htmlParser.element("img",b)},restoreRealElement:function(c){if(c.data("kse-real-node-type")!=e.$.NODE_ELEMENT)return null;var d=a.DOM.create(decodeURIComponent(c.data("kse-realelement")),this.document);if(c.data("kse-resizable")){var g=c.style("width"),c=c.style("height");g&&d.setProperty("width",b(d.getProperty("width"),
g));c&&d.setProperty("height",b(d.getProperty("height"),c))}return d}})});
Klass.Editor.plugins.implement({removeformat:function(a){var c=Klass.Editor.constants,b=function(a,b){for(var c=a.storage.removeFormatFilters,d=0,f=c.length;d<f;d++)if(!1===c[d](b))return!1;return!0};a.addCommand("removeFormat",{execute:function(){for(var e=a.storage.removeFormatRegex||(a.storage.removeFormatRegex=RegExp("^(?:"+a.config.removeFormatTags.replace(/,/g,"|")+")$","i")),g=a.storage.removeAttributes||(a.storage.removeAttributes=a.config.removeFormatAttributes.split(",")),h=a.getSelection(),
d=h.getRanges(1),f=d.createIterator(),i;i=f.getNextRange();){i.collapsed||i.enlarge(c.ENLARGE_ELEMENT);var j=i.createBookmark(),m=j.startNode,l=j.endNode,k=function(c){for(var d=new Klass.DOM.elementPath(c),f=d.elements,g=1,h;(h=f[g])&&!h.equals(d.block)&&!h.equals(d.blockLimit);g++)e.test(h.name())&&b(a,h)&&c.breakParent(h)};k(m);if(l){k(l);for(m=m.getNextSourceNode(!0,c.NODE_ELEMENT);m&&!m.equals(l);){k=m.getNextSourceNode(!1,c.NODE_ELEMENT);if(!m.is("img")||!m.data("kse-realelement")||!b(a,m))e.test(m.name())?
m.dispose(!0):m.removeProperties(g);m=k}}i.moveToBookmark(j)}h.selectRanges(d)}});a.storage.removeFormatFilters=[]}});Klass.Editor.prototype.addRemoveFormatFilter=function(a){return this.storage.removeFormatFilters.push(a)};Klass.Editor.config.removeFormatTags="b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var";Klass.Editor.config.removeFormatAttributes="class,style,lang,width,height,align,hspace,valign";
(function(a){function c(){var b=this.getSelection();if(b&&b.document.getWindow()[0]){var c=b.getStartElement(),d=new a.DOM.elementPath(c);if(!d.compare(this.storage.selectionPreviousPath))this.storage.selectionPreviousPath=d,this.fireEvent("selectionChange",{editor:this,selection:b,path:d,element:c})}}function b(){f=!0;d||(e.call(this),d=e.delay(200,this))}function e(){d=null;f&&(c.delay(0,this),f=!1)}function g(a){return a&&a.retrieve("kse-fillingChar")}function h(a){var b=g(a);if(b&&a.eliminate("kse-fillingChar")){var c,
d=(a=a.getSelection().getSelection())&&"None"!==a.type&&a.getRangeAt(0);if(1<b.length()&&d&&d.intersectsNode(b[0])){c=[a.anchorOffset,a.focusOffset];d=a.focusNode==b[0]&&0<a.focusOffset;a.anchorNode==b[0]&&0<a.anchorOffset&&c[0]--;d&&c[1]--;var e;if(!a.isCollapsed)e=a.getRangeAt(0),e.setStart(a.anchorNode,a.anchorOffset),e.setEnd(a.focusNode,a.focusOffset),e=e.collapsed;e&&c.unshift(c.pop())}b.text(b.text().replace(/\u200B/g,""));c&&(b=a.getRangeAt(0),b.setStart(b.startContainer,c[0]),b.setEnd(b.startContainer,
c[1]),a.removeAllRanges(),a.addRange(b))}}var d,f,i={modes:{wysiwyg:1,source:1},shortcut:"a",readOnly:a.env.ie||a.env.webkit,execute:function(b){switch(b.mode){case "wysiwyg":b.document[0].execCommand("selectAll",!1,null);b.forceNextSelectionCheck();b.selectionChange();break;case "source":b=b.textarea[0],a.env.ie?b.createTextRange().execCommand("selectAll"):(b.selectionStart=0,b.selectionEnd=b.value.length),b.focus()}},canUndo:!1};a.Editor.plugins.implement("selection",function(d){if(a.env.webkit){var e,
f,k=function(){var a=d.document,b=g(a);b&&(a=a[0].defaultView.getSelection(),"Caret"===a.type&&a.anchorNode==b[0]&&(f=1),e=b.text(),b.text(e.replace(/\u200B/g,"")))},n=function(){var a=d.document,b=g(a);b&&(b.text(e),f&&(a[0].defaultView.getSelection().setPosition(b[0],b.length()),f=0))};d.addEvents({selectionChange:function(){var a=d.document,b=g(a);b&&(b.retrieve("ready")?h(a):b.store("ready",1))},beforeSetMode:function(){h(d.document)},beforeUndoImage:k,afterUndoImage:n,beforeGetData:k,getData:n})}d.addEvent("contentDOMReady",
function(){var c=d.document,e=c.html(),f=c.body();if(a.env.ie){var g,h,i=1,m=function(){h=0},k=function(){h=1;l()},l=function(a){if(h){var c=d.document,e=c.getSelection(),f=e&&e.getSelection();if(a&&f&&"None"===f.type&&!c[0].queryCommandEnabled("InsertImage"))l.delay(50,this,!0);else{var i;if(!f||!f.type||!("Control"!==f.type&&(i=f.createRange())&&(i=i.parentElement())&&(i=i.nodeName)&&i.toLowerCase()in{input:1,textarea:1}))g=f&&e.getRanges()[0],b.call(d)}}};f.addEvents({focusin:function(a){if(!(a&&
"BODY"!==a.target.nodeName))if(a=c.retrieve("kse-locked-selection"))a.unlock(1),a.lock();else if(g&&i){try{g.select()}catch(b){}g=null}},beforedeactivate:function(a){a.event.toElement||(h=0,i=1)},keyup:k,keydown:m,mousedown:m,mouseup:function(){h=1;l.delay(0,null,!0)},focus:k});e.addEvents({mouseup:function(){i=1},mousedown:function(){i=0}});a.env.ie8&&e.addEvent("mouseup",function(){var a=d.getSelection().getRanges()[0],b=a.getBoundaryNodes(),c=b.startNode,b=b.endNode;c&&c.$element&&c.equals(b)&&
c.is("img")&&(a.moveToElementEditEnd(c),a.select())});a.env.mode&&e.addEvent("mouseup",function(b){if(b.getTarget().is("html")){var b=a.Editor.document[0].selection,d=b.createRange();"None"!==b.type&&d.parentElement().ownerDocument==c[0]&&d.select()}});d.addEvent("blur",function(){try{c[0].selection.empty()}catch(a){}});c.addEvent("selectionchange",l)}else c.addEvents({keyup:b.bind(d),mouseup:b.bind(d),selectionchange:b.bind(d)})});d.addCommand("selectAll",i);d.selectionChange=function(a){(a?c:b).call(this)};
a.env.ie9&&d.addEvent("destroy",function(){var a=d.getSelection();a&&a.getSelection().clear()})})})(Klass);
Klass.run(function(a){var c=a.Editor;c.plugins.implement("sourcearea",function(b){var e=c.document.getWindow();b.addEvent("editingBlockReady",function(){var c,h;this.addMode("source",{load:function(d,f){b.textarea=c=new a.DOM.element("textarea",{dir:"ltr",role:"textbox",tabIndex:a.env.webkit?-1:b.tabIndex,readOnly:b.readOnly?"readOnly":null,"class":"kse-source kse-enable-context-menu",styles:{width:a.env.ie7?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},events:{blur:function(){b.focusManager.blur()},
focus:function(){b.focusManager.focus()}}});a.env.ie&&(h=function(){c.hide();c.styles({height:d[0].clientHeight,width:d[0].clientWidth});c.show()},b.addEvent("resize",h),e.addEvent("resize",h),setTimeout(h,0));d.html("").append(c);b.maybeRecord=!0;this.loadData(f);setTimeout(function(){b.mode="source";b.fireEvent("mode")},a.env.firefox||a.env.webkit?100:0)},unload:function(){b.textarea=c=null;h&&(b.removeEvent("resize",h),e.removeEvent("resize",h))},loadData:function(a){c.value(a)},getData:function(){return c.value()},
getSnapshotData:function(){return this.getData()},focus:function(){c.focus()}})});b.addEvents({readOnly:function(){if("source"===this.mode)this.textarea[b.readOnly?"setProperty":"removeProperty"]("readOnly","readonly")},mode:function(){this.getCommand("source").set("source"===this.mode?c.$.TRISTATE_ON:c.$.TRISTATE_OFF)}});b.addCommand("source",{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,execute:function(a){"wysiwyg"===a.mode&&a.fireEvent("saveSnapshot");a.getCommand("source").set(c.$.TRISTATE_DISABLED);
a.setMode("source"===a.mode?"wysiwyg":"source")},canUndo:!1})})});
(function(a){var c=a.Editor,b=c.constants,e=c.plugins;e.undo={};var g=/\b(?:href|src|name)="[^"]*?"/gi,h=e.undo.Image=new Class({initialize:function(b){b.fireEvent("beforeUndoImage");var c=b.getSnapshot(),d=c&&b.getSelection();a.env.ie&&c&&(c=c.replace(/\s+data-kse-expando=".*?"/g,""));this.editor=b;this.contents=c;this.bookmarks=d&&d.createBookmarks2(!0);b.fireEvent("afterUndoImage")},equals:function(b,d){var e=this.contents,f=b.contents;if(a.env.ie6||a.env.ie7)e=e.replace(g,""),f=f.replace(g,"");
if(e!=f)return!1;if(d)return!0;e=this.bookmarks;f=b.bookmarks;if(e||f){if(!e||!f||e.length!==f.length)return!1;for(var h=0,j=e.length;h<j;h++){var i=e[h],w=f[h];if(i.startOffset!=w.startOffset||i.endOffset!=w.endOffset||!c.utils.arrayCompare(i.start,w.start)||!c.utils.arrayCompare(i.end,w.end))return!1}}return!0}}),d={8:1,46:1},f={16:1,17:1,18:1},i={37:1,38:1,39:1,40:1},j=new Class({Extends:Class.Events,initialize:function(a){this.editor=a;this.reset()},type:function(b){var b=b.code,c=b in d,e=this.lastKeystroke in
d,g=c&&b==this.lastKeystroke,j=b in i,o=this.lastKeystroke in i;if(!(b in f||this.typing)||!c&&!j&&(e||o)||c&&!g){var q=new h(this.editor),w=this.snapshots.length;(function(){var b=this.editor.getSnapshot();a.env.ie&&(b=b.replace(/\s+data-kse-expando=".*?"/g,""));if(q.contents!=b&&w==this.snapshots.length)this.typing=!0,this.save(!1,q,!1)||this.snapshots.splice(this.index+1,this.snapshots.length-this.index-1),this.hasUndo=!0,this.hasRedo=!1,this.modifiersCount=this.typesCount=1,this.fireEvent("change")}).delay(0,
this)}this.lastKeystroke=b;if(c){if(this.typesCount=0,this.modifiersCount++,25<this.modifiersCount)this.save(!1,null,!1),this.modifiersCount=1}else if(!j&&(this.modifiersCount=0,this.typesCount++,25<this.typesCount))this.save(!1,null,!1),this.typesCount=1},reset:function(){this.lastKeystroke=0;this.snapshots=[];this.index=-1;this.limit=this.editor.config.undoStackSize||20;this.currentImage=null;this.hasRedo=this.hasUndo=!1;this.resetType()},resetType:function(){this.typing=!1;delete this.lastKeystroke;
this.modifiersCount=this.typesCount=0},fireChange:function(){this.hasUndo=!!this.getNextImage(!0);this.hasRedo=!!this.getNextImage(!1);this.resetType();this.fireEvent("change")},save:function(a,b,c){var d=this.snapshots;b||(b=new h(this.editor));if(!1===b.contents||this.currentImage&&b.equals(this.currentImage,a))return!1;d.splice(this.index+1,d.length-this.index-1);d.length==this.limit&&d.shift();this.index=d.push(b)-1;this.currentImage=b;!1!==c&&this.fireChange();return!0},restoreImage:function(b){var c=
this.editor,d;b.bookmarks&&(c.focus(),d=c.getSelection());this.editor.loadSnapshot(b.contents);b.bookmarks?d.selectBookmarks(b.bookmarks):a.env.ie&&(c=c.document.body()[0].createTextRange(),c.collapse(!0),c.select());this.index=b.index;this.update();this.fireChange()},getNextImage:function(a){var b=this.snapshots,c=this.currentImage,d,e;if(c)if(a)for(d=this.index-1;0<=d;d--){if(a=b[d],!c.equals(a,!0))return a.index=d,a}else for(d=this.index+1,e=b.length;d<e;d++)if(a=b[d],!c.equals(a,!0))return a.index=
d,a;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var a=this.getNextImage(!0);if(a)return this.restoreImage(a),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var a=this.getNextImage(!1);if(a)return this.restoreImage(a),!0}return!1},update:function(){this.snapshots.splice(this.index,1,this.currentImage=new h(this.editor))}});e.implement("undo",
function(a){function c(a){d.enabled&&!1!==a.canUndo&&d.save()}var d=new j(a),e=a.addCommand("undo",{execute:function(){d.undo()&&(a.selectionChange(),this.fireEvent("afterUndo"))},config:{shortcut:"z"},state:b.TRISTATE_DISABLED,canUndo:!1}),f=a.addCommand("redo",{execute:function(){d.redo()&&(a.selectionChange(),this.fireEvent("afterRedo"))},config:{shortcut:"y"},state:b.TRISTATE_DISABLED,canUndo:!1});d.addEvent("change",function(){e.set(d.undoable()?b.TRISTATE_OFF:b.TRISTATE_DISABLED);f.set(d.redoable()?
b.TRISTATE_OFF:b.TRISTATE_DISABLED)});a.addEvents({beforeCommandExec:c,afterCommandExec:c,saveSnapshot:function(a){d.save(a)},updateSnapshot:function(){d.currentImage&&d.update()},contentDOMReady:function(){a.document.addEvent("keydown",function(a){!a.control&&!a.meta&&d.type(a)})},beforeModeUnload:function(){"wysiwyg"===a.mode&&d.save(!0)},mode:function(){d.enabled=!a.readOnly&&"wysiwyg"===a.mode;d.fireEvent("change")}});a.resetUndo=function(){d.reset();a.fireEvent("saveSnapshot")}})})(Klass);
Klass.run(function(a){var c=a.Editor,b={"data-kse-widget":1};c.extend({defineWidget:function(a,b){b=b||{};b.extend="widget";if("string"===typeof a)this.definePseudo(a,b);else for(var c in a)this.definePseudo(c,Object.append(a[c],b))},lookupWidget:function(a){return this.lookupPseudo(a)}});c.implement({insertWidget:function(e,g,h){var e=c.lookupWidget(e)?e:"widget",g=Object.append(g||{},{"data-widget-type":e}),d=a.DOM.create("<kse:widget></kse:widget>",editor.document),f=d[0],i;for(i in g)f.setAttribute(i,
""+g[i]);e=this.createPseudoElement(e,d,b);h&&e.styles(h);this.insertElement(e)}});c.plugins.implement("widget",function(a){a.addCommand("widget",new c.dialogCommand("widget",{label:a.lang.widget.label}));a.addEvent("afterInitPlugins",function(){var c=this.dataProcessor,h=c&&c.dataFilter,c=c&&c.htmlFilter;h&&h.addRules({elements:{"kse:widget":function(c){return a.createPseudoParserElement(c.attributes["data-widget-type"]||"widget",c,b)}}},5);c&&c.addRules({elements:{p:function(a){var b=a.parent,c=
a.children,e=c.length;if(b){for(var a=b.children.indexOf(a)+1,g=e;g--;)if((e=c[g])&&e.$element&&e.attributes["data-kse-widget"])b.add(e,a),c.splice(g,1);if(!c.length)return!1}},"kse:widget":function(a){for(var b=a.name,c=a.parent,e=a.children,g,h=e.length;h--;)e[h].name===b&&e.splice(h,1);for(;c&&c.$element;)"p"===c.name&&(g=c),c=c.parent;if(c&&g)return b=c.children.indexOf(g)+1,c.add(a,b),!1}}})})});c.definePseudo("widget",{className:"kse-widget"});c.config.widget={}});
Klass.Editor.defineWidget({customText:{title:"Custom Text",image:Klass.Editor.getUrl("plugins/widget/images/widget1.png"),description:"Reusable pre-set format content fragment."},relatedProduct:{title:"Related Product",image:Klass.Editor.getUrl("plugins/widget/images/widget2.png"),description:"Reusable pre-set format content fragment."}});
Klass.Editor.dialog.add("widget",function(a){var c=a.lang.widget,b=a.config.widget,a=b.datasource,b=b.dataViewSize||{},e=Klass.Editor.utils.isURL(a)?'<iframe src="{datasource}" width="100%" height="{height}" frameBorder="0"></iframe>':c.emptyList;return{title:c.title,width:b.x||600,contents:e.substitute({height:b.y||400,datasource:a}),onOk:function(){this.fireEvent("complete")}}});
Klass.run(function(a){function c(a){return function(b){if("wysiwyg"===this.mode){this.focus();var c=this.getSelection(),d=c.isLocked;d&&c.unlock();this.fireEvent("saveSnapshot");a.call(this,b);d&&this.getSelection().lock();this.fireEvent.delay(0,this,"saveSnapshot")}}}function b(b){var r;this.dataProcessor&&(b=this.dataProcessor.toHTML(b));if(b){var c=this.getSelection(),d=c.getRanges()[0];if(!d.checkReadOnly()){if(j.opera&&(new a.DOM.elementPath(d.startContainer)).block)for(var e=a.htmlParser.fragment.fromHtml(b).children,
f=0,g=e.length;f<g;f++)if(e[f].isBlockLike){d.splitBlock(this.enterMode===n.ENTER_DIV?"div":"p");d.insertNode(d.document.createText(""));d.select();break}if(j.ie){e=c.getSelection();if("Control"==e.type)e.clear();else if(c.getType()==n.SELECTION_TEXT&&(r=(d=c.getRanges()[0])&&d.endContainer,c=r)&&c.$element&&"false"==c.getProperty("contenteditable")&&d.checkBoundaryOfElement(c,n.END))d.setEndAfter(d.endContainer),d.deleteContents();e.createRange().pasteHTML(b)}else this.execCommand("inserthtml",b);
j.webkit&&(c=this.getSelection(),c.scrollIntoView())}}}function e(c){var d=this.getSelection(),e=d.getStartElement().hasAscendant("pre",!0)?n.ENTER_BR:this.config.enterMode,f=e==n.ENTER_BR,c=l.htmlEncode(c.replace(/\r\n|\r/g,"\n")),c=c.replace(/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+"&nbsp;".repeat(a.length-1):"&nbsp;".repeat(a.length-1)+" "}),c=c.replace(/[ \t]{2,}/g,function(a){return"&nbsp;".repeat(a.length-1)+" "}),g=e==n.ENTER_P?"p":"div";f||(c=c.replace(/(\n{2})([\s\S]*?)(?:$|\1)/g,
function(a,b,c){return"<"+g+">"+c+"</"+g+">"}));c=c.replace(/\n/g,"<br>");!f&&!j.ie&&(c=c.replace(RegExp("<br>(?=</"+g+">)"),function(a){return a.repeat(2)}));if(j.firefox||j.webkit){for(var d=(new a.DOM.elementPath(d.getStartElement())).elements,e=[],f=0,h=d.length;f<h;f++){var i=d[f].name();if(i in p.$inline)e.unshift(d[f].outerHTML().match(/^<.*?>/));else if(i in p.$block)break}c=e.join("")+c}b.call(this,c)}function g(a){var b=this.getSelection(),c=b.getRanges(),d=a.name(),e=p.$block[d],f=b.isLocked;
f&&b.unlock();for(var g,h,j,i=c.length-1;0<=i;i--)if(g=c[i],!g.checkReadOnly()){g.deleteContents(1);h=!i&&a||a.clone(1);var k,l;if(e)for(;(k=g.getCommonAncestor(0,1))&&(l=p[k.name()])&&(!l||!l[d]);)k.name()in p.span?g.splitElement(k):g.checkStartOfBlock()&&g.checkEndOfBlock()?(g.setStartBefore(k),g.collapse(!0),k.dispose()):g.splitBlock();g.insertNode(h);j||(j=h)}j&&(g.moveToPosition(j,n.POSITION_AFTER_END),e&&(c=(a=j.next(q))&&a.$element&&a.name())&&p.$block[c]&&p[c]["#"]&&g.moveToElementEditStart(a));
b.selectRanges([g]);f&&this.getSelection().lock()}function h(a){a.checkRecord()||setTimeout(function(){a.resetRecord()},0)}function d(a){return w(a)&&v(a)}function f(b){var c=b.window,d=b.document,e=d.body(),f=e.length(),g=e.first();if(!f||1==f&&g.$element&&g.hasAttribute("_moz_editor_bogus_node")){h(b);var b=b.element.getDocument(),j=b.html(),i=j[0].scrollTop,k=j[0].scrollLeft,l=d[0].createEvent("KeyEvents");l.initKeyEvent("keypress",!0,!0,c[0],!1,!1,!1,!1,0,32);d[0].dispatchEvent(l);(i!=j[0].scrollTop||
k!=j[0].scrollLeft)&&b.getWindow()[0].scrollTo(k,i);f&&g.dispose();e.appendBogus();c=new a.DOM.range(d);c.setStartAt(e,n.POSITION_AFTER_START);c.select()}}var i=this.document,j=a.env,m=a.Editor,l=m.utils,k=m.markup,n=m.constants,p=m.dtd,o=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,q=a.DOM.walker.whitespaces(!0),w=a.DOM.walker.whitespaces(!0),v=a.DOM.walker.bookmark(!1,!0),w=a.DOM.walker.whitespaces(!0);m.plugins.implement({wysiwygarea:function(h){var s=
h.config.enterMode!==n.ENTER_BR&&!1!==h.config.autoParagraph?h.config.enterMode===n.ENTER_DIV?"div":"p":!1;h.addEvent("editingBlockReady",function(){var h,r,v,C,E,z,u=this,B=l.isCustomDomain(),H=j.webkit?-1:this.tabIndex,y=function(b){r&&r.destroy();var c="document.open();"+(B?'document.domain="'+i.domain+'";':"")+"document.close();",c=j.air?"javascript:void(0)":j.ie?"javascript:void(function(){"+encodeURIComponent(c)+"}())":"",c=k.iframeContainer.substitute({src:c,tabIndex:H});r=a.DOM.create(c);
if("chrome:"==i.location.protocol)a.support.useCapture=!0;r.addEvent("load",function(){z=!0;this.removeEvents("load");r.getFrameDocument().write(b)});if("chrome:"==i.location.protocol)a.support.useCapture=!1;h.append(r)},D=l.addFunction(function(b){if(z){z=!1;var c=b.document,d=c.body,e=!u.readOnly,g=c.getElementById("kse-script");g&&g.parentNode.removeChild(g);d.spellcheck=!u.config.disableNativeSpellChecker;if(u.config.enableLivePreview)u.config.useLivePreview=u.config.enableLivePreview&&!j.ie,
d.setAttribute("livepreview",!u.config.enableLivePreview);j.ie?(d.hideFocus=!0,d.disabled=!0,d.contentEditable=e,d.removeAttribute("disabled")):setTimeout(function(){j.firefox||j.opera?c[0].body.contentEditable=e:j.webkit?c[0].body.parentNode.contentEditable=e:c[0].designMode=e?"off":"on"},0);e&&j.firefox&&f.delay(0,null,u);b=u.window=new a.DOM.window(b);c=u.document=new a.DOM.document(c);c.addEvents({click:function(a){a.getTarget().is("a")&&!a.rightClick&&a.preventDefault()},dblclick:function(a){a=
{element:a.getTarget(),dialog:""};u.fireEvent("doubleclick",a);a.dialog&&u.openDialog(a.dialog)}});(j.webkit||j.firefox)&&c.addEvent("mousedown",function(a){a=a.getTarget();a.is("img","hr","input","textarea","select")&&u.getSelection().selectElement(a)});j.webkit&&c.addEvents({mousedown:function(){h=1},click:function(a){a.getTarget().is("input","select")&&a.preventDefault()},mouseup:function(a){a.getTarget().is("input","textarea")&&a.preventDefault()}});var h;(j.ie?r:b).addEvents({blur:function(){u.focusManager.blur()},
focus:function(){var a=u.document;j.firefox&&j.opera?a.body().focus():j.webkit&&!h&&(u.document.html().focus(),h=1);u.focusManager.focus()}});c.addEvent("keydown",function(a){u.fireEvent("keystroke",a)});e&&c.addEvent("keydown",function(c){var d=c.code;if(d in{8:1,46:1}){var e=u.getSelection(),f=e.getSelectedElement(),e=e.getRanges()[0],g=new a.DOM.elementPath(e.startContainer),h,i,k,l=8===d;if(f)u.fireEvent("saveSnapshot"),e.moveToPosition(f,n.POSITION_BEFORE_START),f.dispose(),e.select(),u.fireEvent("saveSnapshot"),
c.preventDefault();else if((h=g.block)&&e[l?"checkStartOfBlock":"checkEndOfBlock"]()&&(k=h[l?"prev":"next"](q))&&k.is("table"))u.fireEvent("saveSnapshot"),e[l?"checkEndOfBlock":"checkStartOfBlock"]()&&h.dispose(),e["moveToElementEdit"+(l?"End":"Start")](k),e.select(),u.fireEvent("saveSnapshot"),c.preventDefault();else if(g.blockLimit.is("td")&&(i=g.blockLimit.getAscendant("table"))&&e.checkBoundaryOfElement(i,l?n.START:n.END)&&(k=i[l?"prev":"next"](q)))u.fireEvent("saveSnapshot"),e["moveToElementEdit"+
(l?"End":"Start")](k),e.checkStartOfBlock()&&e.checkEndOfBlock()?k.dispose():e.select(),u.fireEvent("saveSnapshot"),c.preventDefault()}j.firefox&&d in{33:1,34:1}&&(f=this.body(),b[0].innerHeight>f[0].offsetHeight&&(e=new a.DOM.range(this),e[33===d?"moveToElementEditStart":"moveToElementEditEnd"](f),e.select(),c.preventDefault()))});if(j.ie&&"CSS1Compat"===c[0].compatMode){var i={33:1,34:1};c.addEvent("keydown",function(a){a.code in i&&setTimeout(function(){u.getSelection().scrollIntoView()},0)})}var k=
{};if(j.ie||j.webkit)k["187"]=["=","+"];var l=function(b){if("keypress"!==b.type){var c=k[b.code];return c&&a.isArray(c)?c[b.shift?1:0]:c}};c.addEvent(j.opera||j.firefox?"keypress":"keydown",function(a){var b=a.meta||a.control,c=a.shift,d=a.alt,e=l(a)||a.key,f=u.specialKeys[e],g=typeof f;if(f&&(b||c||d||"enter"===a.key)){if("function"===g)return f.call(u,a);if("object"===g&&f.keystrokes){var h=[];h.append(f.keystrokes.replace("++",function(){h.push("+");return""}).split("+"));if(h.every(function(b){return a.event[b+
"Key"]||b===e}))return!!u.execCommand(f.command,!1)}if(b)return u.execCommand(f,!1),!1}});j.ie&&u.config.enterMode!==n.ENTER_P&&c.addEvent("selectionchange",function(){var a=this.body(),b=u.getSelection(),c=b&&b.getRanges()[0];c&&a.html().match(/^<p>&nbsp;<\/p>$/i)&&c.startContainer.equals(a)&&setTimeout(function(){c=u.getSelection().getRanges()[0];c.startContainer.equals("body")||(a.first().dispose(1),c.moveToElementEditEnd(a),c.select(1))},0)});setTimeout(function(){u.fireEvent("contentDOMReady");
if(E)u.mode="wysiwyg",u.fireEvent("mode"),E=!1;v=!1;C&&(u.focus(),C=!1);try{u.execCommand("2D-position",!0)}catch(a){}try{u.execCommand("enableInlineTableEditing",!u.config.disableNativeTableHandles)}catch(b){}if(u.config.disableObjectResizing)try{u.execCommand("enableObjectResizing")}catch(c){u.document.body().addEvent(j.ie?"resizestart":"resize",function(a){a.preventDefault()})}},0)}}),F=B?'document.domain="'+i.domain+';"':"window.parent.Klass.Editor.utils.callFunction("+D+", window);";this.addEvents({insertHTML:c(b),
insertElement:c(g),insertText:c(e),selectionChange:function(b){if(!this.readOnly){var c=this.getSelection();if(c&&!c.isLocked){c=this.checkRecord();this.fireEvent("saveSnapshot",1);var e=b.editor,g=b.path,h=g.blockLimit,i=b.selection.getRanges()[0],b=e.document.body(),k=e.config.enterMode;if(j.firefox){f(e);var l=g.block||h,m=l&&l.last(d);l&&l.isBlockBoundary()&&(!m||!m.$element||!m.isBlockBoundary())&&!l.is("pre")&&!l.getBogus()&&l.appendBogus()}if(!1!==e.config.autoParagraph&&k!=n.ENTER_BR&&i.collapsed&&
h.is("body")&&!g.block){g=i.fixBlock(!0,e.config.enterMode==n.ENTER_DIV?"div":"p");j.ie&&(h=g.first(d))&&h.$text&&h.text().trim().match(/^(?:&nbsp;|\xa0)$/)&&h.dispose();if(g.outerHTML().match(o))if((h=g.next(w))&&h.$element&&(!h.isBlockBoundary()||!p.$empty[h.name()]))i.moveToElementEditStart(h),g.dispose();else if((h=g.prev(w))&&h.$element&&(!h.isBlockBoundary()||!p.$empty[h.name()]))i.moveToElementEditEnd(h),g.dispose();i.select()}i=new a.DOM.range(e.document);i.moveToElementEditEnd(e.document.body());
(new a.DOM.elementPath(i.startContainer)).blockLimit.is("body")||(e=k!=n.ENTER_BR?b.append(e.document.createElement(k==n.ENTER_P?"p":"div")):b,j.ie||e.appendBogus());this.fireEvent("updateSnapshot");!c&&this.resetRecord()}}}});this.addMode("wysiwyg",{load:function(a,b){h=a;E=u.maybeRecord=!0;this.loadData(b)},unload:function(){this.dispose();u.window=u.document=h=C=null;u.fireEvent("contentDomUnload")},getData:function(){var a=u.config,b=a.fullPage,c=b&&u.docType,d=b&&u.xmlDeclaration,e=r.getFrameDocument(),
b=b?e.html().outerHtml():e.body().html();j.firefox&&(b=b.replace(/<br>(?=\s*(:?$|<\/body>))/,""));u.dataProcessor&&(b=u.dataProcessor.toDataFormat(b,s));a.ignoreEmptyParagraph&&(b=b.replace(o,function(a,b){return b}));d&&(b=d+"\n"+b);c&&(b=c+"\n"+b);return b},loadData:function(a){v=!0;u.dataProcessor&&(a=u.dataProcessor.toHTML(a,s));j.firefox&&(a=a.replace(/<br \/>(?=\s*<\/(:?html|body)>)/,'$&<br type="_moz" />'));a=k.iframeContent.substitute({contentsCss:l.buildStyleHtml(m.getUrl(u.config.contentsCss)),
externalCss:u.storage.styles.join("\n"),direction:u.config.contentsDirection,content:a,script:F});this.dispose();y(a)},getSnapshotData:function(){return r.getFrameDocument().body().html()},loadSnapshotData:function(a){r.getFrameDocument().body().html(a)},dispose:function(){u.document&&(u.document.html().removeEvents(),u.document.body().removeEvents(),u.window.removeEvents(),u.document.removeEvents())},focus:function(){var a=u.window;if(v)C=!0;else if(a){var b=u.getSelection(),b=b&&b.getSelection();
b&&"Control"===b.type||(j.air?setTimeout(function(){a.focus()},0):a.focus(),u.selectionChange())}}})});h.addEvent("readOnly",function(){if("wysiwyg"===this.mode){var a=this.getMode();a.loadData(a.getData())}})}})});Klass.Editor.config.disableObjectResizing=!1;Klass.Editor.config.disableNativeTableHandles=!0;Klass.Editor.config.disableNativeSpellChecker=!0;Klass.Editor.config.ignoreEmptyParagraph=!0;
